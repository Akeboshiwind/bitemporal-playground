# 4 – Support null _valid_to (open-ended events)

Related issue(s): GH-4
Source of truth for task status: the external issue tracker.

---

## Task Summary

Allow `_valid_to` to be null, representing an open-ended event that extends to infinity in valid time. These events should render differently and have modified interaction behavior.

---

## Current Understanding

When `_valid_to` is null:
* Event extends to the right edge of the canvas
* No resize handle is shown
* Right edge stroke is not drawn
* Cannot be resized (no handle)
* Can be toggled via "Open" checkbox in context menu

Implementation areas:
1. **Canvas rendering** - draw open events differently
2. **Hit testing** - treat null as extending to edge, never report handle hit
3. **Move logic** - only move `_valid_from` (no width to preserve)
4. **Selection logic** - treat null as 1.0 for intersection
5. **Context menu** - add "Open" checkbox

---

## What We Need to Do

**Completed:**
1. ~~Update `draw-event!` in canvas.cljs to handle null `_valid_to`~~
2. ~~Update `hit-test` in app.cljs to handle null `_valid_to`~~
3. ~~Update move logic to handle open events (no fixed width)~~
4. ~~Update `events-in-selection` for null `_valid_to`~~
5. ~~Add "Open" checkbox to context menu~~
6. ~~Build and test~~

---

## Important Learnings

* `open?` pattern: check `(nil? _valid_to)` then use `effective-valid-to` of 1 for calculations
* When closing an open event, default to `_valid_from + 0.2` width (capped at 1.0)
* The checkbox state reflects whether ALL targeted events are open (for multi-select)

---

## Important Files / Components

* `src/app/canvas.cljs` – `draw-event!` function (handles open? rendering)
* `src/app/app.cljs`:
  * `hit-test` - uses effective-valid-to, never reports handle for open events
  * `events-in-selection` - uses effective-valid-to
  * Single/multi move logic - preserves nil for open events
  * `toggle-events-open!` - toggles _valid_to between nil and a default value
  * `color-menu` - includes "Open" checkbox

---

## Reasoning Notes

Initial document creation for task 4.

Implementation complete. All areas handle null `_valid_to` consistently using the pattern of checking `open?` and computing `effective-valid-to` where needed.
