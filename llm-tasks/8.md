# 8 â€“ Add point drawing tool

Related issue(s): #8
Source of truth for task status: the external issue tracker.

---

## Task Summary

Add a new tool that allows drawing points (coloured circles) on the canvas. Points have a context menu for changing colour or deleting. They are always drawn on top of events and are selectable/moveable with the selection tool.

---

## Current Understanding

Implemented features:
* New point tool in toolbar (circle icon) - click to place points
* Points rendered as coloured circles (8px radius)
* Points always drawn on top of events
* Context menu with colour picker and delete option (no "Open" checkbox since points don't have that concept)
* Selection tool selects and moves points (single and multi-select)
* Delete/Backspace deletes selected points
* Points persist to localStorage
* Points sync via Ably to room members

Point data structure:
* `x` - normalized 0-1 x coordinate
* `y` - normalized 0-1 y coordinate
* `color` - RGB array like events `[r g b]`

---

## What We Need to Do

All tasks completed:
- [x] Add `:points` collection to state and localStorage persistence
- [x] Add `:point` tool option and toolbar button
- [x] Implement point placement on click when point tool active
- [x] Add `draw-points!` function in canvas.cljs (circles on top of events)
- [x] Add point hit testing (`point-hit-test` function)
- [x] Extend context menu to work with points
- [x] Extend selection logic to include points (`selected-points` in drag-state)
- [x] Extend drag logic to move selected points (single and multi)
- [x] Persist points to localStorage
- [x] Sync points via Ably room broadcasting

---

## Important Learnings

* Points use the same color system as events (RGB arrays)
* Context menu uses `target-point-indices` to differentiate from event targets
* Drag state uses separate `selected-points` and `dragging-point` keys
* Point radius of 8px matches the `POINT_RADIUS` constant in app.cljs
* Hit testing for points uses elliptical distance to handle non-square aspect ratios

---

## Important Files / Components

* `src/app/app.cljs` - Main state, point tool, event handlers, context menu, Ably sync
  - `point-hit-test` - hit testing for points
  - `points-in-selection` - finds points in selection box
  - `delete-points!` - deletes points by indices
  - `set-point-colors!` - sets colors for points
* `src/app/canvas.cljs` - Canvas rendering
  - `draw-point!` - renders a single point as a circle
  - `draw-points!` - renders all points (called after events)

---

## Reasoning Notes

Points are kept separate from events because:
1. Different data structure (simple x, y vs temporal ranges)
2. Different rendering (circle vs rectangle with handle)
3. Different hit testing (radius-based vs rectangle bounds)
4. No "Open" concept (events can be open-ended, points cannot)
