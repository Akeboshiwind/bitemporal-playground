# 7 – Real-time room-based collaboration

Related issue(s): GH-7
Source of truth for task status: the external issue tracker.

---

## Task Summary

Implement real-time collaboration where multiple users in the same "room" see and edit the same canvas. Rooms are identified by codes, with random generation on page load and ability to join others' rooms.

---

## Current Understanding

Requirements:
* Random room code generated on page load
* Room code displayed in sidebar with "Join" button
* Join button opens prompt to enter different room code
* User count shows: `<users in room>/<total online>`
* All users in same room see same canvas state
* Changes sync in real-time across room members

## Technical Approach

**Channels:**
- `global` - presence for total online users count
- `room:<code>` - room-specific channel for presence + state sync

**Events:**
- `state-request` - new member requests current state
- `state-sync` - full state broadcast (used for both initial sync and updates)

**Flow:**
1. On join room: enter presence, publish `state-request`
2. Existing member with oldest join time responds with `state-sync`
3. On any local state change: publish `state-sync` with full state
4. On receive `state-sync` (from others): update local state

---

## What We Need to Do

**Completed:**
1. ~~Research Ably capabilities~~ - Using existing Pub/Sub
2. ~~Add room code generation and state~~
3. ~~Update ably.cljs with room helpers~~
4. ~~Update app.cljs for room UI and sync logic~~
5. ~~Rename presence-demo channel to "global"~~

---

## Important Files / Components

* `src/app/ably.cljs` – Ably wrapper
* `src/app/app.cljs` – state, UI

---

## Reasoning Notes

Initial document creation for task 7.

Simplified approach: only `state-sync` event (no partial updates), state is small enough to send in full each time.
