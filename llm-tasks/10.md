# 10 – Add Snap to Grid Option

Related issue(s): Task 10
Source of truth for task status: the external issue tracker.

---

## Task Summary

Add a "Snap to grid" option in the sidebar that, when enabled, makes all draggable elements (events and points) snap to grid lines when being moved or resized.

---

## Current Understanding

The app has:
- A grid with 10 divisions in both axes (configurable in `canvas.cljs`)
- Draggable events (rectangles) that can be moved and resized
- Draggable points (circles) that can be moved
- An existing settings pattern: `show-grid` checkbox that persists to localStorage

Requirements:
- Add a "Snap to grid" checkbox in the sidebar Options section
- When enabled, dragging should snap positions to grid intersections (0.1 increments in normalized coords)
- Should work for: single event move, multi-event move, single resize, multi-resize, single point move, multi-point move
- Setting should persist to localStorage like other settings

---

## What We Need to Do

1. Add `snap-to-grid` to default-settings and state initialization
2. Add `snap-to-grid` to localStorage persistence (in `save-to-storage!` and `get-persisted-state`)
3. Add a toggle function `toggle-snap-to-grid!`
4. Add checkbox UI in the sidebar Options section
5. Create a `snap-to-grid` helper function that rounds coordinates to grid divisions
6. Apply snapping in all drag handlers in `on-mouse-move`

---

## Important Learnings

- Grid has 10 divisions, so snapping should round to 0.1 increments (0.0, 0.1, 0.2, ... 1.0)
- Existing pattern: `toggle-grid!` function for toggling settings
- All drag position calculations happen in `on-mouse-move` function
- Normalized coordinates are 0..1 range

---

## Important Files / Components

* `src/app/app.cljs` – Main app with state, drag handlers, sidebar UI
* `src/app/canvas.cljs` – Canvas rendering, grid configuration

---

## Reasoning Notes

Implementation complete. All drag handlers now check the `snap-to-grid` state and apply `snap-to-grid-value` which rounds to 0.1 increments (grid divisions). The snap is applied before the boundary clamping to ensure positions stay within 0..1 range.

**Update:** Added room syncing for snap-to-grid setting:
- Moved to new "Room Settings" section in sidebar (between local options and saved states)
- Added sync icon (rotating arrows) after the label
- Setting is now broadcast via `broadcast-state!` and received via `handle-room-message`
- Changes to snap-to-grid trigger room sync via the `::sync-to-room` watch
