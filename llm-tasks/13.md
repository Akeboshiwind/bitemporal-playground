# 13 – Add DML Copy Feature for Canvas Events

Related issue(s): #13
Source of truth for task status: the external issue tracker.

---

## Task Summary

Add the ability to copy DML (Data Manipulation Language) statements representing the current events on the canvas. The DML will map normalized 0-1 coordinates to real dates based on a configurable date range.

---

## Current Understanding

Requirements (all implemented):
* New section in side panel below Room Settings (separated by dividers)
* Two date inputs: "Start" (default: 2024-01-01) and "End" (default: 2025-01-01)
* "Copy DML" button that copies INSERT statements to clipboard
* Events only (not points)
* Conversion: normalized values (0-1) map to the date range
* Open events (where `_valid_to` is nil/infinity) omit `_valid_to` from the INSERT

DML format:
```sql
INSERT INTO docs RECORDS
  {
    _id: 1,
    _valid_from: #inst "2024-01-01",
    _valid_to: #inst "2024-04-01",
    _system_from: #inst "2024-01-01",
    color: [59 130 246]
  };
```

---

## What We Need to Do

All tasks completed:
- [x] Add state atoms for `dml-start-date` and `dml-end-date`
- [x] Create date input UI components in the side panel
- [x] Implement `generate-dml` function to convert events to DML strings
- [x] Implement `copy-dml!` function to copy to clipboard
- [x] Add the new section to `side-panel` component
- [x] Build and verify

---

## Important Learnings

* Events are stored in normalized 0-1 coordinates
* Open events have `nil` for `_valid_to`
* Side panel uses Tailwind classes and dividers (`h-px bg-gray-600 my-4`) between sections
* Clipboard API: `js/navigator.clipboard.writeText`
* Date calculations use JS Date with UTC methods to avoid timezone issues
* Squint doesn't have `clojure.string/join` - use `(.join (to-array seq) separator)` instead

---

## Important Files / Components

* `src/app/app.cljs:69-82` – State atom with `dml-start-date` and `dml-end-date`
* `src/app/app.cljs:930-985` – DML export functions: `parse-date`, `format-date-for-dml`, `normalized-to-date`, `event-to-dml`, `generate-dml`, `copy-dml!`
* `src/app/app.cljs:1114-1132` – UI section with date inputs and Copy DML button

---

## Reasoning Notes

Initial implementation completed without issues. Used XTDB's `#inst` syntax for date literals in the DML output.
