# 9 â€“ Add saved states section to sidebar

Related issue(s): #9
Source of truth for task status: the external issue tracker.

---

## Task Summary

Add a new section to the sidebar for saving and loading canvas states. Users can save snapshots of the current canvas and restore them later.

---

## Current Understanding

Implemented features:
* New "Saved States" section in sidebar with divider
* "Save" button captures current canvas state with thumbnail
* Scrollable 2-column grid of saved state cards
* Each card shows thumbnail, clicking loads that state
* Red X button in top-right corner to delete (appears on hover)
* Saved states persist to localStorage under separate key

Saved state data structure:
* `id` - unique identifier (timestamp + random)
* `events` - array of events at save time
* `points` - array of points at save time
* `thumbnail` - base64 PNG data URL (120x80px)
* `timestamp` - when saved

---

## What We Need to Do

All tasks completed:
- [x] Add `:saved-states` to app state (loaded from localStorage)
- [x] Add separate localStorage key `SAVED_STATES_KEY`
- [x] Store canvas ref in state on mount for thumbnail capture
- [x] Create `save-current-state!` function with thumbnail generation
- [x] Create `load-saved-state!` function to restore state
- [x] Create `delete-saved-state!` function
- [x] Add watcher to persist saved-states changes
- [x] Add sidebar UI: divider, save button, scrollable list
- [x] Create `saved-state-card` component with thumbnail and delete button

---

## Important Learnings

* Squint has no `clj->js` or `js->clj` - data is already JS objects
* Reagami uses `:on-render` with lifecycle strings ("mount"/"update"/"unmount")
* Canvas thumbnail captured by creating temp canvas and using `drawImage` to scale
* Used `overflow-y-auto` and `min-h-0` for scrollable flex child

---

## Important Files / Components

* `src/app/app.cljs`
  - `SAVED_STATES_KEY` - localStorage key for saved states
  - `save-saved-states!` / `load-saved-states` - persistence functions
  - `capture-thumbnail` - creates scaled canvas thumbnail
  - `save-current-state!` / `load-saved-state!` / `delete-saved-state!` - state operations
  - `saved-state-card` - UI component for each saved state
  - `side-panel` - updated with saved states section

---

## Reasoning Notes

* Separate localStorage key for saved states to keep them independent from current state
* Thumbnail size 120x80 chosen for good visibility in 2-column grid while keeping data URLs small
* Canvas ref stored in state on mount to enable thumbnail capture from anywhere
