{
  "version": 3,
  "sources": ["../../node_modules/ably/build/ably.js", "../../node_modules/squint-cljs/src/squint/core.js", "../../node_modules/reagami/node_modules/squint-cljs/src/squint/core.js", "../../node_modules/reagami/lib/reagami/core.mjs", "../../build/app/ably.js", "../../build/app/canvas.js", "../../build/app/app.js"],
  "sourcesContent": [
    "/*@license Copyright 2015-2022 Ably Real-time Ltd (ably.com)\n\nAbly JavaScript Library v2.15.0\nhttps://github.com/ably/ably-js\n\nReleased under the Apache Licence v2.0*/(function (g, f) {\n    if (\"object\" == typeof exports && \"object\" == typeof module) {\n      module.exports = f();\n    } else if (\"function\" == typeof define && define.amd) {\n      define([], f);\n    } else if (\"object\" == typeof exports) {\n      exports[\"Ably\"] = f();\n    } else {\n      g[\"Ably\"] = f();\n    }\n  }(this, () => {\nvar exports = {};\nvar module = { exports };\n\"use strict\";\nvar __defProp = Object.defineProperty;\nvar __defProps = Object.defineProperties;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropDescs = Object.getOwnPropertyDescriptors;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __spreadValues = (a, b) => {\n  for (var prop in b || (b = {}))\n    if (__hasOwnProp.call(b, prop))\n      __defNormalProp(a, prop, b[prop]);\n  if (__getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(b)) {\n      if (__propIsEnum.call(b, prop))\n        __defNormalProp(a, prop, b[prop]);\n    }\n  return a;\n};\nvar __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));\nvar __objRest = (source, exclude) => {\n  var target = {};\n  for (var prop in source)\n    if (__hasOwnProp.call(source, prop) && exclude.indexOf(prop) < 0)\n      target[prop] = source[prop];\n  if (source != null && __getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(source)) {\n      if (exclude.indexOf(prop) < 0 && __propIsEnum.call(source, prop))\n        target[prop] = source[prop];\n    }\n  return target;\n};\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\n\n// src/platform/web/index.ts\nvar web_exports = {};\n__export(web_exports, {\n  ErrorInfo: () => ErrorInfo,\n  Realtime: () => DefaultRealtime,\n  Rest: () => DefaultRest,\n  default: () => web_default,\n  makeProtocolMessageFromDeserialized: () => makeFromDeserializedWithDependencies,\n  msgpack: () => msgpack_default\n});\nmodule.exports = __toCommonJS(web_exports);\n\n// src/common/platform.ts\nvar Platform = class {\n};\n\n// src/common/lib/util/logger.ts\nvar globalObject = typeof global !== \"undefined\" ? global : typeof window !== \"undefined\" ? window : self;\nfunction pad(timeSegment, three) {\n  return `${timeSegment}`.padStart(three ? 3 : 2, \"0\");\n}\nfunction getHandler(logger) {\n  return Platform.Config.logTimestamps ? function(msg) {\n    const time = /* @__PURE__ */ new Date();\n    logger(\n      pad(time.getHours()) + \":\" + pad(time.getMinutes()) + \":\" + pad(time.getSeconds()) + \".\" + pad(time.getMilliseconds(), 1) + \" \" + msg\n    );\n  } : function(msg) {\n    logger(msg);\n  };\n}\nvar getDefaultLoggers = () => {\n  var _a2;\n  let consoleLogger;\n  let errorLogger;\n  if (typeof ((_a2 = globalObject == null ? void 0 : globalObject.console) == null ? void 0 : _a2.log) === \"function\") {\n    consoleLogger = function(...args) {\n      console.log.apply(console, args);\n    };\n    errorLogger = console.warn ? function(...args) {\n      console.warn.apply(console, args);\n    } : consoleLogger;\n  } else {\n    consoleLogger = errorLogger = function() {\n    };\n  }\n  return [consoleLogger, errorLogger].map(getHandler);\n};\nvar _Logger = class _Logger {\n  constructor() {\n    this.deprecated = (description, msg) => {\n      this.deprecationWarning(`${description} is deprecated and will be removed in a future version. ${msg}`);\n    };\n    /* Where a logging operation is expensive, such as serialisation of data, use shouldLog will prevent\n      the object being serialised if the log level will not output the message */\n    this.shouldLog = (level) => {\n      return level <= this.logLevel;\n    };\n    this.setLog = (level, handler) => {\n      if (level !== void 0)\n        this.logLevel = level;\n      if (handler !== void 0)\n        this.logHandler = this.logErrorHandler = handler;\n    };\n    this.logLevel = _Logger.defaultLogLevel;\n    this.logHandler = _Logger.defaultLogHandler;\n    this.logErrorHandler = _Logger.defaultLogErrorHandler;\n  }\n  static initLogHandlers() {\n    const [logHandler, logErrorHandler] = getDefaultLoggers();\n    this.defaultLogHandler = logHandler;\n    this.defaultLogErrorHandler = logErrorHandler;\n    this.defaultLogger = new _Logger();\n  }\n  /**\n   * Calls to this method are never stripped by the `stripLogs` esbuild plugin. Use it for log statements that you wish to always be included in the modular variant of the SDK.\n   */\n  static logActionNoStrip(logger, level, action, message) {\n    logger.logAction(level, action, message);\n  }\n  logAction(level, action, message) {\n    if (this.shouldLog(level)) {\n      (level === 1 /* Error */ ? this.logErrorHandler : this.logHandler)(\"Ably: \" + action + \": \" + message, level);\n    }\n  }\n  renamedClientOption(oldName, newName) {\n    this.deprecationWarning(\n      `The \\`${oldName}\\` client option has been renamed to \\`${newName}\\`. Please update your code to use \\`${newName}\\` instead. \\`${oldName}\\` will be removed in a future version.`\n    );\n  }\n  renamedMethod(className, oldName, newName) {\n    this.deprecationWarning(\n      `\\`${className}\\`\\u2019s \\`${oldName}\\` method has been renamed to \\`${newName}\\`. Please update your code to use \\`${newName}\\` instead. \\`${oldName}\\` will be removed in a future version.`\n    );\n  }\n  deprecationWarning(message) {\n    if (this.shouldLog(1 /* Error */)) {\n      this.logErrorHandler(`Ably: Deprecation warning - ${message}`, 1 /* Error */);\n    }\n  }\n};\n_Logger.defaultLogLevel = 1 /* Error */;\n// public constants\n_Logger.LOG_NONE = 0 /* None */;\n_Logger.LOG_ERROR = 1 /* Error */;\n_Logger.LOG_MAJOR = 2 /* Major */;\n_Logger.LOG_MINOR = 3 /* Minor */;\n_Logger.LOG_MICRO = 4 /* Micro */;\n/* public static functions */\n/**\n * In the modular variant of the SDK, the `stripLogs` esbuild plugin strips out all calls to this method (when invoked as `Logger.logAction(...)`) except when called with level `Logger.LOG_ERROR`. If you wish for a log statement to never be stripped, use the {@link logActionNoStrip} method instead.\n *\n * The aforementioned plugin expects `level` to be an expression of the form `Logger.LOG_*`; that is, you canâ€™t dynamically specify the log level.\n */\n_Logger.logAction = (logger, level, action, message) => {\n  _Logger.logActionNoStrip(logger, level, action, message);\n};\nvar Logger = _Logger;\nvar logger_default = Logger;\n\n// src/common/lib/util/utils.ts\nvar utils_exports = {};\n__export(utils_exports, {\n  Format: () => Format,\n  allSame: () => allSame,\n  allToLowerCase: () => allToLowerCase,\n  allToUpperCase: () => allToUpperCase,\n  arrChooseN: () => arrChooseN,\n  arrDeleteValue: () => arrDeleteValue,\n  arrEquals: () => arrEquals,\n  arrIntersect: () => arrIntersect,\n  arrIntersectOb: () => arrIntersectOb,\n  arrPopRandomElement: () => arrPopRandomElement,\n  arrWithoutValue: () => arrWithoutValue,\n  cheapRandStr: () => cheapRandStr,\n  containsValue: () => containsValue,\n  copy: () => copy,\n  createMissingPluginError: () => createMissingPluginError,\n  dataSizeBytes: () => dataSizeBytes,\n  decodeBody: () => decodeBody,\n  encodeBody: () => encodeBody,\n  ensureArray: () => ensureArray,\n  forInOwnNonNullProperties: () => forInOwnNonNullProperties,\n  getBackoffCoefficient: () => getBackoffCoefficient,\n  getGlobalObject: () => getGlobalObject,\n  getJitterCoefficient: () => getJitterCoefficient,\n  getRetryTime: () => getRetryTime,\n  inherits: () => inherits,\n  inspectBody: () => inspectBody,\n  inspectError: () => inspectError,\n  intersect: () => intersect,\n  isEmpty: () => isEmpty,\n  isErrorInfoOrPartialErrorInfo: () => isErrorInfoOrPartialErrorInfo,\n  isNil: () => isNil,\n  isObject: () => isObject,\n  keysArray: () => keysArray,\n  matchDerivedChannel: () => matchDerivedChannel,\n  mixin: () => mixin,\n  parseQueryString: () => parseQueryString,\n  prototypicalClone: () => prototypicalClone,\n  randomString: () => randomString,\n  shallowClone: () => shallowClone,\n  shallowEquals: () => shallowEquals,\n  throwMissingPluginError: () => throwMissingPluginError,\n  toBase64: () => toBase64,\n  toQueryString: () => toQueryString,\n  valuesArray: () => valuesArray,\n  whenPromiseSettles: () => whenPromiseSettles,\n  withTimeoutAsync: () => withTimeoutAsync\n});\n\n// src/common/lib/types/errorinfo.ts\nfunction toString(err) {\n  let result = \"[\" + err.constructor.name;\n  if (err.message)\n    result += \": \" + err.message;\n  if (err.statusCode)\n    result += \"; statusCode=\" + err.statusCode;\n  if (err.code)\n    result += \"; code=\" + err.code;\n  if (err.cause)\n    result += \"; cause=\" + inspectError(err.cause);\n  if (err.href && !(err.message && err.message.indexOf(\"help.ably.io\") > -1))\n    result += \"; see \" + err.href + \" \";\n  result += \"]\";\n  return result;\n}\nvar ErrorInfo = class _ErrorInfo extends Error {\n  constructor(message, code, statusCode, cause) {\n    super(message);\n    if (typeof Object.setPrototypeOf !== \"undefined\") {\n      Object.setPrototypeOf(this, _ErrorInfo.prototype);\n    }\n    this.code = code;\n    this.statusCode = statusCode;\n    this.cause = cause;\n  }\n  toString() {\n    return toString(this);\n  }\n  static fromValues(values) {\n    const { message, code, statusCode } = values;\n    if (typeof message !== \"string\" || typeof code !== \"number\" || typeof statusCode !== \"number\") {\n      throw new Error(\"ErrorInfo.fromValues(): invalid values: \" + Platform.Config.inspect(values));\n    }\n    const result = Object.assign(new _ErrorInfo(message, code, statusCode), values);\n    if (result.code && !result.href) {\n      result.href = \"https://help.ably.io/error/\" + result.code;\n    }\n    return result;\n  }\n};\nvar PartialErrorInfo = class _PartialErrorInfo extends Error {\n  constructor(message, code, statusCode, cause) {\n    super(message);\n    if (typeof Object.setPrototypeOf !== \"undefined\") {\n      Object.setPrototypeOf(this, _PartialErrorInfo.prototype);\n    }\n    this.code = code;\n    this.statusCode = statusCode;\n    this.cause = cause;\n  }\n  toString() {\n    return toString(this);\n  }\n  static fromValues(values) {\n    const { message, code, statusCode } = values;\n    if (typeof message !== \"string\" || !isNil(code) && typeof code !== \"number\" || !isNil(statusCode) && typeof statusCode !== \"number\") {\n      throw new Error(\"PartialErrorInfo.fromValues(): invalid values: \" + Platform.Config.inspect(values));\n    }\n    const result = Object.assign(new _PartialErrorInfo(message, code, statusCode), values);\n    if (result.code && !result.href) {\n      result.href = \"https://help.ably.io/error/\" + result.code;\n    }\n    return result;\n  }\n};\n\n// src/common/lib/util/utils.ts\nfunction randomPosn(arrOrStr) {\n  return Math.floor(Math.random() * arrOrStr.length);\n}\nfunction mixin(target, ...args) {\n  for (let i = 0; i < args.length; i++) {\n    const source = args[i];\n    if (!source) {\n      break;\n    }\n    for (const key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n}\nfunction copy(src) {\n  return mixin({}, src);\n}\nfunction ensureArray(obj) {\n  if (isNil(obj)) {\n    return [];\n  }\n  if (Array.isArray(obj)) {\n    return obj;\n  }\n  return [obj];\n}\nfunction isObject(ob) {\n  return Object.prototype.toString.call(ob) == \"[object Object]\";\n}\nfunction isEmpty(ob) {\n  for (const prop in ob)\n    return false;\n  return true;\n}\nfunction isNil(arg) {\n  return arg == null;\n}\nfunction shallowClone(ob) {\n  const result = new Object();\n  for (const prop in ob)\n    result[prop] = ob[prop];\n  return result;\n}\nfunction prototypicalClone(ob, ownProperties) {\n  class F {\n  }\n  F.prototype = ob;\n  const result = new F();\n  if (ownProperties)\n    mixin(result, ownProperties);\n  return result;\n}\nvar inherits = function(ctor, superCtor) {\n  if (Platform.Config.inherits) {\n    Platform.Config.inherits(ctor, superCtor);\n    return;\n  }\n  ctor.super_ = superCtor;\n  ctor.prototype = prototypicalClone(superCtor.prototype, { constructor: ctor });\n};\nfunction containsValue(ob, val) {\n  for (const i in ob) {\n    if (ob[i] == val)\n      return true;\n  }\n  return false;\n}\nfunction intersect(arr, ob) {\n  return Array.isArray(ob) ? arrIntersect(arr, ob) : arrIntersectOb(arr, ob);\n}\nfunction arrIntersect(arr1, arr2) {\n  const result = [];\n  for (let i = 0; i < arr1.length; i++) {\n    const member = arr1[i];\n    if (arr2.indexOf(member) != -1)\n      result.push(member);\n  }\n  return result;\n}\nfunction arrIntersectOb(arr, ob) {\n  const result = [];\n  for (let i = 0; i < arr.length; i++) {\n    const member = arr[i];\n    if (member in ob)\n      result.push(member);\n  }\n  return result;\n}\nfunction arrDeleteValue(arr, val) {\n  const idx = arr.indexOf(val);\n  const res = idx != -1;\n  if (res)\n    arr.splice(idx, 1);\n  return res;\n}\nfunction arrWithoutValue(arr, val) {\n  const newArr = arr.slice();\n  arrDeleteValue(newArr, val);\n  return newArr;\n}\nfunction keysArray(ob, ownOnly) {\n  const result = [];\n  for (const prop in ob) {\n    if (ownOnly && !Object.prototype.hasOwnProperty.call(ob, prop))\n      continue;\n    result.push(prop);\n  }\n  return result;\n}\nfunction valuesArray(ob, ownOnly) {\n  const result = [];\n  for (const prop in ob) {\n    if (ownOnly && !Object.prototype.hasOwnProperty.call(ob, prop))\n      continue;\n    result.push(ob[prop]);\n  }\n  return result;\n}\nfunction forInOwnNonNullProperties(ob, fn) {\n  for (const prop in ob) {\n    if (Object.prototype.hasOwnProperty.call(ob, prop) && ob[prop]) {\n      fn(prop);\n    }\n  }\n}\nfunction allSame(arr, prop) {\n  if (arr.length === 0) {\n    return true;\n  }\n  const first = arr[0][prop];\n  return arr.every(function(item) {\n    return item[prop] === first;\n  });\n}\nvar Format = /* @__PURE__ */ ((Format2) => {\n  Format2[\"msgpack\"] = \"msgpack\";\n  Format2[\"json\"] = \"json\";\n  return Format2;\n})(Format || {});\nfunction arrPopRandomElement(arr) {\n  return arr.splice(randomPosn(arr), 1)[0];\n}\nfunction toQueryString(params) {\n  const parts = [];\n  if (params) {\n    for (const key in params)\n      parts.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]));\n  }\n  return parts.length ? \"?\" + parts.join(\"&\") : \"\";\n}\nfunction parseQueryString(query) {\n  let match;\n  const search = /([^?&=]+)=?([^&]*)/g;\n  const result = {};\n  while (match = search.exec(query))\n    result[decodeURIComponent(match[1])] = decodeURIComponent(match[2]);\n  return result;\n}\nfunction isErrorInfoOrPartialErrorInfo(err) {\n  return typeof err == \"object\" && err !== null && (err instanceof ErrorInfo || err instanceof PartialErrorInfo);\n}\nfunction inspectError(err) {\n  var _a2, _b;\n  if (err instanceof Error || ((_a2 = err == null ? void 0 : err.constructor) == null ? void 0 : _a2.name) === \"ErrorInfo\" || ((_b = err == null ? void 0 : err.constructor) == null ? void 0 : _b.name) === \"PartialErrorInfo\")\n    return err.toString();\n  return Platform.Config.inspect(err);\n}\nfunction inspectBody(body) {\n  if (Platform.BufferUtils.isBuffer(body)) {\n    return body.toString();\n  } else if (typeof body === \"string\") {\n    return body;\n  } else {\n    return Platform.Config.inspect(body);\n  }\n}\nfunction dataSizeBytes(data) {\n  if (Platform.BufferUtils.isBuffer(data)) {\n    return Platform.BufferUtils.byteLength(data);\n  }\n  if (typeof data === \"string\") {\n    return Platform.Config.stringByteSize(data);\n  }\n  if (typeof data === \"number\") {\n    return 8;\n  }\n  if (typeof data === \"boolean\") {\n    return 1;\n  }\n  throw new Error(\n    `Expected input of Utils.dataSizeBytes to be a string, a number, a boolean or a buffer, but was: ${typeof data}`\n  );\n}\nfunction cheapRandStr() {\n  return String(Math.random()).substr(2);\n}\nvar randomString = async (numBytes) => {\n  const buffer = await Platform.Config.getRandomArrayBuffer(numBytes);\n  return Platform.BufferUtils.base64Encode(buffer);\n};\nfunction arrChooseN(arr, n2) {\n  const numItems = Math.min(n2, arr.length), mutableArr = arr.slice(), result = [];\n  for (let i = 0; i < numItems; i++) {\n    result.push(arrPopRandomElement(mutableArr));\n  }\n  return result;\n}\nfunction whenPromiseSettles(promise, callback) {\n  promise.then((result) => {\n    callback == null ? void 0 : callback(null, result);\n  }).catch((err) => {\n    callback == null ? void 0 : callback(err);\n  });\n}\nfunction decodeBody(body, MsgPack, format) {\n  if (format == \"msgpack\") {\n    if (!MsgPack) {\n      throwMissingPluginError(\"MsgPack\");\n    }\n    return MsgPack.decode(body);\n  }\n  return JSON.parse(String(body));\n}\nfunction encodeBody(body, MsgPack, format) {\n  if (format == \"msgpack\") {\n    if (!MsgPack) {\n      throwMissingPluginError(\"MsgPack\");\n    }\n    return MsgPack.encode(body, true);\n  }\n  return JSON.stringify(body);\n}\nfunction allToLowerCase(arr) {\n  return arr.map(function(element) {\n    return element && element.toLowerCase();\n  });\n}\nfunction allToUpperCase(arr) {\n  return arr.map(function(element) {\n    return element && element.toUpperCase();\n  });\n}\nfunction getBackoffCoefficient(count) {\n  return Math.min((count + 2) / 3, 2);\n}\nfunction getJitterCoefficient() {\n  return 1 - Math.random() * 0.2;\n}\nfunction getRetryTime(initialTimeout, retryAttempt) {\n  return initialTimeout * getBackoffCoefficient(retryAttempt) * getJitterCoefficient();\n}\nfunction getGlobalObject() {\n  if (typeof global !== \"undefined\") {\n    return global;\n  }\n  if (typeof window !== \"undefined\") {\n    return window;\n  }\n  return self;\n}\nfunction shallowEquals(source, target) {\n  return Object.keys(source).every((key) => source[key] === target[key]) && Object.keys(target).every((key) => target[key] === source[key]);\n}\nfunction matchDerivedChannel(name) {\n  const regex = /^(\\[([^?]*)(?:(.*))\\])?(.+)$/;\n  const match = name.match(regex);\n  if (!match || !match.length || match.length < 5) {\n    throw new ErrorInfo(\"regex match failed\", 400, 40010);\n  }\n  if (match[2]) {\n    throw new ErrorInfo(`cannot use a derived option with a ${match[2]} channel`, 400, 40010);\n  }\n  return {\n    qualifierParam: match[3] || \"\",\n    channelName: match[4]\n  };\n}\nfunction toBase64(str) {\n  const bufferUtils = Platform.BufferUtils;\n  const textBuffer = bufferUtils.utf8Encode(str);\n  return bufferUtils.base64Encode(textBuffer);\n}\nfunction arrEquals(a, b) {\n  return a.length === b.length && a.every(function(val, i) {\n    return val === b[i];\n  });\n}\nfunction createMissingPluginError(pluginName) {\n  return new ErrorInfo(`${pluginName} plugin not provided`, 40019, 400);\n}\nfunction throwMissingPluginError(pluginName) {\n  throw createMissingPluginError(pluginName);\n}\nasync function withTimeoutAsync(promise, timeout = 5e3, err = \"Timeout expired\") {\n  const e = new ErrorInfo(err, 5e4, 500);\n  return Promise.race([promise, new Promise((_resolve, reject) => setTimeout(() => reject(e), timeout))]);\n}\n\n// package.json\nvar version = \"2.15.0\";\n\n// src/common/lib/util/defaults.ts\nvar agent = \"ably-js/\" + version;\nvar Defaults = {\n  ENDPOINT: \"main\",\n  ENVIRONMENT: \"\",\n  REST_HOST: \"rest.ably.io\",\n  REALTIME_HOST: \"realtime.ably.io\",\n  FALLBACK_HOSTS: [\n    \"main.a.fallback.ably-realtime.com\",\n    \"main.b.fallback.ably-realtime.com\",\n    \"main.c.fallback.ably-realtime.com\",\n    \"main.d.fallback.ably-realtime.com\",\n    \"main.e.fallback.ably-realtime.com\"\n  ],\n  PORT: 80,\n  TLS_PORT: 443,\n  TIMEOUTS: {\n    /* Documented as options params: */\n    disconnectedRetryTimeout: 15e3,\n    suspendedRetryTimeout: 3e4,\n    /* Undocumented, but part of the api and can be used by customers: */\n    httpRequestTimeout: 1e4,\n    httpMaxRetryDuration: 15e3,\n    channelRetryTimeout: 15e3,\n    fallbackRetryTimeout: 6e5,\n    /* For internal / test use only: */\n    connectionStateTtl: 12e4,\n    realtimeRequestTimeout: 1e4,\n    recvTimeout: 9e4,\n    webSocketConnectTimeout: 1e4,\n    webSocketSlowTimeout: 4e3\n  },\n  httpMaxRetryCount: 3,\n  maxMessageSize: 65536,\n  version,\n  protocolVersion: 4,\n  agent,\n  getPort,\n  getHttpScheme,\n  getPrimaryDomainFromEndpoint,\n  getEndpointFallbackHosts,\n  getFallbackHosts,\n  getHosts,\n  checkHost,\n  objectifyOptions,\n  normaliseOptions,\n  defaultGetHeaders,\n  defaultPostHeaders\n};\nfunction getPort(options, tls) {\n  return tls || options.tls ? options.tlsPort : options.port;\n}\nfunction getHttpScheme(options) {\n  return options.tls ? \"https://\" : \"http://\";\n}\nfunction isFqdnIpOrLocalhost(endpoint) {\n  return endpoint.includes(\".\") || endpoint.includes(\"::\") || endpoint === \"localhost\";\n}\nfunction getPrimaryDomainFromEndpoint(endpoint) {\n  if (isFqdnIpOrLocalhost(endpoint))\n    return endpoint;\n  if (endpoint.startsWith(\"nonprod:\")) {\n    const routingPolicyId = endpoint.replace(\"nonprod:\", \"\");\n    return `${routingPolicyId}.realtime.ably-nonprod.net`;\n  }\n  return `${endpoint}.realtime.ably.net`;\n}\nfunction getEndpointFallbackHosts(endpoint) {\n  if (isFqdnIpOrLocalhost(endpoint))\n    return [];\n  if (endpoint.startsWith(\"nonprod:\")) {\n    const routingPolicyId = endpoint.replace(\"nonprod:\", \"\");\n    return endpointFallbacks(routingPolicyId, \"ably-realtime-nonprod.com\");\n  }\n  return endpointFallbacks(endpoint, \"ably-realtime.com\");\n}\nfunction endpointFallbacks(routingPolicyId, domain) {\n  return [\"a\", \"b\", \"c\", \"d\", \"e\"].map((id) => `${routingPolicyId}.${id}.fallback.${domain}`);\n}\nfunction getFallbackHosts(options) {\n  const fallbackHosts = options.fallbackHosts, httpMaxRetryCount = typeof options.httpMaxRetryCount !== \"undefined\" ? options.httpMaxRetryCount : Defaults.httpMaxRetryCount;\n  return fallbackHosts ? arrChooseN(fallbackHosts, httpMaxRetryCount) : [];\n}\nfunction getHosts(options) {\n  return [options.primaryDomain].concat(getFallbackHosts(options));\n}\nfunction checkHost(host) {\n  if (typeof host !== \"string\") {\n    throw new ErrorInfo(\"host must be a string; was a \" + typeof host, 4e4, 400);\n  }\n  if (!host.length) {\n    throw new ErrorInfo(\"host must not be zero-length\", 4e4, 400);\n  }\n}\nfunction getTimeouts(options) {\n  const timeouts = {};\n  for (const prop in Defaults.TIMEOUTS) {\n    timeouts[prop] = options[prop] || Defaults.TIMEOUTS[prop];\n  }\n  return timeouts;\n}\nfunction getAgentString(options) {\n  let agentStr = Defaults.agent;\n  if (options.agents) {\n    for (var agent2 in options.agents) {\n      agentStr += \" \" + agent2 + \"/\" + options.agents[agent2];\n    }\n  }\n  return agentStr;\n}\nfunction objectifyOptions(options, allowKeyOrToken, sourceForErrorMessage, logger, modularPluginsToInclude) {\n  if (options === void 0) {\n    const msg = allowKeyOrToken ? `${sourceForErrorMessage} must be initialized with either a client options object, an Ably API key, or an Ably Token` : `${sourceForErrorMessage} must be initialized with a client options object`;\n    logger_default.logAction(logger, logger_default.LOG_ERROR, `${sourceForErrorMessage}()`, msg);\n    throw new Error(msg);\n  }\n  let optionsObj;\n  if (typeof options === \"string\") {\n    if (options.indexOf(\":\") == -1) {\n      if (!allowKeyOrToken) {\n        const msg = `${sourceForErrorMessage} cannot be initialized with just an Ably Token; you must provide a client options object with a \\`plugins\\` property. (Set this Ably Token as the object\\u2019s \\`token\\` property.)`;\n        logger_default.logAction(logger, logger_default.LOG_ERROR, `${sourceForErrorMessage}()`, msg);\n        throw new Error(msg);\n      }\n      optionsObj = { token: options };\n    } else {\n      if (!allowKeyOrToken) {\n        const msg = `${sourceForErrorMessage} cannot be initialized with just an Ably API key; you must provide a client options object with a \\`plugins\\` property. (Set this Ably API key as the object\\u2019s \\`key\\` property.)`;\n        logger_default.logAction(logger, logger_default.LOG_ERROR, `${sourceForErrorMessage}()`, msg);\n        throw new Error(msg);\n      }\n      optionsObj = { key: options };\n    }\n  } else {\n    optionsObj = options;\n  }\n  if (modularPluginsToInclude) {\n    optionsObj = __spreadProps(__spreadValues({}, optionsObj), { plugins: __spreadValues(__spreadValues({}, modularPluginsToInclude), optionsObj.plugins) });\n  }\n  return optionsObj;\n}\nfunction checkIfClientOptionsAreValid(options) {\n  if (options.endpoint && (options.environment || options.restHost || options.realtimeHost)) {\n    throw new ErrorInfo(\n      \"The `endpoint` option cannot be used in conjunction with the `environment`, `restHost`, or `realtimeHost` options.\",\n      40106,\n      400\n    );\n  }\n  if (options.environment && (options.restHost || options.realtimeHost)) {\n    throw new ErrorInfo(\n      \"The `environment` option cannot be used in conjunction with the `restHost`, or `realtimeHost` options.\",\n      40106,\n      400\n    );\n  }\n}\nfunction normaliseOptions(options, MsgPack, logger) {\n  const loggerToUse = logger != null ? logger : logger_default.defaultLogger;\n  if (options.environment) {\n    loggerToUse.deprecated(\"The `environment` client option\", \"Use the `endpoint` client option instead.\");\n  }\n  if (options.restHost) {\n    loggerToUse.deprecated(\"The `restHost` client option\", \"Use the `endpoint` client option instead.\");\n  }\n  if (options.realtimeHost) {\n    loggerToUse.deprecated(\"The `realtimeHost` client option\", \"Use the `endpoint` client option instead.\");\n  }\n  checkIfClientOptionsAreValid(options);\n  if (typeof options.recover === \"function\" && options.closeOnUnload === true) {\n    logger_default.logAction(\n      loggerToUse,\n      logger_default.LOG_ERROR,\n      \"Defaults.normaliseOptions\",\n      \"closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter\"\n    );\n    options.recover = void 0;\n  }\n  if (!(\"closeOnUnload\" in options)) {\n    options.closeOnUnload = !options.recover;\n  }\n  if (!(\"queueMessages\" in options))\n    options.queueMessages = true;\n  const endpoint = options.endpoint || Defaults.ENDPOINT;\n  if (!options.fallbackHosts && !options.restHost && !options.realtimeHost && !options.port && !options.tlsPort) {\n    options.fallbackHosts = getEndpointFallbackHosts(options.environment || endpoint);\n  }\n  const primaryDomainFromEnvironment = options.environment && `${options.environment}.realtime.ably.net`;\n  const primaryDomainFromLegacyOptions = options.restHost || options.realtimeHost || primaryDomainFromEnvironment;\n  const primaryDomain = primaryDomainFromLegacyOptions || getPrimaryDomainFromEndpoint(endpoint);\n  (options.fallbackHosts || []).concat(primaryDomain).forEach(checkHost);\n  options.port = options.port || Defaults.PORT;\n  options.tlsPort = options.tlsPort || Defaults.TLS_PORT;\n  if (!(\"tls\" in options))\n    options.tls = true;\n  const timeouts = getTimeouts(options);\n  if (MsgPack) {\n    if (\"useBinaryProtocol\" in options) {\n      options.useBinaryProtocol = Platform.Config.supportsBinary && options.useBinaryProtocol;\n    } else {\n      options.useBinaryProtocol = Platform.Config.preferBinary;\n    }\n  } else {\n    options.useBinaryProtocol = false;\n  }\n  const headers = {};\n  if (options.clientId) {\n    headers[\"X-Ably-ClientId\"] = Platform.BufferUtils.base64Encode(Platform.BufferUtils.utf8Encode(options.clientId));\n  }\n  if (!(\"idempotentRestPublishing\" in options)) {\n    options.idempotentRestPublishing = true;\n  }\n  let connectivityCheckParams = null;\n  let connectivityCheckUrl = options.connectivityCheckUrl;\n  if (options.connectivityCheckUrl) {\n    let [uri, qs] = options.connectivityCheckUrl.split(\"?\");\n    connectivityCheckParams = qs ? parseQueryString(qs) : {};\n    if (uri.indexOf(\"://\") === -1) {\n      uri = \"https://\" + uri;\n    }\n    connectivityCheckUrl = uri;\n  }\n  let wsConnectivityCheckUrl = options.wsConnectivityCheckUrl;\n  if (wsConnectivityCheckUrl && wsConnectivityCheckUrl.indexOf(\"://\") === -1) {\n    wsConnectivityCheckUrl = \"wss://\" + wsConnectivityCheckUrl;\n  }\n  return __spreadProps(__spreadValues({}, options), {\n    primaryDomain,\n    maxMessageSize: options.maxMessageSize || Defaults.maxMessageSize,\n    timeouts,\n    connectivityCheckParams,\n    connectivityCheckUrl,\n    wsConnectivityCheckUrl,\n    headers\n  });\n}\nfunction normaliseChannelOptions(Crypto2, logger, options) {\n  const channelOptions = options || {};\n  if (channelOptions.cipher) {\n    if (!Crypto2)\n      throwMissingPluginError(\"Crypto\");\n    const cipher = Crypto2.getCipher(channelOptions.cipher, logger);\n    channelOptions.cipher = cipher.cipherParams;\n    channelOptions.channelCipher = cipher.cipher;\n  } else if (\"cipher\" in channelOptions) {\n    channelOptions.cipher = void 0;\n    channelOptions.channelCipher = null;\n  }\n  return channelOptions;\n}\nvar contentTypes = {\n  json: \"application/json\",\n  xml: \"application/xml\",\n  html: \"text/html\",\n  msgpack: \"application/x-msgpack\",\n  text: \"text/plain\"\n};\nvar defaultHeadersOptions = {\n  format: \"json\" /* json */,\n  protocolVersion: Defaults.protocolVersion\n};\nfunction defaultGetHeaders(options, { format, protocolVersion = defaultHeadersOptions.protocolVersion } = {}) {\n  const accept = contentTypes[format != null ? format : options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */];\n  return {\n    accept,\n    \"X-Ably-Version\": protocolVersion.toString(),\n    \"Ably-Agent\": getAgentString(options)\n  };\n}\nfunction defaultPostHeaders(options, { format, protocolVersion = defaultHeadersOptions.protocolVersion } = {}) {\n  const accept = contentTypes[format != null ? format : options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */];\n  const contentType = accept;\n  return {\n    accept,\n    \"content-type\": contentType,\n    \"X-Ably-Version\": protocolVersion.toString(),\n    \"Ably-Agent\": getAgentString(options)\n  };\n}\nvar defaults_default = Defaults;\nfunction getDefaults(platformDefaults) {\n  return Object.assign(Defaults, platformDefaults);\n}\n\n// src/common/lib/util/multicaster.ts\nvar Multicaster = class _Multicaster {\n  // Private constructor; use static Multicaster.create instead\n  constructor(logger, members) {\n    this.logger = logger;\n    this.members = members || [];\n  }\n  call(err, result) {\n    for (const member of this.members) {\n      if (member) {\n        try {\n          member(err, result);\n        } catch (e) {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_ERROR,\n            \"Multicaster multiple callback handler\",\n            \"Unexpected exception: \" + e + \"; stack = \" + e.stack\n          );\n        }\n      }\n    }\n  }\n  push(...args) {\n    this.members.push(...args);\n  }\n  createPromise() {\n    return new Promise((resolve, reject) => {\n      this.push((err, result) => {\n        err ? reject(err) : resolve(result);\n      });\n    });\n  }\n  resolveAll(result) {\n    this.call(null, result);\n  }\n  rejectAll(err) {\n    this.call(err);\n  }\n  static create(logger, members) {\n    const instance = new _Multicaster(logger, members);\n    return Object.assign((err, result) => instance.call(err, result), {\n      push: (fn) => instance.push(fn),\n      createPromise: () => instance.createPromise(),\n      resolveAll: (result) => instance.resolveAll(result),\n      rejectAll: (err) => instance.rejectAll(err)\n    });\n  }\n};\nvar multicaster_default = Multicaster;\n\n// src/common/constants/HttpMethods.ts\nvar HttpMethods = /* @__PURE__ */ ((HttpMethods2) => {\n  HttpMethods2[\"Get\"] = \"get\";\n  HttpMethods2[\"Delete\"] = \"delete\";\n  HttpMethods2[\"Post\"] = \"post\";\n  HttpMethods2[\"Put\"] = \"put\";\n  HttpMethods2[\"Patch\"] = \"patch\";\n  return HttpMethods2;\n})(HttpMethods || {});\nvar HttpMethods_default = HttpMethods;\n\n// src/common/constants/HttpStatusCodes.ts\nvar HttpStatusCodes = /* @__PURE__ */ ((HttpStatusCodes2) => {\n  HttpStatusCodes2[HttpStatusCodes2[\"Success\"] = 200] = \"Success\";\n  HttpStatusCodes2[HttpStatusCodes2[\"NoContent\"] = 204] = \"NoContent\";\n  HttpStatusCodes2[HttpStatusCodes2[\"BadRequest\"] = 400] = \"BadRequest\";\n  HttpStatusCodes2[HttpStatusCodes2[\"Unauthorized\"] = 401] = \"Unauthorized\";\n  HttpStatusCodes2[HttpStatusCodes2[\"Forbidden\"] = 403] = \"Forbidden\";\n  HttpStatusCodes2[HttpStatusCodes2[\"RequestTimeout\"] = 408] = \"RequestTimeout\";\n  HttpStatusCodes2[HttpStatusCodes2[\"InternalServerError\"] = 500] = \"InternalServerError\";\n  return HttpStatusCodes2;\n})(HttpStatusCodes || {});\nfunction isSuccessCode(statusCode) {\n  return statusCode >= 200 /* Success */ && statusCode < 400 /* BadRequest */;\n}\nvar HttpStatusCodes_default = HttpStatusCodes;\n\n// src/common/lib/client/auth.ts\nvar MAX_TOKEN_LENGTH = Math.pow(2, 17);\nfunction random() {\n  return (\"000000\" + Math.floor(Math.random() * 1e16)).slice(-16);\n}\nfunction isRealtime(client) {\n  return !!client.connection;\n}\nfunction normaliseAuthcallbackError(err) {\n  if (!isErrorInfoOrPartialErrorInfo(err)) {\n    return new ErrorInfo(inspectError(err), err.code || 40170, err.statusCode || 401);\n  }\n  if (!err.code) {\n    if (err.statusCode === 403) {\n      err.code = 40300;\n    } else {\n      err.code = 40170;\n      err.statusCode = 401;\n    }\n  }\n  return err;\n}\nvar hmac = (text, key) => {\n  const bufferUtils = Platform.BufferUtils;\n  const textBuffer = bufferUtils.utf8Encode(text);\n  const keyBuffer = bufferUtils.utf8Encode(key);\n  const digest = bufferUtils.hmacSha256(textBuffer, keyBuffer);\n  return bufferUtils.base64Encode(digest);\n};\nfunction c14n(capability) {\n  if (!capability)\n    return \"\";\n  if (typeof capability == \"string\")\n    capability = JSON.parse(capability);\n  const c14nCapability = /* @__PURE__ */ Object.create(null);\n  const keys = keysArray(capability, true);\n  if (!keys)\n    return \"\";\n  keys.sort();\n  for (let i = 0; i < keys.length; i++) {\n    c14nCapability[keys[i]] = capability[keys[i]].sort();\n  }\n  return JSON.stringify(c14nCapability);\n}\nfunction logAndValidateTokenAuthMethod(authOptions, logger) {\n  if (authOptions.authCallback) {\n    logger_default.logAction(logger, logger_default.LOG_MINOR, \"Auth()\", \"using token auth with authCallback\");\n  } else if (authOptions.authUrl) {\n    logger_default.logAction(logger, logger_default.LOG_MINOR, \"Auth()\", \"using token auth with authUrl\");\n  } else if (authOptions.key) {\n    logger_default.logAction(logger, logger_default.LOG_MINOR, \"Auth()\", \"using token auth with client-side signing\");\n  } else if (authOptions.tokenDetails) {\n    logger_default.logAction(logger, logger_default.LOG_MINOR, \"Auth()\", \"using token auth with supplied token only\");\n  } else {\n    const msg = \"authOptions must include valid authentication parameters\";\n    logger_default.logAction(logger, logger_default.LOG_ERROR, \"Auth()\", msg);\n    throw new Error(msg);\n  }\n}\nfunction basicAuthForced(options) {\n  return \"useTokenAuth\" in options && !options.useTokenAuth;\n}\nfunction useTokenAuth(options) {\n  return options.useTokenAuth || !basicAuthForced(options) && (options.authCallback || options.authUrl || options.token || options.tokenDetails);\n}\nfunction noWayToRenew(options) {\n  return !options.key && !options.authCallback && !options.authUrl;\n}\nvar trId = 0;\nfunction getTokenRequestId() {\n  return trId++;\n}\nvar Auth = class {\n  constructor(client, options) {\n    // This initialization is always overwritten and only used to prevent a TypeScript compiler error\n    this.authOptions = {};\n    this.client = client;\n    this.tokenParams = options.defaultTokenParams || {};\n    this.currentTokenRequestId = null;\n    this.waitingForTokenRequest = null;\n    if (useTokenAuth(options)) {\n      if (noWayToRenew(options)) {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_ERROR,\n          \"Auth()\",\n          \"Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help\"\n        );\n      }\n      this._saveTokenOptions(options.defaultTokenParams, options);\n      logAndValidateTokenAuthMethod(this.authOptions, this.logger);\n    } else {\n      if (!options.key) {\n        const msg = \"No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)\";\n        logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"Auth()\", msg);\n        throw new ErrorInfo(msg, 40160, 401);\n      }\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Auth()\", \"anonymous, using basic auth\");\n      this._saveBasicOptions(options);\n    }\n  }\n  get logger() {\n    return this.client.logger;\n  }\n  async authorize(tokenParams, authOptions) {\n    if (authOptions && authOptions.key && this.authOptions.key !== authOptions.key) {\n      throw new ErrorInfo(\"Unable to update auth options with incompatible key\", 40102, 401);\n    }\n    try {\n      let tokenDetails = await this._forceNewToken(tokenParams != null ? tokenParams : null, authOptions != null ? authOptions : null);\n      if (isRealtime(this.client)) {\n        return new Promise((resolve, reject) => {\n          this.client.connection.connectionManager.onAuthUpdated(\n            tokenDetails,\n            (err, tokenDetails2) => err ? reject(err) : resolve(tokenDetails2)\n          );\n        });\n      } else {\n        return tokenDetails;\n      }\n    } catch (err) {\n      if (this.client.connection && err.statusCode === HttpStatusCodes_default.Forbidden) {\n        this.client.connection.connectionManager.actOnErrorFromAuthorize(err);\n      }\n      throw err;\n    }\n  }\n  /* For internal use, eg by connectionManager - useful when want to call back\n   * as soon as we have the new token, rather than waiting for it to take\n   * effect on the connection as #authorize does */\n  async _forceNewToken(tokenParams, authOptions) {\n    this.tokenDetails = null;\n    this._saveTokenOptions(tokenParams, authOptions);\n    logAndValidateTokenAuthMethod(this.authOptions, this.logger);\n    try {\n      return this._ensureValidAuthCredentials(true);\n    } finally {\n      delete this.tokenParams.timestamp;\n      delete this.authOptions.queryTime;\n    }\n  }\n  async requestToken(tokenParams, authOptions) {\n    const resolvedAuthOptions = authOptions || this.authOptions;\n    const resolvedTokenParams = tokenParams || copy(this.tokenParams);\n    let tokenRequestCallback, client = this.client;\n    if (resolvedAuthOptions.authCallback) {\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Auth.requestToken()\", \"using token auth with authCallback\");\n      tokenRequestCallback = resolvedAuthOptions.authCallback;\n    } else if (resolvedAuthOptions.authUrl) {\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Auth.requestToken()\", \"using token auth with authUrl\");\n      tokenRequestCallback = (params, cb) => {\n        const authHeaders = mixin(\n          { accept: \"application/json, text/plain\" },\n          resolvedAuthOptions.authHeaders\n        );\n        const usePost = resolvedAuthOptions.authMethod && resolvedAuthOptions.authMethod.toLowerCase() === \"post\";\n        let providedQsParams;\n        const queryIdx = resolvedAuthOptions.authUrl.indexOf(\"?\");\n        if (queryIdx > -1) {\n          providedQsParams = parseQueryString(resolvedAuthOptions.authUrl.slice(queryIdx));\n          resolvedAuthOptions.authUrl = resolvedAuthOptions.authUrl.slice(0, queryIdx);\n          if (!usePost) {\n            resolvedAuthOptions.authParams = mixin(\n              providedQsParams,\n              resolvedAuthOptions.authParams\n            );\n          }\n        }\n        const authParams = mixin({}, resolvedAuthOptions.authParams || {}, params);\n        const authUrlRequestCallback = (result) => {\n          var _a2, _b;\n          let body = (_a2 = result.body) != null ? _a2 : null;\n          let contentType = null;\n          if (result.error) {\n            logger_default.logAction(\n              this.logger,\n              logger_default.LOG_MICRO,\n              \"Auth.requestToken().tokenRequestCallback\",\n              \"Received Error: \" + inspectError(result.error)\n            );\n          } else {\n            const contentTypeHeaderOrHeaders = (_b = result.headers[\"content-type\"]) != null ? _b : null;\n            if (Array.isArray(contentTypeHeaderOrHeaders)) {\n              contentType = contentTypeHeaderOrHeaders.join(\", \");\n            } else {\n              contentType = contentTypeHeaderOrHeaders;\n            }\n            logger_default.logAction(\n              this.logger,\n              logger_default.LOG_MICRO,\n              \"Auth.requestToken().tokenRequestCallback\",\n              \"Received; content-type: \" + contentType + \"; body: \" + inspectBody(body)\n            );\n          }\n          if (result.error) {\n            cb(result.error, null);\n            return;\n          }\n          if (result.unpacked) {\n            cb(null, body);\n            return;\n          }\n          if (Platform.BufferUtils.isBuffer(body))\n            body = body.toString();\n          if (!contentType) {\n            cb(new ErrorInfo(\"authUrl response is missing a content-type header\", 40170, 401), null);\n            return;\n          }\n          const json = contentType.indexOf(\"application/json\") > -1, text = contentType.indexOf(\"text/plain\") > -1 || contentType.indexOf(\"application/jwt\") > -1;\n          if (!json && !text) {\n            cb(\n              new ErrorInfo(\n                \"authUrl responded with unacceptable content-type \" + contentType + \", should be either text/plain, application/jwt or application/json\",\n                40170,\n                401\n              ),\n              null\n            );\n            return;\n          }\n          if (json) {\n            if (body.length > MAX_TOKEN_LENGTH) {\n              cb(new ErrorInfo(\"authUrl response exceeded max permitted length\", 40170, 401), null);\n              return;\n            }\n            try {\n              body = JSON.parse(body);\n            } catch (e) {\n              cb(\n                new ErrorInfo(\n                  \"Unexpected error processing authURL response; err = \" + e.message,\n                  40170,\n                  401\n                ),\n                null\n              );\n              return;\n            }\n          }\n          cb(null, body, contentType);\n        };\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MICRO,\n          \"Auth.requestToken().tokenRequestCallback\",\n          \"Requesting token from \" + resolvedAuthOptions.authUrl + \"; Params: \" + JSON.stringify(authParams) + \"; method: \" + (usePost ? \"POST\" : \"GET\")\n        );\n        if (usePost) {\n          const headers = authHeaders || {};\n          headers[\"content-type\"] = \"application/x-www-form-urlencoded\";\n          const body = toQueryString(authParams).slice(1);\n          whenPromiseSettles(\n            this.client.http.doUri(\n              HttpMethods_default.Post,\n              resolvedAuthOptions.authUrl,\n              headers,\n              body,\n              providedQsParams\n            ),\n            (err, result) => err ? authUrlRequestCallback(err) : authUrlRequestCallback(result)\n          );\n        } else {\n          whenPromiseSettles(\n            this.client.http.doUri(HttpMethods_default.Get, resolvedAuthOptions.authUrl, authHeaders || {}, null, authParams),\n            (err, result) => err ? authUrlRequestCallback(err) : authUrlRequestCallback(result)\n          );\n        }\n      };\n    } else if (resolvedAuthOptions.key) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"Auth.requestToken()\",\n        \"using token auth with client-side signing\"\n      );\n      tokenRequestCallback = (params, cb) => {\n        whenPromiseSettles(\n          this.createTokenRequest(params, resolvedAuthOptions),\n          (err, result) => cb(err, result != null ? result : null)\n        );\n      };\n    } else {\n      const msg = \"Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)\";\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"Auth()\",\n        \"library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help\"\n      );\n      throw new ErrorInfo(msg, 40171, 403);\n    }\n    if (\"capability\" in resolvedTokenParams)\n      resolvedTokenParams.capability = c14n(\n        resolvedTokenParams.capability\n      );\n    const tokenRequest = (signedTokenParams, tokenCb) => {\n      const keyName = signedTokenParams.keyName, path = \"/keys/\" + keyName + \"/requestToken\", tokenUri = function(host) {\n        return client.baseUri(host) + path;\n      };\n      const requestHeaders = defaults_default.defaultPostHeaders(this.client.options, { format: \"json\" /* json */ });\n      if (resolvedAuthOptions.requestHeaders)\n        mixin(requestHeaders, resolvedAuthOptions.requestHeaders);\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"Auth.requestToken().requestToken\",\n        \"Sending POST to \" + path + \"; Token params: \" + JSON.stringify(signedTokenParams)\n      );\n      whenPromiseSettles(\n        this.client.http.do(HttpMethods_default.Post, tokenUri, requestHeaders, JSON.stringify(signedTokenParams), null),\n        (err, result) => err ? tokenCb(err) : tokenCb(result.error, result.body, result.unpacked)\n      );\n    };\n    return new Promise((resolve, reject) => {\n      let tokenRequestCallbackTimeoutExpired = false, timeoutLength = this.client.options.timeouts.realtimeRequestTimeout, tokenRequestCallbackTimeout = setTimeout(() => {\n        tokenRequestCallbackTimeoutExpired = true;\n        const msg = \"Token request callback timed out after \" + timeoutLength / 1e3 + \" seconds\";\n        logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"Auth.requestToken()\", msg);\n        reject(new ErrorInfo(msg, 40170, 401));\n      }, timeoutLength);\n      tokenRequestCallback(resolvedTokenParams, (err, tokenRequestOrDetails, contentType) => {\n        if (tokenRequestCallbackTimeoutExpired)\n          return;\n        clearTimeout(tokenRequestCallbackTimeout);\n        if (err) {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_ERROR,\n            \"Auth.requestToken()\",\n            \"token request signing call returned error; err = \" + inspectError(err)\n          );\n          reject(normaliseAuthcallbackError(err));\n          return;\n        }\n        if (typeof tokenRequestOrDetails === \"string\") {\n          if (tokenRequestOrDetails.length === 0) {\n            reject(new ErrorInfo(\"Token string is empty\", 40170, 401));\n          } else if (tokenRequestOrDetails.length > MAX_TOKEN_LENGTH) {\n            reject(\n              new ErrorInfo(\n                \"Token string exceeded max permitted length (was \" + tokenRequestOrDetails.length + \" bytes)\",\n                40170,\n                401\n              )\n            );\n          } else if (tokenRequestOrDetails === \"undefined\" || tokenRequestOrDetails === \"null\") {\n            reject(new ErrorInfo(\"Token string was literal null/undefined\", 40170, 401));\n          } else if (tokenRequestOrDetails[0] === \"{\" && !(contentType && contentType.indexOf(\"application/jwt\") > -1)) {\n            reject(\n              new ErrorInfo(\n                \"Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details\",\n                40170,\n                401\n              )\n            );\n          } else {\n            resolve({ token: tokenRequestOrDetails });\n          }\n          return;\n        }\n        if (typeof tokenRequestOrDetails !== \"object\" || tokenRequestOrDetails === null) {\n          const msg = \"Expected token request callback to call back with a token string or token request/details object, but got a \" + typeof tokenRequestOrDetails;\n          logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"Auth.requestToken()\", msg);\n          reject(new ErrorInfo(msg, 40170, 401));\n          return;\n        }\n        const objectSize = JSON.stringify(tokenRequestOrDetails).length;\n        if (objectSize > MAX_TOKEN_LENGTH && !resolvedAuthOptions.suppressMaxLengthCheck) {\n          reject(\n            new ErrorInfo(\n              \"Token request/details object exceeded max permitted stringified size (was \" + objectSize + \" bytes)\",\n              40170,\n              401\n            )\n          );\n          return;\n        }\n        if (\"issued\" in tokenRequestOrDetails) {\n          resolve(tokenRequestOrDetails);\n          return;\n        }\n        if (!(\"keyName\" in tokenRequestOrDetails)) {\n          const msg = \"Expected token request callback to call back with a token string, token request object, or token details object\";\n          logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"Auth.requestToken()\", msg);\n          reject(new ErrorInfo(msg, 40170, 401));\n          return;\n        }\n        tokenRequest(tokenRequestOrDetails, (err2, tokenResponse, unpacked) => {\n          if (err2) {\n            logger_default.logAction(\n              this.logger,\n              logger_default.LOG_ERROR,\n              \"Auth.requestToken()\",\n              \"token request API call returned error; err = \" + inspectError(err2)\n            );\n            reject(normaliseAuthcallbackError(err2));\n            return;\n          }\n          if (!unpacked)\n            tokenResponse = JSON.parse(tokenResponse);\n          logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Auth.getToken()\", \"token received\");\n          resolve(tokenResponse);\n        });\n      });\n    });\n  }\n  /**\n   * Create and sign a token request based on the given options.\n   * NOTE this can only be used when the key value is available locally.\n   * Otherwise, signed token requests must be obtained from the key\n   * owner (either using the token request callback or url).\n   *\n   * @param authOptions\n   * an object containing the request options:\n   * - key:           the key to use. If not specified, a key passed in constructing\n   *                  the Rest interface will be used\n   *\n   * - queryTime      (optional) boolean indicating that the ably system should be\n   *                  queried for the current time when none is specified explicitly\n   *\n   * - requestHeaders (optional, unsupported, for testing only) extra headers to add to the\n   *                  requestToken request\n   *\n   * @param tokenParams\n   * an object containing the parameters for the requested token:\n   * - ttl:       (optional) the requested life of the token in ms. If none is specified\n   *                  a default of 1 hour is provided. The maximum lifetime is 24hours; any request\n   *                  exceeding that lifetime will be rejected with an error.\n   *\n   * - capability:    (optional) the capability to associate with the access token.\n   *                  If none is specified, a token will be requested with all of the\n   *                  capabilities of the specified key.\n   *\n   * - clientId:      (optional) a client ID to associate with the token; if not\n   *                  specified, a clientId passed in constructing the Rest interface will be used\n   *\n   * - timestamp:     (optional) the time in ms since the epoch. If none is specified,\n   *                  the system will be queried for a time value to use.\n   */\n  async createTokenRequest(tokenParams, authOptions) {\n    authOptions = authOptions || this.authOptions;\n    tokenParams = tokenParams || copy(this.tokenParams);\n    const key = authOptions.key;\n    if (!key) {\n      throw new ErrorInfo(\"No key specified\", 40101, 403);\n    }\n    const keyParts = key.split(\":\"), keyName = keyParts[0], keySecret = keyParts[1];\n    if (!keySecret) {\n      throw new ErrorInfo(\"Invalid key specified\", 40101, 403);\n    }\n    if (tokenParams.clientId === \"\") {\n      throw new ErrorInfo(\"clientId can\\u2019t be an empty string\", 40012, 400);\n    }\n    if (\"capability\" in tokenParams) {\n      tokenParams.capability = c14n(tokenParams.capability);\n    }\n    const request = mixin({ keyName }, tokenParams), clientId = tokenParams.clientId || \"\", ttl = tokenParams.ttl || \"\", capability = tokenParams.capability || \"\";\n    if (!request.timestamp) {\n      request.timestamp = await this._getTimestamp(authOptions && authOptions.queryTime);\n    }\n    const nonce = request.nonce || (request.nonce = random()), timestamp = request.timestamp;\n    const signText = request.keyName + \"\\n\" + ttl + \"\\n\" + capability + \"\\n\" + clientId + \"\\n\" + timestamp + \"\\n\" + nonce + \"\\n\";\n    request.mac = request.mac || hmac(signText, keySecret);\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Auth.getTokenRequest()\", \"generated signed request\");\n    return request;\n  }\n  /**\n   * Get the auth query params to use for a websocket connection,\n   * based on the current auth parameters\n   */\n  async getAuthParams() {\n    if (this.method == \"basic\")\n      return { key: this.key };\n    else {\n      let tokenDetails = await this._ensureValidAuthCredentials(false);\n      if (!tokenDetails) {\n        throw new Error(\"Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails\");\n      }\n      return { access_token: tokenDetails.token };\n    }\n  }\n  /**\n   * Get the authorization header to use for a REST or comet request,\n   * based on the current auth parameters\n   */\n  async getAuthHeaders() {\n    if (this.method == \"basic\") {\n      return { authorization: \"Basic \" + this.basicKey };\n    } else {\n      const tokenDetails = await this._ensureValidAuthCredentials(false);\n      if (!tokenDetails) {\n        throw new Error(\"Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails\");\n      }\n      return { authorization: \"Bearer \" + toBase64(tokenDetails.token) };\n    }\n  }\n  _saveBasicOptions(authOptions) {\n    this.method = \"basic\";\n    this.key = authOptions.key;\n    this.basicKey = toBase64(authOptions.key);\n    this.authOptions = authOptions || {};\n    if (\"clientId\" in authOptions) {\n      this._userSetClientId(authOptions.clientId);\n    }\n  }\n  _saveTokenOptions(tokenParams, authOptions) {\n    this.method = \"token\";\n    if (tokenParams) {\n      this.tokenParams = tokenParams;\n    }\n    if (authOptions) {\n      if (authOptions.token) {\n        authOptions.tokenDetails = typeof authOptions.token === \"string\" ? { token: authOptions.token } : authOptions.token;\n      }\n      if (authOptions.tokenDetails) {\n        this.tokenDetails = authOptions.tokenDetails;\n      }\n      if (\"clientId\" in authOptions) {\n        this._userSetClientId(authOptions.clientId);\n      }\n      this.authOptions = authOptions;\n    }\n  }\n  /* @param forceSupersede: force a new token request even if there's one in\n   * progress, making all pending callbacks wait for the new one */\n  async _ensureValidAuthCredentials(forceSupersede) {\n    const token = this.tokenDetails;\n    if (token) {\n      if (this._tokenClientIdMismatch(token.clientId)) {\n        throw new ErrorInfo(\n          \"Mismatch between clientId in token (\" + token.clientId + \") and current clientId (\" + this.clientId + \")\",\n          40102,\n          403\n        );\n      }\n      if (!this.client.isTimeOffsetSet() || !token.expires || token.expires >= this.client.getTimestampUsingOffset()) {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"Auth.getToken()\",\n          \"using cached token; expires = \" + token.expires\n        );\n        return token;\n      }\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Auth.getToken()\", \"deleting expired token\");\n      this.tokenDetails = null;\n    }\n    const promise = (this.waitingForTokenRequest || (this.waitingForTokenRequest = multicaster_default.create(this.logger))).createPromise();\n    if (this.currentTokenRequestId !== null && !forceSupersede) {\n      return promise;\n    }\n    const tokenRequestId = this.currentTokenRequestId = getTokenRequestId();\n    let tokenResponse, caughtError = null;\n    try {\n      tokenResponse = await this.requestToken(this.tokenParams, this.authOptions);\n    } catch (err) {\n      caughtError = err;\n    }\n    if (this.currentTokenRequestId > tokenRequestId) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"Auth._ensureValidAuthCredentials()\",\n        \"Discarding token request response; overtaken by newer one\"\n      );\n      return promise;\n    }\n    this.currentTokenRequestId = null;\n    const multicaster = this.waitingForTokenRequest;\n    this.waitingForTokenRequest = null;\n    if (caughtError) {\n      multicaster == null ? void 0 : multicaster.rejectAll(caughtError);\n      return promise;\n    }\n    multicaster == null ? void 0 : multicaster.resolveAll(this.tokenDetails = tokenResponse);\n    return promise;\n  }\n  /* User-set: check types, '*' is disallowed, throw any errors */\n  _userSetClientId(clientId) {\n    if (!(typeof clientId === \"string\" || clientId === null)) {\n      throw new ErrorInfo(\"clientId must be either a string or null\", 40012, 400);\n    } else if (clientId === \"*\") {\n      throw new ErrorInfo(\n        'Can\\u2019t use \"*\" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: \"*\"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: \"*\"}, authOptions)',\n        40012,\n        400\n      );\n    } else {\n      const err = this._uncheckedSetClientId(clientId);\n      if (err)\n        throw err;\n    }\n  }\n  /* Ably-set: no typechecking, '*' is allowed but not set on this.clientId), return errors to the caller */\n  _uncheckedSetClientId(clientId) {\n    if (this._tokenClientIdMismatch(clientId)) {\n      const msg = \"Unexpected clientId mismatch: client has \" + this.clientId + \", requested \" + clientId;\n      const err = new ErrorInfo(msg, 40102, 401);\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"Auth._uncheckedSetClientId()\", msg);\n      return err;\n    } else {\n      this.clientId = this.tokenParams.clientId = clientId;\n      return null;\n    }\n  }\n  _tokenClientIdMismatch(tokenClientId) {\n    return !!(this.clientId && this.clientId !== \"*\" && tokenClientId && tokenClientId !== \"*\" && this.clientId !== tokenClientId);\n  }\n  static isTokenErr(error) {\n    return error.code && error.code >= 40140 && error.code < 40150;\n  }\n  revokeTokens(specifiers, options) {\n    return this.client.rest.revokeTokens(specifiers, options);\n  }\n  /**\n   * Same as {@link BaseClient.getTimestamp} but also takes into account {@link Auth.authOptions}\n   */\n  async _getTimestamp(queryTime) {\n    return this.client.getTimestamp(queryTime || !!this.authOptions.queryTime);\n  }\n};\nvar auth_default = Auth;\n\n// src/common/types/http.ts\nfunction paramString(params) {\n  const paramPairs = [];\n  if (params) {\n    for (const needle in params) {\n      paramPairs.push(needle + \"=\" + params[needle]);\n    }\n  }\n  return paramPairs.join(\"&\");\n}\nfunction appendingParams(uri, params) {\n  return uri + (params ? \"?\" : \"\") + paramString(params);\n}\nfunction logResult(result, method, uri, params, logger) {\n  if (result.error) {\n    logger_default.logActionNoStrip(\n      logger,\n      logger_default.LOG_MICRO,\n      \"Http.\" + method + \"()\",\n      \"Received Error; \" + appendingParams(uri, params) + \"; Error: \" + inspectError(result.error)\n    );\n  } else {\n    logger_default.logActionNoStrip(\n      logger,\n      logger_default.LOG_MICRO,\n      \"Http.\" + method + \"()\",\n      \"Received; \" + appendingParams(uri, params) + \"; Headers: \" + paramString(result.headers) + \"; StatusCode: \" + result.statusCode + \"; Body\" + (Platform.BufferUtils.isBuffer(result.body) ? \" (Base64): \" + Platform.BufferUtils.base64Encode(result.body) : \": \" + result.body)\n    );\n  }\n}\nfunction logRequest(method, uri, body, params, logger) {\n  if (logger.shouldLog(logger_default.LOG_MICRO)) {\n    logger_default.logActionNoStrip(\n      logger,\n      logger_default.LOG_MICRO,\n      \"Http.\" + method + \"()\",\n      \"Sending; \" + appendingParams(uri, params) + \"; Body\" + (Platform.BufferUtils.isBuffer(body) ? \" (Base64): \" + Platform.BufferUtils.base64Encode(body) : \": \" + body)\n    );\n  }\n}\nvar Http = class {\n  constructor(client) {\n    this.client = client;\n    this.platformHttp = new Platform.Http(client);\n    this.checkConnectivity = this.platformHttp.checkConnectivity ? () => this.platformHttp.checkConnectivity() : void 0;\n  }\n  get logger() {\n    var _a2, _b;\n    return (_b = (_a2 = this.client) == null ? void 0 : _a2.logger) != null ? _b : logger_default.defaultLogger;\n  }\n  get supportsAuthHeaders() {\n    return this.platformHttp.supportsAuthHeaders;\n  }\n  get supportsLinkHeaders() {\n    return this.platformHttp.supportsLinkHeaders;\n  }\n  _getHosts(client) {\n    const connection = client.connection, connectionHost = connection && connection.connectionManager.host;\n    if (connectionHost) {\n      return [connectionHost].concat(defaults_default.getFallbackHosts(client.options));\n    }\n    return defaults_default.getHosts(client.options);\n  }\n  /**\n   * This method will not throw any errors; rather, it will communicate any error by populating the {@link RequestResult.error} property of the returned {@link RequestResult}.\n   */\n  async do(method, path, headers, body, params) {\n    try {\n      const client = this.client;\n      if (!client) {\n        return { error: new ErrorInfo(\"http.do called without client\", 5e4, 500) };\n      }\n      const uriFromHost = typeof path === \"function\" ? path : function(host) {\n        return client.baseUri(host) + path;\n      };\n      const currentFallback = client._currentFallback;\n      if (currentFallback) {\n        if (currentFallback.validUntil > Date.now()) {\n          const result = await this.doUri(method, uriFromHost(currentFallback.host), headers, body, params);\n          if (result.error && this.platformHttp.shouldFallback(result.error)) {\n            client._currentFallback = null;\n            return this.do(method, path, headers, body, params);\n          }\n          return result;\n        } else {\n          client._currentFallback = null;\n        }\n      }\n      const hosts = this._getHosts(client);\n      if (hosts.length === 1) {\n        return this.doUri(method, uriFromHost(hosts[0]), headers, body, params);\n      }\n      let tryAHostStartedAt = null;\n      const tryAHost = async (candidateHosts, persistOnSuccess) => {\n        const host = candidateHosts.shift();\n        tryAHostStartedAt = tryAHostStartedAt != null ? tryAHostStartedAt : /* @__PURE__ */ new Date();\n        const result = await this.doUri(method, uriFromHost(host), headers, body, params);\n        if (result.error && this.platformHttp.shouldFallback(result.error) && candidateHosts.length) {\n          const elapsedTime = Date.now() - tryAHostStartedAt.getTime();\n          if (elapsedTime > client.options.timeouts.httpMaxRetryDuration) {\n            return {\n              error: new ErrorInfo(\n                `Timeout for trying fallback hosts retries. Total elapsed time exceeded the ${client.options.timeouts.httpMaxRetryDuration}ms limit`,\n                50003,\n                500\n              )\n            };\n          }\n          return tryAHost(candidateHosts, true);\n        }\n        if (persistOnSuccess) {\n          client._currentFallback = {\n            host,\n            validUntil: Date.now() + client.options.timeouts.fallbackRetryTimeout\n          };\n        }\n        return result;\n      };\n      return tryAHost(hosts);\n    } catch (err) {\n      return { error: new ErrorInfo(`Unexpected error in Http.do: ${inspectError(err)}`, 500, 5e4) };\n    }\n  }\n  /**\n   * This method will not throw any errors; rather, it will communicate any error by populating the {@link RequestResult.error} property of the returned {@link RequestResult}.\n   */\n  async doUri(method, uri, headers, body, params) {\n    try {\n      logRequest(method, uri, body, params, this.logger);\n      const result = await this.platformHttp.doUri(method, uri, headers, body, params);\n      if (this.logger.shouldLog(logger_default.LOG_MICRO)) {\n        logResult(result, method, uri, params, this.logger);\n      }\n      return result;\n    } catch (err) {\n      return { error: new ErrorInfo(`Unexpected error in Http.doUri: ${inspectError(err)}`, 500, 5e4) };\n    }\n  }\n};\n\n// src/common/lib/util/eventemitter.ts\nfunction callListener(logger, eventThis, listener, args) {\n  try {\n    listener.apply(eventThis, args);\n  } catch (e) {\n    logger_default.logAction(\n      logger,\n      logger_default.LOG_ERROR,\n      \"EventEmitter.emit()\",\n      \"Unexpected listener exception: \" + e + \"; stack = \" + (e && e.stack)\n    );\n  }\n}\nfunction removeListener(targetListeners, listener, eventFilter) {\n  let listeners;\n  let index;\n  let eventName;\n  for (let targetListenersIndex = 0; targetListenersIndex < targetListeners.length; targetListenersIndex++) {\n    listeners = targetListeners[targetListenersIndex];\n    if (eventFilter) {\n      listeners = listeners[eventFilter];\n    }\n    if (Array.isArray(listeners)) {\n      while ((index = listeners.indexOf(listener)) !== -1) {\n        listeners.splice(index, 1);\n      }\n      if (eventFilter && listeners.length === 0) {\n        delete targetListeners[targetListenersIndex][eventFilter];\n      }\n    } else if (isObject(listeners)) {\n      for (eventName in listeners) {\n        if (Object.prototype.hasOwnProperty.call(listeners, eventName) && Array.isArray(listeners[eventName])) {\n          removeListener([listeners], listener, eventName);\n        }\n      }\n    }\n  }\n}\nvar EventEmitter = class {\n  constructor(logger) {\n    this.logger = logger;\n    this.any = [];\n    this.events = /* @__PURE__ */ Object.create(null);\n    this.anyOnce = [];\n    this.eventsOnce = /* @__PURE__ */ Object.create(null);\n  }\n  on(...args) {\n    if (args.length === 1) {\n      const listener = args[0];\n      if (typeof listener === \"function\") {\n        this.any.push(listener);\n      } else {\n        throw new Error(\"EventListener.on(): Invalid arguments: \" + Platform.Config.inspect(args));\n      }\n    }\n    if (args.length === 2) {\n      const [event, listener] = args;\n      if (typeof listener !== \"function\") {\n        throw new Error(\"EventListener.on(): Invalid arguments: \" + Platform.Config.inspect(args));\n      }\n      if (isNil(event)) {\n        this.any.push(listener);\n      } else if (Array.isArray(event)) {\n        event.forEach((eventName) => {\n          this.on(eventName, listener);\n        });\n      } else {\n        if (typeof event !== \"string\") {\n          throw new Error(\"EventListener.on(): Invalid arguments: \" + Platform.Config.inspect(args));\n        }\n        const listeners = this.events[event] || (this.events[event] = []);\n        listeners.push(listener);\n      }\n    }\n  }\n  off(...args) {\n    if (args.length == 0 || isNil(args[0]) && isNil(args[1])) {\n      this.any = [];\n      this.events = /* @__PURE__ */ Object.create(null);\n      this.anyOnce = [];\n      this.eventsOnce = /* @__PURE__ */ Object.create(null);\n      return;\n    }\n    const [firstArg, secondArg] = args;\n    let listener = null;\n    let event = null;\n    if (args.length === 1 || !secondArg) {\n      if (typeof firstArg === \"function\") {\n        listener = firstArg;\n      } else {\n        event = firstArg;\n      }\n    } else {\n      if (typeof secondArg !== \"function\") {\n        throw new Error(\"EventEmitter.off(): invalid arguments:\" + Platform.Config.inspect(args));\n      }\n      [event, listener] = [firstArg, secondArg];\n    }\n    if (listener && isNil(event)) {\n      removeListener([this.any, this.events, this.anyOnce, this.eventsOnce], listener);\n      return;\n    }\n    if (Array.isArray(event)) {\n      event.forEach((eventName) => {\n        this.off(eventName, listener);\n      });\n      return;\n    }\n    if (typeof event !== \"string\") {\n      throw new Error(\"EventEmitter.off(): invalid arguments:\" + Platform.Config.inspect(args));\n    }\n    if (listener) {\n      removeListener([this.events, this.eventsOnce], listener, event);\n    } else {\n      delete this.events[event];\n      delete this.eventsOnce[event];\n    }\n  }\n  /**\n   * Get the array of listeners for a given event; excludes once events\n   * @param event (optional) the name of the event, or none for 'any'\n   * @return array of events, or null if none\n   */\n  listeners(event) {\n    if (event) {\n      const listeners = this.events[event] || [];\n      if (this.eventsOnce[event])\n        Array.prototype.push.apply(listeners, this.eventsOnce[event]);\n      return listeners.length ? listeners : null;\n    }\n    return this.any.length ? this.any : null;\n  }\n  /**\n   * Emit an event\n   * @param event the event name\n   * @param args the arguments to pass to the listener\n   */\n  emit(event, ...args) {\n    const eventThis = { event };\n    const listeners = [];\n    if (this.anyOnce.length) {\n      Array.prototype.push.apply(listeners, this.anyOnce);\n      this.anyOnce = [];\n    }\n    if (this.any.length) {\n      Array.prototype.push.apply(listeners, this.any);\n    }\n    const eventsOnceListeners = this.eventsOnce[event];\n    if (eventsOnceListeners) {\n      Array.prototype.push.apply(listeners, eventsOnceListeners);\n      delete this.eventsOnce[event];\n    }\n    const eventsListeners = this.events[event];\n    if (eventsListeners) {\n      Array.prototype.push.apply(listeners, eventsListeners);\n    }\n    listeners.forEach((listener) => {\n      callListener(this.logger, eventThis, listener, args);\n    });\n  }\n  once(...args) {\n    const argCount = args.length;\n    if (argCount === 0 || argCount === 1 && typeof args[0] !== \"function\") {\n      const event = args[0];\n      return new Promise((resolve) => {\n        this.once(event, resolve);\n      });\n    }\n    const [firstArg, secondArg] = args;\n    if (args.length === 1 && typeof firstArg === \"function\") {\n      this.anyOnce.push(firstArg);\n    } else if (isNil(firstArg)) {\n      if (typeof secondArg !== \"function\") {\n        throw new Error(\"EventEmitter.once(): Invalid arguments:\" + Platform.Config.inspect(args));\n      }\n      this.anyOnce.push(secondArg);\n    } else if (Array.isArray(firstArg)) {\n      const self2 = this;\n      const listenerWrapper = function() {\n        const innerArgs = Array.prototype.slice.call(arguments);\n        firstArg.forEach(function(eventName) {\n          self2.off(eventName, listenerWrapper);\n        });\n        if (typeof secondArg !== \"function\") {\n          throw new Error(\"EventEmitter.once(): Invalid arguments:\" + Platform.Config.inspect(args));\n        }\n        secondArg.apply(this, innerArgs);\n      };\n      firstArg.forEach(function(eventName) {\n        self2.on(eventName, listenerWrapper);\n      });\n    } else {\n      if (typeof firstArg !== \"string\") {\n        throw new Error(\"EventEmitter.once(): Invalid arguments:\" + Platform.Config.inspect(args));\n      }\n      const listeners = this.eventsOnce[firstArg] || (this.eventsOnce[firstArg] = []);\n      if (secondArg) {\n        if (typeof secondArg !== \"function\") {\n          throw new Error(\"EventEmitter.once(): Invalid arguments:\" + Platform.Config.inspect(args));\n        }\n        listeners.push(secondArg);\n      }\n    }\n  }\n  /**\n   * Listen for a single occurrence of a state event and fire immediately if currentState matches targetState\n   * @param targetState the name of the state event to listen to\n   * @param currentState the name of the current state of this object\n   */\n  async whenState(targetState, currentState) {\n    if (typeof targetState !== \"string\" || typeof currentState !== \"string\") {\n      throw new Error(\"whenState requires a valid state String argument\");\n    }\n    if (targetState === currentState) {\n      return null;\n    } else {\n      return this.once(targetState);\n    }\n  }\n};\nvar eventemitter_default = EventEmitter;\n\n// src/common/lib/types/protocolmessagecommon.ts\nvar actions = {\n  HEARTBEAT: 0,\n  ACK: 1,\n  NACK: 2,\n  CONNECT: 3,\n  CONNECTED: 4,\n  DISCONNECT: 5,\n  DISCONNECTED: 6,\n  CLOSE: 7,\n  CLOSED: 8,\n  ERROR: 9,\n  ATTACH: 10,\n  ATTACHED: 11,\n  DETACH: 12,\n  DETACHED: 13,\n  PRESENCE: 14,\n  MESSAGE: 15,\n  SYNC: 16,\n  AUTH: 17,\n  ACTIVATE: 18,\n  OBJECT: 19,\n  OBJECT_SYNC: 20,\n  ANNOTATION: 21\n};\nvar ActionName = [];\nObject.keys(actions).forEach(function(name) {\n  ActionName[actions[name]] = name;\n});\nvar flags = {\n  /* Channel attach state flags */\n  HAS_PRESENCE: 1 << 0,\n  HAS_BACKLOG: 1 << 1,\n  RESUMED: 1 << 2,\n  TRANSIENT: 1 << 4,\n  ATTACH_RESUME: 1 << 5,\n  HAS_OBJECTS: 1 << 7,\n  /* Channel mode flags */\n  PRESENCE: 1 << 16,\n  PUBLISH: 1 << 17,\n  SUBSCRIBE: 1 << 18,\n  PRESENCE_SUBSCRIBE: 1 << 19,\n  ANNOTATION_PUBLISH: 1 << 21,\n  ANNOTATION_SUBSCRIBE: 1 << 22,\n  OBJECT_SUBSCRIBE: 1 << 24,\n  OBJECT_PUBLISH: 1 << 25\n};\nvar flagNames = Object.keys(flags);\nflags.MODE_ALL = flags.PRESENCE | flags.PUBLISH | flags.SUBSCRIBE | flags.PRESENCE_SUBSCRIBE | flags.ANNOTATION_PUBLISH | flags.ANNOTATION_SUBSCRIBE | flags.OBJECT_SUBSCRIBE | flags.OBJECT_PUBLISH;\nvar channelModes = [\n  \"PRESENCE\",\n  \"PUBLISH\",\n  \"SUBSCRIBE\",\n  \"PRESENCE_SUBSCRIBE\",\n  \"ANNOTATION_PUBLISH\",\n  \"ANNOTATION_SUBSCRIBE\",\n  \"OBJECT_SUBSCRIBE\",\n  \"OBJECT_PUBLISH\"\n];\n\n// src/common/lib/types/basemessage.ts\nfunction normaliseContext(context) {\n  if (!context || !context.channelOptions) {\n    return {\n      channelOptions: context,\n      plugins: {},\n      baseEncodedPreviousPayload: void 0\n    };\n  }\n  return context;\n}\nfunction normalizeCipherOptions(Crypto2, logger, options) {\n  if (options && options.cipher) {\n    if (!Crypto2)\n      throwMissingPluginError(\"Crypto\");\n    const cipher = Crypto2.getCipher(options.cipher, logger);\n    return {\n      cipher: cipher.cipherParams,\n      channelCipher: cipher.cipher\n    };\n  }\n  return options != null ? options : {};\n}\nasync function encrypt(msg, cipherOptions) {\n  const { data, encoding } = await encryptData(msg.data, msg.encoding, cipherOptions);\n  msg.data = data;\n  msg.encoding = encoding;\n  return msg;\n}\nasync function encryptData(data, encoding, cipherOptions) {\n  let cipher = cipherOptions.channelCipher;\n  let dataToEncrypt = data;\n  let finalEncoding = encoding ? encoding + \"/\" : \"\";\n  if (!Platform.BufferUtils.isBuffer(dataToEncrypt)) {\n    dataToEncrypt = Platform.BufferUtils.utf8Encode(String(dataToEncrypt));\n    finalEncoding = finalEncoding + \"utf-8/\";\n  }\n  const ciphertext = await cipher.encrypt(dataToEncrypt);\n  finalEncoding = finalEncoding + \"cipher+\" + cipher.algorithm;\n  return {\n    data: ciphertext,\n    encoding: finalEncoding\n  };\n}\nasync function encode(msg, options) {\n  const { data, encoding } = encodeData(msg.data, msg.encoding);\n  msg.data = data;\n  msg.encoding = encoding;\n  if (options != null && options.cipher) {\n    return encrypt(msg, options);\n  } else {\n    return msg;\n  }\n}\nfunction encodeData(data, encoding) {\n  const nativeDataType = typeof data == \"string\" || Platform.BufferUtils.isBuffer(data) || data === null || data === void 0;\n  if (nativeDataType) {\n    return {\n      data,\n      encoding\n    };\n  }\n  if (isObject(data) || Array.isArray(data)) {\n    return {\n      data: JSON.stringify(data),\n      encoding: encoding ? encoding + \"/json\" : \"json\"\n    };\n  }\n  throw new ErrorInfo(\"Data type is unsupported\", 40013, 400);\n}\nasync function decode(message, inputContext) {\n  const { data, encoding, error } = await decodeData(message.data, message.encoding, inputContext);\n  message.data = data;\n  message.encoding = encoding;\n  if (error) {\n    throw error;\n  }\n}\nasync function decodeData(data, encoding, inputContext) {\n  const context = normaliseContext(inputContext);\n  let lastPayload = data;\n  let decodedData = data;\n  let finalEncoding = encoding;\n  let decodingError;\n  if (encoding) {\n    const xforms = encoding.split(\"/\");\n    let lastProcessedEncodingIndex;\n    let encodingsToProcess = xforms.length;\n    let xform = \"\";\n    try {\n      while ((lastProcessedEncodingIndex = encodingsToProcess) > 0) {\n        const match = xforms[--encodingsToProcess].match(/([-\\w]+)(\\+([\\w-]+))?/);\n        if (!match)\n          break;\n        xform = match[1];\n        switch (xform) {\n          case \"base64\":\n            decodedData = Platform.BufferUtils.base64Decode(String(decodedData));\n            if (lastProcessedEncodingIndex == xforms.length) {\n              lastPayload = decodedData;\n            }\n            continue;\n          case \"utf-8\":\n            decodedData = Platform.BufferUtils.utf8Decode(decodedData);\n            continue;\n          case \"json\":\n            decodedData = JSON.parse(decodedData);\n            continue;\n          case \"cipher\":\n            if (context.channelOptions != null && context.channelOptions.cipher && context.channelOptions.channelCipher) {\n              const xformAlgorithm = match[3], cipher = context.channelOptions.channelCipher;\n              if (xformAlgorithm != cipher.algorithm) {\n                throw new Error(\"Unable to decrypt message with given cipher; incompatible cipher params\");\n              }\n              decodedData = await cipher.decrypt(decodedData);\n              continue;\n            } else {\n              throw new Error(\"Unable to decrypt message; not an encrypted channel\");\n            }\n          case \"vcdiff\":\n            if (!context.plugins || !context.plugins.vcdiff) {\n              throw new ErrorInfo(\"Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)\", 40019, 400);\n            }\n            if (typeof Uint8Array === \"undefined\") {\n              throw new ErrorInfo(\n                \"Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)\",\n                40020,\n                400\n              );\n            }\n            try {\n              let deltaBase = context.baseEncodedPreviousPayload;\n              if (typeof deltaBase === \"string\") {\n                deltaBase = Platform.BufferUtils.utf8Encode(deltaBase);\n              }\n              const deltaBaseBuffer = Platform.BufferUtils.toBuffer(deltaBase);\n              decodedData = Platform.BufferUtils.toBuffer(decodedData);\n              decodedData = Platform.BufferUtils.arrayBufferViewToBuffer(\n                context.plugins.vcdiff.decode(decodedData, deltaBaseBuffer)\n              );\n              lastPayload = decodedData;\n            } catch (e) {\n              throw new ErrorInfo(\"Vcdiff delta decode failed with \" + e, 40018, 400);\n            }\n            continue;\n          default:\n            throw new Error(\"Unknown encoding\");\n        }\n      }\n    } catch (e) {\n      const err = e;\n      decodingError = new ErrorInfo(\n        `Error processing the ${xform} encoding, decoder returned \\u2018${err.message}\\u2019`,\n        err.code || 40013,\n        400\n      );\n    } finally {\n      finalEncoding = lastProcessedEncodingIndex <= 0 ? null : xforms.slice(0, lastProcessedEncodingIndex).join(\"/\");\n    }\n  }\n  if (decodingError) {\n    return {\n      error: decodingError,\n      data: decodedData,\n      encoding: finalEncoding\n    };\n  }\n  context.baseEncodedPreviousPayload = lastPayload;\n  return {\n    data: decodedData,\n    encoding: finalEncoding\n  };\n}\nfunction wireToJSON(...args) {\n  const format = args.length > 0 ? \"json\" /* json */ : \"msgpack\" /* msgpack */;\n  const { data, encoding } = encodeDataForWire(this.data, this.encoding, format);\n  return Object.assign({}, this, { encoding, data });\n}\nfunction encodeDataForWire(data, encoding, format) {\n  if (!data || !Platform.BufferUtils.isBuffer(data)) {\n    return {\n      data,\n      encoding\n    };\n  }\n  if (format === \"msgpack\" /* msgpack */) {\n    return {\n      data: Platform.BufferUtils.toBuffer(data),\n      encoding\n    };\n  }\n  return {\n    data: Platform.BufferUtils.base64Encode(data),\n    encoding: encoding ? encoding + \"/base64\" : \"base64\"\n  };\n}\nvar MessageEncoding = {\n  encryptData,\n  encodeData,\n  encodeDataForWire,\n  decodeData\n};\nfunction populateFieldsFromParent(parent) {\n  const { id, connectionId, timestamp } = parent;\n  let msgs;\n  switch (parent.action) {\n    case actions.MESSAGE: {\n      msgs = parent.messages;\n      break;\n    }\n    case actions.PRESENCE:\n    case actions.SYNC:\n      msgs = parent.presence;\n      break;\n    case actions.ANNOTATION:\n      msgs = parent.annotations;\n      break;\n    case actions.OBJECT:\n    case actions.OBJECT_SYNC:\n      msgs = parent.state;\n      break;\n    default:\n      throw new ErrorInfo(\"Unexpected action \" + parent.action, 4e4, 400);\n  }\n  for (let i = 0; i < msgs.length; i++) {\n    const msg = msgs[i];\n    if (!msg.connectionId) {\n      msg.connectionId = connectionId;\n    }\n    if (!msg.timestamp) {\n      msg.timestamp = timestamp;\n    }\n    if (id && !msg.id) {\n      msg.id = id + \":\" + i;\n    }\n  }\n}\nfunction strMsg(m, cls) {\n  let result = \"[\" + cls;\n  for (const attr in m) {\n    if (attr === \"data\") {\n      if (typeof m.data == \"string\") {\n        result += \"; data=\" + m.data;\n      } else if (Platform.BufferUtils.isBuffer(m.data)) {\n        result += \"; data (buffer)=\" + Platform.BufferUtils.base64Encode(m.data);\n      } else if (typeof m.data !== \"undefined\") {\n        result += \"; data (json)=\" + JSON.stringify(m.data);\n      }\n    } else if (attr && (attr === \"extras\" || attr === \"operation\")) {\n      result += \"; \" + attr + \"=\" + JSON.stringify(m[attr]);\n    } else if (attr === \"version\") {\n      result += \"; version=\" + JSON.stringify(m[attr]);\n    } else if (attr === \"annotations\") {\n      result += \"; annotations=\" + JSON.stringify(m[attr]);\n    } else if (m[attr] !== void 0) {\n      result += \"; \" + attr + \"=\" + m[attr];\n    }\n  }\n  result += \"]\";\n  return result;\n}\nvar BaseMessage = class {\n};\n\n// src/common/lib/client/baseclient.ts\nvar BaseClient = class {\n  constructor(options) {\n    /**\n     * These exports are for use by UMD plugins; reason being so that constructors and static methods can be accessed by these plugins without needing to import the classes directly and result in the class existing in both the plugin and the core library.\n     */\n    this.Platform = Platform;\n    this.ErrorInfo = ErrorInfo;\n    this.Logger = logger_default;\n    this.Defaults = defaults_default;\n    this.Utils = utils_exports;\n    this.EventEmitter = eventemitter_default;\n    this.MessageEncoding = MessageEncoding;\n    var _a2, _b, _c, _d, _e, _f, _g, _h, _i, _j;\n    this._additionalHTTPRequestImplementations = (_a2 = options.plugins) != null ? _a2 : null;\n    this.logger = new logger_default();\n    this.logger.setLog(options.logLevel, options.logHandler);\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"BaseClient()\",\n      \"initialized with clientOptions \" + Platform.Config.inspect(options)\n    );\n    this._MsgPack = (_c = (_b = options.plugins) == null ? void 0 : _b.MsgPack) != null ? _c : null;\n    const normalOptions = this.options = defaults_default.normaliseOptions(options, this._MsgPack, this.logger);\n    if (normalOptions.key) {\n      const keyMatch = normalOptions.key.match(/^([^:\\s]+):([^:.\\s]+)$/);\n      if (!keyMatch) {\n        const msg = \"invalid key parameter\";\n        logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"BaseClient()\", msg);\n        throw new ErrorInfo(msg, 40400, 404);\n      }\n      normalOptions.keyName = keyMatch[1];\n      normalOptions.keySecret = keyMatch[2];\n    }\n    if (\"clientId\" in normalOptions) {\n      if (!(typeof normalOptions.clientId === \"string\" || normalOptions.clientId === null))\n        throw new ErrorInfo(\"clientId must be either a string or null\", 40012, 400);\n      else if (normalOptions.clientId === \"*\")\n        throw new ErrorInfo(\n          'Can\\u2019t use \"*\" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: \"*\"}})',\n          40012,\n          400\n        );\n    }\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"BaseClient()\", \"started; version = \" + defaults_default.version);\n    this._currentFallback = null;\n    this.serverTimeOffset = null;\n    this.http = new Http(this);\n    this.auth = new auth_default(this, normalOptions);\n    this._rest = ((_d = options.plugins) == null ? void 0 : _d.Rest) ? new options.plugins.Rest(this) : null;\n    this._Crypto = (_f = (_e = options.plugins) == null ? void 0 : _e.Crypto) != null ? _f : null;\n    this.__FilteredSubscriptions = (_h = (_g = options.plugins) == null ? void 0 : _g.MessageInteractions) != null ? _h : null;\n    this._Annotations = (_j = (_i = options.plugins) == null ? void 0 : _i.Annotations) != null ? _j : null;\n  }\n  get rest() {\n    if (!this._rest) {\n      throwMissingPluginError(\"Rest\");\n    }\n    return this._rest;\n  }\n  get _FilteredSubscriptions() {\n    if (!this.__FilteredSubscriptions) {\n      throwMissingPluginError(\"MessageInteractions\");\n    }\n    return this.__FilteredSubscriptions;\n  }\n  get channels() {\n    return this.rest.channels;\n  }\n  get push() {\n    return this.rest.push;\n  }\n  /** RSH8 */\n  device() {\n    var _a2;\n    if (!((_a2 = this.options.plugins) == null ? void 0 : _a2.Push) || !this.push.LocalDevice) {\n      throwMissingPluginError(\"Push\");\n    }\n    if (!this._device) {\n      this._device = this.push.LocalDevice.load(this);\n    }\n    return this._device;\n  }\n  baseUri(host) {\n    return defaults_default.getHttpScheme(this.options) + host + \":\" + defaults_default.getPort(this.options, false);\n  }\n  async stats(params) {\n    return this.rest.stats(params);\n  }\n  async time(params) {\n    return this.rest.time(params);\n  }\n  async request(method, path, version2, params, body, customHeaders) {\n    return this.rest.request(method, path, version2, params, body, customHeaders);\n  }\n  batchPublish(specOrSpecs) {\n    return this.rest.batchPublish(specOrSpecs);\n  }\n  batchPresence(channels) {\n    return this.rest.batchPresence(channels);\n  }\n  setLog(logOptions) {\n    this.logger.setLog(logOptions.level, logOptions.handler);\n  }\n  /**\n   * Get the current time based on the local clock,\n   * or if the option queryTime is true, return the server time.\n   * The server time offset from the local time is stored so that\n   * only one request to the server to get the time is ever needed\n   */\n  async getTimestamp(queryTime) {\n    if (!this.isTimeOffsetSet() && queryTime) {\n      return this.time();\n    }\n    return this.getTimestampUsingOffset();\n  }\n  getTimestampUsingOffset() {\n    return Date.now() + (this.serverTimeOffset || 0);\n  }\n  isTimeOffsetSet() {\n    return this.serverTimeOffset !== null;\n  }\n};\nBaseClient.Platform = Platform;\nvar baseclient_default = BaseClient;\n\n// src/common/lib/types/devicedetails.ts\nvar DeviceDetails = class _DeviceDetails {\n  toJSON() {\n    var _a2, _b, _c;\n    return {\n      id: this.id,\n      deviceSecret: this.deviceSecret,\n      platform: this.platform,\n      formFactor: this.formFactor,\n      clientId: this.clientId,\n      metadata: this.metadata,\n      deviceIdentityToken: this.deviceIdentityToken,\n      push: {\n        recipient: (_a2 = this.push) == null ? void 0 : _a2.recipient,\n        state: (_b = this.push) == null ? void 0 : _b.state,\n        error: (_c = this.push) == null ? void 0 : _c.error\n      }\n    };\n  }\n  toString() {\n    var _a2, _b, _c, _d;\n    let result = \"[DeviceDetails\";\n    if (this.id)\n      result += \"; id=\" + this.id;\n    if (this.platform)\n      result += \"; platform=\" + this.platform;\n    if (this.formFactor)\n      result += \"; formFactor=\" + this.formFactor;\n    if (this.clientId)\n      result += \"; clientId=\" + this.clientId;\n    if (this.metadata)\n      result += \"; metadata=\" + this.metadata;\n    if (this.deviceIdentityToken)\n      result += \"; deviceIdentityToken=\" + JSON.stringify(this.deviceIdentityToken);\n    if ((_a2 = this.push) == null ? void 0 : _a2.recipient)\n      result += \"; push.recipient=\" + JSON.stringify(this.push.recipient);\n    if ((_b = this.push) == null ? void 0 : _b.state)\n      result += \"; push.state=\" + this.push.state;\n    if ((_c = this.push) == null ? void 0 : _c.error)\n      result += \"; push.error=\" + JSON.stringify(this.push.error);\n    if ((_d = this.push) == null ? void 0 : _d.metadata)\n      result += \"; push.metadata=\" + this.push.metadata;\n    result += \"]\";\n    return result;\n  }\n  static toRequestBody(body, MsgPack, format) {\n    return encodeBody(body, MsgPack, format);\n  }\n  static fromResponseBody(body, MsgPack, format) {\n    if (format) {\n      body = decodeBody(body, MsgPack, format);\n    }\n    if (Array.isArray(body)) {\n      return _DeviceDetails.fromValuesArray(body);\n    } else {\n      return _DeviceDetails.fromValues(body);\n    }\n  }\n  static fromValues(values) {\n    values.error = values.error && ErrorInfo.fromValues(values.error);\n    return Object.assign(new _DeviceDetails(), values);\n  }\n  static fromLocalDevice(device) {\n    return Object.assign(new _DeviceDetails(), device);\n  }\n  static fromValuesArray(values) {\n    const count = values.length, result = new Array(count);\n    for (let i = 0; i < count; i++)\n      result[i] = _DeviceDetails.fromValues(values[i]);\n    return result;\n  }\n};\nvar devicedetails_default = DeviceDetails;\n\n// src/common/lib/client/resource.ts\nasync function withAuthDetails(client, headers, params, opCallback) {\n  if (client.http.supportsAuthHeaders) {\n    const authHeaders = await client.auth.getAuthHeaders();\n    return opCallback(mixin(authHeaders, headers), params);\n  } else {\n    const authParams = await client.auth.getAuthParams();\n    return opCallback(headers, mixin(authParams, params));\n  }\n}\nfunction unenvelope(result, MsgPack, format) {\n  if (result.err && !result.body) {\n    return { err: result.err };\n  }\n  if (result.statusCode === HttpStatusCodes_default.NoContent) {\n    return __spreadProps(__spreadValues({}, result), { body: [], unpacked: true });\n  }\n  let body = result.body;\n  if (!result.unpacked) {\n    try {\n      body = decodeBody(body, MsgPack, format);\n    } catch (e) {\n      if (isErrorInfoOrPartialErrorInfo(e)) {\n        return { err: e };\n      } else {\n        return { err: new PartialErrorInfo(inspectError(e), null) };\n      }\n    }\n  }\n  if (!body) {\n    return { err: new PartialErrorInfo(\"unenvelope(): Response body is missing\", null) };\n  }\n  const { statusCode: wrappedStatusCode, response, headers: wrappedHeaders } = body;\n  if (wrappedStatusCode === void 0) {\n    return __spreadProps(__spreadValues({}, result), { body, unpacked: true });\n  }\n  if (wrappedStatusCode < 200 || wrappedStatusCode >= 300) {\n    let wrappedErr = response && response.error || result.err;\n    if (!wrappedErr) {\n      wrappedErr = new Error(\"Error in unenveloping \" + body);\n      wrappedErr.statusCode = wrappedStatusCode;\n    }\n    return { err: wrappedErr, body: response, headers: wrappedHeaders, unpacked: true, statusCode: wrappedStatusCode };\n  }\n  return { err: result.err, body: response, headers: wrappedHeaders, unpacked: true, statusCode: wrappedStatusCode };\n}\nfunction logResult2(result, method, path, params, logger) {\n  if (result.err) {\n    logger_default.logAction(\n      logger,\n      logger_default.LOG_MICRO,\n      \"Resource.\" + method + \"()\",\n      \"Received Error; \" + appendingParams(path, params) + \"; Error: \" + inspectError(result.err)\n    );\n  } else {\n    logger_default.logAction(\n      logger,\n      logger_default.LOG_MICRO,\n      \"Resource.\" + method + \"()\",\n      \"Received; \" + appendingParams(path, params) + \"; Headers: \" + paramString(result.headers) + \"; StatusCode: \" + result.statusCode + \"; Body: \" + (Platform.BufferUtils.isBuffer(result.body) ? \" (Base64): \" + Platform.BufferUtils.base64Encode(result.body) : \": \" + Platform.Config.inspect(result.body))\n    );\n  }\n}\nvar Resource = class _Resource {\n  static async get(client, path, headers, params, envelope, throwError) {\n    return _Resource.do(HttpMethods_default.Get, client, path, null, headers, params, envelope, throwError != null ? throwError : false);\n  }\n  static async delete(client, path, headers, params, envelope, throwError) {\n    return _Resource.do(HttpMethods_default.Delete, client, path, null, headers, params, envelope, throwError);\n  }\n  static async post(client, path, body, headers, params, envelope, throwError) {\n    return _Resource.do(HttpMethods_default.Post, client, path, body, headers, params, envelope, throwError);\n  }\n  static async patch(client, path, body, headers, params, envelope, throwError) {\n    return _Resource.do(HttpMethods_default.Patch, client, path, body, headers, params, envelope, throwError);\n  }\n  static async put(client, path, body, headers, params, envelope, throwError) {\n    return _Resource.do(HttpMethods_default.Put, client, path, body, headers, params, envelope, throwError);\n  }\n  static async do(method, client, path, body, headers, params, envelope, throwError) {\n    if (envelope) {\n      (params = params || {})[\"envelope\"] = envelope;\n    }\n    const logger = client.logger;\n    async function doRequest(headers2, params2) {\n      var _a2;\n      if (logger.shouldLog(logger_default.LOG_MICRO)) {\n        let decodedBody = body;\n        if (((_a2 = headers2[\"content-type\"]) == null ? void 0 : _a2.indexOf(\"msgpack\")) > 0) {\n          try {\n            if (!client._MsgPack) {\n              throwMissingPluginError(\"MsgPack\");\n            }\n            decodedBody = client._MsgPack.decode(body);\n          } catch (decodeErr) {\n            logger_default.logAction(\n              logger,\n              logger_default.LOG_MICRO,\n              \"Resource.\" + method + \"()\",\n              \"Sending MsgPack Decoding Error: \" + inspectError(decodeErr)\n            );\n          }\n        }\n        logger_default.logAction(\n          logger,\n          logger_default.LOG_MICRO,\n          \"Resource.\" + method + \"()\",\n          \"Sending; \" + appendingParams(path, params2) + \"; Body: \" + decodedBody\n        );\n      }\n      const httpResult = await client.http.do(method, path, headers2, body, params2);\n      if (httpResult.error && auth_default.isTokenErr(httpResult.error)) {\n        await client.auth.authorize(null, null);\n        return withAuthDetails(client, headers2, params2, doRequest);\n      }\n      return {\n        err: httpResult.error,\n        body: httpResult.body,\n        headers: httpResult.headers,\n        unpacked: httpResult.unpacked,\n        statusCode: httpResult.statusCode\n      };\n    }\n    let result = await withAuthDetails(client, headers, params, doRequest);\n    if (envelope) {\n      result = unenvelope(result, client._MsgPack, envelope);\n    }\n    if (logger.shouldLog(logger_default.LOG_MICRO)) {\n      logResult2(result, method, path, params, logger);\n    }\n    if (throwError) {\n      if (result.err) {\n        throw result.err;\n      } else {\n        const response = __spreadValues({}, result);\n        delete response.err;\n        return response;\n      }\n    }\n    return result;\n  }\n};\nvar resource_default = Resource;\n\n// src/common/lib/client/paginatedresource.ts\nfunction getRelParams(linkUrl) {\n  const urlMatch = linkUrl.match(/^\\.\\/(\\w+)\\?(.*)$/);\n  return urlMatch && urlMatch[2] && parseQueryString(urlMatch[2]);\n}\nfunction parseRelLinks(linkHeader) {\n  if (typeof linkHeader == \"string\")\n    linkHeader = linkHeader.split(\",\");\n  const relParams = {};\n  for (let i = 0; i < linkHeader.length; i++) {\n    const linkMatch = linkHeader[i].match(/^\\s*<(.+)>;\\s*rel=\"(\\w+)\"$/);\n    if (linkMatch) {\n      const params = getRelParams(linkMatch[1]);\n      if (params)\n        relParams[linkMatch[2]] = params;\n    }\n  }\n  return relParams;\n}\nfunction returnErrOnly(err, body, useHPR) {\n  return !(useHPR && (body || typeof err.code === \"number\"));\n}\nvar PaginatedResource = class {\n  constructor(client, path, headers, envelope, bodyHandler, useHttpPaginatedResponse) {\n    this.client = client;\n    this.path = path;\n    this.headers = headers;\n    this.envelope = envelope != null ? envelope : null;\n    this.bodyHandler = bodyHandler;\n    this.useHttpPaginatedResponse = useHttpPaginatedResponse || false;\n  }\n  get logger() {\n    return this.client.logger;\n  }\n  async get(params) {\n    const result = await resource_default.get(this.client, this.path, this.headers, params, this.envelope, false);\n    return this.handlePage(result);\n  }\n  async delete(params) {\n    const result = await resource_default.delete(this.client, this.path, this.headers, params, this.envelope, false);\n    return this.handlePage(result);\n  }\n  async post(params, body) {\n    const result = await resource_default.post(this.client, this.path, body, this.headers, params, this.envelope, false);\n    return this.handlePage(result);\n  }\n  async put(params, body) {\n    const result = await resource_default.put(this.client, this.path, body, this.headers, params, this.envelope, false);\n    return this.handlePage(result);\n  }\n  async patch(params, body) {\n    const result = await resource_default.patch(this.client, this.path, body, this.headers, params, this.envelope, false);\n    return this.handlePage(result);\n  }\n  async handlePage(result) {\n    if (result.err && returnErrOnly(result.err, result.body, this.useHttpPaginatedResponse)) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"PaginatedResource.handlePage()\",\n        \"Unexpected error getting resource: err = \" + inspectError(result.err)\n      );\n      throw result.err;\n    }\n    let items, linkHeader, relParams;\n    try {\n      items = result.statusCode == HttpStatusCodes_default.NoContent ? [] : await this.bodyHandler(result.body, result.headers || {}, result.unpacked);\n    } catch (e) {\n      throw result.err || e;\n    }\n    if (result.headers && (linkHeader = result.headers[\"Link\"] || result.headers[\"link\"])) {\n      relParams = parseRelLinks(linkHeader);\n    }\n    if (this.useHttpPaginatedResponse) {\n      return new HttpPaginatedResponse(\n        this,\n        items,\n        result.headers || {},\n        result.statusCode,\n        relParams,\n        result.err\n      );\n    } else {\n      return new PaginatedResult(this, items, relParams);\n    }\n  }\n};\nvar PaginatedResult = class {\n  constructor(resource, items, relParams) {\n    this.resource = resource;\n    this.items = items;\n    this._relParams = relParams;\n  }\n  async first() {\n    if (this.hasFirst()) {\n      return this.get(this._relParams.first);\n    }\n    throw new ErrorInfo(\"No link to the first page of results\", 40400, 404);\n  }\n  async current() {\n    if (this.hasCurrent()) {\n      return this.get(this._relParams.current);\n    }\n    throw new ErrorInfo(\"No link to the current page of results\", 40400, 404);\n  }\n  async next() {\n    if (this.hasNext()) {\n      return this.get(this._relParams.next);\n    }\n    return null;\n  }\n  hasFirst() {\n    return this._relParams != null && \"first\" in this._relParams;\n  }\n  hasCurrent() {\n    return this._relParams != null && \"current\" in this._relParams;\n  }\n  hasNext() {\n    return this._relParams != null && \"next\" in this._relParams;\n  }\n  isLast() {\n    return !this.hasNext();\n  }\n  /* We assume that only the initial request can be a POST, and that accessing\n   * the rest of a multipage set of results can always be done with GET */\n  async get(params) {\n    const res = this.resource;\n    const result = await resource_default.get(res.client, res.path, res.headers, params, res.envelope, false);\n    return res.handlePage(result);\n  }\n};\nvar HttpPaginatedResponse = class extends PaginatedResult {\n  constructor(resource, items, headers, statusCode, relParams, err) {\n    super(resource, items, relParams);\n    this.statusCode = statusCode;\n    this.success = statusCode < 300 && statusCode >= 200;\n    this.headers = headers;\n    this.errorCode = err && err.code;\n    this.errorMessage = err && err.message;\n  }\n  toJSON() {\n    return {\n      items: this.items,\n      statusCode: this.statusCode,\n      success: this.success,\n      headers: this.headers,\n      errorCode: this.errorCode,\n      errorMessage: this.errorMessage\n    };\n  }\n};\nvar paginatedresource_default = PaginatedResource;\n\n// src/common/lib/types/pushchannelsubscription.ts\nvar _PushChannelSubscription = class _PushChannelSubscription {\n  /**\n   * Overload toJSON() to intercept JSON.stringify()\n   * @return {*}\n   */\n  toJSON() {\n    return {\n      channel: this.channel,\n      deviceId: this.deviceId,\n      clientId: this.clientId\n    };\n  }\n  toString() {\n    let result = \"[PushChannelSubscription\";\n    if (this.channel)\n      result += \"; channel=\" + this.channel;\n    if (this.deviceId)\n      result += \"; deviceId=\" + this.deviceId;\n    if (this.clientId)\n      result += \"; clientId=\" + this.clientId;\n    result += \"]\";\n    return result;\n  }\n  static fromResponseBody(body, MsgPack, format) {\n    if (format) {\n      body = decodeBody(body, MsgPack, format);\n    }\n    if (Array.isArray(body)) {\n      return _PushChannelSubscription.fromValuesArray(body);\n    } else {\n      return _PushChannelSubscription.fromValues(body);\n    }\n  }\n  static fromValues(values) {\n    return Object.assign(new _PushChannelSubscription(), values);\n  }\n  static fromValuesArray(values) {\n    const count = values.length, result = new Array(count);\n    for (let i = 0; i < count; i++)\n      result[i] = _PushChannelSubscription.fromValues(values[i]);\n    return result;\n  }\n};\n_PushChannelSubscription.toRequestBody = encodeBody;\nvar PushChannelSubscription = _PushChannelSubscription;\nvar pushchannelsubscription_default = PushChannelSubscription;\n\n// src/common/lib/client/push.ts\nvar Push = class {\n  constructor(client) {\n    var _a2;\n    this.client = client;\n    this.admin = new Admin(client);\n    if (Platform.Config.push && ((_a2 = client.options.plugins) == null ? void 0 : _a2.Push)) {\n      this.stateMachine = new client.options.plugins.Push.ActivationStateMachine(client);\n      this.LocalDevice = client.options.plugins.Push.localDeviceFactory(devicedetails_default);\n    }\n  }\n  async activate(registerCallback, updateFailedCallback) {\n    await new Promise((resolve, reject) => {\n      var _a2;\n      if (!((_a2 = this.client.options.plugins) == null ? void 0 : _a2.Push)) {\n        reject(createMissingPluginError(\"Push\"));\n        return;\n      }\n      if (!this.stateMachine) {\n        reject(new ErrorInfo(\"This platform is not supported as a target of push notifications\", 4e4, 400));\n        return;\n      }\n      if (this.stateMachine.activatedCallback) {\n        reject(new ErrorInfo(\"Activation already in progress\", 4e4, 400));\n        return;\n      }\n      this.stateMachine.activatedCallback = (err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve();\n      };\n      this.stateMachine.updateFailedCallback = updateFailedCallback;\n      this.stateMachine.handleEvent(\n        new this.client.options.plugins.Push.CalledActivate(this.stateMachine, registerCallback)\n      );\n    });\n  }\n  async deactivate(deregisterCallback) {\n    await new Promise((resolve, reject) => {\n      var _a2;\n      if (!((_a2 = this.client.options.plugins) == null ? void 0 : _a2.Push)) {\n        reject(createMissingPluginError(\"Push\"));\n        return;\n      }\n      if (!this.stateMachine) {\n        reject(new ErrorInfo(\"This platform is not supported as a target of push notifications\", 4e4, 400));\n        return;\n      }\n      if (this.stateMachine.deactivatedCallback) {\n        reject(new ErrorInfo(\"Deactivation already in progress\", 4e4, 400));\n        return;\n      }\n      this.stateMachine.deactivatedCallback = (err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve();\n      };\n      this.stateMachine.handleEvent(\n        new this.client.options.plugins.Push.CalledDeactivate(this.stateMachine, deregisterCallback)\n      );\n    });\n  }\n};\nvar Admin = class {\n  constructor(client) {\n    this.client = client;\n    this.deviceRegistrations = new DeviceRegistrations(client);\n    this.channelSubscriptions = new ChannelSubscriptions(client);\n  }\n  async publish(recipient, payload) {\n    const client = this.client;\n    const format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultPostHeaders(client.options), params = {};\n    const body = mixin({ recipient }, payload);\n    mixin(headers, client.options.headers);\n    if (client.options.pushFullWait)\n      mixin(params, { fullWait: \"true\" });\n    const requestBody = encodeBody(body, client._MsgPack, format);\n    await resource_default.post(client, \"/push/publish\", requestBody, headers, params, null, true);\n  }\n};\nvar DeviceRegistrations = class {\n  constructor(client) {\n    this.client = client;\n  }\n  async save(device) {\n    const client = this.client;\n    const body = devicedetails_default.fromValues(device);\n    const format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultPostHeaders(client.options), params = {};\n    mixin(headers, client.options.headers);\n    if (client.options.pushFullWait)\n      mixin(params, { fullWait: \"true\" });\n    const requestBody = encodeBody(body, client._MsgPack, format);\n    const response = await resource_default.put(\n      client,\n      \"/push/deviceRegistrations/\" + encodeURIComponent(device.id),\n      requestBody,\n      headers,\n      params,\n      null,\n      true\n    );\n    return devicedetails_default.fromResponseBody(\n      response.body,\n      client._MsgPack,\n      response.unpacked ? void 0 : format\n    );\n  }\n  async get(deviceIdOrDetails) {\n    const client = this.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultGetHeaders(client.options), deviceId = deviceIdOrDetails.id || deviceIdOrDetails;\n    if (typeof deviceId !== \"string\" || !deviceId.length) {\n      throw new ErrorInfo(\n        \"First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails\",\n        4e4,\n        400\n      );\n    }\n    mixin(headers, client.options.headers);\n    const response = await resource_default.get(\n      client,\n      \"/push/deviceRegistrations/\" + encodeURIComponent(deviceId),\n      headers,\n      {},\n      null,\n      true\n    );\n    return devicedetails_default.fromResponseBody(\n      response.body,\n      client._MsgPack,\n      response.unpacked ? void 0 : format\n    );\n  }\n  async list(params) {\n    const client = this.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, envelope = this.client.http.supportsLinkHeaders ? void 0 : format, headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    return new paginatedresource_default(client, \"/push/deviceRegistrations\", headers, envelope, async function(body, headers2, unpacked) {\n      return devicedetails_default.fromResponseBody(\n        body,\n        client._MsgPack,\n        unpacked ? void 0 : format\n      );\n    }).get(params);\n  }\n  async remove(deviceIdOrDetails) {\n    const client = this.client, headers = defaults_default.defaultGetHeaders(client.options), params = {}, deviceId = deviceIdOrDetails.id || deviceIdOrDetails;\n    if (typeof deviceId !== \"string\" || !deviceId.length) {\n      throw new ErrorInfo(\n        \"First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails\",\n        4e4,\n        400\n      );\n    }\n    mixin(headers, client.options.headers);\n    if (client.options.pushFullWait)\n      mixin(params, { fullWait: \"true\" });\n    await resource_default[\"delete\"](\n      client,\n      \"/push/deviceRegistrations/\" + encodeURIComponent(deviceId),\n      headers,\n      params,\n      null,\n      true\n    );\n  }\n  async removeWhere(params) {\n    const client = this.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultGetHeaders(client.options, { format });\n    mixin(headers, client.options.headers);\n    if (client.options.pushFullWait)\n      mixin(params, { fullWait: \"true\" });\n    await resource_default[\"delete\"](client, \"/push/deviceRegistrations\", headers, params, null, true);\n  }\n};\nvar ChannelSubscriptions = class _ChannelSubscriptions {\n  constructor(client) {\n    /* ChannelSubscriptions have no unique id; removing one is equivalent to removeWhere by its properties */\n    this.remove = _ChannelSubscriptions.prototype.removeWhere;\n    this.client = client;\n  }\n  async save(subscription) {\n    const client = this.client;\n    const body = pushchannelsubscription_default.fromValues(subscription);\n    const format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultPostHeaders(client.options), params = {};\n    mixin(headers, client.options.headers);\n    if (client.options.pushFullWait)\n      mixin(params, { fullWait: \"true\" });\n    const requestBody = encodeBody(body, client._MsgPack, format);\n    const response = await resource_default.post(\n      client,\n      \"/push/channelSubscriptions\",\n      requestBody,\n      headers,\n      params,\n      null,\n      true\n    );\n    return pushchannelsubscription_default.fromResponseBody(\n      response.body,\n      client._MsgPack,\n      response.unpacked ? void 0 : format\n    );\n  }\n  async list(params) {\n    const client = this.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, envelope = this.client.http.supportsLinkHeaders ? void 0 : format, headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    return new paginatedresource_default(client, \"/push/channelSubscriptions\", headers, envelope, async function(body, headers2, unpacked) {\n      return pushchannelsubscription_default.fromResponseBody(\n        body,\n        client._MsgPack,\n        unpacked ? void 0 : format\n      );\n    }).get(params);\n  }\n  async removeWhere(params) {\n    const client = this.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultGetHeaders(client.options, { format });\n    mixin(headers, client.options.headers);\n    if (client.options.pushFullWait)\n      mixin(params, { fullWait: \"true\" });\n    await resource_default[\"delete\"](client, \"/push/channelSubscriptions\", headers, params, null, true);\n  }\n  async listChannels(params) {\n    const client = this.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, envelope = this.client.http.supportsLinkHeaders ? void 0 : format, headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    if (client.options.pushFullWait)\n      mixin(params, { fullWait: \"true\" });\n    return new paginatedresource_default(client, \"/push/channels\", headers, envelope, async function(body, headers2, unpacked) {\n      const parsedBody = !unpacked && format ? decodeBody(body, client._MsgPack, format) : body;\n      for (let i = 0; i < parsedBody.length; i++) {\n        parsedBody[i] = String(parsedBody[i]);\n      }\n      return parsedBody;\n    }).get(params);\n  }\n};\nvar push_default = Push;\n\n// src/common/lib/types/presencemessage.ts\nvar actions2 = [\"absent\", \"present\", \"enter\", \"leave\", \"update\"];\nasync function fromEncoded(logger, Crypto2, encoded, inputOptions) {\n  const options = normalizeCipherOptions(Crypto2, logger, inputOptions != null ? inputOptions : null);\n  const wpm = WirePresenceMessage.fromValues(encoded);\n  return wpm.decode(options, logger);\n}\nasync function fromEncodedArray(logger, Crypto2, encodedArray, options) {\n  return Promise.all(\n    encodedArray.map(function(encoded) {\n      return fromEncoded(logger, Crypto2, encoded, options);\n    })\n  );\n}\nasync function _fromEncoded(encoded, channel) {\n  return WirePresenceMessage.fromValues(encoded).decode(channel.channelOptions, channel.logger);\n}\nasync function _fromEncodedArray(encodedArray, channel) {\n  return Promise.all(\n    encodedArray.map(function(encoded) {\n      return _fromEncoded(encoded, channel);\n    })\n  );\n}\nvar PresenceMessage = class _PresenceMessage extends BaseMessage {\n  /* Returns whether this presenceMessage is synthesized, i.e. was not actually\n   * sent by the connection (usually means a leave event sent 15s after a\n   * disconnection). This is useful because synthesized messages cannot be\n   * compared for newness by id lexicographically - RTP2b1\n   */\n  isSynthesized() {\n    if (!this.id || !this.connectionId) {\n      return true;\n    }\n    return this.id.substring(this.connectionId.length, 0) !== this.connectionId;\n  }\n  /* RTP2b2 */\n  parseId() {\n    if (!this.id)\n      throw new Error(\"parseId(): Presence message does not contain an id\");\n    const parts = this.id.split(\":\");\n    return {\n      connectionId: parts[0],\n      msgSerial: parseInt(parts[1], 10),\n      index: parseInt(parts[2], 10)\n    };\n  }\n  async encode(options) {\n    const res = Object.assign(new WirePresenceMessage(), this, {\n      action: actions2.indexOf(this.action || \"present\")\n    });\n    return encode(res, options);\n  }\n  static fromValues(values) {\n    return Object.assign(new _PresenceMessage(), values);\n  }\n  static fromValuesArray(values) {\n    return values.map((v) => _PresenceMessage.fromValues(v));\n  }\n  static fromData(data) {\n    if (data instanceof _PresenceMessage) {\n      return data;\n    }\n    return _PresenceMessage.fromValues({\n      data\n    });\n  }\n  toString() {\n    return strMsg(this, \"PresenceMessage\");\n  }\n};\nvar WirePresenceMessage = class _WirePresenceMessage extends BaseMessage {\n  toJSON(...args) {\n    return wireToJSON.call(this, ...args);\n  }\n  static fromValues(values) {\n    return Object.assign(new _WirePresenceMessage(), values);\n  }\n  static fromValuesArray(values) {\n    return values.map((v) => _WirePresenceMessage.fromValues(v));\n  }\n  async decode(channelOptions, logger) {\n    const res = Object.assign(new PresenceMessage(), __spreadProps(__spreadValues({}, this), {\n      action: actions2[this.action]\n    }));\n    try {\n      await decode(res, channelOptions);\n    } catch (e) {\n      logger_default.logAction(logger, logger_default.LOG_ERROR, \"WirePresenceMessage.decode()\", inspectError(e));\n    }\n    return res;\n  }\n  toString() {\n    return strMsg(this, \"WirePresenceMessage\");\n  }\n};\nvar presencemessage_default = PresenceMessage;\n\n// src/common/lib/client/restpresence.ts\nvar RestPresence = class {\n  constructor(channel) {\n    this.channel = channel;\n  }\n  get logger() {\n    return this.channel.logger;\n  }\n  async get(params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RestPresence.get()\", \"channel = \" + this.channel.name);\n    const client = this.channel.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, envelope = this.channel.client.http.supportsLinkHeaders ? void 0 : format, headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    return new paginatedresource_default(\n      client,\n      this.channel.client.rest.presenceMixin.basePath(this),\n      headers,\n      envelope,\n      async (body, headers2, unpacked) => {\n        const decoded = unpacked ? body : decodeBody(body, client._MsgPack, format);\n        return _fromEncodedArray(decoded, this.channel);\n      }\n    ).get(params);\n  }\n  async history(params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RestPresence.history()\", \"channel = \" + this.channel.name);\n    return this.channel.client.rest.presenceMixin.history(this, params);\n  }\n};\nvar restpresence_default = RestPresence;\n\n// src/common/lib/types/message.ts\nvar actions3 = [\"message.create\", \"message.update\", \"message.delete\", \"meta\", \"message.summary\"];\nfunction stringifyAction(action) {\n  return actions3[action || 0] || \"unknown\";\n}\nfunction getMessageSize(msg) {\n  let size = 0;\n  if (msg.name) {\n    size += msg.name.length;\n  }\n  if (msg.clientId) {\n    size += msg.clientId.length;\n  }\n  if (msg.extras) {\n    size += JSON.stringify(msg.extras).length;\n  }\n  if (msg.data) {\n    size += dataSizeBytes(msg.data);\n  }\n  return size;\n}\nasync function fromEncoded2(logger, Crypto2, encoded, inputOptions) {\n  const options = normalizeCipherOptions(Crypto2, logger, inputOptions != null ? inputOptions : null);\n  const wm = WireMessage.fromValues(encoded);\n  return wm.decode(options, logger);\n}\nasync function fromEncodedArray2(logger, Crypto2, encodedArray, options) {\n  return Promise.all(\n    encodedArray.map(function(encoded) {\n      return fromEncoded2(logger, Crypto2, encoded, options);\n    })\n  );\n}\nasync function _fromEncoded2(encoded, channel) {\n  const wm = WireMessage.fromValues(encoded);\n  return wm.decode(channel.channelOptions, channel.logger);\n}\nasync function _fromEncodedArray2(encodedArray, channel) {\n  return Promise.all(\n    encodedArray.map(function(encoded) {\n      return _fromEncoded2(encoded, channel);\n    })\n  );\n}\nasync function encodeArray(messages, options) {\n  return Promise.all(messages.map((message) => message.encode(options)));\n}\nvar serialize = encodeBody;\nfunction getMessagesSize(messages) {\n  let msg, total = 0;\n  for (let i = 0; i < messages.length; i++) {\n    msg = messages[i];\n    total += msg.size || (msg.size = getMessageSize(msg));\n  }\n  return total;\n}\nvar Message = class _Message extends BaseMessage {\n  expandFields() {\n    if (!this.version) {\n      this.version = {};\n    }\n    if (!this.version.serial && this.serial) {\n      this.version.serial = this.serial;\n    }\n    if (!this.version.timestamp && this.timestamp) {\n      this.version.timestamp = this.timestamp;\n    }\n    if (!this.annotations) {\n      this.annotations = {\n        summary: {}\n      };\n    } else if (!this.annotations.summary) {\n      this.annotations.summary = {};\n    }\n    if (this.annotations && this.annotations.summary) {\n      for (const [type, summaryEntry] of Object.entries(this.annotations.summary)) {\n        if (type.endsWith(\":distinct.v1\") || type.endsWith(\":unique.v1\") || type.endsWith(\":multiple.v1\")) {\n          for (const [, entry] of Object.entries(summaryEntry)) {\n            if (!entry.clipped) {\n              entry.clipped = false;\n            }\n          }\n        } else if (type.endsWith(\":flag.v1\")) {\n          if (!summaryEntry.clipped) {\n            summaryEntry.clipped = false;\n          }\n        }\n      }\n    }\n  }\n  async encode(options) {\n    const res = Object.assign(new WireMessage(), this, {\n      action: actions3.indexOf(this.action || \"message.create\")\n    });\n    return encode(res, options);\n  }\n  static fromValues(values) {\n    return Object.assign(new _Message(), values);\n  }\n  static fromValuesArray(values) {\n    return values.map((v) => _Message.fromValues(v));\n  }\n  toString() {\n    return strMsg(this, \"Message\");\n  }\n};\nvar WireMessage = class _WireMessage extends BaseMessage {\n  // Overload toJSON() to intercept JSON.stringify()\n  toJSON(...args) {\n    return wireToJSON.call(this, ...args);\n  }\n  static fromValues(values) {\n    return Object.assign(new _WireMessage(), values);\n  }\n  static fromValuesArray(values) {\n    return values.map((v) => _WireMessage.fromValues(v));\n  }\n  // for contexts where some decoding errors need to be handled specially by the caller\n  async decodeWithErr(inputContext, logger) {\n    const res = Object.assign(new Message(), __spreadProps(__spreadValues({}, this), {\n      action: stringifyAction(this.action)\n    }));\n    let err;\n    try {\n      await decode(res, inputContext);\n    } catch (e) {\n      logger_default.logAction(logger, logger_default.LOG_ERROR, \"WireMessage.decode()\", inspectError(e));\n      err = e;\n    }\n    res.expandFields();\n    return { decoded: res, err };\n  }\n  async decode(inputContext, logger) {\n    const { decoded } = await this.decodeWithErr(inputContext, logger);\n    return decoded;\n  }\n  toString() {\n    return strMsg(this, \"WireMessage\");\n  }\n};\nvar message_default = Message;\n\n// src/common/lib/client/restchannel.ts\nvar MSG_ID_ENTROPY_BYTES = 9;\nfunction allEmptyIds(messages) {\n  return messages.every(function(message) {\n    return !message.id;\n  });\n}\nvar RestChannel = class {\n  constructor(client, name, channelOptions) {\n    this._annotations = null;\n    var _a2, _b;\n    logger_default.logAction(client.logger, logger_default.LOG_MINOR, \"RestChannel()\", \"started; name = \" + name);\n    this.name = name;\n    this.client = client;\n    this.presence = new restpresence_default(this);\n    this.channelOptions = normaliseChannelOptions((_a2 = client._Crypto) != null ? _a2 : null, this.logger, channelOptions);\n    if ((_b = client.options.plugins) == null ? void 0 : _b.Push) {\n      this._push = new client.options.plugins.Push.PushChannel(this);\n    }\n    if (client._Annotations) {\n      this._annotations = new client._Annotations.RestAnnotations(this);\n    }\n  }\n  get annotations() {\n    if (!this._annotations) {\n      throwMissingPluginError(\"Annotations\");\n    }\n    return this._annotations;\n  }\n  get push() {\n    if (!this._push) {\n      throwMissingPluginError(\"Push\");\n    }\n    return this._push;\n  }\n  get logger() {\n    return this.client.logger;\n  }\n  setOptions(options) {\n    var _a2;\n    this.channelOptions = normaliseChannelOptions((_a2 = this.client._Crypto) != null ? _a2 : null, this.logger, options);\n  }\n  async history(params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RestChannel.history()\", \"channel = \" + this.name);\n    return this.client.rest.channelMixin.history(this, params);\n  }\n  async publish(...args) {\n    const first = args[0], second = args[1];\n    let messages;\n    let params;\n    if (typeof first === \"string\" || first === null) {\n      messages = [message_default.fromValues({ name: first, data: second })];\n      params = args[2];\n    } else if (isObject(first)) {\n      messages = [message_default.fromValues(first)];\n      params = args[1];\n    } else if (Array.isArray(first)) {\n      messages = message_default.fromValuesArray(first);\n      params = args[1];\n    } else {\n      throw new ErrorInfo(\n        \"The single-argument form of publish() expects a message object or an array of message objects\",\n        40013,\n        400\n      );\n    }\n    if (!params) {\n      params = {};\n    }\n    const client = this.client, options = client.options, format = options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, idempotentRestPublishing = client.options.idempotentRestPublishing, headers = defaults_default.defaultPostHeaders(client.options);\n    mixin(headers, options.headers);\n    if (idempotentRestPublishing && allEmptyIds(messages)) {\n      const msgIdBase = await randomString(MSG_ID_ENTROPY_BYTES);\n      messages.forEach(function(message, index) {\n        message.id = msgIdBase + \":\" + index.toString();\n      });\n    }\n    const wireMessages = await encodeArray(messages, this.channelOptions);\n    const size = getMessagesSize(wireMessages), maxMessageSize = options.maxMessageSize;\n    if (size > maxMessageSize) {\n      throw new ErrorInfo(\n        `Maximum size of messages that can be published at once exceeded (was ${size} bytes; limit is ${maxMessageSize} bytes)`,\n        40009,\n        400\n      );\n    }\n    await this._publish(serialize(wireMessages, client._MsgPack, format), headers, params);\n  }\n  async _publish(requestBody, headers, params) {\n    await resource_default.post(\n      this.client,\n      this.client.rest.channelMixin.basePath(this) + \"/messages\",\n      requestBody,\n      headers,\n      params,\n      null,\n      true\n    );\n  }\n  async status() {\n    return this.client.rest.channelMixin.status(this);\n  }\n  async getMessage(serialOrMessage) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RestChannel.getMessage()\", \"channel = \" + this.name);\n    return this.client.rest.channelMixin.getMessage(this, serialOrMessage);\n  }\n  async updateMessage(message, operation, params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RestChannel.updateMessage()\", \"channel = \" + this.name);\n    return this.client.rest.channelMixin.updateDeleteMessage(this, { isDelete: false }, message, operation, params);\n  }\n  async deleteMessage(message, operation, params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RestChannel.deleteMessage()\", \"channel = \" + this.name);\n    return this.client.rest.channelMixin.updateDeleteMessage(this, { isDelete: true }, message, operation, params);\n  }\n  async getMessageVersions(serialOrMessage, params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RestChannel.getMessageVersions()\", \"channel = \" + this.name);\n    return this.client.rest.channelMixin.getMessageVersions(this, serialOrMessage, params);\n  }\n};\nvar restchannel_default = RestChannel;\n\n// src/common/lib/types/stats.ts\nvar Stats = class _Stats {\n  constructor(values) {\n    this.entries = values && values.entries || void 0;\n    this.schema = values && values.schema || void 0;\n    this.appId = values && values.appId || void 0;\n    this.inProgress = values && values.inProgress || void 0;\n    this.unit = values && values.unit || void 0;\n    this.intervalId = values && values.intervalId || void 0;\n  }\n  static fromValues(values) {\n    return new _Stats(values);\n  }\n};\nvar stats_default = Stats;\n\n// src/common/lib/client/restchannelmixin.ts\nvar RestChannelMixin = class {\n  static basePath(channel) {\n    return \"/channels/\" + encodeURIComponent(channel.name);\n  }\n  static history(channel, params) {\n    const client = channel.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, envelope = channel.client.http.supportsLinkHeaders ? void 0 : format, headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    return new paginatedresource_default(client, this.basePath(channel) + \"/messages\", headers, envelope, async function(body, headers2, unpacked) {\n      const decoded = unpacked ? body : decodeBody(body, client._MsgPack, format);\n      return _fromEncodedArray2(decoded, channel);\n    }).get(params);\n  }\n  static async status(channel) {\n    const format = channel.client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */;\n    const headers = defaults_default.defaultPostHeaders(channel.client.options);\n    const response = await resource_default.get(\n      channel.client,\n      this.basePath(channel),\n      headers,\n      {},\n      format,\n      true\n    );\n    return response.body;\n  }\n  static async getMessage(channel, serialOrMessage) {\n    const serial = typeof serialOrMessage === \"string\" ? serialOrMessage : serialOrMessage.serial;\n    if (!serial) {\n      throw new ErrorInfo(\n        'This message lacks a serial. Make sure you have enabled \"Message annotations, updates, and deletes\" in channel settings on your dashboard.',\n        40003,\n        400\n      );\n    }\n    const client = channel.client;\n    const format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */;\n    const headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    const { body, unpacked } = await resource_default.get(\n      client,\n      this.basePath(channel) + \"/messages/\" + encodeURIComponent(serial),\n      headers,\n      {},\n      null,\n      true\n    );\n    const decoded = unpacked ? body : decodeBody(body, client._MsgPack, format);\n    return _fromEncoded2(decoded, channel);\n  }\n  static async updateDeleteMessage(channel, opts, message, operation, params) {\n    if (!message.serial) {\n      throw new ErrorInfo(\n        'This message lacks a serial and cannot be updated. Make sure you have enabled \"Message annotations, updates, and deletes\" in channel settings on your dashboard.',\n        40003,\n        400\n      );\n    }\n    const client = channel.client;\n    const format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */;\n    const headers = defaults_default.defaultPostHeaders(client.options);\n    mixin(headers, client.options.headers);\n    let encoded = null;\n    if (message.data !== void 0) {\n      encoded = await message_default.fromValues(message).encode(channel.channelOptions);\n    }\n    const req = {\n      serial: message.serial,\n      operation,\n      name: message.name,\n      data: encoded && encoded.data,\n      encoding: encoded && encoded.encoding,\n      extras: message.extras\n    };\n    const requestBody = serialize(req, client._MsgPack, format);\n    const method = opts.isDelete ? resource_default.post : resource_default.patch;\n    const pathSuffix = opts.isDelete ? \"/delete\" : \"\";\n    await method(\n      client,\n      this.basePath(channel) + \"/messages/\" + encodeURIComponent(message.serial) + pathSuffix,\n      requestBody,\n      headers,\n      params || {},\n      null,\n      true\n    );\n  }\n  static getMessageVersions(channel, serialOrMessage, params) {\n    const serial = typeof serialOrMessage === \"string\" ? serialOrMessage : serialOrMessage.serial;\n    if (!serial) {\n      throw new ErrorInfo(\n        'This message lacks a serial. Make sure you have enabled \"Message annotations, updates, and deletes\" in channel settings on your dashboard.',\n        40003,\n        400\n      );\n    }\n    const client = channel.client;\n    const format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */;\n    const envelope = channel.client.http.supportsLinkHeaders ? void 0 : format;\n    const headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    return new paginatedresource_default(\n      client,\n      this.basePath(channel) + \"/messages/\" + encodeURIComponent(serial) + \"/versions\",\n      headers,\n      envelope,\n      async (body, headers2, unpacked) => {\n        const decoded = unpacked ? body : decodeBody(body, client._MsgPack, format);\n        return _fromEncodedArray2(decoded, channel);\n      }\n    ).get(params || {});\n  }\n};\n\n// src/common/lib/client/restpresencemixin.ts\nvar RestPresenceMixin = class {\n  static basePath(presence) {\n    return RestChannelMixin.basePath(presence.channel) + \"/presence\";\n  }\n  static async history(presence, params) {\n    const client = presence.channel.client, format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, envelope = presence.channel.client.http.supportsLinkHeaders ? void 0 : format, headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    return new paginatedresource_default(\n      client,\n      this.basePath(presence) + \"/history\",\n      headers,\n      envelope,\n      async (body, headers2, unpacked) => {\n        const decoded = unpacked ? body : decodeBody(body, client._MsgPack, format);\n        return _fromEncodedArray(decoded, presence.channel);\n      }\n    ).get(params);\n  }\n};\n\n// src/common/lib/client/rest.ts\nvar Rest = class {\n  constructor(client) {\n    this.channelMixin = RestChannelMixin;\n    this.presenceMixin = RestPresenceMixin;\n    // exposed for plugins but shouldn't be bundled with minimal realtime\n    this.Resource = resource_default;\n    this.PaginatedResource = paginatedresource_default;\n    this.DeviceDetails = devicedetails_default;\n    this.PushChannelSubscription = pushchannelsubscription_default;\n    this.client = client;\n    this.channels = new Channels(this.client);\n    this.push = new push_default(this.client);\n  }\n  async stats(params) {\n    const headers = defaults_default.defaultGetHeaders(this.client.options), format = this.client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, envelope = this.client.http.supportsLinkHeaders ? void 0 : format;\n    mixin(headers, this.client.options.headers);\n    return new paginatedresource_default(this.client, \"/stats\", headers, envelope, async (body, _, unpacked) => {\n      const statsValues = unpacked ? body : decodeBody(body, this.client._MsgPack, format);\n      for (let i = 0; i < statsValues.length; i++)\n        statsValues[i] = stats_default.fromValues(statsValues[i]);\n      return statsValues;\n    }).get(params);\n  }\n  async time(params) {\n    const headers = defaults_default.defaultGetHeaders(this.client.options, { format: \"json\" /* json */ });\n    if (this.client.options.headers)\n      mixin(headers, this.client.options.headers);\n    const timeUri = (host) => {\n      return this.client.baseUri(host) + \"/time\";\n    };\n    let { error, body, unpacked } = await this.client.http.do(\n      HttpMethods_default.Get,\n      timeUri,\n      headers,\n      null,\n      params\n    );\n    if (error) {\n      throw error;\n    }\n    if (!unpacked)\n      body = JSON.parse(body);\n    const time = body[0];\n    if (!time) {\n      throw new ErrorInfo(\"Internal error (unexpected result type from GET /time)\", 5e4, 500);\n    }\n    this.client.serverTimeOffset = time - Date.now();\n    return time;\n  }\n  async request(method, path, version2, params, body, customHeaders) {\n    var _a2;\n    const [encoder, decoder, format] = (() => {\n      if (this.client.options.useBinaryProtocol) {\n        if (!this.client._MsgPack) {\n          throwMissingPluginError(\"MsgPack\");\n        }\n        return [this.client._MsgPack.encode, this.client._MsgPack.decode, \"msgpack\" /* msgpack */];\n      } else {\n        return [JSON.stringify, JSON.parse, \"json\" /* json */];\n      }\n    })();\n    const envelope = this.client.http.supportsLinkHeaders ? void 0 : format;\n    params = params || {};\n    const _method = method.toLowerCase();\n    const headers = _method == \"get\" ? defaults_default.defaultGetHeaders(this.client.options, { format, protocolVersion: version2 }) : defaults_default.defaultPostHeaders(this.client.options, { format, protocolVersion: version2 });\n    if (typeof body !== \"string\") {\n      body = (_a2 = encoder(body)) != null ? _a2 : null;\n    }\n    mixin(headers, this.client.options.headers);\n    if (customHeaders) {\n      mixin(headers, customHeaders);\n    }\n    const paginatedResource = new paginatedresource_default(\n      this.client,\n      path,\n      headers,\n      envelope,\n      async function(resbody, headers2, unpacked) {\n        return ensureArray(unpacked ? resbody : decoder(resbody));\n      },\n      /* useHttpPaginatedResponse: */\n      true\n    );\n    if (!Platform.Http.methods.includes(_method)) {\n      throw new ErrorInfo(\"Unsupported method \" + _method, 40500, 405);\n    }\n    if (Platform.Http.methodsWithBody.includes(_method)) {\n      return paginatedResource[_method](params, body);\n    } else {\n      return paginatedResource[_method](params);\n    }\n  }\n  async batchPublish(specOrSpecs) {\n    let requestBodyDTO;\n    let singleSpecMode;\n    if (Array.isArray(specOrSpecs)) {\n      requestBodyDTO = specOrSpecs;\n      singleSpecMode = false;\n    } else {\n      requestBodyDTO = [specOrSpecs];\n      singleSpecMode = true;\n    }\n    const format = this.client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultPostHeaders(this.client.options);\n    if (this.client.options.headers)\n      mixin(headers, this.client.options.headers);\n    const requestBody = encodeBody(requestBodyDTO, this.client._MsgPack, format);\n    const response = await resource_default.post(this.client, \"/messages\", requestBody, headers, {}, null, true);\n    const batchResults = response.unpacked ? response.body : decodeBody(response.body, this.client._MsgPack, format);\n    if (singleSpecMode) {\n      return batchResults[0];\n    } else {\n      return batchResults;\n    }\n  }\n  async batchPresence(channels) {\n    const format = this.client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultGetHeaders(this.client.options);\n    if (this.client.options.headers)\n      mixin(headers, this.client.options.headers);\n    const channelsParam = channels.join(\",\");\n    const response = await resource_default.get(this.client, \"/presence\", headers, { channels: channelsParam }, null, true);\n    return response.unpacked ? response.body : decodeBody(response.body, this.client._MsgPack, format);\n  }\n  async revokeTokens(specifiers, options) {\n    if (useTokenAuth(this.client.options)) {\n      throw new ErrorInfo(\"Cannot revoke tokens when using token auth\", 40162, 401);\n    }\n    const keyName = this.client.options.keyName;\n    let resolvedOptions = options != null ? options : {};\n    const requestBodyDTO = __spreadValues({\n      targets: specifiers.map((specifier) => `${specifier.type}:${specifier.value}`)\n    }, resolvedOptions);\n    const format = this.client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultPostHeaders(this.client.options);\n    if (this.client.options.headers)\n      mixin(headers, this.client.options.headers);\n    const requestBody = encodeBody(requestBodyDTO, this.client._MsgPack, format);\n    const response = await resource_default.post(\n      this.client,\n      `/keys/${keyName}/revokeTokens`,\n      requestBody,\n      headers,\n      {},\n      null,\n      true\n    );\n    return response.unpacked ? response.body : decodeBody(response.body, this.client._MsgPack, format);\n  }\n};\nvar Channels = class {\n  constructor(client) {\n    this.client = client;\n    this.all = /* @__PURE__ */ Object.create(null);\n  }\n  get(name, channelOptions) {\n    name = String(name);\n    let channel = this.all[name];\n    if (!channel) {\n      this.all[name] = channel = new restchannel_default(this.client, name, channelOptions);\n    } else if (channelOptions) {\n      channel.setOptions(channelOptions);\n    }\n    return channel;\n  }\n  /* Included to support certain niche use-cases; most users should ignore this.\n   * Please do not use this unless you know what you're doing */\n  release(name) {\n    delete this.all[String(name)];\n  }\n};\n\n// src/common/lib/client/baserest.ts\nvar BaseRest = class extends baseclient_default {\n  /*\n   * The public typings declare that this only accepts an object, but since we want to emit a good error message in the case where a non-TypeScript user does one of these things:\n   *\n   * 1. passes a string (which is quite likely if theyâ€™re e.g. migrating from the default variant to the modular variant)\n   * 2. passes no argument at all\n   *\n   * tell the compiler that these cases are possible so that it forces us to handle them.\n   */\n  constructor(options) {\n    super(defaults_default.objectifyOptions(options, false, \"BaseRest\", logger_default.defaultLogger, { Rest }));\n  }\n};\n\n// src/common/lib/client/modularplugins.ts\nvar allCommonModularPlugins = { Rest };\n\n// src/common/lib/types/defaultmessage.ts\nvar DefaultMessage = class extends message_default {\n  static async fromEncoded(encoded, inputOptions) {\n    return fromEncoded2(logger_default.defaultLogger, Platform.Crypto, encoded, inputOptions);\n  }\n  static async fromEncodedArray(encodedArray, options) {\n    return fromEncodedArray2(logger_default.defaultLogger, Platform.Crypto, encodedArray, options);\n  }\n  static fromValues(values) {\n    return message_default.fromValues(values);\n  }\n};\n\n// src/common/lib/types/defaultpresencemessage.ts\nvar DefaultPresenceMessage = class extends presencemessage_default {\n  static async fromEncoded(encoded, inputOptions) {\n    return fromEncoded(logger_default.defaultLogger, Platform.Crypto, encoded, inputOptions);\n  }\n  static async fromEncodedArray(encodedArray, options) {\n    return fromEncodedArray(logger_default.defaultLogger, Platform.Crypto, encodedArray, options);\n  }\n  static fromValues(values) {\n    return presencemessage_default.fromValues(values);\n  }\n};\n\n// src/common/lib/types/annotation.ts\nvar actions4 = [\"annotation.create\", \"annotation.delete\"];\nasync function fromEncoded3(logger, encoded, options) {\n  const wa = WireAnnotation.fromValues(encoded);\n  return wa.decode(options || {}, logger);\n}\nasync function fromEncodedArray3(logger, encodedArray, options) {\n  return Promise.all(\n    encodedArray.map(function(encoded) {\n      return fromEncoded3(logger, encoded, options);\n    })\n  );\n}\nasync function _fromEncoded3(encoded, channel) {\n  return WireAnnotation.fromValues(encoded).decode(channel.channelOptions, channel.logger);\n}\nasync function _fromEncodedArray3(encodedArray, channel) {\n  return Promise.all(\n    encodedArray.map(function(encoded) {\n      return _fromEncoded3(encoded, channel);\n    })\n  );\n}\nvar Annotation = class _Annotation extends BaseMessage {\n  async encode() {\n    const res = Object.assign(new WireAnnotation(), this, {\n      action: actions4.indexOf(this.action || \"annotation.create\")\n    });\n    return encode(res, {});\n  }\n  static fromValues(values) {\n    return Object.assign(new _Annotation(), values);\n  }\n  static fromValuesArray(values) {\n    return values.map((v) => _Annotation.fromValues(v));\n  }\n  toString() {\n    return strMsg(this, \"Annotation\");\n  }\n};\nvar WireAnnotation = class _WireAnnotation extends BaseMessage {\n  toJSON(...args) {\n    return wireToJSON.call(this, ...args);\n  }\n  static fromValues(values) {\n    return Object.assign(new _WireAnnotation(), values);\n  }\n  static fromValuesArray(values) {\n    return values.map((v) => _WireAnnotation.fromValues(v));\n  }\n  async decode(channelOptions, logger) {\n    const res = Object.assign(new Annotation(), __spreadProps(__spreadValues({}, this), {\n      action: actions4[this.action]\n    }));\n    try {\n      await decode(res, channelOptions);\n    } catch (e) {\n      logger_default.logAction(logger, logger_default.LOG_ERROR, \"WireAnnotation.decode()\", inspectError(e));\n    }\n    return res;\n  }\n  toString() {\n    return strMsg(this, \"WireAnnotation\");\n  }\n};\nvar annotation_default = Annotation;\n\n// src/common/lib/types/defaultannotation.ts\nvar DefaultAnnotation = class extends annotation_default {\n  static async fromEncoded(encoded, inputOptions) {\n    return fromEncoded3(logger_default.defaultLogger, encoded, inputOptions);\n  }\n  static async fromEncodedArray(encodedArray, options) {\n    return fromEncodedArray3(logger_default.defaultLogger, encodedArray, options);\n  }\n  static fromValues(values) {\n    return annotation_default.fromValues(values);\n  }\n};\n\n// src/common/lib/client/restannotations.ts\nfunction serialFromMsgOrSerial(msgOrSerial) {\n  let messageSerial;\n  switch (typeof msgOrSerial) {\n    case \"string\":\n      messageSerial = msgOrSerial;\n      break;\n    case \"object\":\n      messageSerial = msgOrSerial.serial;\n      break;\n  }\n  if (!messageSerial || typeof messageSerial !== \"string\") {\n    throw new ErrorInfo(\n      \"First argument of annotations.publish() must be either a Message (or at least an object with a string `serial` property) or a message serial (string)\",\n      40003,\n      400\n    );\n  }\n  return messageSerial;\n}\nfunction constructValidateAnnotation(msgOrSerial, annotationValues) {\n  const messageSerial = serialFromMsgOrSerial(msgOrSerial);\n  if (!annotationValues || typeof annotationValues !== \"object\") {\n    throw new ErrorInfo(\n      \"Second argument of annotations.publish() must be an object (the intended annotation to publish)\",\n      40003,\n      400\n    );\n  }\n  const annotation = annotation_default.fromValues(annotationValues);\n  annotation.messageSerial = messageSerial;\n  if (!annotation.action) {\n    annotation.action = \"annotation.create\";\n  }\n  return annotation;\n}\nfunction basePathForSerial(channel, serial) {\n  return channel.client.rest.channelMixin.basePath(channel) + \"/messages/\" + encodeURIComponent(serial) + \"/annotations\";\n}\nvar RestAnnotations = class {\n  constructor(channel) {\n    this.channel = channel;\n  }\n  async publish(msgOrSerial, annotationValues) {\n    const annotation = constructValidateAnnotation(msgOrSerial, annotationValues);\n    const wireAnnotation = await annotation.encode();\n    const client = this.channel.client, options = client.options, format = options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, headers = defaults_default.defaultPostHeaders(client.options), params = {};\n    mixin(headers, client.options.headers);\n    const requestBody = encodeBody([wireAnnotation], client._MsgPack, format);\n    await resource_default.post(\n      client,\n      basePathForSerial(this.channel, annotation.messageSerial),\n      requestBody,\n      headers,\n      params,\n      null,\n      true\n    );\n  }\n  async delete(msgOrSerial, annotationValues) {\n    annotationValues.action = \"annotation.delete\";\n    return this.publish(msgOrSerial, annotationValues);\n  }\n  async get(msgOrSerial, params) {\n    const client = this.channel.client, messageSerial = serialFromMsgOrSerial(msgOrSerial), format = client.options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */, envelope = client.http.supportsLinkHeaders ? void 0 : format, headers = defaults_default.defaultGetHeaders(client.options);\n    mixin(headers, client.options.headers);\n    return new paginatedresource_default(\n      client,\n      basePathForSerial(this.channel, messageSerial),\n      headers,\n      envelope,\n      async (body, _, unpacked) => {\n        const decoded = unpacked ? body : decodeBody(body, client._MsgPack, format);\n        return _fromEncodedArray3(decoded, this.channel);\n      }\n    ).get(params);\n  }\n};\nvar restannotations_default = RestAnnotations;\n\n// src/common/lib/types/protocolmessage.ts\nvar serialize2 = encodeBody;\nfunction toStringArray(array) {\n  const result = [];\n  if (array) {\n    for (let i = 0; i < array.length; i++) {\n      result.push(array[i].toString());\n    }\n  }\n  return \"[ \" + result.join(\", \") + \" ]\";\n}\nfunction deserialize(serialized, MsgPack, presenceMessagePlugin, annotationsPlugin, objectsPlugin, format) {\n  const deserialized = decodeBody(serialized, MsgPack, format);\n  return fromDeserialized(deserialized, presenceMessagePlugin, annotationsPlugin, objectsPlugin);\n}\nfunction fromDeserialized(deserialized, presenceMessagePlugin, annotationsPlugin, objectsPlugin) {\n  let error;\n  if (deserialized.error) {\n    error = ErrorInfo.fromValues(deserialized.error);\n  }\n  let messages;\n  if (deserialized.messages) {\n    messages = WireMessage.fromValuesArray(deserialized.messages);\n  }\n  let presence;\n  if (presenceMessagePlugin && deserialized.presence) {\n    presence = presenceMessagePlugin.WirePresenceMessage.fromValuesArray(\n      deserialized.presence\n    );\n  }\n  let annotations;\n  if (annotationsPlugin && deserialized.annotations) {\n    annotations = annotationsPlugin.WireAnnotation.fromValuesArray(\n      deserialized.annotations\n    );\n  }\n  let state;\n  if (objectsPlugin && deserialized.state) {\n    state = objectsPlugin.WireObjectMessage.fromValuesArray(\n      deserialized.state,\n      utils_exports,\n      MessageEncoding\n    );\n  }\n  return Object.assign(new ProtocolMessage(), __spreadProps(__spreadValues({}, deserialized), { presence, messages, annotations, state, error }));\n}\nfunction makeFromDeserializedWithDependencies(dependencies) {\n  return (deserialized) => {\n    var _a2;\n    return fromDeserialized(\n      deserialized,\n      {\n        PresenceMessage: presencemessage_default,\n        WirePresenceMessage\n      },\n      { Annotation: annotation_default, WireAnnotation, RealtimeAnnotations: realtimeannotations_default, RestAnnotations: restannotations_default },\n      (_a2 = dependencies == null ? void 0 : dependencies.ObjectsPlugin) != null ? _a2 : null\n    );\n  };\n}\nfunction fromValues(values) {\n  return Object.assign(new ProtocolMessage(), values);\n}\nfunction stringify(msg, presenceMessagePlugin, annotationsPlugin, objectsPlugin) {\n  let result = \"[ProtocolMessage\";\n  if (msg.action !== void 0)\n    result += \"; action=\" + ActionName[msg.action] || msg.action;\n  const simpleAttributes = [\"id\", \"channel\", \"channelSerial\", \"connectionId\", \"count\", \"msgSerial\", \"timestamp\"];\n  let attribute;\n  for (let attribIndex = 0; attribIndex < simpleAttributes.length; attribIndex++) {\n    attribute = simpleAttributes[attribIndex];\n    if (msg[attribute] !== void 0)\n      result += \"; \" + attribute + \"=\" + msg[attribute];\n  }\n  if (msg.messages)\n    result += \"; messages=\" + toStringArray(WireMessage.fromValuesArray(msg.messages));\n  if (msg.presence && presenceMessagePlugin)\n    result += \"; presence=\" + toStringArray(presenceMessagePlugin.WirePresenceMessage.fromValuesArray(msg.presence));\n  if (msg.annotations && annotationsPlugin) {\n    result += \"; annotations=\" + toStringArray(annotationsPlugin.WireAnnotation.fromValuesArray(msg.annotations));\n  }\n  if (msg.state && objectsPlugin) {\n    result += \"; state=\" + toStringArray(objectsPlugin.WireObjectMessage.fromValuesArray(msg.state, utils_exports, MessageEncoding));\n  }\n  if (msg.error)\n    result += \"; error=\" + ErrorInfo.fromValues(msg.error).toString();\n  if (msg.auth && msg.auth.accessToken)\n    result += \"; token=\" + msg.auth.accessToken;\n  if (msg.flags)\n    result += \"; flags=\" + flagNames.filter(msg.hasFlag).join(\",\");\n  if (msg.params) {\n    let stringifiedParams = \"\";\n    forInOwnNonNullProperties(msg.params, function(prop) {\n      if (stringifiedParams.length > 0) {\n        stringifiedParams += \"; \";\n      }\n      stringifiedParams += prop + \"=\" + msg.params[prop];\n    });\n    if (stringifiedParams.length > 0) {\n      result += \"; params=[\" + stringifiedParams + \"]\";\n    }\n  }\n  result += \"]\";\n  return result;\n}\nvar ProtocolMessage = class {\n  constructor() {\n    this.hasFlag = (flag) => {\n      return (this.flags & flags[flag]) > 0;\n    };\n  }\n  setFlag(flag) {\n    return this.flags = this.flags | flags[flag];\n  }\n  getMode() {\n    return (this.flags || 0) & flags.MODE_ALL;\n  }\n  encodeModesToFlags(modes) {\n    modes.forEach((mode) => this.setFlag(mode));\n  }\n  decodeModesFromFlags() {\n    const modes = [];\n    channelModes.forEach((mode) => {\n      if (this.hasFlag(mode)) {\n        modes.push(mode);\n      }\n    });\n    return modes.length > 0 ? modes : void 0;\n  }\n};\nvar protocolmessage_default = ProtocolMessage;\n\n// src/common/lib/client/channelstatechange.ts\nvar ChannelStateChange = class {\n  constructor(previous, current, resumed, hasBacklog, reason) {\n    this.previous = previous;\n    this.current = current;\n    if (current === \"attached\") {\n      this.resumed = resumed;\n      this.hasBacklog = hasBacklog;\n    }\n    if (reason)\n      this.reason = reason;\n  }\n};\nvar channelstatechange_default = ChannelStateChange;\n\n// src/common/lib/client/realtimechannel.ts\nvar noop = function() {\n};\nfunction validateChannelOptions(options) {\n  if (options && \"params\" in options && !isObject(options.params)) {\n    return new ErrorInfo(\"options.params must be an object\", 4e4, 400);\n  }\n  if (options && \"modes\" in options) {\n    if (!Array.isArray(options.modes)) {\n      return new ErrorInfo(\"options.modes must be an array\", 4e4, 400);\n    }\n    for (let i = 0; i < options.modes.length; i++) {\n      const currentMode = options.modes[i];\n      if (!currentMode || typeof currentMode !== \"string\" || !channelModes.includes(String.prototype.toUpperCase.call(currentMode))) {\n        return new ErrorInfo(\"Invalid channel mode: \" + currentMode, 4e4, 400);\n      }\n    }\n  }\n}\nvar RealtimeChannel = class _RealtimeChannel extends eventemitter_default {\n  constructor(client, name, options) {\n    var _a2, _b, _c;\n    super(client.logger);\n    this._annotations = null;\n    this._mode = 0;\n    this.retryCount = 0;\n    this.history = async function(params) {\n      logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimeChannel.history()\", \"channel = \" + this.name);\n      const restMixin = this.client.rest.channelMixin;\n      if (params && params.untilAttach) {\n        if (this.state !== \"attached\") {\n          throw new ErrorInfo(\"option untilAttach requires the channel to be attached\", 4e4, 400);\n        }\n        if (!this.properties.attachSerial) {\n          throw new ErrorInfo(\n            \"untilAttach was specified and channel is attached, but attachSerial is not defined\",\n            4e4,\n            400\n          );\n        }\n        delete params.untilAttach;\n        params.from_serial = this.properties.attachSerial;\n      }\n      return restMixin.history(this, params);\n    };\n    this.whenState = (state) => {\n      return eventemitter_default.prototype.whenState.call(this, state, this.state);\n    };\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"RealtimeChannel()\", \"started; name = \" + name);\n    this.name = name;\n    this.channelOptions = normaliseChannelOptions((_a2 = client._Crypto) != null ? _a2 : null, this.logger, options);\n    this.client = client;\n    this._presence = client._RealtimePresence ? new client._RealtimePresence.RealtimePresence(this) : null;\n    if (client._Annotations) {\n      this._annotations = new client._Annotations.RealtimeAnnotations(this);\n    }\n    this.connectionManager = client.connection.connectionManager;\n    this.state = \"initialized\";\n    this.subscriptions = new eventemitter_default(this.logger);\n    this.syncChannelSerial = void 0;\n    this.properties = {\n      attachSerial: void 0,\n      channelSerial: void 0\n    };\n    this.setOptions(options);\n    this.errorReason = null;\n    this._attachResume = false;\n    this._decodingContext = {\n      channelOptions: this.channelOptions,\n      plugins: client.options.plugins || {},\n      baseEncodedPreviousPayload: void 0\n    };\n    this._lastPayload = {\n      messageId: null,\n      protocolMessageChannelSerial: null,\n      decodeFailureRecoveryInProgress: null\n    };\n    this._allChannelChanges = new eventemitter_default(this.logger);\n    if ((_b = client.options.plugins) == null ? void 0 : _b.Push) {\n      this._push = new client.options.plugins.Push.PushChannel(this);\n    }\n    if ((_c = client.options.plugins) == null ? void 0 : _c.Objects) {\n      this._objects = new client.options.plugins.Objects.Objects(this);\n    }\n  }\n  get presence() {\n    if (!this._presence) {\n      throwMissingPluginError(\"RealtimePresence\");\n    }\n    return this._presence;\n  }\n  get annotations() {\n    if (!this._annotations) {\n      throwMissingPluginError(\"Annotations\");\n    }\n    return this._annotations;\n  }\n  get push() {\n    if (!this._push) {\n      throwMissingPluginError(\"Push\");\n    }\n    return this._push;\n  }\n  /** @spec RTL27 */\n  get objects() {\n    if (!this._objects) {\n      throwMissingPluginError(\"Objects\");\n    }\n    return this._objects;\n  }\n  invalidStateError() {\n    return new ErrorInfo(\n      \"Channel operation failed as channel state is \" + this.state,\n      90001,\n      400,\n      this.errorReason || void 0\n    );\n  }\n  static processListenerArgs(args) {\n    args = Array.prototype.slice.call(args);\n    if (typeof args[0] === \"function\") {\n      args.unshift(null);\n    }\n    return args;\n  }\n  async setOptions(options) {\n    var _a2;\n    const previousChannelOptions = this.channelOptions;\n    const err = validateChannelOptions(options);\n    if (err) {\n      throw err;\n    }\n    this.channelOptions = normaliseChannelOptions((_a2 = this.client._Crypto) != null ? _a2 : null, this.logger, options);\n    if (this._decodingContext)\n      this._decodingContext.channelOptions = this.channelOptions;\n    if (this._shouldReattachToSetOptions(options, previousChannelOptions)) {\n      this.attachImpl();\n      return new Promise((resolve, reject) => {\n        this._allChannelChanges.once(\n          [\"attached\", \"update\", \"detached\", \"failed\"],\n          function(stateChange) {\n            switch (this.event) {\n              case \"update\":\n              case \"attached\":\n                resolve();\n                break;\n              default:\n                reject(stateChange.reason);\n            }\n          }\n        );\n      });\n    }\n  }\n  _shouldReattachToSetOptions(options, prevOptions) {\n    if (!(this.state === \"attached\" || this.state === \"attaching\")) {\n      return false;\n    }\n    if (options == null ? void 0 : options.params) {\n      const requestedParams = omitAgent(options.params);\n      const existingParams = omitAgent(prevOptions.params);\n      if (Object.keys(requestedParams).length !== Object.keys(existingParams).length) {\n        return true;\n      }\n      if (!shallowEquals(existingParams, requestedParams)) {\n        return true;\n      }\n    }\n    if (options == null ? void 0 : options.modes) {\n      if (!prevOptions.modes || !arrEquals(options.modes, prevOptions.modes)) {\n        return true;\n      }\n    }\n    return false;\n  }\n  async publish(...args) {\n    let messages;\n    let argCount = args.length;\n    if (argCount == 1) {\n      if (isObject(args[0])) {\n        messages = [message_default.fromValues(args[0])];\n      } else if (Array.isArray(args[0])) {\n        messages = message_default.fromValuesArray(args[0]);\n      } else {\n        throw new ErrorInfo(\n          \"The single-argument form of publish() expects a message object or an array of message objects\",\n          40013,\n          400\n        );\n      }\n    } else {\n      messages = [message_default.fromValues({ name: args[0], data: args[1] })];\n    }\n    const maxMessageSize = this.client.options.maxMessageSize;\n    const wireMessages = await encodeArray(messages, this.channelOptions);\n    const size = getMessagesSize(wireMessages);\n    if (size > maxMessageSize) {\n      throw new ErrorInfo(\n        `Maximum size of messages that can be published at once exceeded (was ${size} bytes; limit is ${maxMessageSize} bytes)`,\n        40009,\n        400\n      );\n    }\n    this.throwIfUnpublishableState();\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"RealtimeChannel.publish()\",\n      \"sending message; channel state is \" + this.state + \", message count = \" + wireMessages.length\n    );\n    const pm = fromValues({ action: actions.MESSAGE, channel: this.name, messages: wireMessages });\n    return this.sendMessage(pm);\n  }\n  throwIfUnpublishableState() {\n    if (!this.connectionManager.activeState()) {\n      throw this.connectionManager.getError();\n    }\n    if (this.state === \"failed\" || this.state === \"suspended\") {\n      throw this.invalidStateError();\n    }\n  }\n  onEvent(messages) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimeChannel.onEvent()\", \"received message\");\n    const subscriptions = this.subscriptions;\n    for (let i = 0; i < messages.length; i++) {\n      const message = messages[i];\n      subscriptions.emit(message.name, message);\n    }\n  }\n  async attach() {\n    if (this.state === \"attached\") {\n      return null;\n    }\n    return new Promise((resolve, reject) => {\n      this._attach(false, null, (err, result) => err ? reject(err) : resolve(result));\n    });\n  }\n  _attach(forceReattach, attachReason, callback) {\n    if (!callback) {\n      callback = (err) => {\n        if (err) {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_ERROR,\n            \"RealtimeChannel._attach()\",\n            \"Channel attach failed: \" + err.toString()\n          );\n        }\n      };\n    }\n    const connectionManager = this.connectionManager;\n    if (!connectionManager.activeState()) {\n      callback(connectionManager.getError());\n      return;\n    }\n    if (this.state !== \"attaching\" || forceReattach) {\n      this.requestState(\"attaching\", attachReason);\n    }\n    this.once(function(stateChange) {\n      switch (this.event) {\n        case \"attached\":\n          callback == null ? void 0 : callback(null, stateChange);\n          break;\n        case \"detached\":\n        case \"suspended\":\n        case \"failed\":\n          callback == null ? void 0 : callback(\n            stateChange.reason || connectionManager.getError() || new ErrorInfo(\"Unable to attach; reason unknown; state = \" + this.event, 9e4, 500)\n          );\n          break;\n        case \"detaching\":\n          callback == null ? void 0 : callback(new ErrorInfo(\"Attach request superseded by a subsequent detach request\", 9e4, 409));\n          break;\n      }\n    });\n  }\n  attachImpl() {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimeChannel.attachImpl()\", \"sending ATTACH message\");\n    const attachMsg = fromValues({\n      action: actions.ATTACH,\n      channel: this.name,\n      params: this.channelOptions.params,\n      // RTL4c1: Includes the channel serial to resume from a previous message\n      // or attachment.\n      channelSerial: this.properties.channelSerial\n    });\n    if (this.channelOptions.modes) {\n      attachMsg.encodeModesToFlags(allToUpperCase(this.channelOptions.modes));\n    }\n    if (this._attachResume) {\n      attachMsg.setFlag(\"ATTACH_RESUME\");\n    }\n    if (this._lastPayload.decodeFailureRecoveryInProgress) {\n      attachMsg.channelSerial = this._lastPayload.protocolMessageChannelSerial;\n    }\n    this.sendMessage(attachMsg).catch(noop);\n  }\n  async detach() {\n    const connectionManager = this.connectionManager;\n    if (!connectionManager.activeState()) {\n      throw connectionManager.getError();\n    }\n    switch (this.state) {\n      case \"suspended\":\n        this.notifyState(\"detached\");\n        return;\n      case \"detached\":\n        return;\n      case \"failed\":\n        throw new ErrorInfo(\"Unable to detach; channel state = failed\", 90001, 400);\n      default:\n        this.requestState(\"detaching\");\n      case \"detaching\":\n        return new Promise((resolve, reject) => {\n          this.once(function(stateChange) {\n            switch (this.event) {\n              case \"detached\":\n                resolve();\n                break;\n              case \"attached\":\n              case \"suspended\":\n              case \"failed\":\n                reject(\n                  stateChange.reason || connectionManager.getError() || new ErrorInfo(\"Unable to detach; reason unknown; state = \" + this.event, 9e4, 500)\n                );\n                break;\n              case \"attaching\":\n                reject(new ErrorInfo(\"Detach request superseded by a subsequent attach request\", 9e4, 409));\n                break;\n            }\n          });\n        });\n    }\n  }\n  detachImpl() {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimeChannel.detach()\", \"sending DETACH message\");\n    const msg = fromValues({ action: actions.DETACH, channel: this.name });\n    this.sendMessage(msg).catch(noop);\n  }\n  async subscribe(...args) {\n    const [event, listener] = _RealtimeChannel.processListenerArgs(args);\n    if (this.state === \"failed\") {\n      throw ErrorInfo.fromValues(this.invalidStateError());\n    }\n    if (event && typeof event === \"object\" && !Array.isArray(event)) {\n      this.client._FilteredSubscriptions.subscribeFilter(this, event, listener);\n    } else {\n      this.subscriptions.on(event, listener);\n    }\n    if (this.channelOptions.attachOnSubscribe !== false) {\n      return this.attach();\n    } else {\n      return null;\n    }\n  }\n  unsubscribe(...args) {\n    var _a2;\n    const [event, listener] = _RealtimeChannel.processListenerArgs(args);\n    if (typeof event === \"object\" && !listener || ((_a2 = this.filteredSubscriptions) == null ? void 0 : _a2.has(listener))) {\n      this.client._FilteredSubscriptions.getAndDeleteFilteredSubscriptions(this, event, listener).forEach((l) => this.subscriptions.off(l));\n      return;\n    }\n    this.subscriptions.off(event, listener);\n  }\n  sync() {\n    switch (this.state) {\n      case \"initialized\":\n      case \"detaching\":\n      case \"detached\":\n        throw new PartialErrorInfo(\"Unable to sync to channel; not attached\", 4e4);\n      default:\n    }\n    const connectionManager = this.connectionManager;\n    if (!connectionManager.activeState()) {\n      throw connectionManager.getError();\n    }\n    const syncMessage = fromValues({ action: actions.SYNC, channel: this.name });\n    if (this.syncChannelSerial) {\n      syncMessage.channelSerial = this.syncChannelSerial;\n    }\n    connectionManager.send(syncMessage);\n  }\n  async sendMessage(msg) {\n    return new Promise((resolve, reject) => {\n      this.connectionManager.send(msg, this.client.options.queueMessages, (err) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      });\n    });\n  }\n  async sendPresence(presence) {\n    const msg = fromValues({\n      action: actions.PRESENCE,\n      channel: this.name,\n      presence\n    });\n    return this.sendMessage(msg);\n  }\n  sendState(objectMessages) {\n    const msg = fromValues({\n      action: actions.OBJECT,\n      channel: this.name,\n      state: objectMessages\n    });\n    return this.sendMessage(msg);\n  }\n  // Access to this method is synchronised by ConnectionManager#processChannelMessage, in order to synchronise access to the state stored in _decodingContext.\n  async processMessage(message) {\n    if (message.action === actions.ATTACHED || message.action === actions.MESSAGE || message.action === actions.PRESENCE || message.action === actions.OBJECT || message.action === actions.ANNOTATION) {\n      this.setChannelSerial(message.channelSerial);\n    }\n    let syncChannelSerial, isSync = false;\n    switch (message.action) {\n      case actions.ATTACHED: {\n        this.properties.attachSerial = message.channelSerial;\n        this._mode = message.getMode();\n        this.params = message.params || {};\n        const modesFromFlags = message.decodeModesFromFlags();\n        this.modes = modesFromFlags && allToLowerCase(modesFromFlags) || void 0;\n        const resumed = message.hasFlag(\"RESUMED\");\n        const hasPresence = message.hasFlag(\"HAS_PRESENCE\");\n        const hasBacklog = message.hasFlag(\"HAS_BACKLOG\");\n        const hasObjects = message.hasFlag(\"HAS_OBJECTS\");\n        if (this.state === \"attached\") {\n          if (!resumed) {\n            if (this._presence) {\n              this._presence.onAttached(hasPresence);\n            }\n            if (this._objects) {\n              this._objects.onAttached(hasObjects);\n            }\n          }\n          const change = new channelstatechange_default(this.state, this.state, resumed, hasBacklog, message.error);\n          this._allChannelChanges.emit(\"update\", change);\n          if (!resumed || this.channelOptions.updateOnAttached) {\n            this.emit(\"update\", change);\n          }\n        } else if (this.state === \"detaching\") {\n          this.checkPendingState();\n        } else {\n          this.notifyState(\"attached\", message.error, resumed, hasPresence, hasBacklog, hasObjects);\n        }\n        break;\n      }\n      case actions.DETACHED: {\n        const detachErr = message.error ? ErrorInfo.fromValues(message.error) : new ErrorInfo(\"Channel detached\", 90001, 404);\n        if (this.state === \"detaching\") {\n          this.notifyState(\"detached\", detachErr);\n        } else if (this.state === \"attaching\") {\n          this.notifyState(\"suspended\", detachErr);\n        } else if (this.state === \"attached\" || this.state === \"suspended\") {\n          this.requestState(\"attaching\", detachErr);\n        }\n        break;\n      }\n      case actions.SYNC:\n        isSync = true;\n        syncChannelSerial = this.syncChannelSerial = message.channelSerial;\n        if (!message.presence)\n          break;\n      case actions.PRESENCE: {\n        if (!message.presence) {\n          break;\n        }\n        populateFieldsFromParent(message);\n        const options = this.channelOptions;\n        if (this._presence) {\n          const presenceMessages = await Promise.all(\n            message.presence.map((wpm) => {\n              return wpm.decode(options, this.logger);\n            })\n          );\n          this._presence.setPresence(presenceMessages, isSync, syncChannelSerial);\n        }\n        break;\n      }\n      case actions.OBJECT:\n      case actions.OBJECT_SYNC: {\n        if (!this._objects || !message.state) {\n          return;\n        }\n        populateFieldsFromParent(message);\n        const format = this.client.connection.connectionManager.getActiveTransportFormat();\n        const objectMessages = message.state.map((om) => om.decode(this.client, format));\n        if (message.action === actions.OBJECT) {\n          this._objects.handleObjectMessages(objectMessages);\n        } else {\n          this._objects.handleObjectSyncMessages(objectMessages, message.channelSerial);\n        }\n        break;\n      }\n      case actions.MESSAGE: {\n        if (this.state !== \"attached\") {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MAJOR,\n            \"RealtimeChannel.processMessage()\",\n            'Message \"' + message.id + '\" skipped as this channel \"' + this.name + '\" state is not \"attached\" (state is \"' + this.state + '\").'\n          );\n          return;\n        }\n        populateFieldsFromParent(message);\n        const encoded = message.messages, firstMessage = encoded[0], lastMessage = encoded[encoded.length - 1];\n        if (firstMessage.extras && firstMessage.extras.delta && firstMessage.extras.delta.from !== this._lastPayload.messageId) {\n          const msg = 'Delta message decode failure - previous message not available for message \"' + message.id + '\" on this channel \"' + this.name + '\".';\n          logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"RealtimeChannel.processMessage()\", msg);\n          this._startDecodeFailureRecovery(new ErrorInfo(msg, 40018, 400));\n          break;\n        }\n        let messages = [];\n        for (let i = 0; i < encoded.length; i++) {\n          const { decoded, err } = await encoded[i].decodeWithErr(this._decodingContext, this.logger);\n          messages[i] = decoded;\n          if (err) {\n            switch (err.code) {\n              case 40018:\n                this._startDecodeFailureRecovery(err);\n                return;\n              case 40019:\n              case 40021:\n                this.notifyState(\"failed\", err);\n                return;\n              default:\n            }\n          }\n        }\n        this._lastPayload.messageId = lastMessage.id;\n        this._lastPayload.protocolMessageChannelSerial = message.channelSerial;\n        this.onEvent(messages);\n        break;\n      }\n      case actions.ANNOTATION: {\n        populateFieldsFromParent(message);\n        const options = this.channelOptions;\n        if (this._annotations) {\n          const annotations = await Promise.all(\n            (message.annotations || []).map((wpm) => {\n              return wpm.decode(options, this.logger);\n            })\n          );\n          this._annotations._processIncoming(annotations);\n        }\n        break;\n      }\n      case actions.ERROR: {\n        const err = message.error;\n        if (err && err.code == 80016) {\n          this.checkPendingState();\n        } else {\n          this.notifyState(\"failed\", ErrorInfo.fromValues(err));\n        }\n        break;\n      }\n      default:\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MAJOR,\n          \"RealtimeChannel.processMessage()\",\n          \"Protocol error: unrecognised message action (\" + message.action + \")\"\n        );\n    }\n  }\n  _startDecodeFailureRecovery(reason) {\n    if (!this._lastPayload.decodeFailureRecoveryInProgress) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MAJOR,\n        \"RealtimeChannel.processMessage()\",\n        \"Starting decode failure recovery process.\"\n      );\n      this._lastPayload.decodeFailureRecoveryInProgress = true;\n      this._attach(true, reason, () => {\n        this._lastPayload.decodeFailureRecoveryInProgress = false;\n      });\n    }\n  }\n  onAttached() {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"RealtimeChannel.onAttached\",\n      \"activating channel; name = \" + this.name\n    );\n  }\n  notifyState(state, reason, resumed, hasPresence, hasBacklog, hasObjects) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"RealtimeChannel.notifyState\",\n      \"name = \" + this.name + \", current state = \" + this.state + \", notifying state \" + state\n    );\n    this.clearStateTimer();\n    if ([\"detached\", \"suspended\", \"failed\"].includes(state)) {\n      this.properties.channelSerial = null;\n    }\n    if (state === this.state) {\n      return;\n    }\n    if (this._presence) {\n      this._presence.actOnChannelState(state, hasPresence, reason);\n    }\n    if (this._objects) {\n      this._objects.actOnChannelState(state, hasObjects);\n    }\n    if (state === \"suspended\" && this.connectionManager.state.sendEvents) {\n      this.startRetryTimer();\n    } else {\n      this.cancelRetryTimer();\n    }\n    if (reason) {\n      this.errorReason = reason;\n    }\n    const change = new channelstatechange_default(this.state, state, resumed, hasBacklog, reason);\n    const action = 'Channel state for channel \"' + this.name + '\"';\n    const message = state + (reason ? \"; reason: \" + reason : \"\");\n    if (state === \"failed\") {\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, action, message);\n    } else {\n      logger_default.logAction(this.logger, logger_default.LOG_MAJOR, action, message);\n    }\n    if (state !== \"attaching\" && state !== \"suspended\") {\n      this.retryCount = 0;\n    }\n    if (state === \"attached\") {\n      this.onAttached();\n    }\n    if (state === \"attached\") {\n      this._attachResume = true;\n    } else if (state === \"detaching\" || state === \"failed\") {\n      this._attachResume = false;\n    }\n    this.state = state;\n    this._allChannelChanges.emit(state, change);\n    this.emit(state, change);\n  }\n  requestState(state, reason) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"RealtimeChannel.requestState\",\n      \"name = \" + this.name + \", state = \" + state\n    );\n    this.notifyState(state, reason);\n    this.checkPendingState();\n  }\n  checkPendingState() {\n    const cmState = this.connectionManager.state;\n    if (!cmState.sendEvents) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"RealtimeChannel.checkPendingState\",\n        \"sendEvents is false; state is \" + this.connectionManager.state.state\n      );\n      return;\n    }\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"RealtimeChannel.checkPendingState\",\n      \"name = \" + this.name + \", state = \" + this.state\n    );\n    switch (this.state) {\n      case \"attaching\":\n        this.startStateTimerIfNotRunning();\n        this.attachImpl();\n        break;\n      case \"detaching\":\n        this.startStateTimerIfNotRunning();\n        this.detachImpl();\n        break;\n      case \"attached\":\n        this.sync();\n        break;\n      default:\n        break;\n    }\n  }\n  timeoutPendingState() {\n    switch (this.state) {\n      case \"attaching\": {\n        const err = new ErrorInfo(\"Channel attach timed out\", 90007, 408);\n        this.notifyState(\"suspended\", err);\n        break;\n      }\n      case \"detaching\": {\n        const err = new ErrorInfo(\"Channel detach timed out\", 90007, 408);\n        this.notifyState(\"attached\", err);\n        break;\n      }\n      default:\n        this.checkPendingState();\n        break;\n    }\n  }\n  startStateTimerIfNotRunning() {\n    if (!this.stateTimer) {\n      this.stateTimer = setTimeout(() => {\n        logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"RealtimeChannel.startStateTimerIfNotRunning\", \"timer expired\");\n        this.stateTimer = null;\n        this.timeoutPendingState();\n      }, this.client.options.timeouts.realtimeRequestTimeout);\n    }\n  }\n  clearStateTimer() {\n    const stateTimer = this.stateTimer;\n    if (stateTimer) {\n      clearTimeout(stateTimer);\n      this.stateTimer = null;\n    }\n  }\n  startRetryTimer() {\n    if (this.retryTimer)\n      return;\n    this.retryCount++;\n    const retryDelay = getRetryTime(this.client.options.timeouts.channelRetryTimeout, this.retryCount);\n    this.retryTimer = setTimeout(() => {\n      if (this.state === \"suspended\" && this.connectionManager.state.sendEvents) {\n        this.retryTimer = null;\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"RealtimeChannel retry timer expired\",\n          \"attempting a new attach\"\n        );\n        this.requestState(\"attaching\");\n      }\n    }, retryDelay);\n  }\n  cancelRetryTimer() {\n    if (this.retryTimer) {\n      clearTimeout(this.retryTimer);\n      this.retryTimer = null;\n    }\n  }\n  /* @returns null (if can safely be released) | ErrorInfo (if cannot) */\n  getReleaseErr() {\n    const s = this.state;\n    if (s === \"initialized\" || s === \"detached\" || s === \"failed\") {\n      return null;\n    }\n    return new ErrorInfo(\n      \"Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was \" + s,\n      90001,\n      400\n    );\n  }\n  setChannelSerial(channelSerial) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"RealtimeChannel.setChannelSerial()\",\n      \"Updating channel serial; serial = \" + channelSerial + \"; previous = \" + this.properties.channelSerial\n    );\n    if (channelSerial) {\n      this.properties.channelSerial = channelSerial;\n    }\n  }\n  async status() {\n    return this.client.rest.channelMixin.status(this);\n  }\n  async getMessage(serialOrMessage) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimeChannel.getMessage()\", \"channel = \" + this.name);\n    const restMixin = this.client.rest.channelMixin;\n    return restMixin.getMessage(this, serialOrMessage);\n  }\n  async updateMessage(message, operation, params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimeChannel.updateMessage()\", \"channel = \" + this.name);\n    const restMixin = this.client.rest.channelMixin;\n    return restMixin.updateDeleteMessage(this, { isDelete: false }, message, operation, params);\n  }\n  async deleteMessage(message, operation, params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimeChannel.deleteMessage()\", \"channel = \" + this.name);\n    const restMixin = this.client.rest.channelMixin;\n    return restMixin.updateDeleteMessage(this, { isDelete: true }, message, operation, params);\n  }\n  async getMessageVersions(serialOrMessage, params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimeChannel.getMessageVersions()\", \"channel = \" + this.name);\n    const restMixin = this.client.rest.channelMixin;\n    return restMixin.getMessageVersions(this, serialOrMessage, params);\n  }\n};\nfunction omitAgent(channelParams) {\n  const _a2 = channelParams || {}, { agent: _ } = _a2, paramsWithoutAgent = __objRest(_a2, [\"agent\"]);\n  return paramsWithoutAgent;\n}\nvar realtimechannel_default = RealtimeChannel;\n\n// src/common/lib/client/realtimeannotations.ts\nvar RealtimeAnnotations = class {\n  constructor(channel) {\n    this.channel = channel;\n    this.logger = channel.logger;\n    this.subscriptions = new eventemitter_default(this.logger);\n  }\n  async publish(msgOrSerial, annotationValues) {\n    const channelName = this.channel.name;\n    const annotation = constructValidateAnnotation(msgOrSerial, annotationValues);\n    const wireAnnotation = await annotation.encode();\n    this.channel.throwIfUnpublishableState();\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"RealtimeAnnotations.publish()\",\n      \"channelName = \" + channelName + \", sending annotation with messageSerial = \" + annotation.messageSerial + \", type = \" + annotation.type\n    );\n    const pm = fromValues({\n      action: actions.ANNOTATION,\n      channel: channelName,\n      annotations: [wireAnnotation]\n    });\n    return this.channel.sendMessage(pm);\n  }\n  async delete(msgOrSerial, annotationValues) {\n    annotationValues.action = \"annotation.delete\";\n    return this.publish(msgOrSerial, annotationValues);\n  }\n  async subscribe(..._args) {\n    const args = realtimechannel_default.processListenerArgs(_args);\n    const event = args[0];\n    const listener = args[1];\n    const channel = this.channel;\n    if (channel.state === \"failed\") {\n      throw ErrorInfo.fromValues(channel.invalidStateError());\n    }\n    this.subscriptions.on(event, listener);\n    if (this.channel.channelOptions.attachOnSubscribe !== false) {\n      await channel.attach();\n    }\n    if ((this.channel.state === \"attached\" && this.channel._mode & flags.ANNOTATION_SUBSCRIBE) === 0) {\n      throw new ErrorInfo(\n        \"You are trying to add an annotation listener, but you haven't requested the annotation_subscribe channel mode in ChannelOptions, so this won't do anything (we only deliver annotations to clients who have explicitly requested them)\",\n        93001,\n        400\n      );\n    }\n  }\n  unsubscribe(..._args) {\n    const args = realtimechannel_default.processListenerArgs(_args);\n    const event = args[0];\n    const listener = args[1];\n    this.subscriptions.off(event, listener);\n  }\n  _processIncoming(annotations) {\n    for (const annotation of annotations) {\n      this.subscriptions.emit(annotation.type || \"\", annotation);\n    }\n  }\n  async get(msgOrSerial, params) {\n    return restannotations_default.prototype.get.call(this, msgOrSerial, params);\n  }\n};\nvar realtimeannotations_default = RealtimeAnnotations;\n\n// src/common/lib/client/defaultrest.ts\nvar _DefaultRest = class _DefaultRest extends BaseRest {\n  // The public typings declare that this requires an argument to be passed, but since we want to emit a good error message in the case where a non-TypeScript user does not pass an argument, tell the compiler that this is possible so that it forces us to handle it.\n  constructor(options) {\n    var _a2, _b;\n    const MsgPack = _DefaultRest._MsgPack;\n    if (!MsgPack) {\n      throw new Error(\"Expected DefaultRest._MsgPack to have been set\");\n    }\n    super(\n      defaults_default.objectifyOptions(options, true, \"Rest\", logger_default.defaultLogger, __spreadProps(__spreadValues({}, allCommonModularPlugins), {\n        Crypto: (_a2 = _DefaultRest.Crypto) != null ? _a2 : void 0,\n        MsgPack: (_b = _DefaultRest._MsgPack) != null ? _b : void 0,\n        Annotations: {\n          Annotation: annotation_default,\n          WireAnnotation,\n          RealtimeAnnotations: realtimeannotations_default,\n          RestAnnotations: restannotations_default\n        }\n      }))\n    );\n  }\n  static get Crypto() {\n    if (this._Crypto === null) {\n      throw new Error(\"Encryption not enabled; use ably.encryption.js instead\");\n    }\n    return this._Crypto;\n  }\n  static set Crypto(newValue) {\n    this._Crypto = newValue;\n  }\n};\n_DefaultRest._Crypto = null;\n_DefaultRest.Message = DefaultMessage;\n_DefaultRest.PresenceMessage = DefaultPresenceMessage;\n_DefaultRest.Annotation = DefaultAnnotation;\n_DefaultRest._MsgPack = null;\n// Used by tests\n_DefaultRest._Http = Http;\nvar DefaultRest = _DefaultRest;\n\n// src/common/lib/transport/messagequeue.ts\nvar MessageQueue = class extends eventemitter_default {\n  constructor(logger) {\n    super(logger);\n    this.messages = [];\n  }\n  count() {\n    return this.messages.length;\n  }\n  push(message) {\n    this.messages.push(message);\n  }\n  shift() {\n    return this.messages.shift();\n  }\n  last() {\n    return this.messages[this.messages.length - 1];\n  }\n  copyAll() {\n    return this.messages.slice();\n  }\n  append(messages) {\n    this.messages.push.apply(this.messages, messages);\n  }\n  prepend(messages) {\n    this.messages.unshift.apply(this.messages, messages);\n  }\n  completeMessages(serial, count, err) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"MessageQueue.completeMessages()\",\n      \"serial = \" + serial + \"; count = \" + count\n    );\n    err = err || null;\n    const messages = this.messages;\n    if (messages.length === 0) {\n      throw new Error(\"MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue\");\n    }\n    const first = messages[0];\n    if (first) {\n      const startSerial = first.message.msgSerial;\n      const endSerial = serial + count;\n      if (endSerial > startSerial) {\n        const completeMessages = messages.splice(0, endSerial - startSerial);\n        for (const message of completeMessages) {\n          message.callback(err);\n        }\n      }\n      if (messages.length == 0)\n        this.emit(\"idle\");\n    }\n  }\n  completeAllMessages(err) {\n    this.completeMessages(0, Number.MAX_SAFE_INTEGER || Number.MAX_VALUE, err);\n  }\n  resetSendAttempted() {\n    for (let msg of this.messages) {\n      msg.sendAttempted = false;\n    }\n  }\n  clear() {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"MessageQueue.clear()\",\n      \"clearing \" + this.messages.length + \" messages\"\n    );\n    this.messages = [];\n    this.emit(\"idle\");\n  }\n};\nvar messagequeue_default = MessageQueue;\n\n// src/common/lib/transport/protocol.ts\nvar PendingMessage = class {\n  constructor(message, callback) {\n    this.message = message;\n    this.callback = callback;\n    this.merged = false;\n    const action = message.action;\n    this.sendAttempted = false;\n    this.ackRequired = typeof action === \"number\" && [actions.MESSAGE, actions.PRESENCE, actions.ANNOTATION, actions.OBJECT].includes(action);\n  }\n};\nvar Protocol = class extends eventemitter_default {\n  constructor(transport) {\n    super(transport.logger);\n    this.transport = transport;\n    this.messageQueue = new messagequeue_default(this.logger);\n    transport.on(\"ack\", (serial, count) => {\n      this.onAck(serial, count);\n    });\n    transport.on(\"nack\", (serial, count, err) => {\n      this.onNack(serial, count, err);\n    });\n  }\n  onAck(serial, count) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"Protocol.onAck()\", \"serial = \" + serial + \"; count = \" + count);\n    this.messageQueue.completeMessages(serial, count);\n  }\n  onNack(serial, count, err) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_ERROR,\n      \"Protocol.onNack()\",\n      \"serial = \" + serial + \"; count = \" + count + \"; err = \" + inspectError(err)\n    );\n    if (!err) {\n      err = new ErrorInfo(\"Unable to send message; channel not responding\", 50001, 500);\n    }\n    this.messageQueue.completeMessages(serial, count, err);\n  }\n  onceIdle(listener) {\n    const messageQueue = this.messageQueue;\n    if (messageQueue.count() === 0) {\n      listener();\n      return;\n    }\n    messageQueue.once(\"idle\", listener);\n  }\n  send(pendingMessage) {\n    if (pendingMessage.ackRequired) {\n      this.messageQueue.push(pendingMessage);\n    }\n    if (this.logger.shouldLog(logger_default.LOG_MICRO)) {\n      logger_default.logActionNoStrip(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"Protocol.send()\",\n        \"sending msg; \" + stringify(\n          pendingMessage.message,\n          this.transport.connectionManager.realtime._RealtimePresence,\n          this.transport.connectionManager.realtime._Annotations,\n          this.transport.connectionManager.realtime._objectsPlugin\n        )\n      );\n    }\n    pendingMessage.sendAttempted = true;\n    this.transport.send(pendingMessage.message);\n  }\n  getTransport() {\n    return this.transport;\n  }\n  getPendingMessages() {\n    return this.messageQueue.copyAll();\n  }\n  clearPendingMessages() {\n    return this.messageQueue.clear();\n  }\n  finish() {\n    const transport = this.transport;\n    this.onceIdle(function() {\n      transport.disconnect();\n    });\n  }\n};\nvar protocol_default = Protocol;\n\n// src/common/lib/client/connectionstatechange.ts\nvar ConnectionStateChange = class {\n  constructor(previous, current, retryIn, reason) {\n    this.previous = previous;\n    this.current = current;\n    if (retryIn)\n      this.retryIn = retryIn;\n    if (reason)\n      this.reason = reason;\n  }\n};\nvar connectionstatechange_default = ConnectionStateChange;\n\n// src/common/lib/transport/connectionerrors.ts\nvar ConnectionErrorCodes = {\n  DISCONNECTED: 80003,\n  SUSPENDED: 80002,\n  FAILED: 8e4,\n  CLOSING: 80017,\n  CLOSED: 80017,\n  UNKNOWN_CONNECTION_ERR: 50002,\n  UNKNOWN_CHANNEL_ERR: 50001\n};\nvar ConnectionErrors = {\n  disconnected: () => ErrorInfo.fromValues({\n    statusCode: 400,\n    code: ConnectionErrorCodes.DISCONNECTED,\n    message: \"Connection to server temporarily unavailable\"\n  }),\n  suspended: () => ErrorInfo.fromValues({\n    statusCode: 400,\n    code: ConnectionErrorCodes.SUSPENDED,\n    message: \"Connection to server unavailable\"\n  }),\n  failed: () => ErrorInfo.fromValues({\n    statusCode: 400,\n    code: ConnectionErrorCodes.FAILED,\n    message: \"Connection failed or disconnected by server\"\n  }),\n  closing: () => ErrorInfo.fromValues({\n    statusCode: 400,\n    code: ConnectionErrorCodes.CLOSING,\n    message: \"Connection closing\"\n  }),\n  closed: () => ErrorInfo.fromValues({\n    statusCode: 400,\n    code: ConnectionErrorCodes.CLOSED,\n    message: \"Connection closed\"\n  }),\n  unknownConnectionErr: () => ErrorInfo.fromValues({\n    statusCode: 500,\n    code: ConnectionErrorCodes.UNKNOWN_CONNECTION_ERR,\n    message: \"Internal connection error\"\n  }),\n  unknownChannelErr: () => ErrorInfo.fromValues({\n    statusCode: 500,\n    code: ConnectionErrorCodes.UNKNOWN_CONNECTION_ERR,\n    message: \"Internal channel error\"\n  })\n};\nfunction isRetriable(err) {\n  if (!err.statusCode || !err.code || err.statusCode >= 500) {\n    return true;\n  }\n  return Object.values(ConnectionErrorCodes).includes(err.code);\n}\nvar connectionerrors_default = ConnectionErrors;\n\n// src/common/lib/transport/transport.ts\nvar closeMessage = fromValues({ action: actions.CLOSE });\nvar disconnectMessage = fromValues({ action: actions.DISCONNECT });\nvar Transport = class extends eventemitter_default {\n  constructor(connectionManager, auth, params, forceJsonProtocol) {\n    super(connectionManager.logger);\n    if (forceJsonProtocol) {\n      params.format = void 0;\n      params.heartbeats = true;\n    }\n    this.connectionManager = connectionManager;\n    this.auth = auth;\n    this.params = params;\n    this.timeouts = params.options.timeouts;\n    this.format = params.format;\n    this.isConnected = false;\n    this.isFinished = false;\n    this.isDisposed = false;\n    this.maxIdleInterval = null;\n    this.idleTimer = null;\n    this.lastActivity = null;\n  }\n  connect() {\n  }\n  close() {\n    if (this.isConnected) {\n      this.requestClose();\n    }\n    this.finish(\"closed\", connectionerrors_default.closed());\n  }\n  disconnect(err) {\n    if (this.isConnected) {\n      this.requestDisconnect();\n    }\n    this.finish(\"disconnected\", err || connectionerrors_default.disconnected());\n  }\n  fail(err) {\n    if (this.isConnected) {\n      this.requestDisconnect();\n    }\n    this.finish(\"failed\", err || connectionerrors_default.failed());\n  }\n  finish(event, err) {\n    var _a2;\n    if (this.isFinished) {\n      return;\n    }\n    this.isFinished = true;\n    this.isConnected = false;\n    this.maxIdleInterval = null;\n    clearTimeout((_a2 = this.idleTimer) != null ? _a2 : void 0);\n    this.idleTimer = null;\n    this.emit(event, err);\n    this.dispose();\n  }\n  onProtocolMessage(message) {\n    if (this.logger.shouldLog(logger_default.LOG_MICRO)) {\n      logger_default.logActionNoStrip(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"Transport.onProtocolMessage()\",\n        \"received on \" + this.shortName + \": \" + stringify(\n          message,\n          this.connectionManager.realtime._RealtimePresence,\n          this.connectionManager.realtime._Annotations,\n          this.connectionManager.realtime._objectsPlugin\n        ) + \"; connectionId = \" + this.connectionManager.connectionId\n      );\n    }\n    this.onActivity();\n    switch (message.action) {\n      case actions.HEARTBEAT:\n        logger_default.logActionNoStrip(\n          this.logger,\n          logger_default.LOG_MICRO,\n          \"Transport.onProtocolMessage()\",\n          this.shortName + \" heartbeat; connectionId = \" + this.connectionManager.connectionId\n        );\n        this.emit(\"heartbeat\", message.id);\n        break;\n      case actions.CONNECTED:\n        this.onConnect(message);\n        this.emit(\"connected\", message.error, message.connectionId, message.connectionDetails, message);\n        break;\n      case actions.CLOSED:\n        this.onClose(message);\n        break;\n      case actions.DISCONNECTED:\n        this.onDisconnect(message);\n        break;\n      case actions.ACK:\n        this.emit(\"ack\", message.msgSerial, message.count);\n        break;\n      case actions.NACK:\n        this.emit(\"nack\", message.msgSerial, message.count, message.error);\n        break;\n      case actions.SYNC:\n        this.connectionManager.onChannelMessage(message, this);\n        break;\n      case actions.ACTIVATE:\n        break;\n      case actions.AUTH:\n        whenPromiseSettles(this.auth.authorize(), (err) => {\n          if (err) {\n            logger_default.logAction(\n              this.logger,\n              logger_default.LOG_ERROR,\n              \"Transport.onProtocolMessage()\",\n              \"Ably requested re-authentication, but unable to obtain a new token: \" + inspectError(err)\n            );\n          }\n        });\n        break;\n      case actions.ERROR:\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"Transport.onProtocolMessage()\",\n          \"received error action; connectionId = \" + this.connectionManager.connectionId + \"; err = \" + Platform.Config.inspect(message.error) + (message.channel ? \", channel: \" + message.channel : \"\")\n        );\n        if (message.channel === void 0) {\n          this.onFatalError(message);\n          break;\n        }\n        this.connectionManager.onChannelMessage(message, this);\n        break;\n      default:\n        this.connectionManager.onChannelMessage(message, this);\n    }\n  }\n  onConnect(message) {\n    this.isConnected = true;\n    if (!message.connectionDetails) {\n      throw new Error(\"Transport.onConnect(): Connect message recieved without connectionDetails\");\n    }\n    const maxPromisedIdle = message.connectionDetails.maxIdleInterval;\n    if (maxPromisedIdle) {\n      this.maxIdleInterval = maxPromisedIdle + this.timeouts.realtimeRequestTimeout;\n      this.onActivity();\n    }\n  }\n  onDisconnect(message) {\n    const err = message && message.error;\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Transport.onDisconnect()\", \"err = \" + inspectError(err));\n    this.finish(\"disconnected\", err);\n  }\n  onFatalError(message) {\n    const err = message && message.error;\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Transport.onFatalError()\", \"err = \" + inspectError(err));\n    this.finish(\"failed\", err);\n  }\n  onClose(message) {\n    const err = message && message.error;\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Transport.onClose()\", \"err = \" + inspectError(err));\n    this.finish(\"closed\", err);\n  }\n  requestClose() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Transport.requestClose()\", \"\");\n    this.send(closeMessage);\n  }\n  requestDisconnect() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Transport.requestDisconnect()\", \"\");\n    this.send(disconnectMessage);\n  }\n  ping(id) {\n    const msg = { action: actions.HEARTBEAT };\n    if (id)\n      msg.id = id;\n    this.send(fromValues(msg));\n  }\n  dispose() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Transport.dispose()\", \"\");\n    this.isDisposed = true;\n    this.off();\n  }\n  onActivity() {\n    if (!this.maxIdleInterval) {\n      return;\n    }\n    this.lastActivity = this.connectionManager.lastActivity = Date.now();\n    this.setIdleTimer(this.maxIdleInterval + 100);\n  }\n  setIdleTimer(timeout) {\n    if (!this.idleTimer) {\n      this.idleTimer = setTimeout(() => {\n        this.onIdleTimerExpire();\n      }, timeout);\n    }\n  }\n  onIdleTimerExpire() {\n    if (!this.lastActivity || !this.maxIdleInterval) {\n      throw new Error(\"Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set\");\n    }\n    this.idleTimer = null;\n    const sinceLast = Date.now() - this.lastActivity;\n    const timeRemaining = this.maxIdleInterval - sinceLast;\n    if (timeRemaining <= 0) {\n      const msg = \"No activity seen from realtime in \" + sinceLast + \"ms; assuming connection has dropped\";\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"Transport.onIdleTimerExpire()\", msg);\n      this.disconnect(new ErrorInfo(msg, 80003, 408));\n    } else {\n      this.setIdleTimer(timeRemaining + 100);\n    }\n  }\n  static tryConnect(transportCtor, connectionManager, auth, transportParams, callback) {\n    const transport = new transportCtor(connectionManager, auth, transportParams);\n    let transportAttemptTimer;\n    const errorCb = function(err) {\n      clearTimeout(transportAttemptTimer);\n      callback({ event: this.event, error: err });\n    };\n    const realtimeRequestTimeout = connectionManager.options.timeouts.realtimeRequestTimeout;\n    transportAttemptTimer = setTimeout(() => {\n      transport.off([\"preconnect\", \"disconnected\", \"failed\"]);\n      transport.dispose();\n      errorCb.call(\n        { event: \"disconnected\" },\n        new ErrorInfo(\"Timeout waiting for transport to indicate itself viable\", 5e4, 500)\n      );\n    }, realtimeRequestTimeout);\n    transport.on([\"failed\", \"disconnected\"], errorCb);\n    transport.on(\"preconnect\", function() {\n      logger_default.logAction(\n        connectionManager.logger,\n        logger_default.LOG_MINOR,\n        \"Transport.tryConnect()\",\n        \"viable transport \" + transport\n      );\n      clearTimeout(transportAttemptTimer);\n      transport.off([\"failed\", \"disconnected\"], errorCb);\n      callback(null, transport);\n    });\n    transport.connect();\n    return transport;\n  }\n  static isAvailable() {\n    throw new ErrorInfo(\"isAvailable not implemented for transport\", 5e4, 500);\n  }\n};\nvar transport_default = Transport;\n\n// src/common/constants/TransportName.ts\nvar TransportNames;\n((TransportNames2) => {\n  TransportNames2.WebSocket = \"web_socket\";\n  TransportNames2.Comet = \"comet\";\n  TransportNames2.XhrPolling = \"xhr_polling\";\n})(TransportNames || (TransportNames = {}));\n\n// src/common/lib/transport/connectionmanager.ts\nvar globalObject2 = typeof global !== \"undefined\" ? global : typeof window !== \"undefined\" ? window : self;\nvar haveWebStorage = () => {\n  var _a2;\n  return typeof Platform.WebStorage !== \"undefined\" && ((_a2 = Platform.WebStorage) == null ? void 0 : _a2.localSupported);\n};\nvar haveSessionStorage = () => {\n  var _a2;\n  return typeof Platform.WebStorage !== \"undefined\" && ((_a2 = Platform.WebStorage) == null ? void 0 : _a2.sessionSupported);\n};\nvar noop2 = function() {\n};\nvar transportPreferenceName = \"ably-transport-preference\";\nfunction bundleWith(dest, src, maxSize) {\n  let action;\n  if (dest.channel !== src.channel) {\n    return false;\n  }\n  if ((action = dest.action) !== actions.PRESENCE && action !== actions.MESSAGE) {\n    return false;\n  }\n  if (action !== src.action) {\n    return false;\n  }\n  const kind = action === actions.PRESENCE ? \"presence\" : \"messages\", proposed = dest[kind].concat(src[kind]), size = getMessagesSize(proposed);\n  if (size > maxSize) {\n    return false;\n  }\n  if (!allSame(proposed, \"clientId\")) {\n    return false;\n  }\n  if (!proposed.every(function(msg) {\n    return !msg.id;\n  })) {\n    return false;\n  }\n  dest[kind] = proposed;\n  return true;\n}\nfunction decodeRecoveryKey(recoveryKey) {\n  try {\n    return JSON.parse(recoveryKey);\n  } catch (e) {\n    return null;\n  }\n}\nvar TransportParams = class {\n  constructor(options, host, mode, connectionKey) {\n    this.options = options;\n    this.host = host;\n    this.mode = mode;\n    this.connectionKey = connectionKey;\n    this.format = options.useBinaryProtocol ? \"msgpack\" /* msgpack */ : \"json\" /* json */;\n  }\n  getConnectParams(authParams) {\n    const params = authParams ? copy(authParams) : {};\n    const options = this.options;\n    switch (this.mode) {\n      case \"resume\":\n        params.resume = this.connectionKey;\n        break;\n      case \"recover\": {\n        const recoveryContext = decodeRecoveryKey(options.recover);\n        if (recoveryContext) {\n          params.recover = recoveryContext.connectionKey;\n        }\n        break;\n      }\n      default:\n    }\n    if (options.clientId !== void 0) {\n      params.clientId = options.clientId;\n    }\n    if (options.echoMessages === false) {\n      params.echo = \"false\";\n    }\n    if (this.format !== void 0) {\n      params.format = this.format;\n    }\n    if (this.stream !== void 0) {\n      params.stream = this.stream;\n    }\n    if (this.heartbeats !== void 0) {\n      params.heartbeats = this.heartbeats;\n    }\n    params.v = defaults_default.protocolVersion;\n    params.agent = getAgentString(this.options);\n    if (options.transportParams !== void 0) {\n      mixin(params, options.transportParams);\n    }\n    return params;\n  }\n  toString() {\n    let result = \"[mode=\" + this.mode;\n    if (this.host) {\n      result += \",host=\" + this.host;\n    }\n    if (this.connectionKey) {\n      result += \",connectionKey=\" + this.connectionKey;\n    }\n    if (this.format) {\n      result += \",format=\" + this.format;\n    }\n    result += \"]\";\n    return result;\n  }\n};\nvar ConnectionManager = class _ConnectionManager extends eventemitter_default {\n  constructor(realtime, options) {\n    super(realtime.logger);\n    this.supportedTransports = {};\n    this.disconnectedRetryCount = 0;\n    this.pendingChannelMessagesState = { isProcessing: false, queue: [] };\n    this.realtime = realtime;\n    this.initTransports();\n    this.options = options;\n    const timeouts = options.timeouts;\n    const connectingTimeout = timeouts.webSocketConnectTimeout + timeouts.realtimeRequestTimeout;\n    this.states = {\n      initialized: {\n        state: \"initialized\",\n        terminal: false,\n        queueEvents: true,\n        sendEvents: false,\n        failState: \"disconnected\"\n      },\n      connecting: {\n        state: \"connecting\",\n        terminal: false,\n        queueEvents: true,\n        sendEvents: false,\n        retryDelay: connectingTimeout,\n        failState: \"disconnected\"\n      },\n      connected: {\n        state: \"connected\",\n        terminal: false,\n        queueEvents: false,\n        sendEvents: true,\n        failState: \"disconnected\"\n      },\n      disconnected: {\n        state: \"disconnected\",\n        terminal: false,\n        queueEvents: true,\n        sendEvents: false,\n        retryDelay: timeouts.disconnectedRetryTimeout,\n        failState: \"disconnected\"\n      },\n      suspended: {\n        state: \"suspended\",\n        terminal: false,\n        queueEvents: false,\n        sendEvents: false,\n        retryDelay: timeouts.suspendedRetryTimeout,\n        failState: \"suspended\"\n      },\n      closing: {\n        state: \"closing\",\n        terminal: false,\n        queueEvents: false,\n        sendEvents: false,\n        retryDelay: timeouts.realtimeRequestTimeout,\n        failState: \"closed\"\n      },\n      closed: { state: \"closed\", terminal: true, queueEvents: false, sendEvents: false, failState: \"closed\" },\n      failed: { state: \"failed\", terminal: true, queueEvents: false, sendEvents: false, failState: \"failed\" }\n    };\n    this.state = this.states.initialized;\n    this.errorReason = null;\n    this.queuedMessages = new messagequeue_default(this.logger);\n    this.msgSerial = 0;\n    this.connectionDetails = void 0;\n    this.connectionId = void 0;\n    this.connectionKey = void 0;\n    this.connectionStateTtl = timeouts.connectionStateTtl;\n    this.maxIdleInterval = null;\n    this.transports = intersect(options.transports || defaults_default.defaultTransports, this.supportedTransports);\n    this.transportPreference = null;\n    if (this.transports.includes(TransportNames.WebSocket)) {\n      this.webSocketTransportAvailable = true;\n    }\n    if (this.transports.includes(TransportNames.XhrPolling)) {\n      this.baseTransport = TransportNames.XhrPolling;\n    } else if (this.transports.includes(TransportNames.Comet)) {\n      this.baseTransport = TransportNames.Comet;\n    }\n    this.domains = defaults_default.getHosts(options);\n    this.activeProtocol = null;\n    this.host = null;\n    this.lastAutoReconnectAttempt = null;\n    this.lastActivity = null;\n    this.forceFallbackHost = false;\n    this.connectCounter = 0;\n    this.wsCheckResult = null;\n    this.webSocketSlowTimer = null;\n    this.webSocketGiveUpTimer = null;\n    this.abandonedWebSocket = false;\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Realtime.ConnectionManager()\", \"started\");\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"Realtime.ConnectionManager()\",\n      \"requested transports = [\" + (options.transports || defaults_default.defaultTransports) + \"]\"\n    );\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"Realtime.ConnectionManager()\",\n      \"available transports = [\" + this.transports + \"]\"\n    );\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"Realtime.ConnectionManager()\",\n      \"http domains = [\" + this.domains + \"]\"\n    );\n    if (!this.transports.length) {\n      const msg = \"no requested transports available\";\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"realtime.ConnectionManager()\", msg);\n      throw new Error(msg);\n    }\n    const addEventListener = Platform.Config.addEventListener;\n    if (addEventListener) {\n      if (haveSessionStorage() && typeof options.recover === \"function\") {\n        addEventListener(\"beforeunload\", this.persistConnection.bind(this));\n      }\n      if (options.closeOnUnload === true) {\n        addEventListener(\"beforeunload\", () => {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MAJOR,\n            \"Realtime.ConnectionManager()\",\n            \"beforeunload event has triggered the connection to close as closeOnUnload is true\"\n          );\n          this.requestState({ state: \"closing\" });\n        });\n      }\n      addEventListener(\"online\", () => {\n        var _a2;\n        if (this.state == this.states.disconnected || this.state == this.states.suspended) {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MINOR,\n            \"ConnectionManager caught browser \\u2018online\\u2019 event\",\n            \"reattempting connection\"\n          );\n          this.requestState({ state: \"connecting\" });\n        } else if (this.state == this.states.connecting) {\n          (_a2 = this.pendingTransport) == null ? void 0 : _a2.off();\n          this.disconnectAllTransports();\n          this.startConnect();\n        }\n      });\n      addEventListener(\"offline\", () => {\n        if (this.state == this.states.connected) {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MINOR,\n            \"ConnectionManager caught browser \\u2018offline\\u2019 event\",\n            \"disconnecting active transport\"\n          );\n          this.disconnectAllTransports();\n        }\n      });\n    }\n  }\n  /*********************\n   * transport management\n   *********************/\n  // Used by tests\n  static supportedTransports(additionalImplementations) {\n    const storage = { supportedTransports: {} };\n    this.initTransports(additionalImplementations, storage);\n    return storage.supportedTransports;\n  }\n  static initTransports(additionalImplementations, storage) {\n    const implementations = __spreadValues(__spreadValues({}, Platform.Transports.bundledImplementations), additionalImplementations);\n    [TransportNames.WebSocket, ...Platform.Transports.order].forEach((transportName) => {\n      const transport = implementations[transportName];\n      if (transport && transport.isAvailable()) {\n        storage.supportedTransports[transportName] = transport;\n      }\n    });\n  }\n  initTransports() {\n    _ConnectionManager.initTransports(this.realtime._additionalTransportImplementations, this);\n  }\n  createTransportParams(host, mode) {\n    return new TransportParams(this.options, host, mode, this.connectionKey);\n  }\n  getTransportParams(callback) {\n    const decideMode = (modeCb) => {\n      if (this.connectionKey) {\n        modeCb(\"resume\");\n        return;\n      }\n      if (typeof this.options.recover === \"string\") {\n        modeCb(\"recover\");\n        return;\n      }\n      const recoverFn = this.options.recover, lastSessionData = this.getSessionRecoverData(), sessionRecoveryName = this.sessionRecoveryName();\n      if (lastSessionData && typeof recoverFn === \"function\") {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"ConnectionManager.getTransportParams()\",\n          \"Calling clientOptions-provided recover function with last session data (recovery scope: \" + sessionRecoveryName + \")\"\n        );\n        recoverFn(lastSessionData, (shouldRecover) => {\n          if (shouldRecover) {\n            this.options.recover = lastSessionData.recoveryKey;\n            modeCb(\"recover\");\n          } else {\n            modeCb(\"clean\");\n          }\n        });\n        return;\n      }\n      modeCb(\"clean\");\n    };\n    decideMode((mode) => {\n      const transportParams = this.createTransportParams(null, mode);\n      if (mode === \"recover\") {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"ConnectionManager.getTransportParams()\",\n          \"Transport recovery mode = recover; recoveryKey = \" + this.options.recover\n        );\n        const recoveryContext = decodeRecoveryKey(this.options.recover);\n        if (recoveryContext) {\n          this.msgSerial = recoveryContext.msgSerial;\n        }\n      } else {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"ConnectionManager.getTransportParams()\",\n          \"Transport params = \" + transportParams.toString()\n        );\n      }\n      callback(transportParams);\n    });\n  }\n  /**\n   * Attempt to connect using a given transport\n   * @param transportParams\n   * @param candidate, the transport to try\n   * @param callback\n   */\n  tryATransport(transportParams, candidate, callback) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"ConnectionManager.tryATransport()\", \"trying \" + candidate);\n    this.proposedTransport = transport_default.tryConnect(\n      this.supportedTransports[candidate],\n      this,\n      this.realtime.auth,\n      transportParams,\n      (wrappedErr, transport) => {\n        const state = this.state;\n        if (state == this.states.closing || state == this.states.closed || state == this.states.failed) {\n          if (transport) {\n            logger_default.logAction(\n              this.logger,\n              logger_default.LOG_MINOR,\n              \"ConnectionManager.tryATransport()\",\n              \"connection \" + state.state + \" while we were attempting the transport; closing \" + transport\n            );\n            transport.close();\n          }\n          callback(true);\n          return;\n        }\n        if (wrappedErr) {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MINOR,\n            \"ConnectionManager.tryATransport()\",\n            \"transport \" + candidate + \" \" + wrappedErr.event + \", err: \" + wrappedErr.error.toString()\n          );\n          if (auth_default.isTokenErr(wrappedErr.error) && !(this.errorReason && auth_default.isTokenErr(this.errorReason))) {\n            this.errorReason = wrappedErr.error;\n            whenPromiseSettles(this.realtime.auth._forceNewToken(null, null), (err) => {\n              if (err) {\n                this.actOnErrorFromAuthorize(err);\n                return;\n              }\n              this.tryATransport(transportParams, candidate, callback);\n            });\n          } else if (wrappedErr.event === \"failed\") {\n            this.notifyState({ state: \"failed\", error: wrappedErr.error });\n            callback(true);\n          } else if (wrappedErr.event === \"disconnected\") {\n            if (!isRetriable(wrappedErr.error)) {\n              this.notifyState({ state: this.states.connecting.failState, error: wrappedErr.error });\n              callback(true);\n            } else {\n              callback(false);\n            }\n          }\n          return;\n        }\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MICRO,\n          \"ConnectionManager.tryATransport()\",\n          \"viable transport \" + candidate + \"; setting pending\"\n        );\n        this.setTransportPending(transport, transportParams);\n        callback(null, transport);\n      }\n    );\n  }\n  /**\n   * Called when a transport is indicated to be viable, and the ConnectionManager\n   * expects to activate this transport as soon as it is connected.\n   * @param transport\n   * @param transportParams\n   */\n  setTransportPending(transport, transportParams) {\n    const mode = transportParams.mode;\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.setTransportPending()\",\n      \"transport = \" + transport + \"; mode = \" + mode\n    );\n    this.pendingTransport = transport;\n    this.cancelWebSocketSlowTimer();\n    this.cancelWebSocketGiveUpTimer();\n    transport.once(\"connected\", (error, connectionId, connectionDetails) => {\n      this.activateTransport(error, transport, connectionId, connectionDetails);\n      if (mode === \"recover\" && this.options.recover) {\n        delete this.options.recover;\n        this.unpersistConnection();\n      }\n    });\n    const self2 = this;\n    transport.on([\"disconnected\", \"closed\", \"failed\"], function(error) {\n      self2.deactivateTransport(transport, this.event, error);\n    });\n    this.emit(\"transport.pending\", transport);\n  }\n  /**\n   * Called when a transport is connected, and the connectionmanager decides that\n   * it will now be the active transport. Returns whether or not it activated\n   * the transport (if the connection is closing/closed it will choose not to).\n   * @param transport the transport instance\n   * @param connectionId the id of the new active connection\n   * @param connectionDetails the details of the new active connection\n   */\n  activateTransport(error, transport, connectionId, connectionDetails) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.activateTransport()\",\n      \"transport = \" + transport\n    );\n    if (error) {\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"ConnectionManager.activateTransport()\", \"error = \" + error);\n    }\n    if (connectionId) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.activateTransport()\",\n        \"connectionId =  \" + connectionId\n      );\n    }\n    if (connectionDetails) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.activateTransport()\",\n        \"connectionDetails =  \" + JSON.stringify(connectionDetails)\n      );\n    }\n    this.persistTransportPreference(transport);\n    const existingState = this.state, connectedState = this.states.connected.state;\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.activateTransport()\",\n      \"current state = \" + existingState.state\n    );\n    if (existingState.state == this.states.closing.state || existingState.state == this.states.closed.state || existingState.state == this.states.failed.state) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"ConnectionManager.activateTransport()\",\n        \"Disconnecting transport and abandoning\"\n      );\n      transport.disconnect();\n      return false;\n    }\n    delete this.pendingTransport;\n    if (!transport.isConnected) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"ConnectionManager.activateTransport()\",\n        \"Declining to activate transport \" + transport + \" since it appears to no longer be connected\"\n      );\n      return false;\n    }\n    const existingActiveProtocol = this.activeProtocol;\n    this.activeProtocol = new protocol_default(transport);\n    this.host = transport.params.host;\n    const connectionKey = connectionDetails.connectionKey;\n    if (connectionKey && this.connectionKey != connectionKey) {\n      this.setConnection(connectionId, connectionDetails, !!error);\n    }\n    this.onConnectionDetailsUpdate(connectionDetails, transport);\n    Platform.Config.nextTick(() => {\n      transport.on(\n        \"connected\",\n        (connectedErr, _connectionId, connectionDetails2) => {\n          this.onConnectionDetailsUpdate(connectionDetails2, transport);\n          this.emit(\"update\", new connectionstatechange_default(connectedState, connectedState, null, connectedErr));\n        }\n      );\n    });\n    if (existingState.state === this.states.connected.state) {\n      if (error) {\n        this.errorReason = this.realtime.connection.errorReason = error;\n        this.emit(\"update\", new connectionstatechange_default(connectedState, connectedState, null, error));\n      }\n    } else {\n      this.notifyState({ state: \"connected\", error });\n      this.errorReason = this.realtime.connection.errorReason = error || null;\n    }\n    this.emit(\"transport.active\", transport);\n    if (existingActiveProtocol) {\n      if (existingActiveProtocol.messageQueue.count() > 0) {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_ERROR,\n          \"ConnectionManager.activateTransport()\",\n          \"Previous active protocol (for transport \" + existingActiveProtocol.transport.shortName + \", new one is \" + transport.shortName + \") finishing with \" + existingActiveProtocol.messageQueue.count() + \" messages still pending\"\n        );\n      }\n      if (existingActiveProtocol.transport === transport) {\n        const msg = \"Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = \" + transport.shortName + \"; stack = \" + new Error().stack;\n        logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"ConnectionManager.activateTransport()\", msg);\n      } else {\n        existingActiveProtocol.finish();\n      }\n    }\n    return true;\n  }\n  /**\n   * Called when a transport is no longer the active transport. This can occur\n   * in any transport connection state.\n   * @param transport\n   */\n  deactivateTransport(transport, state, error) {\n    const currentProtocol = this.activeProtocol, wasActive = currentProtocol && currentProtocol.getTransport() === transport, wasPending = transport === this.pendingTransport, noTransportsScheduledForActivation = this.noTransportsScheduledForActivation();\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.deactivateTransport()\",\n      \"transport = \" + transport\n    );\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.deactivateTransport()\",\n      \"state = \" + state + (wasActive ? \"; was active\" : wasPending ? \"; was pending\" : \"\") + (noTransportsScheduledForActivation ? \"\" : \"; another transport is scheduled for activation\")\n    );\n    if (error && error.message)\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.deactivateTransport()\",\n        \"reason =  \" + error.message\n      );\n    if (wasActive) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.deactivateTransport()\",\n        \"Getting, clearing, and requeuing \" + this.activeProtocol.messageQueue.count() + \" pending messages\"\n      );\n      this.queuePendingMessages(currentProtocol.getPendingMessages());\n      currentProtocol.clearPendingMessages();\n      this.activeProtocol = this.host = null;\n    }\n    this.emit(\"transport.inactive\", transport);\n    if (wasActive && noTransportsScheduledForActivation || wasActive && state === \"failed\" || state === \"closed\" || currentProtocol === null && wasPending) {\n      if (state === \"disconnected\" && error && error.statusCode > 500 && this.domains.length > 1) {\n        this.unpersistTransportPreference();\n        this.forceFallbackHost = true;\n        this.notifyState({ state, error, retryImmediately: true });\n        return;\n      }\n      const newConnectionState = state === \"failed\" && auth_default.isTokenErr(error) ? \"disconnected\" : state;\n      this.notifyState({ state: newConnectionState, error });\n      return;\n    }\n  }\n  /* Helper that returns true if there are no transports which are pending,\n   * have been connected, and are just waiting for onceNoPending to fire before\n   * being activated */\n  noTransportsScheduledForActivation() {\n    return !this.pendingTransport || !this.pendingTransport.isConnected;\n  }\n  setConnection(connectionId, connectionDetails, hasConnectionError) {\n    const prevConnId = this.connectionId, connIdChanged = prevConnId && prevConnId !== connectionId, recoverFailure = !prevConnId && hasConnectionError;\n    if (connIdChanged || recoverFailure) {\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"ConnectionManager.setConnection()\", \"Resetting msgSerial\");\n      this.msgSerial = 0;\n      this.queuedMessages.resetSendAttempted();\n    }\n    if (this.connectionId !== connectionId) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"ConnectionManager.setConnection()\",\n        \"New connectionId; reattaching any attached channels\"\n      );\n    }\n    this.realtime.connection.id = this.connectionId = connectionId;\n    this.realtime.connection.key = this.connectionKey = connectionDetails.connectionKey;\n  }\n  clearConnection() {\n    this.realtime.connection.id = this.connectionId = void 0;\n    this.realtime.connection.key = this.connectionKey = void 0;\n    this.msgSerial = 0;\n    this.unpersistConnection();\n  }\n  createRecoveryKey() {\n    if (!this.connectionKey) {\n      return null;\n    }\n    return JSON.stringify({\n      connectionKey: this.connectionKey,\n      msgSerial: this.msgSerial,\n      channelSerials: this.realtime.channels.channelSerials()\n    });\n  }\n  checkConnectionStateFreshness() {\n    if (!this.lastActivity || !this.connectionId) {\n      return;\n    }\n    const sinceLast = Date.now() - this.lastActivity;\n    if (sinceLast > this.connectionStateTtl + this.maxIdleInterval) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"ConnectionManager.checkConnectionStateFreshness()\",\n        \"Last known activity from realtime was \" + sinceLast + \"ms ago; discarding connection state\"\n      );\n      this.clearConnection();\n      this.states.connecting.failState = \"suspended\";\n    }\n  }\n  /**\n   * Called when the connectionmanager wants to persist transport\n   * state for later recovery. Only applicable in the browser context.\n   */\n  persistConnection() {\n    if (haveSessionStorage()) {\n      const recoveryKey = this.createRecoveryKey();\n      if (recoveryKey) {\n        this.setSessionRecoverData({\n          recoveryKey,\n          disconnectedAt: Date.now(),\n          location: globalObject2.location,\n          clientId: this.realtime.auth.clientId\n        });\n      }\n    }\n  }\n  /**\n   * Called when the connectionmanager wants to persist transport\n   * state for later recovery. Only applicable in the browser context.\n   */\n  unpersistConnection() {\n    this.clearSessionRecoverData();\n  }\n  getActiveTransportFormat() {\n    var _a2;\n    return (_a2 = this.activeProtocol) == null ? void 0 : _a2.getTransport().format;\n  }\n  /*********************\n   * state management\n   *********************/\n  getError() {\n    if (this.errorReason) {\n      const newError = PartialErrorInfo.fromValues(this.errorReason);\n      newError.cause = this.errorReason;\n      return newError;\n    }\n    return this.getStateError();\n  }\n  getStateError() {\n    var _a2, _b;\n    return (_b = (_a2 = connectionerrors_default)[this.state.state]) == null ? void 0 : _b.call(_a2);\n  }\n  activeState() {\n    return this.state.queueEvents || this.state.sendEvents;\n  }\n  enactStateChange(stateChange) {\n    const action = \"Connection state\";\n    const message = stateChange.current + (stateChange.reason ? \"; reason: \" + stateChange.reason : \"\");\n    if (stateChange.current === \"failed\") {\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, action, message);\n    } else {\n      logger_default.logAction(this.logger, logger_default.LOG_MAJOR, action, message);\n    }\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.enactStateChange\",\n      \"setting new state: \" + stateChange.current + \"; reason = \" + (stateChange.reason && stateChange.reason.message)\n    );\n    const newState = this.state = this.states[stateChange.current];\n    if (stateChange.reason) {\n      this.errorReason = stateChange.reason;\n      this.realtime.connection.errorReason = stateChange.reason;\n    }\n    if (newState.terminal || newState.state === \"suspended\") {\n      this.clearConnection();\n    }\n    this.emit(\"connectionstate\", stateChange);\n  }\n  /****************************************\n   * ConnectionManager connection lifecycle\n   ****************************************/\n  startTransitionTimer(transitionState) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.startTransitionTimer()\",\n      \"transitionState: \" + transitionState.state\n    );\n    if (this.transitionTimer) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"ConnectionManager.startTransitionTimer()\",\n        \"clearing already-running timer\"\n      );\n      clearTimeout(this.transitionTimer);\n    }\n    this.transitionTimer = setTimeout(() => {\n      if (this.transitionTimer) {\n        this.transitionTimer = null;\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"ConnectionManager \" + transitionState.state + \" timer expired\",\n          \"requesting new state: \" + transitionState.failState\n        );\n        this.notifyState({ state: transitionState.failState });\n      }\n    }, transitionState.retryDelay);\n  }\n  cancelTransitionTimer() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"ConnectionManager.cancelTransitionTimer()\", \"\");\n    if (this.transitionTimer) {\n      clearTimeout(this.transitionTimer);\n      this.transitionTimer = null;\n    }\n  }\n  startSuspendTimer() {\n    if (this.suspendTimer)\n      return;\n    this.suspendTimer = setTimeout(() => {\n      if (this.suspendTimer) {\n        this.suspendTimer = null;\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"ConnectionManager suspend timer expired\",\n          \"requesting new state: suspended\"\n        );\n        this.states.connecting.failState = \"suspended\";\n        this.notifyState({ state: \"suspended\" });\n      }\n    }, this.connectionStateTtl);\n  }\n  checkSuspendTimer(state) {\n    if (state !== \"disconnected\" && state !== \"suspended\" && state !== \"connecting\")\n      this.cancelSuspendTimer();\n  }\n  cancelSuspendTimer() {\n    this.states.connecting.failState = \"disconnected\";\n    if (this.suspendTimer) {\n      clearTimeout(this.suspendTimer);\n      this.suspendTimer = null;\n    }\n  }\n  startRetryTimer(interval) {\n    this.retryTimer = setTimeout(() => {\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"ConnectionManager retry timer expired\", \"retrying\");\n      this.retryTimer = null;\n      this.requestState({ state: \"connecting\" });\n    }, interval);\n  }\n  cancelRetryTimer() {\n    if (this.retryTimer) {\n      clearTimeout(this.retryTimer);\n      this.retryTimer = null;\n    }\n  }\n  startWebSocketSlowTimer() {\n    this.webSocketSlowTimer = setTimeout(() => {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"ConnectionManager WebSocket slow timer\",\n        \"checking connectivity\"\n      );\n      this.checkWsConnectivity().then(() => {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"ConnectionManager WebSocket slow timer\",\n          \"ws connectivity check succeeded\"\n        );\n        this.wsCheckResult = true;\n      }).catch(() => {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MAJOR,\n          \"ConnectionManager WebSocket slow timer\",\n          \"ws connectivity check failed\"\n        );\n        this.wsCheckResult = false;\n      });\n      if (this.realtime.http.checkConnectivity) {\n        whenPromiseSettles(this.realtime.http.checkConnectivity(), (err, connectivity) => {\n          if (err || !connectivity) {\n            logger_default.logAction(\n              this.logger,\n              logger_default.LOG_MAJOR,\n              \"ConnectionManager WebSocket slow timer\",\n              \"http connectivity check failed\"\n            );\n            this.cancelWebSocketGiveUpTimer();\n            this.notifyState({\n              state: \"disconnected\",\n              error: new ErrorInfo(\"Unable to connect (network unreachable)\", 80003, 404)\n            });\n          } else {\n            logger_default.logAction(\n              this.logger,\n              logger_default.LOG_MINOR,\n              \"ConnectionManager WebSocket slow timer\",\n              \"http connectivity check succeeded\"\n            );\n          }\n        });\n      }\n    }, this.options.timeouts.webSocketSlowTimeout);\n  }\n  cancelWebSocketSlowTimer() {\n    if (this.webSocketSlowTimer) {\n      clearTimeout(this.webSocketSlowTimer);\n      this.webSocketSlowTimer = null;\n    }\n  }\n  startWebSocketGiveUpTimer(transportParams) {\n    this.webSocketGiveUpTimer = setTimeout(() => {\n      var _a2, _b;\n      if (!this.wsCheckResult) {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MINOR,\n          \"ConnectionManager WebSocket give up timer\",\n          \"websocket connection took more than 10s; \" + (this.baseTransport ? \"trying base transport\" : \"\")\n        );\n        if (this.baseTransport) {\n          this.abandonedWebSocket = true;\n          (_a2 = this.proposedTransport) == null ? void 0 : _a2.dispose();\n          (_b = this.pendingTransport) == null ? void 0 : _b.dispose();\n          this.connectBase(transportParams, ++this.connectCounter);\n        } else {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MAJOR,\n            \"ConnectionManager WebSocket give up timer\",\n            \"websocket connectivity appears to be unavailable but no other transports to try\"\n          );\n        }\n      }\n    }, this.options.timeouts.webSocketConnectTimeout);\n  }\n  cancelWebSocketGiveUpTimer() {\n    if (this.webSocketGiveUpTimer) {\n      clearTimeout(this.webSocketGiveUpTimer);\n      this.webSocketGiveUpTimer = null;\n    }\n  }\n  notifyState(indicated) {\n    var _a2, _b;\n    const state = indicated.state;\n    const retryImmediately = state === \"disconnected\" && (this.state === this.states.connected || indicated.retryImmediately || this.state === this.states.connecting && indicated.error && auth_default.isTokenErr(indicated.error) && !(this.errorReason && auth_default.isTokenErr(this.errorReason)));\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.notifyState()\",\n      \"new state: \" + state + (retryImmediately ? \"; will retry connection immediately\" : \"\")\n    );\n    if (state == this.state.state)\n      return;\n    this.cancelTransitionTimer();\n    this.cancelRetryTimer();\n    this.cancelWebSocketSlowTimer();\n    this.cancelWebSocketGiveUpTimer();\n    this.checkSuspendTimer(indicated.state);\n    if (state === \"suspended\" || state === \"connected\") {\n      this.disconnectedRetryCount = 0;\n    }\n    if (this.state.terminal)\n      return;\n    const newState = this.states[indicated.state];\n    let retryDelay = newState.retryDelay;\n    if (newState.state === \"disconnected\") {\n      this.disconnectedRetryCount++;\n      retryDelay = getRetryTime(newState.retryDelay, this.disconnectedRetryCount);\n    }\n    const change = new connectionstatechange_default(\n      this.state.state,\n      newState.state,\n      retryDelay,\n      indicated.error || ((_b = (_a2 = connectionerrors_default)[newState.state]) == null ? void 0 : _b.call(_a2))\n    );\n    if (retryImmediately) {\n      const autoReconnect = () => {\n        if (this.state === this.states.disconnected) {\n          this.lastAutoReconnectAttempt = Date.now();\n          this.requestState({ state: \"connecting\" });\n        }\n      };\n      const sinceLast = this.lastAutoReconnectAttempt && Date.now() - this.lastAutoReconnectAttempt + 1;\n      if (sinceLast && sinceLast < 1e3) {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MICRO,\n          \"ConnectionManager.notifyState()\",\n          \"Last reconnect attempt was only \" + sinceLast + \"ms ago, waiting another \" + (1e3 - sinceLast) + \"ms before trying again\"\n        );\n        setTimeout(autoReconnect, 1e3 - sinceLast);\n      } else {\n        Platform.Config.nextTick(autoReconnect);\n      }\n    } else if (state === \"disconnected\" || state === \"suspended\") {\n      this.startRetryTimer(retryDelay);\n    }\n    if (state === \"disconnected\" && !retryImmediately || state === \"suspended\" || newState.terminal) {\n      Platform.Config.nextTick(() => {\n        this.disconnectAllTransports();\n      });\n    }\n    if (state == \"connected\" && !this.activeProtocol) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"ConnectionManager.notifyState()\",\n        \"Broken invariant: attempted to go into connected state, but there is no active protocol\"\n      );\n    }\n    this.enactStateChange(change);\n    if (this.state.sendEvents) {\n      this.sendQueuedMessages();\n    } else if (!this.state.queueEvents) {\n      this.realtime.channels.propogateConnectionInterruption(state, change.reason);\n      this.failQueuedMessages(change.reason);\n    }\n  }\n  requestState(request) {\n    var _a2, _b;\n    const state = request.state;\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.requestState()\",\n      \"requested state: \" + state + \"; current state: \" + this.state.state\n    );\n    if (state == this.state.state)\n      return;\n    this.cancelWebSocketSlowTimer();\n    this.cancelWebSocketGiveUpTimer();\n    this.cancelTransitionTimer();\n    this.cancelRetryTimer();\n    this.checkSuspendTimer(state);\n    if (state == \"connecting\" && this.state.state == \"connected\")\n      return;\n    if (state == \"closing\" && this.state.state == \"closed\")\n      return;\n    const newState = this.states[state], change = new connectionstatechange_default(\n      this.state.state,\n      newState.state,\n      null,\n      request.error || ((_b = (_a2 = connectionerrors_default)[newState.state]) == null ? void 0 : _b.call(_a2))\n    );\n    this.enactStateChange(change);\n    if (state == \"connecting\") {\n      Platform.Config.nextTick(() => {\n        this.startConnect();\n      });\n    }\n    if (state == \"closing\") {\n      this.closeImpl();\n    }\n  }\n  startConnect() {\n    if (this.state !== this.states.connecting) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"ConnectionManager.startConnect()\",\n        \"Must be in connecting state to connect, but was \" + this.state.state\n      );\n      return;\n    }\n    const auth = this.realtime.auth;\n    const connectCount = ++this.connectCounter;\n    const connect = () => {\n      this.checkConnectionStateFreshness();\n      this.getTransportParams((transportParams) => {\n        if (transportParams.mode === \"recover\" && transportParams.options.recover) {\n          const recoveryContext = decodeRecoveryKey(transportParams.options.recover);\n          if (recoveryContext) {\n            this.realtime.channels.recoverChannels(recoveryContext.channelSerials);\n          }\n        }\n        if (connectCount !== this.connectCounter) {\n          return;\n        }\n        this.connectImpl(transportParams, connectCount);\n      });\n    };\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"ConnectionManager.startConnect()\", \"starting connection\");\n    this.startSuspendTimer();\n    this.startTransitionTimer(this.states.connecting);\n    if (auth.method === \"basic\") {\n      connect();\n    } else {\n      const authCb = (err) => {\n        if (connectCount !== this.connectCounter) {\n          return;\n        }\n        if (err) {\n          this.actOnErrorFromAuthorize(err);\n        } else {\n          connect();\n        }\n      };\n      if (this.errorReason && auth_default.isTokenErr(this.errorReason)) {\n        whenPromiseSettles(auth._forceNewToken(null, null), authCb);\n      } else {\n        whenPromiseSettles(auth._ensureValidAuthCredentials(false), authCb);\n      }\n    }\n  }\n  /*\n   * there are, at most, two transports available with which a connection may\n   * be attempted: web_socket and/or a base transport (xhr_polling in browsers,\n   * comet in nodejs). web_socket is always preferred, and the base transport is\n   * only used in case web_socket connectivity appears to be unavailable.\n   *\n   * connectImpl begins the transport selection process by checking which transports\n   * are available, and if there is a cached preference. It then defers to the\n   * transport-specific connect methods: connectWs and connectBase.\n   *\n   * It is also responsible for invalidating the cache in the case that a base\n   * transport preference is stored but web socket connectivity is now available.\n   *\n   * handling of the case where we need to failover from web_socket to the base\n   * transport is implemented in the connectWs method.\n   */\n  connectImpl(transportParams, connectCount) {\n    const state = this.state.state;\n    if (state !== this.states.connecting.state) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"ConnectionManager.connectImpl()\",\n        \"Must be in connecting state to connect, but was \" + state\n      );\n      return;\n    }\n    const transportPreference = this.getTransportPreference();\n    if (transportPreference && transportPreference === this.baseTransport && this.webSocketTransportAvailable) {\n      this.checkWsConnectivity().then(() => {\n        this.unpersistTransportPreference();\n        if (this.state === this.states.connecting) {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MINOR,\n            \"ConnectionManager.connectImpl():\",\n            \"web socket connectivity available, cancelling connection attempt with \" + this.baseTransport\n          );\n          this.disconnectAllTransports();\n          this.connectWs(transportParams, ++this.connectCounter);\n        }\n      }).catch(noop2);\n    }\n    if (transportPreference && transportPreference === this.baseTransport || this.baseTransport && !this.webSocketTransportAvailable) {\n      this.connectBase(transportParams, connectCount);\n    } else {\n      this.connectWs(transportParams, connectCount);\n    }\n  }\n  /*\n   * connectWs starts two timers to monitor the success of a web_socket connection attempt:\n   * - webSocketSlowTimer: if this timer fires before the connection succeeds,\n   *   cm will simultaneously check websocket and http/xhr connectivity. if the http\n   *   connectivity check fails, we give up the connection sequence entirely and\n   *   transition to disconnected. if the websocket connectivity check fails then\n   *   we assume no ws connectivity and failover to base transport. in the case that\n   *   the checks succeed, we continue with websocket and wait for it to try fallback hosts\n   *   and, if unsuccessful, ultimately transition to disconnected.\n   * - webSocketGiveUpTimer: if this timer fires, and the preceding websocket\n   *   connectivity check is still pending then we assume that there is an issue\n   *   with the transport and fallback to base transport.\n   */\n  connectWs(transportParams, connectCount) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"ConnectionManager.connectWs()\");\n    this.wsCheckResult = null;\n    this.abandonedWebSocket = false;\n    this.startWebSocketSlowTimer();\n    this.startWebSocketGiveUpTimer(transportParams);\n    this.tryTransportWithFallbacks(\"web_socket\", transportParams, true, connectCount, () => {\n      return this.wsCheckResult !== false && !this.abandonedWebSocket;\n    });\n  }\n  connectBase(transportParams, connectCount) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"ConnectionManager.connectBase()\");\n    if (this.baseTransport) {\n      this.tryTransportWithFallbacks(this.baseTransport, transportParams, false, connectCount, () => true);\n    } else {\n      this.notifyState({\n        state: \"disconnected\",\n        error: new ErrorInfo(\"No transports left to try\", 8e4, 404)\n      });\n    }\n  }\n  tryTransportWithFallbacks(transportName, transportParams, ws, connectCount, shouldContinue) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"ConnectionManager.tryTransportWithFallbacks()\",\n      transportName\n    );\n    const giveUp = (err) => {\n      this.notifyState({ state: this.states.connecting.failState, error: err });\n    };\n    const candidateHosts = this.domains.slice();\n    const hostAttemptCb = (fatal, transport) => {\n      if (connectCount !== this.connectCounter) {\n        return;\n      }\n      if (!shouldContinue()) {\n        if (transport) {\n          transport.dispose();\n        }\n        return;\n      }\n      if (!transport && !fatal) {\n        tryFallbackHosts();\n      }\n    };\n    const host = candidateHosts.shift();\n    if (!host) {\n      giveUp(new ErrorInfo(\"Unable to connect (no available host)\", 80003, 404));\n      return;\n    }\n    transportParams.host = host;\n    const tryFallbackHosts = () => {\n      if (!candidateHosts.length) {\n        giveUp(new ErrorInfo(\"Unable to connect (and no more fallback hosts to try)\", 80003, 404));\n        return;\n      }\n      if (!this.realtime.http.checkConnectivity) {\n        giveUp(new PartialErrorInfo(\"Internal error: Http.checkConnectivity not set\", null, 500));\n        return;\n      }\n      whenPromiseSettles(\n        this.realtime.http.checkConnectivity(),\n        (err, connectivity) => {\n          if (connectCount !== this.connectCounter) {\n            return;\n          }\n          if (!shouldContinue()) {\n            return;\n          }\n          if (err) {\n            giveUp(err);\n            return;\n          }\n          if (!connectivity) {\n            giveUp(new ErrorInfo(\"Unable to connect (network unreachable)\", 80003, 404));\n            return;\n          }\n          transportParams.host = arrPopRandomElement(candidateHosts);\n          this.tryATransport(transportParams, transportName, hostAttemptCb);\n        }\n      );\n    };\n    if (this.forceFallbackHost && candidateHosts.length) {\n      this.forceFallbackHost = false;\n      tryFallbackHosts();\n      return;\n    }\n    this.tryATransport(transportParams, transportName, hostAttemptCb);\n  }\n  closeImpl() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"ConnectionManager.closeImpl()\", \"closing connection\");\n    this.cancelSuspendTimer();\n    this.startTransitionTimer(this.states.closing);\n    if (this.pendingTransport) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.closeImpl()\",\n        \"Closing pending transport: \" + this.pendingTransport\n      );\n      this.pendingTransport.close();\n    }\n    if (this.activeProtocol) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.closeImpl()\",\n        \"Closing active transport: \" + this.activeProtocol.getTransport()\n      );\n      this.activeProtocol.getTransport().close();\n    }\n    this.notifyState({ state: \"closed\" });\n  }\n  onAuthUpdated(tokenDetails, callback) {\n    var _a2;\n    switch (this.state.state) {\n      case \"connected\": {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MICRO,\n          \"ConnectionManager.onAuthUpdated()\",\n          \"Sending AUTH message on active transport\"\n        );\n        const activeTransport = (_a2 = this.activeProtocol) == null ? void 0 : _a2.getTransport();\n        if (activeTransport && activeTransport.onAuthUpdated) {\n          activeTransport.onAuthUpdated(tokenDetails);\n        }\n        const authMsg = fromValues({\n          action: actions.AUTH,\n          auth: {\n            accessToken: tokenDetails.token\n          }\n        });\n        this.send(authMsg);\n        const successListener = () => {\n          this.off(failureListener);\n          callback(null, tokenDetails);\n        };\n        const failureListener = (stateChange) => {\n          if (stateChange.current === \"failed\") {\n            this.off(successListener);\n            this.off(failureListener);\n            callback(stateChange.reason || this.getStateError());\n          }\n        };\n        this.once(\"connectiondetails\", successListener);\n        this.on(\"connectionstate\", failureListener);\n        break;\n      }\n      case \"connecting\":\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MICRO,\n          \"ConnectionManager.onAuthUpdated()\",\n          \"Aborting current connection attempts in order to start again with the new auth details\"\n        );\n        this.disconnectAllTransports();\n      default: {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_MICRO,\n          \"ConnectionManager.onAuthUpdated()\",\n          \"Connection state is \" + this.state.state + \"; waiting until either connected or failed\"\n        );\n        const listener = (stateChange) => {\n          switch (stateChange.current) {\n            case \"connected\":\n              this.off(listener);\n              callback(null, tokenDetails);\n              break;\n            case \"failed\":\n            case \"closed\":\n            case \"suspended\":\n              this.off(listener);\n              callback(stateChange.reason || this.getStateError());\n              break;\n            default:\n              break;\n          }\n        };\n        this.on(\"connectionstate\", listener);\n        if (this.state.state === \"connecting\") {\n          this.startConnect();\n        } else {\n          this.requestState({ state: \"connecting\" });\n        }\n      }\n    }\n  }\n  disconnectAllTransports() {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"ConnectionManager.disconnectAllTransports()\",\n      \"Disconnecting all transports\"\n    );\n    this.connectCounter++;\n    if (this.pendingTransport) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.disconnectAllTransports()\",\n        \"Disconnecting pending transport: \" + this.pendingTransport\n      );\n      this.pendingTransport.disconnect();\n    }\n    delete this.pendingTransport;\n    if (this.proposedTransport) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.disconnectAllTransports()\",\n        \"Disconnecting proposed transport: \" + this.pendingTransport\n      );\n      this.proposedTransport.disconnect();\n    }\n    delete this.pendingTransport;\n    if (this.activeProtocol) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.disconnectAllTransports()\",\n        \"Disconnecting active transport: \" + this.activeProtocol.getTransport()\n      );\n      this.activeProtocol.getTransport().disconnect();\n    }\n  }\n  /******************\n   * event queueing\n   ******************/\n  send(msg, queueEvent, callback) {\n    callback = callback || noop2;\n    const state = this.state;\n    if (state.sendEvents) {\n      logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"ConnectionManager.send()\", \"sending event\");\n      this.sendImpl(new PendingMessage(msg, callback));\n      return;\n    }\n    const shouldQueue = queueEvent && state.queueEvents;\n    if (!shouldQueue) {\n      const err = \"rejecting event, queueEvent was \" + queueEvent + \", state was \" + state.state;\n      logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"ConnectionManager.send()\", err);\n      callback(this.errorReason || new ErrorInfo(err, 9e4, 400));\n      return;\n    }\n    if (this.logger.shouldLog(logger_default.LOG_MICRO)) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.send()\",\n        \"queueing msg; \" + stringify(\n          msg,\n          this.realtime._RealtimePresence,\n          this.realtime._Annotations,\n          this.realtime._objectsPlugin\n        )\n      );\n    }\n    this.queue(msg, callback);\n  }\n  sendImpl(pendingMessage) {\n    const msg = pendingMessage.message;\n    if (pendingMessage.ackRequired && !pendingMessage.sendAttempted) {\n      msg.msgSerial = this.msgSerial++;\n    }\n    try {\n      this.activeProtocol.send(pendingMessage);\n    } catch (e) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"ConnectionManager.sendImpl()\",\n        \"Unexpected exception in transport.send(): \" + e.stack\n      );\n    }\n  }\n  queue(msg, callback) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"ConnectionManager.queue()\", \"queueing event\");\n    const lastQueued = this.queuedMessages.last();\n    const maxSize = this.options.maxMessageSize;\n    if (lastQueued && !lastQueued.sendAttempted && bundleWith(lastQueued.message, msg, maxSize)) {\n      if (!lastQueued.merged) {\n        lastQueued.callback = multicaster_default.create(this.logger, [lastQueued.callback]);\n        lastQueued.merged = true;\n      }\n      lastQueued.callback.push(callback);\n    } else {\n      this.queuedMessages.push(new PendingMessage(msg, callback));\n    }\n  }\n  sendQueuedMessages() {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"ConnectionManager.sendQueuedMessages()\",\n      \"sending \" + this.queuedMessages.count() + \" queued messages\"\n    );\n    let pendingMessage;\n    while (pendingMessage = this.queuedMessages.shift())\n      this.sendImpl(pendingMessage);\n  }\n  queuePendingMessages(pendingMessages) {\n    if (pendingMessages && pendingMessages.length) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"ConnectionManager.queuePendingMessages()\",\n        \"queueing \" + pendingMessages.length + \" pending messages\"\n      );\n      this.queuedMessages.prepend(pendingMessages);\n    }\n  }\n  failQueuedMessages(err) {\n    const numQueued = this.queuedMessages.count();\n    if (numQueued > 0) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"ConnectionManager.failQueuedMessages()\",\n        \"failing \" + numQueued + \" queued messages, err = \" + inspectError(err)\n      );\n      this.queuedMessages.completeAllMessages(err);\n    }\n  }\n  onChannelMessage(message, transport) {\n    this.pendingChannelMessagesState.queue.push({ message, transport });\n    if (!this.pendingChannelMessagesState.isProcessing) {\n      this.processNextPendingChannelMessage();\n    }\n  }\n  processNextPendingChannelMessage() {\n    if (this.pendingChannelMessagesState.queue.length > 0) {\n      this.pendingChannelMessagesState.isProcessing = true;\n      const pendingChannelMessage = this.pendingChannelMessagesState.queue.shift();\n      this.processChannelMessage(pendingChannelMessage.message).catch((err) => {\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_ERROR,\n          \"ConnectionManager.processNextPendingChannelMessage() received error \",\n          err\n        );\n      }).finally(() => {\n        this.pendingChannelMessagesState.isProcessing = false;\n        this.processNextPendingChannelMessage();\n      });\n    }\n  }\n  async processChannelMessage(message) {\n    await this.realtime.channels.processChannelMessage(message);\n  }\n  async ping() {\n    var _a2;\n    if (this.state.state !== \"connected\") {\n      throw new ErrorInfo(\"Unable to ping service; not connected\", 4e4, 400);\n    }\n    const transport = (_a2 = this.activeProtocol) == null ? void 0 : _a2.getTransport();\n    if (!transport) {\n      throw this.getStateError();\n    }\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"ConnectionManager.ping()\", \"transport = \" + transport);\n    const pingStart = Date.now();\n    const id = cheapRandStr();\n    return withTimeoutAsync(\n      new Promise((resolve) => {\n        const onHeartbeat = (responseId) => {\n          if (responseId === id) {\n            transport.off(\"heartbeat\", onHeartbeat);\n            resolve(Date.now() - pingStart);\n          }\n        };\n        transport.on(\"heartbeat\", onHeartbeat);\n        transport.ping(id);\n      }),\n      this.options.timeouts.realtimeRequestTimeout,\n      \"Timeout waiting for heartbeat response\"\n    );\n  }\n  abort(error) {\n    this.activeProtocol.getTransport().fail(error);\n  }\n  getTransportPreference() {\n    var _a2, _b;\n    return this.transportPreference || haveWebStorage() && ((_b = (_a2 = Platform.WebStorage) == null ? void 0 : _a2.get) == null ? void 0 : _b.call(_a2, transportPreferenceName));\n  }\n  persistTransportPreference(transport) {\n    var _a2, _b;\n    this.transportPreference = transport.shortName;\n    if (haveWebStorage()) {\n      (_b = (_a2 = Platform.WebStorage) == null ? void 0 : _a2.set) == null ? void 0 : _b.call(_a2, transportPreferenceName, transport.shortName);\n    }\n  }\n  unpersistTransportPreference() {\n    var _a2, _b;\n    this.transportPreference = null;\n    if (haveWebStorage()) {\n      (_b = (_a2 = Platform.WebStorage) == null ? void 0 : _a2.remove) == null ? void 0 : _b.call(_a2, transportPreferenceName);\n    }\n  }\n  /* This method is only used during connection attempts, so implements RSA4c1, RSA4c2,\n   * and RSA4d. It is generally not invoked for serverside-triggered reauths or manual\n   * reauths, so RSA4c3 does not apply, except (per per RSA4d1) in the case that the auth\n   * server returns 403. */\n  actOnErrorFromAuthorize(err) {\n    if (err.code === 40171) {\n      this.notifyState({ state: \"failed\", error: err });\n    } else if (err.code === 40102) {\n      this.notifyState({ state: \"failed\", error: err });\n    } else if (err.statusCode === HttpStatusCodes_default.Forbidden) {\n      const msg = \"Client configured authentication provider returned 403; failing the connection\";\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"ConnectionManager.actOnErrorFromAuthorize()\", msg);\n      this.notifyState({ state: \"failed\", error: new ErrorInfo(msg, 80019, 403, err) });\n    } else {\n      const msg = \"Client configured authentication provider request failed\";\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"ConnectionManager.actOnErrorFromAuthorize\", msg);\n      this.notifyState({ state: this.state.failState, error: new ErrorInfo(msg, 80019, 401, err) });\n    }\n  }\n  onConnectionDetailsUpdate(connectionDetails, transport) {\n    if (!connectionDetails) {\n      return;\n    }\n    this.connectionDetails = connectionDetails;\n    if (connectionDetails.maxMessageSize) {\n      this.options.maxMessageSize = connectionDetails.maxMessageSize;\n    }\n    const clientId = connectionDetails.clientId;\n    if (clientId) {\n      const err = this.realtime.auth._uncheckedSetClientId(clientId);\n      if (err) {\n        logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"ConnectionManager.onConnectionDetailsUpdate()\", err.message);\n        transport.fail(err);\n        return;\n      }\n    }\n    const connectionStateTtl = connectionDetails.connectionStateTtl;\n    if (connectionStateTtl) {\n      this.connectionStateTtl = connectionStateTtl;\n    }\n    this.maxIdleInterval = connectionDetails.maxIdleInterval;\n    this.emit(\"connectiondetails\", connectionDetails);\n  }\n  checkWsConnectivity() {\n    const wsConnectivityCheckUrl = this.options.wsConnectivityCheckUrl || defaults_default.wsConnectivityCheckUrl;\n    const ws = new Platform.Config.WebSocket(wsConnectivityCheckUrl);\n    return new Promise((resolve, reject) => {\n      let finished = false;\n      ws.onopen = () => {\n        if (!finished) {\n          finished = true;\n          resolve();\n          ws.close();\n        }\n      };\n      ws.onclose = ws.onerror = () => {\n        if (!finished) {\n          finished = true;\n          reject();\n        }\n      };\n    });\n  }\n  sessionRecoveryName() {\n    return this.options.recoveryKeyStorageName || \"ably-connection-recovery\";\n  }\n  getSessionRecoverData() {\n    var _a2, _b;\n    return haveSessionStorage() && ((_b = (_a2 = Platform.WebStorage) == null ? void 0 : _a2.getSession) == null ? void 0 : _b.call(_a2, this.sessionRecoveryName()));\n  }\n  setSessionRecoverData(value) {\n    var _a2, _b;\n    return haveSessionStorage() && ((_b = (_a2 = Platform.WebStorage) == null ? void 0 : _a2.setSession) == null ? void 0 : _b.call(_a2, this.sessionRecoveryName(), value));\n  }\n  clearSessionRecoverData() {\n    var _a2, _b;\n    return haveSessionStorage() && ((_b = (_a2 = Platform.WebStorage) == null ? void 0 : _a2.removeSession) == null ? void 0 : _b.call(_a2, this.sessionRecoveryName()));\n  }\n};\nvar connectionmanager_default = ConnectionManager;\n\n// src/common/lib/client/connection.ts\nvar Connection = class extends eventemitter_default {\n  constructor(ably, options) {\n    super(ably.logger);\n    this.whenState = (state) => {\n      return eventemitter_default.prototype.whenState.call(this, state, this.state);\n    };\n    this.ably = ably;\n    this.connectionManager = new connectionmanager_default(ably, options);\n    this.state = this.connectionManager.state.state;\n    this.key = void 0;\n    this.id = void 0;\n    this.errorReason = null;\n    this.connectionManager.on(\"connectionstate\", (stateChange) => {\n      const state = this.state = stateChange.current;\n      Platform.Config.nextTick(() => {\n        this.emit(state, stateChange);\n      });\n    });\n    this.connectionManager.on(\"update\", (stateChange) => {\n      Platform.Config.nextTick(() => {\n        this.emit(\"update\", stateChange);\n      });\n    });\n  }\n  connect() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Connection.connect()\", \"\");\n    this.connectionManager.requestState({ state: \"connecting\" });\n  }\n  async ping() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Connection.ping()\", \"\");\n    return this.connectionManager.ping();\n  }\n  close() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Connection.close()\", \"connectionKey = \" + this.key);\n    this.connectionManager.requestState({ state: \"closing\" });\n  }\n  get recoveryKey() {\n    this.logger.deprecationWarning(\n      \"The `Connection.recoveryKey` attribute has been replaced by the `Connection.createRecoveryKey()` method. Replace your usage of `recoveryKey` with the return value of `createRecoveryKey()`. `recoveryKey` will be removed in a future version.\"\n    );\n    return this.createRecoveryKey();\n  }\n  createRecoveryKey() {\n    return this.connectionManager.createRecoveryKey();\n  }\n};\nvar connection_default = Connection;\n\n// src/common/lib/client/baserealtime.ts\nvar _BaseRealtime = class _BaseRealtime extends baseclient_default {\n  /*\n   * The public typings declare that this only accepts an object, but since we want to emit a good error message in the case where a non-TypeScript user does one of these things:\n   *\n   * 1. passes a string (which is quite likely if theyâ€™re e.g. migrating from the default variant to the modular variant)\n   * 2. passes no argument at all\n   *\n   * tell the compiler that these cases are possible so that it forces us to handle them.\n   */\n  constructor(options) {\n    var _a2, _b, _c, _d;\n    super(defaults_default.objectifyOptions(options, false, \"BaseRealtime\", logger_default.defaultLogger));\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Realtime()\", \"\");\n    if (typeof EdgeRuntime === \"string\") {\n      throw new ErrorInfo(\n        `Ably.Realtime instance cannot be used in Vercel Edge runtime. If you are running Vercel Edge functions, please replace your \"new Ably.Realtime()\" with \"new Ably.Rest()\" and use Ably Rest API instead of the Realtime API. If you are server-rendering your application in the Vercel Edge runtime, please use the condition \"if (typeof EdgeRuntime === 'string')\" to prevent instantiating Ably.Realtime instance during SSR in the Vercel Edge runtime.`,\n        4e4,\n        400\n      );\n    }\n    this._additionalTransportImplementations = _BaseRealtime.transportImplementationsFromPlugins(this.options.plugins);\n    this._RealtimePresence = (_b = (_a2 = this.options.plugins) == null ? void 0 : _a2.RealtimePresence) != null ? _b : null;\n    this._objectsPlugin = (_d = (_c = this.options.plugins) == null ? void 0 : _c.Objects) != null ? _d : null;\n    this.connection = new connection_default(this, this.options);\n    this._channels = new Channels2(this);\n    if (this.options.autoConnect !== false)\n      this.connect();\n  }\n  static transportImplementationsFromPlugins(plugins) {\n    const transports = {};\n    if (plugins == null ? void 0 : plugins.WebSocketTransport) {\n      transports[TransportNames.WebSocket] = plugins.WebSocketTransport;\n    }\n    if (plugins == null ? void 0 : plugins.XHRPolling) {\n      transports[TransportNames.XhrPolling] = plugins.XHRPolling;\n    }\n    return transports;\n  }\n  get channels() {\n    return this._channels;\n  }\n  get clientId() {\n    return this.auth.clientId;\n  }\n  connect() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Realtime.connect()\", \"\");\n    this.connection.connect();\n  }\n  close() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"Realtime.close()\", \"\");\n    this.connection.close();\n  }\n};\n// internal API to make EventEmitter usable in other SDKs\n_BaseRealtime.EventEmitter = eventemitter_default;\nvar BaseRealtime = _BaseRealtime;\nvar Channels2 = class extends eventemitter_default {\n  constructor(realtime) {\n    super(realtime.logger);\n    this.realtime = realtime;\n    this.all = /* @__PURE__ */ Object.create(null);\n    realtime.connection.connectionManager.on(\"transport.active\", () => {\n      this.onTransportActive();\n    });\n  }\n  channelSerials() {\n    let serials = {};\n    for (const name of keysArray(this.all, true)) {\n      const channel = this.all[name];\n      if (channel.properties.channelSerial) {\n        serials[name] = channel.properties.channelSerial;\n      }\n    }\n    return serials;\n  }\n  // recoverChannels gets the given channels and sets their channel serials.\n  recoverChannels(channelSerials) {\n    for (const name of keysArray(channelSerials, true)) {\n      const channel = this.get(name);\n      channel.properties.channelSerial = channelSerials[name];\n    }\n  }\n  // Access to this method is synchronised by ConnectionManager#processChannelMessage.\n  async processChannelMessage(msg) {\n    const channelName = msg.channel;\n    if (channelName === void 0) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"Channels.processChannelMessage()\",\n        \"received event unspecified channel, action = \" + msg.action\n      );\n      return;\n    }\n    const channel = this.all[channelName];\n    if (!channel) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"Channels.processChannelMessage()\",\n        \"received event for non-existent channel: \" + channelName\n      );\n      return;\n    }\n    await channel.processMessage(msg);\n  }\n  /* called when a transport becomes connected; reattempt attach/detach\n   * for channels that are attaching or detaching. */\n  onTransportActive() {\n    for (const channelName in this.all) {\n      const channel = this.all[channelName];\n      if (channel.state === \"attaching\" || channel.state === \"detaching\") {\n        channel.checkPendingState();\n      } else if (channel.state === \"suspended\") {\n        channel._attach(false, null);\n      } else if (channel.state === \"attached\") {\n        channel.requestState(\"attaching\");\n      }\n    }\n  }\n  /* Connection interruptions (ie when the connection will no longer queue\n   * events) imply connection state changes for any channel which is either\n   * attached, pending, or will attempt to become attached in the future */\n  propogateConnectionInterruption(connectionState, reason) {\n    const connectionStateToChannelState = {\n      closing: \"detached\",\n      closed: \"detached\",\n      failed: \"failed\",\n      suspended: \"suspended\"\n    };\n    const fromChannelStates = [\"attaching\", \"attached\", \"detaching\", \"suspended\"];\n    const toChannelState = connectionStateToChannelState[connectionState];\n    for (const channelId in this.all) {\n      const channel = this.all[channelId];\n      if (fromChannelStates.includes(channel.state)) {\n        channel.notifyState(toChannelState, reason);\n      }\n    }\n  }\n  get(name, channelOptions) {\n    name = String(name);\n    let channel = this.all[name];\n    if (!channel) {\n      channel = this.all[name] = new realtimechannel_default(this.realtime, name, channelOptions);\n    } else if (channelOptions) {\n      if (channel._shouldReattachToSetOptions(channelOptions, channel.channelOptions)) {\n        throw new ErrorInfo(\n          \"Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.\",\n          4e4,\n          400\n        );\n      }\n      channel.setOptions(channelOptions);\n    }\n    return channel;\n  }\n  getDerived(name, deriveOptions, channelOptions) {\n    if (deriveOptions.filter) {\n      const filter = toBase64(deriveOptions.filter);\n      const match = matchDerivedChannel(name);\n      name = `[filter=${filter}${match.qualifierParam}]${match.channelName}`;\n    }\n    return this.get(name, channelOptions);\n  }\n  /* Included to support certain niche use-cases; most users should ignore this.\n   * Please do not use this unless you know what you're doing */\n  release(name) {\n    name = String(name);\n    const channel = this.all[name];\n    if (!channel) {\n      return;\n    }\n    const releaseErr = channel.getReleaseErr();\n    if (releaseErr) {\n      throw releaseErr;\n    }\n    delete this.all[name];\n  }\n};\nvar baserealtime_default = BaseRealtime;\n\n// src/common/lib/client/presencemap.ts\nfunction newerThan(item, existing) {\n  if (item.isSynthesized() || existing.isSynthesized()) {\n    return item.timestamp >= existing.timestamp;\n  }\n  const itemOrderings = item.parseId(), existingOrderings = existing.parseId();\n  if (itemOrderings.msgSerial === existingOrderings.msgSerial) {\n    return itemOrderings.index > existingOrderings.index;\n  } else {\n    return itemOrderings.msgSerial > existingOrderings.msgSerial;\n  }\n}\nvar PresenceMap = class extends eventemitter_default {\n  constructor(presence, memberKey, newer = newerThan) {\n    super(presence.logger);\n    this.presence = presence;\n    this.map = /* @__PURE__ */ Object.create(null);\n    this.syncInProgress = false;\n    this.residualMembers = null;\n    this.memberKey = memberKey;\n    this.newerThan = newer;\n  }\n  get(key) {\n    return this.map[key];\n  }\n  getClient(clientId) {\n    const map = this.map, result = [];\n    for (const key in map) {\n      const item = map[key];\n      if (item.clientId == clientId && item.action != \"absent\")\n        result.push(item);\n    }\n    return result;\n  }\n  list(params) {\n    const map = this.map, clientId = params && params.clientId, connectionId = params && params.connectionId, result = [];\n    for (const key in map) {\n      const item = map[key];\n      if (item.action === \"absent\")\n        continue;\n      if (clientId && clientId != item.clientId)\n        continue;\n      if (connectionId && connectionId != item.connectionId)\n        continue;\n      result.push(item);\n    }\n    return result;\n  }\n  put(item) {\n    if (item.action === \"enter\" || item.action === \"update\") {\n      item = presencemessage_default.fromValues(item);\n      item.action = \"present\";\n    }\n    const map = this.map, key = this.memberKey(item);\n    if (this.residualMembers)\n      delete this.residualMembers[key];\n    const existingItem = map[key];\n    if (existingItem && !this.newerThan(item, existingItem)) {\n      return false;\n    }\n    map[key] = item;\n    return true;\n  }\n  values() {\n    const map = this.map, result = [];\n    for (const key in map) {\n      const item = map[key];\n      if (item.action != \"absent\")\n        result.push(item);\n    }\n    return result;\n  }\n  remove(item) {\n    const map = this.map, key = this.memberKey(item);\n    const existingItem = map[key];\n    if (existingItem && !this.newerThan(item, existingItem)) {\n      return false;\n    }\n    if (this.syncInProgress) {\n      item = presencemessage_default.fromValues(item);\n      item.action = \"absent\";\n      map[key] = item;\n    } else {\n      delete map[key];\n    }\n    return !!existingItem;\n  }\n  startSync() {\n    const map = this.map, syncInProgress = this.syncInProgress;\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"PresenceMap.startSync()\",\n      \"channel = \" + this.presence.channel.name + \"; syncInProgress = \" + syncInProgress\n    );\n    if (!this.syncInProgress) {\n      this.residualMembers = copy(map);\n      this.setInProgress(true);\n    }\n  }\n  endSync() {\n    const map = this.map, syncInProgress = this.syncInProgress;\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"PresenceMap.endSync()\",\n      \"channel = \" + this.presence.channel.name + \"; syncInProgress = \" + syncInProgress\n    );\n    if (syncInProgress) {\n      for (const memberKey in map) {\n        const entry = map[memberKey];\n        if (entry.action === \"absent\") {\n          delete map[memberKey];\n        }\n      }\n      this.presence._synthesizeLeaves(valuesArray(this.residualMembers));\n      for (const memberKey in this.residualMembers) {\n        delete map[memberKey];\n      }\n      this.residualMembers = null;\n      this.setInProgress(false);\n    }\n    this.emit(\"sync\");\n  }\n  waitSync(callback) {\n    const syncInProgress = this.syncInProgress;\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"PresenceMap.waitSync()\",\n      \"channel = \" + this.presence.channel.name + \"; syncInProgress = \" + syncInProgress\n    );\n    if (!syncInProgress) {\n      callback();\n      return;\n    }\n    this.once(\"sync\", callback);\n  }\n  clear() {\n    this.map = {};\n    this.setInProgress(false);\n    this.residualMembers = null;\n  }\n  setInProgress(inProgress) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"PresenceMap.setInProgress()\", \"inProgress = \" + inProgress);\n    this.syncInProgress = inProgress;\n    this.presence.syncComplete = !inProgress;\n  }\n};\n\n// src/common/lib/client/realtimepresence.ts\nfunction getClientId(realtimePresence) {\n  return realtimePresence.channel.client.auth.clientId;\n}\nfunction isAnonymousOrWildcard(realtimePresence) {\n  const realtime = realtimePresence.channel.client;\n  const clientId = realtime.auth.clientId;\n  return (!clientId || clientId === \"*\") && realtime.connection.state === \"connected\";\n}\nfunction waitAttached(channel, callback, action) {\n  switch (channel.state) {\n    case \"attached\":\n    case \"suspended\":\n      action();\n      break;\n    case \"initialized\":\n    case \"detached\":\n    case \"detaching\":\n    case \"attaching\":\n      whenPromiseSettles(channel.attach(), function(err) {\n        if (err)\n          callback(err);\n        else\n          action();\n      });\n      break;\n    default:\n      callback(ErrorInfo.fromValues(channel.invalidStateError()));\n  }\n}\nvar RealtimePresence = class extends eventemitter_default {\n  constructor(channel) {\n    super(channel.logger);\n    this.channel = channel;\n    this.syncComplete = false;\n    this.members = new PresenceMap(this, (item) => item.clientId + \":\" + item.connectionId);\n    this._myMembers = new PresenceMap(this, (item) => item.clientId);\n    this.subscriptions = new eventemitter_default(this.logger);\n    this.pendingPresence = [];\n  }\n  async enter(data) {\n    if (isAnonymousOrWildcard(this)) {\n      throw new ErrorInfo(\"clientId must be specified to enter a presence channel\", 40012, 400);\n    }\n    return this._enterOrUpdateClient(void 0, void 0, data, \"enter\");\n  }\n  async update(data) {\n    if (isAnonymousOrWildcard(this)) {\n      throw new ErrorInfo(\"clientId must be specified to update presence data\", 40012, 400);\n    }\n    return this._enterOrUpdateClient(void 0, void 0, data, \"update\");\n  }\n  async enterClient(clientId, data) {\n    return this._enterOrUpdateClient(void 0, clientId, data, \"enter\");\n  }\n  async updateClient(clientId, data) {\n    return this._enterOrUpdateClient(void 0, clientId, data, \"update\");\n  }\n  async _enterOrUpdateClient(id, clientId, data, action) {\n    const channel = this.channel;\n    if (!channel.connectionManager.activeState()) {\n      throw channel.connectionManager.getError();\n    }\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"RealtimePresence.\" + action + \"Client()\",\n      \"channel = \" + channel.name + \", id = \" + id + \", client = \" + (clientId || \"(implicit) \" + getClientId(this))\n    );\n    const presence = presencemessage_default.fromData(data);\n    presence.action = action;\n    if (id) {\n      presence.id = id;\n    }\n    if (clientId) {\n      presence.clientId = clientId;\n    }\n    const wirePresMsg = await presence.encode(channel.channelOptions);\n    switch (channel.state) {\n      case \"attached\":\n        return channel.sendPresence([wirePresMsg]);\n      case \"initialized\":\n      case \"detached\":\n        channel.attach();\n      case \"attaching\":\n        return new Promise((resolve, reject) => {\n          this.pendingPresence.push({\n            presence: wirePresMsg,\n            callback: (err) => err ? reject(err) : resolve()\n          });\n        });\n      default: {\n        const err = new PartialErrorInfo(\n          \"Unable to \" + action + \" presence channel while in \" + channel.state + \" state\",\n          90001\n        );\n        err.code = 90001;\n        throw err;\n      }\n    }\n  }\n  async leave(data) {\n    if (isAnonymousOrWildcard(this)) {\n      throw new ErrorInfo(\"clientId must have been specified to enter or leave a presence channel\", 40012, 400);\n    }\n    return this.leaveClient(void 0, data);\n  }\n  async leaveClient(clientId, data) {\n    const channel = this.channel;\n    if (!channel.connectionManager.activeState()) {\n      throw channel.connectionManager.getError();\n    }\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"RealtimePresence.leaveClient()\",\n      \"leaving; channel = \" + this.channel.name + \", client = \" + clientId\n    );\n    const presence = presencemessage_default.fromData(data);\n    presence.action = \"leave\";\n    if (clientId) {\n      presence.clientId = clientId;\n    }\n    const wirePresMsg = await presence.encode(channel.channelOptions);\n    switch (channel.state) {\n      case \"attached\":\n        return channel.sendPresence([wirePresMsg]);\n      case \"attaching\":\n        return new Promise((resolve, reject) => {\n          this.pendingPresence.push({\n            presence: wirePresMsg,\n            callback: (err) => err ? reject(err) : resolve()\n          });\n        });\n      case \"initialized\":\n      case \"failed\": {\n        throw new PartialErrorInfo(\"Unable to leave presence channel (incompatible state)\", 90001);\n      }\n      default:\n        throw channel.invalidStateError();\n    }\n  }\n  async get(params) {\n    const waitForSync = !params || (\"waitForSync\" in params ? params.waitForSync : true);\n    return new Promise((resolve, reject) => {\n      function returnMembers(members) {\n        resolve(params ? members.list(params) : members.values());\n      }\n      if (this.channel.state === \"suspended\") {\n        if (waitForSync) {\n          reject(\n            ErrorInfo.fromValues({\n              statusCode: 400,\n              code: 91005,\n              message: \"Presence state is out of sync due to channel being in the SUSPENDED state\"\n            })\n          );\n        } else {\n          returnMembers(this.members);\n        }\n        return;\n      }\n      waitAttached(\n        this.channel,\n        (err) => reject(err),\n        () => {\n          const members = this.members;\n          if (waitForSync) {\n            members.waitSync(function() {\n              returnMembers(members);\n            });\n          } else {\n            returnMembers(members);\n          }\n        }\n      );\n    });\n  }\n  async history(params) {\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"RealtimePresence.history()\", \"channel = \" + this.name);\n    const restMixin = this.channel.client.rest.presenceMixin;\n    if (params && params.untilAttach) {\n      if (this.channel.state === \"attached\") {\n        delete params.untilAttach;\n        params.from_serial = this.channel.properties.attachSerial;\n      } else {\n        throw new ErrorInfo(\n          \"option untilAttach requires the channel to be attached, was: \" + this.channel.state,\n          4e4,\n          400\n        );\n      }\n    }\n    return restMixin.history(this, params);\n  }\n  setPresence(presenceSet, isSync, syncChannelSerial) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"RealtimePresence.setPresence()\",\n      \"received presence for \" + presenceSet.length + \" participants; syncChannelSerial = \" + syncChannelSerial\n    );\n    let syncCursor, match;\n    const members = this.members, myMembers = this._myMembers, broadcastMessages = [], connId = this.channel.connectionManager.connectionId;\n    if (isSync) {\n      this.members.startSync();\n      if (syncChannelSerial && (match = syncChannelSerial.match(/^[\\w-]+:(.*)$/))) {\n        syncCursor = match[1];\n      }\n    }\n    for (let presence of presenceSet) {\n      switch (presence.action) {\n        case \"leave\":\n          if (members.remove(presence)) {\n            broadcastMessages.push(presence);\n          }\n          if (presence.connectionId === connId && !presence.isSynthesized()) {\n            myMembers.remove(presence);\n          }\n          break;\n        case \"enter\":\n        case \"present\":\n        case \"update\":\n          if (members.put(presence)) {\n            broadcastMessages.push(presence);\n          }\n          if (presence.connectionId === connId) {\n            myMembers.put(presence);\n          }\n          break;\n      }\n    }\n    if (isSync && !syncCursor) {\n      members.endSync();\n      this.channel.syncChannelSerial = null;\n    }\n    for (let i = 0; i < broadcastMessages.length; i++) {\n      const presence = broadcastMessages[i];\n      this.subscriptions.emit(presence.action, presence);\n    }\n  }\n  onAttached(hasPresence) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"RealtimePresence.onAttached()\",\n      \"channel = \" + this.channel.name + \", hasPresence = \" + hasPresence\n    );\n    if (hasPresence) {\n      this.members.startSync();\n    } else {\n      this._synthesizeLeaves(this.members.values());\n      this.members.clear();\n    }\n    this._ensureMyMembersPresent();\n    const pendingPresence = this.pendingPresence, pendingPresCount = pendingPresence.length;\n    if (pendingPresCount) {\n      this.pendingPresence = [];\n      const presenceArray = [];\n      const multicaster = multicaster_default.create(this.logger);\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"RealtimePresence.onAttached\",\n        \"sending \" + pendingPresCount + \" queued presence messages\"\n      );\n      for (let i = 0; i < pendingPresCount; i++) {\n        const event = pendingPresence[i];\n        presenceArray.push(event.presence);\n        multicaster.push(event.callback);\n      }\n      this.channel.sendPresence(presenceArray).then(() => multicaster()).catch((err) => multicaster(err));\n    }\n  }\n  actOnChannelState(state, hasPresence, err) {\n    switch (state) {\n      case \"attached\":\n        this.onAttached(hasPresence);\n        break;\n      case \"detached\":\n      case \"failed\":\n        this._clearMyMembers();\n        this.members.clear();\n      case \"suspended\":\n        this.failPendingPresence(err);\n        break;\n    }\n  }\n  failPendingPresence(err) {\n    if (this.pendingPresence.length) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"RealtimeChannel.failPendingPresence\",\n        \"channel; name = \" + this.channel.name + \", err = \" + inspectError(err)\n      );\n      for (let i = 0; i < this.pendingPresence.length; i++)\n        try {\n          this.pendingPresence[i].callback(err);\n        } catch (e) {\n        }\n      this.pendingPresence = [];\n    }\n  }\n  _clearMyMembers() {\n    this._myMembers.clear();\n  }\n  _ensureMyMembersPresent() {\n    const myMembers = this._myMembers;\n    const connId = this.channel.connectionManager.connectionId;\n    for (const memberKey in myMembers.map) {\n      const entry = myMembers.map[memberKey];\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MICRO,\n        \"RealtimePresence._ensureMyMembersPresent()\",\n        'Auto-reentering clientId \"' + entry.clientId + '\" into the presence set'\n      );\n      const id = entry.connectionId === connId ? entry.id : void 0;\n      this._enterOrUpdateClient(id, entry.clientId, entry.data, \"enter\").catch((err) => {\n        const wrappedErr = new ErrorInfo(\"Presence auto re-enter failed\", 91004, 400, err);\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_ERROR,\n          \"RealtimePresence._ensureMyMembersPresent()\",\n          \"Presence auto re-enter failed; reason = \" + inspectError(err)\n        );\n        const change = new channelstatechange_default(this.channel.state, this.channel.state, true, false, wrappedErr);\n        this.channel.emit(\"update\", change);\n      });\n    }\n  }\n  _synthesizeLeaves(items) {\n    const subscriptions = this.subscriptions;\n    items.forEach(function(item) {\n      const presence = presencemessage_default.fromValues({\n        action: \"leave\",\n        connectionId: item.connectionId,\n        clientId: item.clientId,\n        data: item.data,\n        encoding: item.encoding,\n        timestamp: Date.now()\n      });\n      subscriptions.emit(\"leave\", presence);\n    });\n  }\n  async subscribe(..._args) {\n    const args = realtimechannel_default.processListenerArgs(_args);\n    const event = args[0];\n    const listener = args[1];\n    const channel = this.channel;\n    if (channel.state === \"failed\") {\n      throw ErrorInfo.fromValues(channel.invalidStateError());\n    }\n    this.subscriptions.on(event, listener);\n    if (channel.channelOptions.attachOnSubscribe !== false) {\n      await channel.attach();\n    }\n  }\n  unsubscribe(..._args) {\n    const args = realtimechannel_default.processListenerArgs(_args);\n    const event = args[0];\n    const listener = args[1];\n    this.subscriptions.off(event, listener);\n  }\n};\nvar realtimepresence_default = RealtimePresence;\n\n// src/common/lib/transport/websockettransport.ts\nvar shortName = TransportNames.WebSocket;\nfunction isNodeWebSocket(ws) {\n  return !!ws.on;\n}\nvar WebSocketTransport = class extends transport_default {\n  constructor(connectionManager, auth, params) {\n    super(connectionManager, auth, params);\n    this.shortName = shortName;\n    params.heartbeats = Platform.Config.useProtocolHeartbeats;\n    this.wsHost = params.host;\n  }\n  static isAvailable() {\n    return !!Platform.Config.WebSocket;\n  }\n  createWebSocket(uri, connectParams) {\n    this.uri = uri + toQueryString(connectParams);\n    return new Platform.Config.WebSocket(this.uri);\n  }\n  toString() {\n    return \"WebSocketTransport; uri=\" + this.uri;\n  }\n  connect() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"WebSocketTransport.connect()\", \"starting\");\n    transport_default.prototype.connect.call(this);\n    const self2 = this, params = this.params, options = params.options;\n    const wsScheme = options.tls ? \"wss://\" : \"ws://\";\n    const wsUri = wsScheme + this.wsHost + \":\" + defaults_default.getPort(options) + \"/\";\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"WebSocketTransport.connect()\", \"uri: \" + wsUri);\n    whenPromiseSettles(\n      this.auth.getAuthParams(),\n      function(err, authParams) {\n        if (self2.isDisposed) {\n          return;\n        }\n        let paramStr = \"\";\n        for (const param in authParams)\n          paramStr += \" \" + param + \": \" + authParams[param] + \";\";\n        logger_default.logAction(\n          self2.logger,\n          logger_default.LOG_MINOR,\n          \"WebSocketTransport.connect()\",\n          \"authParams:\" + paramStr + \" err: \" + err\n        );\n        if (err) {\n          self2.disconnect(err);\n          return;\n        }\n        const connectParams = params.getConnectParams(authParams);\n        try {\n          const wsConnection = self2.wsConnection = self2.createWebSocket(wsUri, connectParams);\n          wsConnection.binaryType = Platform.Config.binaryType;\n          wsConnection.onopen = function() {\n            self2.onWsOpen();\n          };\n          wsConnection.onclose = function(ev) {\n            self2.onWsClose(ev);\n          };\n          wsConnection.onmessage = function(ev) {\n            self2.onWsData(ev.data);\n          };\n          wsConnection.onerror = function(ev) {\n            self2.onWsError(ev);\n          };\n          if (isNodeWebSocket(wsConnection)) {\n            wsConnection.on(\"ping\", function() {\n              self2.onActivity();\n            });\n          }\n        } catch (e) {\n          logger_default.logAction(\n            self2.logger,\n            logger_default.LOG_ERROR,\n            \"WebSocketTransport.connect()\",\n            \"Unexpected exception creating websocket: err = \" + (e.stack || e.message)\n          );\n          self2.disconnect(e);\n        }\n      }\n    );\n  }\n  send(message) {\n    const wsConnection = this.wsConnection;\n    if (!wsConnection) {\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"WebSocketTransport.send()\", \"No socket connection\");\n      return;\n    }\n    try {\n      wsConnection.send(\n        serialize2(message, this.connectionManager.realtime._MsgPack, this.params.format)\n      );\n    } catch (e) {\n      const msg = \"Exception from ws connection when trying to send: \" + inspectError(e);\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"WebSocketTransport.send()\", msg);\n      this.finish(\"disconnected\", new ErrorInfo(msg, 5e4, 500));\n    }\n  }\n  onWsData(data) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MICRO,\n      \"WebSocketTransport.onWsData()\",\n      \"data received; length = \" + data.length + \"; type = \" + typeof data\n    );\n    try {\n      this.onProtocolMessage(\n        deserialize(\n          data,\n          this.connectionManager.realtime._MsgPack,\n          this.connectionManager.realtime._RealtimePresence,\n          this.connectionManager.realtime._Annotations,\n          this.connectionManager.realtime._objectsPlugin,\n          this.format\n        )\n      );\n    } catch (e) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"WebSocketTransport.onWsData()\",\n        \"Unexpected exception handing channel message: \" + e.stack\n      );\n    }\n  }\n  onWsOpen() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"WebSocketTransport.onWsOpen()\", \"opened WebSocket\");\n    this.emit(\"preconnect\");\n  }\n  onWsClose(ev) {\n    let wasClean, code;\n    if (typeof ev == \"object\") {\n      code = ev.code;\n      wasClean = ev.wasClean || code === 1e3;\n    } else {\n      code = ev;\n      wasClean = code == 1e3;\n    }\n    delete this.wsConnection;\n    if (wasClean) {\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"WebSocketTransport.onWsClose()\", \"Cleanly closed WebSocket\");\n      const err = new ErrorInfo(\"Websocket closed\", 80003, 400);\n      this.finish(\"disconnected\", err);\n    } else {\n      const msg = \"Unclean disconnection of WebSocket ; code = \" + code, err = new ErrorInfo(msg, 80003, 400);\n      logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"WebSocketTransport.onWsClose()\", msg);\n      this.finish(\"disconnected\", err);\n    }\n    this.emit(\"disposed\");\n  }\n  onWsError(err) {\n    logger_default.logAction(\n      this.logger,\n      logger_default.LOG_MINOR,\n      \"WebSocketTransport.onError()\",\n      \"Error from WebSocket: \" + err.message\n    );\n    Platform.Config.nextTick(() => {\n      this.disconnect(Error(err.message));\n    });\n  }\n  dispose() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"WebSocketTransport.dispose()\", \"\");\n    this.isDisposed = true;\n    const wsConnection = this.wsConnection;\n    if (wsConnection) {\n      wsConnection.onmessage = function() {\n      };\n      delete this.wsConnection;\n      Platform.Config.nextTick(() => {\n        logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"WebSocketTransport.dispose()\", \"closing websocket\");\n        if (!wsConnection) {\n          throw new Error(\"WebSocketTransport.dispose(): wsConnection is not defined\");\n        }\n        wsConnection.close();\n      });\n    }\n  }\n};\nvar websockettransport_default = WebSocketTransport;\n\n// src/common/lib/client/filteredsubscriptions.ts\nvar FilteredSubscriptions = class {\n  static subscribeFilter(channel, filter, listener) {\n    const filteredListener = (m) => {\n      var _a2, _b, _c, _d, _e, _f;\n      const mapping = {\n        name: m.name,\n        refTimeserial: (_b = (_a2 = m.extras) == null ? void 0 : _a2.ref) == null ? void 0 : _b.timeserial,\n        refType: (_d = (_c = m.extras) == null ? void 0 : _c.ref) == null ? void 0 : _d.type,\n        isRef: !!((_f = (_e = m.extras) == null ? void 0 : _e.ref) == null ? void 0 : _f.timeserial),\n        clientId: m.clientId\n      };\n      if (Object.entries(filter).find(\n        ([key, value]) => value !== void 0 ? mapping[key] !== value : false\n      )) {\n        return;\n      }\n      listener(m);\n    };\n    this.addFilteredSubscription(channel, filter, listener, filteredListener);\n    channel.subscriptions.on(filteredListener);\n  }\n  // Adds a new filtered subscription\n  static addFilteredSubscription(channel, filter, realListener, filteredListener) {\n    var _a2;\n    if (!channel.filteredSubscriptions) {\n      channel.filteredSubscriptions = /* @__PURE__ */ new Map();\n    }\n    if (channel.filteredSubscriptions.has(realListener)) {\n      const realListenerMap = channel.filteredSubscriptions.get(realListener);\n      realListenerMap.set(filter, ((_a2 = realListenerMap == null ? void 0 : realListenerMap.get(filter)) == null ? void 0 : _a2.concat(filteredListener)) || [filteredListener]);\n    } else {\n      channel.filteredSubscriptions.set(\n        realListener,\n        /* @__PURE__ */ new Map([[filter, [filteredListener]]])\n      );\n    }\n  }\n  static getAndDeleteFilteredSubscriptions(channel, filter, realListener) {\n    if (!channel.filteredSubscriptions) {\n      return [];\n    }\n    if (!realListener && filter) {\n      return Array.from(channel.filteredSubscriptions.entries()).map(([key, filterMaps]) => {\n        var _a2;\n        let listenerMaps = filterMaps.get(filter);\n        filterMaps.delete(filter);\n        if (filterMaps.size === 0) {\n          (_a2 = channel.filteredSubscriptions) == null ? void 0 : _a2.delete(key);\n        }\n        return listenerMaps;\n      }).reduce(\n        (prev, cur) => cur ? prev.concat(...cur) : prev,\n        []\n      );\n    }\n    if (!realListener || !channel.filteredSubscriptions.has(realListener)) {\n      return [];\n    }\n    const realListenerMap = channel.filteredSubscriptions.get(realListener);\n    if (!filter) {\n      const listeners2 = Array.from(realListenerMap.values()).reduce((prev, cur) => prev.concat(...cur), []);\n      channel.filteredSubscriptions.delete(realListener);\n      return listeners2;\n    }\n    let listeners = realListenerMap.get(filter);\n    realListenerMap.delete(filter);\n    return listeners || [];\n  }\n};\n\n// src/common/lib/client/defaultrealtime.ts\nvar _DefaultRealtime = class _DefaultRealtime extends baserealtime_default {\n  // The public typings declare that this requires an argument to be passed, but since we want to emit a good error message in the case where a non-TypeScript user does not pass an argument, tell the compiler that this is possible so that it forces us to handle it.\n  constructor(options) {\n    var _a2;\n    const MsgPack = _DefaultRealtime._MsgPack;\n    if (!MsgPack) {\n      throw new Error(\"Expected DefaultRealtime._MsgPack to have been set\");\n    }\n    super(\n      defaults_default.objectifyOptions(options, true, \"Realtime\", logger_default.defaultLogger, __spreadProps(__spreadValues({}, allCommonModularPlugins), {\n        Crypto: (_a2 = _DefaultRealtime.Crypto) != null ? _a2 : void 0,\n        MsgPack,\n        RealtimePresence: {\n          RealtimePresence: realtimepresence_default,\n          PresenceMessage: presencemessage_default,\n          WirePresenceMessage\n        },\n        Annotations: {\n          Annotation: annotation_default,\n          WireAnnotation,\n          RealtimeAnnotations: realtimeannotations_default,\n          RestAnnotations: restannotations_default\n        },\n        WebSocketTransport: websockettransport_default,\n        MessageInteractions: FilteredSubscriptions\n      }))\n    );\n  }\n  static get Crypto() {\n    if (this._Crypto === null) {\n      throw new Error(\"Encryption not enabled; use ably.encryption.js instead\");\n    }\n    return this._Crypto;\n  }\n  static set Crypto(newValue) {\n    this._Crypto = newValue;\n  }\n};\n_DefaultRealtime.Utils = utils_exports;\n_DefaultRealtime.ConnectionManager = connectionmanager_default;\n_DefaultRealtime.ProtocolMessage = protocolmessage_default;\n_DefaultRealtime._Crypto = null;\n_DefaultRealtime.Message = DefaultMessage;\n_DefaultRealtime.PresenceMessage = DefaultPresenceMessage;\n_DefaultRealtime.Annotation = DefaultAnnotation;\n_DefaultRealtime._MsgPack = null;\n// Used by tests\n_DefaultRealtime._Http = Http;\n_DefaultRealtime._PresenceMap = PresenceMap;\n_DefaultRealtime._MessageEncoding = MessageEncoding;\nvar DefaultRealtime = _DefaultRealtime;\n\n// src/platform/web/lib/util/hmac-sha256.ts\nvar uint8Array = Uint8Array;\nvar uint32Array = Uint32Array;\nvar pow = Math.pow;\nvar DEFAULT_STATE = new uint32Array(8);\nvar ROUND_CONSTANTS = [];\nvar M = new uint32Array(64);\nfunction getFractionalBits(n2) {\n  return (n2 - (n2 | 0)) * pow(2, 32) | 0;\n}\nvar n = 2;\nvar nPrime = 0;\nwhile (nPrime < 64) {\n  isPrime = true;\n  for (factor = 2; factor <= n / 2; factor++) {\n    if (n % factor === 0) {\n      isPrime = false;\n    }\n  }\n  if (isPrime) {\n    if (nPrime < 8) {\n      DEFAULT_STATE[nPrime] = getFractionalBits(pow(n, 1 / 2));\n    }\n    ROUND_CONSTANTS[nPrime] = getFractionalBits(pow(n, 1 / 3));\n    nPrime++;\n  }\n  n++;\n}\nvar isPrime;\nvar factor;\nvar LittleEndian = !!new uint8Array(new uint32Array([1]).buffer)[0];\nfunction convertEndian(word) {\n  if (LittleEndian) {\n    return (\n      // byte 1 -> byte 4\n      word >>> 24 | // byte 2 -> byte 3\n      (word >>> 16 & 255) << 8 | // byte 3 -> byte 2\n      (word & 65280) << 8 | // byte 4 -> byte 1\n      word << 24\n    );\n  } else {\n    return word;\n  }\n}\nfunction rightRotate(word, bits) {\n  return word >>> bits | word << 32 - bits;\n}\nfunction sha256(data) {\n  var STATE = DEFAULT_STATE.slice();\n  var legth = data.length;\n  var bitLength = legth * 8;\n  var newBitLength = 512 - (bitLength + 64) % 512 - 1 + bitLength + 65;\n  var bytes = new uint8Array(newBitLength / 8);\n  var words = new uint32Array(bytes.buffer);\n  bytes.set(data, 0);\n  bytes[legth] = 128;\n  words[words.length - 1] = convertEndian(bitLength);\n  var round;\n  for (var block = 0; block < newBitLength / 32; block += 16) {\n    var workingState = STATE.slice();\n    for (round = 0; round < 64; round++) {\n      var MRound;\n      if (round < 16) {\n        MRound = convertEndian(words[block + round]);\n      } else {\n        var gamma0x = M[round - 15];\n        var gamma1x = M[round - 2];\n        MRound = M[round - 7] + M[round - 16] + (rightRotate(gamma0x, 7) ^ rightRotate(gamma0x, 18) ^ gamma0x >>> 3) + (rightRotate(gamma1x, 17) ^ rightRotate(gamma1x, 19) ^ gamma1x >>> 10);\n      }\n      M[round] = MRound |= 0;\n      var t1 = (rightRotate(workingState[4], 6) ^ rightRotate(workingState[4], 11) ^ rightRotate(workingState[4], 25)) + (workingState[4] & workingState[5] ^ ~workingState[4] & workingState[6]) + workingState[7] + MRound + ROUND_CONSTANTS[round];\n      var t2 = (rightRotate(workingState[0], 2) ^ rightRotate(workingState[0], 13) ^ rightRotate(workingState[0], 22)) + (workingState[0] & workingState[1] ^ workingState[2] & (workingState[0] ^ workingState[1]));\n      for (var i = 7; i > 0; i--) {\n        workingState[i] = workingState[i - 1];\n      }\n      workingState[0] = t1 + t2 | 0;\n      workingState[4] = workingState[4] + t1 | 0;\n    }\n    for (round = 0; round < 8; round++) {\n      STATE[round] = STATE[round] + workingState[round] | 0;\n    }\n  }\n  return new uint8Array(\n    new uint32Array(\n      STATE.map(function(val) {\n        return convertEndian(val);\n      })\n    ).buffer\n  );\n}\nfunction hmac2(key, data) {\n  if (key.length > 64)\n    key = sha256(key);\n  if (key.length < 64) {\n    const tmp = new Uint8Array(64);\n    tmp.set(key, 0);\n    key = tmp;\n  }\n  var innerKey = new Uint8Array(64);\n  var outerKey = new Uint8Array(64);\n  for (var i = 0; i < 64; i++) {\n    innerKey[i] = 54 ^ key[i];\n    outerKey[i] = 92 ^ key[i];\n  }\n  var msg = new Uint8Array(data.length + 64);\n  msg.set(innerKey, 0);\n  msg.set(data, 64);\n  var result = new Uint8Array(64 + 32);\n  result.set(outerKey, 0);\n  result.set(sha256(msg), 64);\n  return sha256(result);\n}\n\n// src/platform/web/lib/util/bufferutils.ts\nvar BufferUtils = class {\n  constructor() {\n    this.base64CharSet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n    this.hexCharSet = \"0123456789abcdef\";\n  }\n  // https://gist.githubusercontent.com/jonleighton/958841/raw/f200e30dfe95212c0165ccf1ae000ca51e9de803/gistfile1.js\n  uint8ViewToBase64(bytes) {\n    let base64 = \"\";\n    const encodings = this.base64CharSet;\n    const byteLength = bytes.byteLength;\n    const byteRemainder = byteLength % 3;\n    const mainLength = byteLength - byteRemainder;\n    let a, b, c, d;\n    let chunk;\n    for (let i = 0; i < mainLength; i = i + 3) {\n      chunk = bytes[i] << 16 | bytes[i + 1] << 8 | bytes[i + 2];\n      a = (chunk & 16515072) >> 18;\n      b = (chunk & 258048) >> 12;\n      c = (chunk & 4032) >> 6;\n      d = chunk & 63;\n      base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d];\n    }\n    if (byteRemainder == 1) {\n      chunk = bytes[mainLength];\n      a = (chunk & 252) >> 2;\n      b = (chunk & 3) << 4;\n      base64 += encodings[a] + encodings[b] + \"==\";\n    } else if (byteRemainder == 2) {\n      chunk = bytes[mainLength] << 8 | bytes[mainLength + 1];\n      a = (chunk & 64512) >> 10;\n      b = (chunk & 1008) >> 4;\n      c = (chunk & 15) << 2;\n      base64 += encodings[a] + encodings[b] + encodings[c] + \"=\";\n    }\n    return base64;\n  }\n  base64ToArrayBuffer(base64) {\n    const binary_string = atob == null ? void 0 : atob(base64);\n    const len = binary_string.length;\n    const bytes = new Uint8Array(len);\n    for (let i = 0; i < len; i++) {\n      const ascii = binary_string.charCodeAt(i);\n      bytes[i] = ascii;\n    }\n    return this.toArrayBuffer(bytes);\n  }\n  isBuffer(buffer) {\n    return buffer instanceof ArrayBuffer || ArrayBuffer.isView(buffer);\n  }\n  toBuffer(buffer) {\n    if (!ArrayBuffer) {\n      throw new Error(\"Can't convert to Buffer: browser does not support the necessary types\");\n    }\n    if (buffer instanceof ArrayBuffer) {\n      return new Uint8Array(buffer);\n    }\n    if (ArrayBuffer.isView(buffer)) {\n      return new Uint8Array(this.toArrayBuffer(buffer));\n    }\n    throw new Error(\"BufferUtils.toBuffer expected an ArrayBuffer or a view onto one\");\n  }\n  toArrayBuffer(buffer) {\n    if (!ArrayBuffer) {\n      throw new Error(\"Can't convert to ArrayBuffer: browser does not support the necessary types\");\n    }\n    if (buffer instanceof ArrayBuffer) {\n      return buffer;\n    }\n    if (ArrayBuffer.isView(buffer)) {\n      return buffer.buffer.slice(buffer.byteOffset, buffer.byteOffset + buffer.byteLength);\n    }\n    throw new Error(\"BufferUtils.toArrayBuffer expected an ArrayBuffer or a view onto one\");\n  }\n  base64Encode(buffer) {\n    return this.uint8ViewToBase64(this.toBuffer(buffer));\n  }\n  base64UrlEncode(buffer) {\n    return this.base64Encode(buffer).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n  }\n  base64Decode(str) {\n    if (ArrayBuffer && Platform.Config.atob) {\n      return this.base64ToArrayBuffer(str);\n    } else {\n      throw new Error(\"Expected ArrayBuffer to exist and Platform.Config.atob to be configured\");\n    }\n  }\n  hexEncode(buffer) {\n    const uint8Array2 = this.toBuffer(buffer);\n    return uint8Array2.reduce((accum, byte) => accum + byte.toString(16).padStart(2, \"0\"), \"\");\n  }\n  hexDecode(hexEncodedBytes) {\n    if (hexEncodedBytes.length % 2 !== 0) {\n      throw new Error(\"Can't create a byte array from a hex string of odd length\");\n    }\n    const uint8Array2 = new Uint8Array(hexEncodedBytes.length / 2);\n    for (let i = 0; i < uint8Array2.length; i++) {\n      uint8Array2[i] = parseInt(hexEncodedBytes.slice(2 * i, 2 * (i + 1)), 16);\n    }\n    return this.toArrayBuffer(uint8Array2);\n  }\n  utf8Encode(string) {\n    if (Platform.Config.TextEncoder) {\n      const encodedByteArray = new Platform.Config.TextEncoder().encode(string);\n      return this.toArrayBuffer(encodedByteArray);\n    } else {\n      throw new Error(\"Expected TextEncoder to be configured\");\n    }\n  }\n  /* For utf8 decoding we apply slightly stricter input validation than to\n   * hexEncode/base64Encode/etc: in those we accept anything that Buffer.from\n   * can take (in particular allowing strings, which are just interpreted as\n   * binary); here we ensure that the input is actually a buffer since trying\n   * to utf8-decode a string to another string is almost certainly a mistake */\n  utf8Decode(buffer) {\n    if (!this.isBuffer(buffer)) {\n      throw new Error(\"Expected input of utf8decode to be an arraybuffer or typed array\");\n    }\n    if (TextDecoder) {\n      return new TextDecoder().decode(buffer);\n    } else {\n      throw new Error(\"Expected TextDecoder to be configured\");\n    }\n  }\n  areBuffersEqual(buffer1, buffer2) {\n    if (!buffer1 || !buffer2)\n      return false;\n    const arrayBuffer1 = this.toArrayBuffer(buffer1);\n    const arrayBuffer2 = this.toArrayBuffer(buffer2);\n    if (arrayBuffer1.byteLength != arrayBuffer2.byteLength)\n      return false;\n    const bytes1 = new Uint8Array(arrayBuffer1);\n    const bytes2 = new Uint8Array(arrayBuffer2);\n    for (var i = 0; i < bytes1.length; i++) {\n      if (bytes1[i] != bytes2[i])\n        return false;\n    }\n    return true;\n  }\n  byteLength(buffer) {\n    if (buffer instanceof ArrayBuffer || ArrayBuffer.isView(buffer)) {\n      return buffer.byteLength;\n    }\n    return -1;\n  }\n  arrayBufferViewToBuffer(arrayBufferView) {\n    return this.toArrayBuffer(arrayBufferView);\n  }\n  concat(buffers) {\n    const sumLength = buffers.reduce((acc, v) => acc + v.byteLength, 0);\n    const result = new Uint8Array(sumLength);\n    let offset = 0;\n    for (const buffer of buffers) {\n      const uint8Array2 = this.toBuffer(buffer);\n      result.set(uint8Array2, offset);\n      offset += uint8Array2.byteLength;\n    }\n    return result.buffer;\n  }\n  sha256(message) {\n    const hash = sha256(this.toBuffer(message));\n    return this.toArrayBuffer(hash);\n  }\n  hmacSha256(message, key) {\n    const hash = hmac2(this.toBuffer(key), this.toBuffer(message));\n    return this.toArrayBuffer(hash);\n  }\n};\nvar bufferutils_default = new BufferUtils();\n\n// src/platform/web/lib/util/crypto.ts\nvar createCryptoClass = function(config, bufferUtils) {\n  var DEFAULT_ALGORITHM = \"aes\";\n  var DEFAULT_KEYLENGTH = 256;\n  var DEFAULT_MODE = \"cbc\";\n  var DEFAULT_BLOCKLENGTH = 16;\n  function validateCipherParams(params) {\n    if (params.algorithm === \"aes\" && params.mode === \"cbc\") {\n      if (params.keyLength === 128 || params.keyLength === 256) {\n        return;\n      }\n      throw new Error(\n        \"Unsupported key length \" + params.keyLength + \" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)\"\n      );\n    }\n  }\n  function normaliseBase64(string) {\n    return string.replace(\"_\", \"/\").replace(\"-\", \"+\");\n  }\n  function isCipherParams(params) {\n    return params instanceof CipherParams;\n  }\n  class CipherParams {\n    constructor(algorithm, keyLength, mode, key) {\n      this.algorithm = algorithm;\n      this.keyLength = keyLength;\n      this.mode = mode;\n      this.key = key;\n    }\n  }\n  class Crypto2 {\n    /**\n     * Obtain a complete CipherParams instance from the provided params, filling\n     * in any not provided with default values, calculating a keyLength from\n     * the supplied key, and validating the result.\n     * @param params an object containing at a minimum a `key` key with value the\n     * key, as either a binary or a base64-encoded string.\n     * May optionally also contain: algorithm (defaults to AES),\n     * mode (defaults to 'cbc')\n     */\n    static getDefaultParams(params) {\n      var key;\n      if (!params.key) {\n        throw new Error(\"Crypto.getDefaultParams: a key is required\");\n      }\n      if (typeof params.key === \"string\") {\n        key = bufferUtils.toArrayBuffer(bufferUtils.base64Decode(normaliseBase64(params.key)));\n      } else if (params.key instanceof ArrayBuffer) {\n        key = params.key;\n      } else {\n        key = bufferUtils.toArrayBuffer(params.key);\n      }\n      var algorithm = params.algorithm || DEFAULT_ALGORITHM;\n      var keyLength = key.byteLength * 8;\n      var mode = params.mode || DEFAULT_MODE;\n      var cipherParams = new CipherParams(algorithm, keyLength, mode, key);\n      if (params.keyLength && params.keyLength !== cipherParams.keyLength) {\n        throw new Error(\n          \"Crypto.getDefaultParams: a keyLength of \" + params.keyLength + \" was specified, but the key actually has length \" + cipherParams.keyLength\n        );\n      }\n      validateCipherParams(cipherParams);\n      return cipherParams;\n    }\n    /**\n     * Generate a random encryption key from the supplied keylength (or the\n     * default keyLength if none supplied) as an ArrayBuffer\n     * @param keyLength (optional) the required keyLength in bits\n     */\n    static async generateRandomKey(keyLength) {\n      try {\n        return config.getRandomArrayBuffer((keyLength || DEFAULT_KEYLENGTH) / 8);\n      } catch (err) {\n        throw new ErrorInfo(\"Failed to generate random key: \" + err.message, 400, 5e4, err);\n      }\n    }\n    /**\n     * Internal; get a ChannelCipher instance based on the given cipherParams\n     * @param params either a CipherParams instance or some subset of its\n     * fields that includes a key\n     */\n    static getCipher(params, logger) {\n      var _a2;\n      var cipherParams = isCipherParams(params) ? params : this.getDefaultParams(params);\n      return {\n        cipherParams,\n        cipher: new CBCCipher(cipherParams, (_a2 = params.iv) != null ? _a2 : null, logger)\n      };\n    }\n  }\n  Crypto2.CipherParams = CipherParams;\n  Crypto2;\n  class CBCCipher {\n    constructor(params, iv, logger) {\n      this.logger = logger;\n      if (!crypto.subtle) {\n        if (isSecureContext) {\n          throw new Error(\n            \"Crypto operations are not possible since the browser\\u2019s SubtleCrypto class is unavailable (reason unknown).\"\n          );\n        } else {\n          throw new Error(\n            \"Crypto operations are is not possible since the current environment is a non-secure context and hence the browser\\u2019s SubtleCrypto class is not available.\"\n          );\n        }\n      }\n      this.algorithm = params.algorithm + \"-\" + String(params.keyLength) + \"-\" + params.mode;\n      this.webCryptoAlgorithm = params.algorithm + \"-\" + params.mode;\n      this.key = bufferUtils.toArrayBuffer(params.key);\n      this.iv = iv ? bufferUtils.toArrayBuffer(iv) : null;\n    }\n    concat(buffer1, buffer2) {\n      const output = new ArrayBuffer(buffer1.byteLength + buffer2.byteLength);\n      const outputView = new DataView(output);\n      const buffer1View = new DataView(bufferUtils.toArrayBuffer(buffer1));\n      for (let i = 0; i < buffer1View.byteLength; i++) {\n        outputView.setInt8(i, buffer1View.getInt8(i));\n      }\n      const buffer2View = new DataView(bufferUtils.toArrayBuffer(buffer2));\n      for (let i = 0; i < buffer2View.byteLength; i++) {\n        outputView.setInt8(buffer1View.byteLength + i, buffer2View.getInt8(i));\n      }\n      return output;\n    }\n    async encrypt(plaintext) {\n      logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"CBCCipher.encrypt()\", \"\");\n      const iv = await this.getIv();\n      const cryptoKey = await crypto.subtle.importKey(\"raw\", this.key, this.webCryptoAlgorithm, false, [\"encrypt\"]);\n      const ciphertext = await crypto.subtle.encrypt({ name: this.webCryptoAlgorithm, iv }, cryptoKey, plaintext);\n      return this.concat(iv, ciphertext);\n    }\n    async decrypt(ciphertext) {\n      logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"CBCCipher.decrypt()\", \"\");\n      const ciphertextArrayBuffer = bufferUtils.toArrayBuffer(ciphertext);\n      const iv = ciphertextArrayBuffer.slice(0, DEFAULT_BLOCKLENGTH);\n      const ciphertextBody = ciphertextArrayBuffer.slice(DEFAULT_BLOCKLENGTH);\n      const cryptoKey = await crypto.subtle.importKey(\"raw\", this.key, this.webCryptoAlgorithm, false, [\"decrypt\"]);\n      return crypto.subtle.decrypt({ name: this.webCryptoAlgorithm, iv }, cryptoKey, ciphertextBody);\n    }\n    async getIv() {\n      if (this.iv) {\n        var iv = this.iv;\n        this.iv = null;\n        return iv;\n      }\n      const randomBlock = await config.getRandomArrayBuffer(DEFAULT_BLOCKLENGTH);\n      return bufferUtils.toArrayBuffer(randomBlock);\n    }\n  }\n  return Crypto2;\n};\n\n// src/common/constants/XHRStates.ts\nvar XHRStates = /* @__PURE__ */ ((XHRStates2) => {\n  XHRStates2[XHRStates2[\"REQ_SEND\"] = 0] = \"REQ_SEND\";\n  XHRStates2[XHRStates2[\"REQ_RECV\"] = 1] = \"REQ_RECV\";\n  XHRStates2[XHRStates2[\"REQ_RECV_POLL\"] = 2] = \"REQ_RECV_POLL\";\n  XHRStates2[XHRStates2[\"REQ_RECV_STREAM\"] = 3] = \"REQ_RECV_STREAM\";\n  return XHRStates2;\n})(XHRStates || {});\nvar XHRStates_default = XHRStates;\n\n// src/platform/web/lib/http/http.ts\nfunction createMissingImplementationError() {\n  return new ErrorInfo(\n    \"No HTTP request plugin provided. Provide at least one of the FetchRequest or XHRRequest plugins.\",\n    400,\n    4e4\n  );\n}\nvar _a;\nvar Http2 = (_a = class {\n  constructor(client) {\n    this.checksInProgress = null;\n    this.checkConnectivity = void 0;\n    this.supportsAuthHeaders = false;\n    this.supportsLinkHeaders = false;\n    var _a2;\n    this.client = client != null ? client : null;\n    const connectivityCheckUrl = (client == null ? void 0 : client.options.connectivityCheckUrl) || defaults_default.connectivityCheckUrl;\n    const connectivityCheckParams = (_a2 = client == null ? void 0 : client.options.connectivityCheckParams) != null ? _a2 : null;\n    const connectivityUrlIsDefault = !(client == null ? void 0 : client.options.connectivityCheckUrl);\n    const requestImplementations = __spreadValues(__spreadValues({}, Http2.bundledRequestImplementations), client == null ? void 0 : client._additionalHTTPRequestImplementations);\n    const xhrRequestImplementation = requestImplementations.XHRRequest;\n    const fetchRequestImplementation = requestImplementations.FetchRequest;\n    const hasImplementation = !!(xhrRequestImplementation || fetchRequestImplementation);\n    if (!hasImplementation) {\n      throw createMissingImplementationError();\n    }\n    if (Platform.Config.xhrSupported && xhrRequestImplementation) {\n      this.supportsAuthHeaders = true;\n      this.Request = async function(method, uri, headers, params, body) {\n        return new Promise((resolve) => {\n          var _a3;\n          const req = xhrRequestImplementation.createRequest(\n            uri,\n            headers,\n            params,\n            body,\n            XHRStates_default.REQ_SEND,\n            (_a3 = client && client.options.timeouts) != null ? _a3 : null,\n            this.logger,\n            method\n          );\n          req.once(\n            \"complete\",\n            (error, body2, headers2, unpacked, statusCode) => resolve({ error, body: body2, headers: headers2, unpacked, statusCode })\n          );\n          req.exec();\n        });\n      };\n      if (client == null ? void 0 : client.options.disableConnectivityCheck) {\n        this.checkConnectivity = async function() {\n          return true;\n        };\n      } else {\n        this.checkConnectivity = async function() {\n          var _a3;\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MICRO,\n            \"(XHRRequest)Http.checkConnectivity()\",\n            \"Sending; \" + connectivityCheckUrl\n          );\n          const requestResult = await this.doUri(\n            HttpMethods_default.Get,\n            connectivityCheckUrl,\n            null,\n            null,\n            connectivityCheckParams\n          );\n          let result = false;\n          if (!connectivityUrlIsDefault) {\n            result = !requestResult.error && isSuccessCode(requestResult.statusCode);\n          } else {\n            result = !requestResult.error && ((_a3 = requestResult.body) == null ? void 0 : _a3.replace(/\\n/, \"\")) == \"yes\";\n          }\n          logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"(XHRRequest)Http.checkConnectivity()\", \"Result: \" + result);\n          return result;\n        };\n      }\n    } else if (Platform.Config.fetchSupported && fetchRequestImplementation) {\n      this.supportsAuthHeaders = true;\n      this.Request = async (method, uri, headers, params, body) => {\n        return fetchRequestImplementation(method, client != null ? client : null, uri, headers, params, body);\n      };\n      if (client == null ? void 0 : client.options.disableConnectivityCheck) {\n        this.checkConnectivity = async function() {\n          return true;\n        };\n      } else {\n        this.checkConnectivity = async function() {\n          var _a3;\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_MICRO,\n            \"(Fetch)Http.checkConnectivity()\",\n            \"Sending; \" + connectivityCheckUrl\n          );\n          const requestResult = await this.doUri(HttpMethods_default.Get, connectivityCheckUrl, null, null, null);\n          const result = !requestResult.error && ((_a3 = requestResult.body) == null ? void 0 : _a3.replace(/\\n/, \"\")) == \"yes\";\n          logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"(Fetch)Http.checkConnectivity()\", \"Result: \" + result);\n          return result;\n        };\n      }\n    } else {\n      this.Request = async () => {\n        const error = hasImplementation ? new PartialErrorInfo(\"no supported HTTP transports available\", null, 400) : createMissingImplementationError();\n        return { error };\n      };\n    }\n  }\n  get logger() {\n    var _a2, _b;\n    return (_b = (_a2 = this.client) == null ? void 0 : _a2.logger) != null ? _b : logger_default.defaultLogger;\n  }\n  async doUri(method, uri, headers, body, params) {\n    if (!this.Request) {\n      return { error: new PartialErrorInfo(\"Request invoked before assigned to\", null, 500) };\n    }\n    return this.Request(method, uri, headers, params, body);\n  }\n  shouldFallback(errorInfo) {\n    const statusCode = errorInfo.statusCode;\n    return statusCode === 408 && !errorInfo.code || statusCode === 400 && !errorInfo.code || statusCode >= 500 && statusCode <= 504;\n  }\n}, _a.methods = [HttpMethods_default.Get, HttpMethods_default.Delete, HttpMethods_default.Post, HttpMethods_default.Put, HttpMethods_default.Patch], _a.methodsWithoutBody = [HttpMethods_default.Get, HttpMethods_default.Delete], _a.methodsWithBody = [HttpMethods_default.Post, HttpMethods_default.Put, HttpMethods_default.Patch], _a);\nvar http_default = Http2;\n\n// src/platform/web/lib/util/webstorage.ts\nvar test = \"ablyjs-storage-test\";\nvar globalObject3 = typeof global !== \"undefined\" ? global : typeof window !== \"undefined\" ? window : self;\nvar Webstorage = class {\n  constructor() {\n    try {\n      globalObject3.sessionStorage.setItem(test, test);\n      globalObject3.sessionStorage.removeItem(test);\n      this.sessionSupported = true;\n    } catch (e) {\n      this.sessionSupported = false;\n    }\n    try {\n      globalObject3.localStorage.setItem(test, test);\n      globalObject3.localStorage.removeItem(test);\n      this.localSupported = true;\n    } catch (e) {\n      this.localSupported = false;\n    }\n  }\n  get(name) {\n    return this._get(name, false);\n  }\n  getSession(name) {\n    return this._get(name, true);\n  }\n  remove(name) {\n    return this._remove(name, false);\n  }\n  removeSession(name) {\n    return this._remove(name, true);\n  }\n  set(name, value, ttl) {\n    return this._set(name, value, ttl, false);\n  }\n  setSession(name, value, ttl) {\n    return this._set(name, value, ttl, true);\n  }\n  _set(name, value, ttl, session) {\n    const wrappedValue = { value };\n    if (ttl) {\n      wrappedValue.expires = Date.now() + ttl;\n    }\n    return this.storageInterface(session).setItem(name, JSON.stringify(wrappedValue));\n  }\n  _get(name, session) {\n    if (session && !this.sessionSupported)\n      throw new Error(\"Session Storage not supported\");\n    if (!session && !this.localSupported)\n      throw new Error(\"Local Storage not supported\");\n    const rawItem = this.storageInterface(session).getItem(name);\n    if (!rawItem)\n      return null;\n    const wrappedValue = JSON.parse(rawItem);\n    if (wrappedValue.expires && wrappedValue.expires < Date.now()) {\n      this.storageInterface(session).removeItem(name);\n      return null;\n    }\n    return wrappedValue.value;\n  }\n  _remove(name, session) {\n    return this.storageInterface(session).removeItem(name);\n  }\n  storageInterface(session) {\n    return session ? globalObject3.sessionStorage : globalObject3.localStorage;\n  }\n};\nvar webstorage_default = new Webstorage();\n\n// src/platform/web/config.ts\nvar globalObject4 = getGlobalObject();\nvar isVercelEdgeRuntime = typeof EdgeRuntime === \"string\";\nif (typeof Window === \"undefined\" && typeof WorkerGlobalScope === \"undefined\" && !isVercelEdgeRuntime) {\n  console.log(\n    \"Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm\"\n  );\n}\nfunction allowComet() {\n  const loc = globalObject4.location;\n  return !globalObject4.WebSocket || !loc || !loc.origin || loc.origin.indexOf(\"http\") > -1;\n}\nfunction isWebWorkerContext() {\n  if (typeof WorkerGlobalScope !== \"undefined\" && self instanceof WorkerGlobalScope) {\n    return true;\n  } else {\n    return false;\n  }\n}\nvar userAgent = globalObject4.navigator && globalObject4.navigator.userAgent.toString();\nvar currentUrl = globalObject4.location && globalObject4.location.href;\nvar Config = {\n  agent: \"browser\",\n  logTimestamps: true,\n  userAgent,\n  currentUrl,\n  binaryType: \"arraybuffer\",\n  WebSocket: globalObject4.WebSocket,\n  fetchSupported: !!globalObject4.fetch,\n  xhrSupported: globalObject4.XMLHttpRequest && \"withCredentials\" in new XMLHttpRequest(),\n  allowComet: allowComet(),\n  useProtocolHeartbeats: true,\n  supportsBinary: !!globalObject4.TextDecoder,\n  /* Per Paddy (https://ably-real-time.slack.com/archives/CURL4U2FP/p1705674537763479) web intentionally prefers JSON to MessagePack:\n   *\n   * > browsers' support for binary types in general was historically poor, and JSON transport performance is significantly better in a browser than msgpack. In modern browsers then binary is supported consistently, but I'd still expect that JSON encode/decode performance is dramatically better than msgpack in a browser.\n   */\n  preferBinary: false,\n  ArrayBuffer: globalObject4.ArrayBuffer,\n  atob: globalObject4.atob,\n  nextTick: typeof globalObject4.queueMicrotask === \"function\" ? (f) => globalObject4.queueMicrotask(f) : (f) => Promise.resolve().then(f),\n  addEventListener: globalObject4.addEventListener,\n  inspect: JSON.stringify,\n  stringByteSize: function(str) {\n    return globalObject4.TextDecoder && new globalObject4.TextEncoder().encode(str).length || str.length;\n  },\n  TextEncoder: globalObject4.TextEncoder,\n  TextDecoder: globalObject4.TextDecoder,\n  getRandomArrayBuffer: async function(byteLength) {\n    const byteArray = new Uint8Array(byteLength);\n    globalObject4.crypto.getRandomValues(byteArray);\n    return byteArray.buffer;\n  },\n  isWebworker: isWebWorkerContext(),\n  push: {\n    platform: \"browser\" /* Browser */,\n    formFactor: \"desktop\" /* Desktop */,\n    storage: webstorage_default\n  }\n};\nvar config_default = Config;\n\n// src/common/lib/transport/comettransport.ts\nfunction shouldBeErrorAction(err) {\n  const UNRESOLVABLE_ERROR_CODES = [80015, 80017, 80030];\n  if (err.code) {\n    if (auth_default.isTokenErr(err))\n      return false;\n    if (UNRESOLVABLE_ERROR_CODES.includes(err.code))\n      return true;\n    return err.code >= 4e4 && err.code < 5e4;\n  } else {\n    return false;\n  }\n}\nfunction protocolMessageFromRawError(err) {\n  if (shouldBeErrorAction(err)) {\n    return [fromValues({ action: actions.ERROR, error: err })];\n  } else {\n    return [fromValues({ action: actions.DISCONNECTED, error: err })];\n  }\n}\nvar CometTransport = class extends transport_default {\n  constructor(connectionManager, auth, params) {\n    super(\n      connectionManager,\n      auth,\n      params,\n      /* binary not supported for comet so force JSON protocol */\n      true\n    );\n    /* Historical comment, back from when we supported JSONP:\n     *\n     * > For comet, we could do the auth update by aborting the current recv and\n     * > starting a new one with the new token, that'd be sufficient for realtime.\n     * > Problem is JSONP - you can't cancel truly abort a recv once started. So\n     * > we need to send an AUTH for jsonp. In which case it's simpler to keep all\n     * > comet transports the same and do it for all of them. So we send the AUTH\n     * > instead, and don't need to abort the recv\n     *\n     * Now that weâ€™ve dropped JSONP support, we may be able to revisit the above;\n     * see https://github.com/ably/ably-js/issues/1214.\n     */\n    this.onAuthUpdated = (tokenDetails) => {\n      this.authParams = { access_token: tokenDetails.token };\n    };\n    this.stream = \"stream\" in params ? params.stream : true;\n    this.sendRequest = null;\n    this.recvRequest = null;\n    this.pendingCallback = null;\n    this.pendingItems = null;\n  }\n  connect() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"CometTransport.connect()\", \"starting\");\n    transport_default.prototype.connect.call(this);\n    const params = this.params;\n    const options = params.options;\n    const host = params.host || options.primaryDomain;\n    const port = defaults_default.getPort(options);\n    const cometScheme = options.tls ? \"https://\" : \"http://\";\n    this.baseUri = cometScheme + host + \":\" + port + \"/comet/\";\n    const connectUri = this.baseUri + \"connect\";\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"CometTransport.connect()\", \"uri: \" + connectUri);\n    whenPromiseSettles(this.auth.getAuthParams(), (err, authParams) => {\n      if (err) {\n        this.disconnect(err);\n        return;\n      }\n      if (this.isDisposed) {\n        return;\n      }\n      this.authParams = authParams;\n      const connectParams = this.params.getConnectParams(authParams);\n      if (\"stream\" in connectParams)\n        this.stream = connectParams.stream;\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_MINOR,\n        \"CometTransport.connect()\",\n        \"connectParams:\" + toQueryString(connectParams)\n      );\n      let preconnected = false;\n      const connectRequest = this.recvRequest = this.createRequest(\n        connectUri,\n        null,\n        connectParams,\n        null,\n        this.stream ? XHRStates_default.REQ_RECV_STREAM : XHRStates_default.REQ_RECV\n      );\n      connectRequest.on(\"data\", (data) => {\n        if (!this.recvRequest) {\n          return;\n        }\n        if (!preconnected) {\n          preconnected = true;\n          this.emit(\"preconnect\");\n        }\n        this.onData(data);\n      });\n      connectRequest.on(\"complete\", (err2) => {\n        if (!this.recvRequest) {\n          err2 = err2 || new ErrorInfo(\"Request cancelled\", 80003, 400);\n        }\n        this.recvRequest = null;\n        if (!preconnected && !err2) {\n          preconnected = true;\n          this.emit(\"preconnect\");\n        }\n        this.onActivity();\n        if (err2) {\n          if (err2.code) {\n            this.onData(protocolMessageFromRawError(err2));\n          } else {\n            this.disconnect(err2);\n          }\n          return;\n        }\n        Platform.Config.nextTick(() => {\n          this.recv();\n        });\n      });\n      connectRequest.exec();\n    });\n  }\n  requestClose() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"CometTransport.requestClose()\");\n    this._requestCloseOrDisconnect(true);\n  }\n  requestDisconnect() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"CometTransport.requestDisconnect()\");\n    this._requestCloseOrDisconnect(false);\n  }\n  _requestCloseOrDisconnect(closing) {\n    const closeOrDisconnectUri = closing ? this.closeUri : this.disconnectUri;\n    if (closeOrDisconnectUri) {\n      const request = this.createRequest(closeOrDisconnectUri, null, this.authParams, null, XHRStates_default.REQ_SEND);\n      request.on(\"complete\", (err) => {\n        if (err) {\n          logger_default.logAction(\n            this.logger,\n            logger_default.LOG_ERROR,\n            \"CometTransport.request\" + (closing ? \"Close()\" : \"Disconnect()\"),\n            \"request returned err = \" + inspectError(err)\n          );\n          this.finish(\"disconnected\", err);\n        }\n      });\n      request.exec();\n    }\n  }\n  dispose() {\n    logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"CometTransport.dispose()\", \"\");\n    if (!this.isDisposed) {\n      this.isDisposed = true;\n      if (this.recvRequest) {\n        logger_default.logAction(this.logger, logger_default.LOG_MINOR, \"CometTransport.dispose()\", \"aborting recv request\");\n        this.recvRequest.abort();\n        this.recvRequest = null;\n      }\n      this.finish(\"disconnected\", connectionerrors_default.disconnected());\n      Platform.Config.nextTick(() => {\n        this.emit(\"disposed\");\n      });\n    }\n  }\n  onConnect(message) {\n    var _a2;\n    if (this.isDisposed) {\n      return;\n    }\n    const connectionStr = (_a2 = message.connectionDetails) == null ? void 0 : _a2.connectionKey;\n    transport_default.prototype.onConnect.call(this, message);\n    const baseConnectionUri = this.baseUri + connectionStr;\n    logger_default.logAction(this.logger, logger_default.LOG_MICRO, \"CometTransport.onConnect()\", \"baseUri = \" + baseConnectionUri);\n    this.sendUri = baseConnectionUri + \"/send\";\n    this.recvUri = baseConnectionUri + \"/recv\";\n    this.closeUri = baseConnectionUri + \"/close\";\n    this.disconnectUri = baseConnectionUri + \"/disconnect\";\n  }\n  send(message) {\n    if (this.sendRequest) {\n      this.pendingItems = this.pendingItems || [];\n      this.pendingItems.push(message);\n      return;\n    }\n    const pendingItems = this.pendingItems || [];\n    pendingItems.push(message);\n    this.pendingItems = null;\n    this.sendItems(pendingItems);\n  }\n  sendAnyPending() {\n    const pendingItems = this.pendingItems;\n    if (!pendingItems) {\n      return;\n    }\n    this.pendingItems = null;\n    this.sendItems(pendingItems);\n  }\n  sendItems(items) {\n    const sendRequest = this.sendRequest = this.createRequest(\n      this.sendUri,\n      null,\n      this.authParams,\n      this.encodeRequest(items),\n      XHRStates_default.REQ_SEND\n    );\n    sendRequest.on(\"complete\", (err, data) => {\n      if (err)\n        logger_default.logAction(\n          this.logger,\n          logger_default.LOG_ERROR,\n          \"CometTransport.sendItems()\",\n          \"on complete: err = \" + inspectError(err)\n        );\n      this.sendRequest = null;\n      if (err) {\n        if (err.code) {\n          this.onData(protocolMessageFromRawError(err));\n        } else {\n          this.disconnect(err);\n        }\n        return;\n      }\n      if (data) {\n        this.onData(data);\n      }\n      if (this.pendingItems) {\n        Platform.Config.nextTick(() => {\n          if (!this.sendRequest) {\n            this.sendAnyPending();\n          }\n        });\n      }\n    });\n    sendRequest.exec();\n  }\n  recv() {\n    if (this.recvRequest)\n      return;\n    if (!this.isConnected)\n      return;\n    const recvRequest = this.recvRequest = this.createRequest(\n      this.recvUri,\n      null,\n      this.authParams,\n      null,\n      this.stream ? XHRStates_default.REQ_RECV_STREAM : XHRStates_default.REQ_RECV_POLL\n    );\n    recvRequest.on(\"data\", (data) => {\n      this.onData(data);\n    });\n    recvRequest.on(\"complete\", (err) => {\n      this.recvRequest = null;\n      this.onActivity();\n      if (err) {\n        if (err.code) {\n          this.onData(protocolMessageFromRawError(err));\n        } else {\n          this.disconnect(err);\n        }\n        return;\n      }\n      Platform.Config.nextTick(() => {\n        this.recv();\n      });\n    });\n    recvRequest.exec();\n  }\n  onData(responseData) {\n    try {\n      const items = this.decodeResponse(responseData);\n      if (items && items.length)\n        for (let i = 0; i < items.length; i++)\n          this.onProtocolMessage(\n            fromDeserialized(\n              items[i],\n              this.connectionManager.realtime._RealtimePresence,\n              this.connectionManager.realtime._Annotations,\n              this.connectionManager.realtime._objectsPlugin\n            )\n          );\n    } catch (e) {\n      logger_default.logAction(\n        this.logger,\n        logger_default.LOG_ERROR,\n        \"CometTransport.onData()\",\n        \"Unexpected exception handing channel event: \" + e.stack\n      );\n    }\n  }\n  encodeRequest(requestItems) {\n    return JSON.stringify(requestItems);\n  }\n  decodeResponse(responseData) {\n    if (typeof responseData == \"string\")\n      return JSON.parse(responseData);\n    return responseData;\n  }\n};\nvar comettransport_default = CometTransport;\n\n// src/platform/web/lib/http/request/xhrrequest.ts\nfunction isAblyError(responseBody, headers) {\n  return allToLowerCase(keysArray(headers)).includes(\"x-ably-errorcode\");\n}\nfunction getAblyError(responseBody, headers) {\n  if (isAblyError(responseBody, headers)) {\n    return responseBody.error && ErrorInfo.fromValues(responseBody.error);\n  }\n}\nvar noop3 = function() {\n};\nvar idCounter = 0;\nvar pendingRequests = {};\nfunction getHeader(xhr, header) {\n  return xhr.getResponseHeader && xhr.getResponseHeader(header);\n}\nfunction isEncodingChunked(xhr) {\n  return xhr.getResponseHeader && (xhr.getResponseHeader(\"transfer-encoding\") || !xhr.getResponseHeader(\"content-length\"));\n}\nfunction getHeadersAsObject(xhr) {\n  const headerPairs = xhr.getAllResponseHeaders().trim().split(\"\\r\\n\");\n  const headers = {};\n  for (let i = 0; i < headerPairs.length; i++) {\n    const parts = headerPairs[i].split(\":\").map((x) => x.trim());\n    headers[parts[0].toLowerCase()] = parts[1];\n  }\n  return headers;\n}\nvar XHRRequest = class _XHRRequest extends eventemitter_default {\n  constructor(uri, headers, params, body, requestMode, timeouts, logger, method) {\n    super(logger);\n    params = params || {};\n    params.rnd = cheapRandStr();\n    this.uri = uri + toQueryString(params);\n    this.headers = headers || {};\n    this.body = body;\n    this.method = method ? method.toUpperCase() : isNil(body) ? \"GET\" : \"POST\";\n    this.requestMode = requestMode;\n    this.timeouts = timeouts;\n    this.timedOut = false;\n    this.requestComplete = false;\n    this.id = String(++idCounter);\n    pendingRequests[this.id] = this;\n  }\n  static createRequest(uri, headers, params, body, requestMode, timeouts, logger, method) {\n    const _timeouts = timeouts || defaults_default.TIMEOUTS;\n    return new _XHRRequest(\n      uri,\n      headers,\n      copy(params),\n      body,\n      requestMode,\n      _timeouts,\n      logger,\n      method\n    );\n  }\n  complete(err, body, headers, unpacked, statusCode) {\n    if (!this.requestComplete) {\n      this.requestComplete = true;\n      if (!err && body) {\n        this.emit(\"data\", body);\n      }\n      this.emit(\"complete\", err, body, headers, unpacked, statusCode);\n      this.dispose();\n    }\n  }\n  abort() {\n    this.dispose();\n  }\n  exec() {\n    let headers = this.headers;\n    const timeout = this.requestMode == XHRStates_default.REQ_SEND ? this.timeouts.httpRequestTimeout : this.timeouts.recvTimeout, timer = this.timer = setTimeout(() => {\n      this.timedOut = true;\n      xhr.abort();\n    }, timeout), method = this.method, xhr = this.xhr = new XMLHttpRequest(), accept = headers[\"accept\"];\n    let body = this.body;\n    let responseType = \"text\";\n    if (!accept) {\n      headers[\"accept\"] = \"application/json\";\n    } else if (accept.indexOf(\"application/x-msgpack\") === 0) {\n      responseType = \"arraybuffer\";\n    }\n    if (body) {\n      const contentType = headers[\"content-type\"] || (headers[\"content-type\"] = \"application/json\");\n      if (contentType.indexOf(\"application/json\") > -1 && typeof body != \"string\")\n        body = JSON.stringify(body);\n    }\n    xhr.open(method, this.uri, true);\n    xhr.responseType = responseType;\n    if (\"authorization\" in headers) {\n      xhr.withCredentials = true;\n    }\n    for (const h in headers)\n      xhr.setRequestHeader(h, headers[h]);\n    const errorHandler = (errorEvent, message, code, statusCode2) => {\n      var _a2;\n      let errorMessage = message + \" (event type: \" + errorEvent.type + \")\";\n      if ((_a2 = this == null ? void 0 : this.xhr) == null ? void 0 : _a2.statusText)\n        errorMessage += \", current statusText is \" + this.xhr.statusText;\n      logger_default.logAction(this.logger, logger_default.LOG_ERROR, \"Request.on\" + errorEvent.type + \"()\", errorMessage);\n      this.complete(new PartialErrorInfo(errorMessage, code, statusCode2));\n    };\n    xhr.onerror = (errorEvent) => {\n      errorHandler(errorEvent, \"XHR error occurred\", null, 400);\n    };\n    xhr.onabort = (errorEvent) => {\n      if (this.timedOut) {\n        errorHandler(errorEvent, \"Request aborted due to request timeout expiring\", null, 408);\n      } else {\n        errorHandler(errorEvent, \"Request cancelled\", null, 400);\n      }\n    };\n    xhr.ontimeout = (errorEvent) => {\n      errorHandler(errorEvent, \"Request timed out\", null, 408);\n    };\n    let streaming;\n    let statusCode;\n    let successResponse;\n    let streamPos = 0;\n    let unpacked = false;\n    const onResponse = () => {\n      clearTimeout(timer);\n      successResponse = statusCode < 400;\n      if (statusCode == 204) {\n        this.complete(null, null, null, null, statusCode);\n        return;\n      }\n      streaming = this.requestMode == XHRStates_default.REQ_RECV_STREAM && successResponse && isEncodingChunked(xhr);\n    };\n    const onEnd = () => {\n      let parsedResponse;\n      try {\n        const contentType = getHeader(xhr, \"content-type\");\n        const json = contentType ? contentType.indexOf(\"application/json\") >= 0 : xhr.responseType == \"text\";\n        if (json) {\n          const jsonResponseBody = xhr.responseType === \"arraybuffer\" ? Platform.BufferUtils.utf8Decode(xhr.response) : String(xhr.responseText);\n          if (jsonResponseBody.length) {\n            parsedResponse = JSON.parse(jsonResponseBody);\n          } else {\n            parsedResponse = jsonResponseBody;\n          }\n          unpacked = true;\n        } else {\n          parsedResponse = xhr.response;\n        }\n        if (parsedResponse.response !== void 0) {\n          statusCode = parsedResponse.statusCode;\n          successResponse = statusCode < 400;\n          headers = parsedResponse.headers;\n          parsedResponse = parsedResponse.response;\n        } else {\n          headers = getHeadersAsObject(xhr);\n        }\n      } catch (e) {\n        this.complete(new PartialErrorInfo(\"Malformed response body from server: \" + e.message, null, 400));\n        return;\n      }\n      if (successResponse || Array.isArray(parsedResponse)) {\n        this.complete(null, parsedResponse, headers, unpacked, statusCode);\n        return;\n      }\n      let err = getAblyError(parsedResponse, headers);\n      if (!err) {\n        err = new PartialErrorInfo(\n          \"Error response received from server: \" + statusCode + \" body was: \" + Platform.Config.inspect(parsedResponse),\n          null,\n          statusCode\n        );\n      }\n      this.complete(err, parsedResponse, headers, unpacked, statusCode);\n    };\n    function onProgress() {\n      const responseText = xhr.responseText;\n      const bodyEnd = responseText.length - 1;\n      let idx, chunk;\n      while (streamPos < bodyEnd && (idx = responseText.indexOf(\"\\n\", streamPos)) > -1) {\n        chunk = responseText.slice(streamPos, idx);\n        streamPos = idx + 1;\n        onChunk(chunk);\n      }\n    }\n    const onChunk = (chunk) => {\n      try {\n        chunk = JSON.parse(chunk);\n      } catch (e) {\n        this.complete(new PartialErrorInfo(\"Malformed response body from server: \" + e.message, null, 400));\n        return;\n      }\n      this.emit(\"data\", chunk);\n    };\n    const onStreamEnd = () => {\n      onProgress();\n      this.streamComplete = true;\n      Platform.Config.nextTick(() => {\n        this.complete();\n      });\n    };\n    xhr.onreadystatechange = () => {\n      const readyState = xhr.readyState;\n      if (readyState < 3)\n        return;\n      if (xhr.status !== 0) {\n        if (statusCode === void 0) {\n          statusCode = xhr.status;\n          onResponse();\n        }\n        if (readyState == 3 && streaming) {\n          onProgress();\n        } else if (readyState == 4) {\n          if (streaming)\n            onStreamEnd();\n          else\n            onEnd();\n        }\n      }\n    };\n    xhr.send(body);\n  }\n  dispose() {\n    const xhr = this.xhr;\n    if (xhr) {\n      xhr.onreadystatechange = xhr.onerror = xhr.onabort = xhr.ontimeout = noop3;\n      this.xhr = null;\n      const timer = this.timer;\n      if (timer) {\n        clearTimeout(timer);\n        this.timer = null;\n      }\n      if (!this.requestComplete)\n        xhr.abort();\n    }\n    delete pendingRequests[this.id];\n  }\n};\nvar xhrrequest_default = XHRRequest;\n\n// src/platform/web/lib/transport/xhrpollingtransport.ts\nvar shortName2 = TransportNames.XhrPolling;\nvar XHRPollingTransport = class extends comettransport_default {\n  constructor(connectionManager, auth, params) {\n    super(connectionManager, auth, params);\n    this.shortName = shortName2;\n    params.stream = false;\n    this.shortName = shortName2;\n  }\n  static isAvailable() {\n    return !!(Platform.Config.xhrSupported && Platform.Config.allowComet);\n  }\n  toString() {\n    return \"XHRPollingTransport; uri=\" + this.baseUri + \"; isConnected=\" + this.isConnected;\n  }\n  createRequest(uri, headers, params, body, requestMode) {\n    return xhrrequest_default.createRequest(uri, headers, params, body, requestMode, this.timeouts, this.logger);\n  }\n};\nvar xhrpollingtransport_default = XHRPollingTransport;\n\n// src/platform/web/lib/transport/index.ts\nvar order = [\"xhr_polling\"];\nvar defaultTransports = {\n  order,\n  bundledImplementations: {\n    web_socket: websockettransport_default,\n    xhr_polling: xhrpollingtransport_default\n  }\n};\nvar transport_default2 = defaultTransports;\n\n// src/platform/web/lib/util/defaults.ts\nvar Defaults2 = {\n  connectivityCheckUrl: \"https://internet-up.ably-realtime.com/is-the-internet-up.txt\",\n  wsConnectivityCheckUrl: \"wss://ws-up.ably-realtime.com\",\n  /* Order matters here: the base transport is the leftmost one in the\n   * intersection of baseTransportOrder and the transports clientOption that's\n   * supported. */\n  defaultTransports: [TransportNames.XhrPolling, TransportNames.WebSocket]\n};\nvar defaults_default2 = Defaults2;\n\n// src/platform/web/lib/util/msgpack.ts\nfunction inspect(buffer) {\n  if (buffer === void 0)\n    return \"undefined\";\n  let view;\n  let type;\n  if (buffer instanceof ArrayBuffer) {\n    type = \"ArrayBuffer\";\n    view = new DataView(buffer);\n  } else if (buffer instanceof DataView) {\n    type = \"DataView\";\n    view = buffer;\n  }\n  if (!view)\n    return JSON.stringify(buffer);\n  const bytes = [];\n  for (let i = 0; i < buffer.byteLength; i++) {\n    if (i > 20) {\n      bytes.push(\"...\");\n      break;\n    }\n    let byte_ = view.getUint8(i).toString(16);\n    if (byte_.length === 1)\n      byte_ = \"0\" + byte_;\n    bytes.push(byte_);\n  }\n  return \"<\" + type + \" \" + bytes.join(\" \") + \">\";\n}\nfunction utf8Write(view, offset, string) {\n  for (let i = 0, l = string.length; i < l; i++) {\n    const codePoint = string.charCodeAt(i);\n    if (codePoint < 128) {\n      view.setUint8(offset++, codePoint >>> 0 & 127 | 0);\n      continue;\n    }\n    if (codePoint < 2048) {\n      view.setUint8(offset++, codePoint >>> 6 & 31 | 192);\n      view.setUint8(offset++, codePoint >>> 0 & 63 | 128);\n      continue;\n    }\n    if (codePoint < 65536) {\n      view.setUint8(offset++, codePoint >>> 12 & 15 | 224);\n      view.setUint8(offset++, codePoint >>> 6 & 63 | 128);\n      view.setUint8(offset++, codePoint >>> 0 & 63 | 128);\n      continue;\n    }\n    if (codePoint < 1114112) {\n      view.setUint8(offset++, codePoint >>> 18 & 7 | 240);\n      view.setUint8(offset++, codePoint >>> 12 & 63 | 128);\n      view.setUint8(offset++, codePoint >>> 6 & 63 | 128);\n      view.setUint8(offset++, codePoint >>> 0 & 63 | 128);\n      continue;\n    }\n    throw new Error(\"bad codepoint \" + codePoint);\n  }\n}\nfunction utf8Read(view, offset, length) {\n  let string = \"\";\n  for (let i = offset, end = offset + length; i < end; i++) {\n    const byte_ = view.getUint8(i);\n    if ((byte_ & 128) === 0) {\n      string += String.fromCharCode(byte_);\n      continue;\n    }\n    if ((byte_ & 224) === 192) {\n      string += String.fromCharCode((byte_ & 15) << 6 | view.getUint8(++i) & 63);\n      continue;\n    }\n    if ((byte_ & 240) === 224) {\n      string += String.fromCharCode(\n        (byte_ & 15) << 12 | (view.getUint8(++i) & 63) << 6 | (view.getUint8(++i) & 63) << 0\n      );\n      continue;\n    }\n    if ((byte_ & 248) === 240) {\n      string += String.fromCharCode(\n        (byte_ & 7) << 18 | (view.getUint8(++i) & 63) << 12 | (view.getUint8(++i) & 63) << 6 | (view.getUint8(++i) & 63) << 0\n      );\n      continue;\n    }\n    throw new Error(\"Invalid byte \" + byte_.toString(16));\n  }\n  return string;\n}\nfunction utf8ByteCount(string) {\n  let count = 0;\n  for (let i = 0, l = string.length; i < l; i++) {\n    const codePoint = string.charCodeAt(i);\n    if (codePoint < 128) {\n      count += 1;\n      continue;\n    }\n    if (codePoint < 2048) {\n      count += 2;\n      continue;\n    }\n    if (codePoint < 65536) {\n      count += 3;\n      continue;\n    }\n    if (codePoint < 1114112) {\n      count += 4;\n      continue;\n    }\n    throw new Error(\"bad codepoint \" + codePoint);\n  }\n  return count;\n}\nfunction encode2(value, sparse) {\n  const size = sizeof(value, sparse);\n  if (size === 0)\n    return void 0;\n  const buffer = new ArrayBuffer(size);\n  const view = new DataView(buffer);\n  _encode(value, view, 0, sparse);\n  return buffer;\n}\nvar SH_L_32 = (1 << 16) * (1 << 16);\nvar SH_R_32 = 1 / SH_L_32;\nfunction getInt64(view, offset) {\n  offset = offset || 0;\n  return view.getInt32(offset) * SH_L_32 + view.getUint32(offset + 4);\n}\nfunction getUint64(view, offset) {\n  offset = offset || 0;\n  return view.getUint32(offset) * SH_L_32 + view.getUint32(offset + 4);\n}\nfunction setInt64(view, offset, val) {\n  if (val < 9223372036854776e3) {\n    view.setInt32(offset, Math.floor(val * SH_R_32));\n    view.setInt32(offset + 4, val & -1);\n  } else {\n    view.setUint32(offset, 2147483647);\n    view.setUint32(offset + 4, 2147483647);\n  }\n}\nfunction setUint64(view, offset, val) {\n  if (val < 18446744073709552e3) {\n    view.setUint32(offset, Math.floor(val * SH_R_32));\n    view.setInt32(offset + 4, val & -1);\n  } else {\n    view.setUint32(offset, 4294967295);\n    view.setUint32(offset + 4, 4294967295);\n  }\n}\nvar Decoder = class {\n  constructor(view, offset) {\n    this.map = (length) => {\n      const value = {};\n      for (let i = 0; i < length; i++) {\n        const key = this.parse();\n        value[key] = this.parse();\n      }\n      return value;\n    };\n    this.bin = (length) => {\n      const value = new ArrayBuffer(length);\n      new Uint8Array(value).set(new Uint8Array(this.view.buffer, this.offset, length), 0);\n      this.offset += length;\n      return value;\n    };\n    this.buf = this.bin;\n    this.str = (length) => {\n      const value = utf8Read(this.view, this.offset, length);\n      this.offset += length;\n      return value;\n    };\n    this.array = (length) => {\n      const value = new Array(length);\n      for (let i = 0; i < length; i++) {\n        value[i] = this.parse();\n      }\n      return value;\n    };\n    this.ext = (length) => {\n      this.offset += length;\n      return {\n        type: this.view.getInt8(this.offset),\n        data: this.buf(length)\n      };\n    };\n    this.parse = () => {\n      const type = this.view.getUint8(this.offset);\n      let value, length;\n      if ((type & 128) === 0) {\n        this.offset++;\n        return type;\n      }\n      if ((type & 240) === 128) {\n        length = type & 15;\n        this.offset++;\n        return this.map(length);\n      }\n      if ((type & 240) === 144) {\n        length = type & 15;\n        this.offset++;\n        return this.array(length);\n      }\n      if ((type & 224) === 160) {\n        length = type & 31;\n        this.offset++;\n        return this.str(length);\n      }\n      if ((type & 224) === 224) {\n        value = this.view.getInt8(this.offset);\n        this.offset++;\n        return value;\n      }\n      switch (type) {\n        case 192:\n          this.offset++;\n          return null;\n        case 193:\n          this.offset++;\n          return void 0;\n        case 194:\n          this.offset++;\n          return false;\n        case 195:\n          this.offset++;\n          return true;\n        case 196:\n          length = this.view.getUint8(this.offset + 1);\n          this.offset += 2;\n          return this.bin(length);\n        case 197:\n          length = this.view.getUint16(this.offset + 1);\n          this.offset += 3;\n          return this.bin(length);\n        case 198:\n          length = this.view.getUint32(this.offset + 1);\n          this.offset += 5;\n          return this.bin(length);\n        case 199:\n          length = this.view.getUint8(this.offset + 1);\n          this.offset += 2;\n          return this.ext(length);\n        case 200:\n          length = this.view.getUint16(this.offset + 1);\n          this.offset += 3;\n          return this.ext(length);\n        case 201:\n          length = this.view.getUint32(this.offset + 1);\n          this.offset += 5;\n          return this.ext(length);\n        case 202:\n          value = this.view.getFloat32(this.offset + 1);\n          this.offset += 5;\n          return value;\n        case 203:\n          value = this.view.getFloat64(this.offset + 1);\n          this.offset += 9;\n          return value;\n        case 204:\n          value = this.view.getUint8(this.offset + 1);\n          this.offset += 2;\n          return value;\n        case 205:\n          value = this.view.getUint16(this.offset + 1);\n          this.offset += 3;\n          return value;\n        case 206:\n          value = this.view.getUint32(this.offset + 1);\n          this.offset += 5;\n          return value;\n        case 207:\n          value = getUint64(this.view, this.offset + 1);\n          this.offset += 9;\n          return value;\n        case 208:\n          value = this.view.getInt8(this.offset + 1);\n          this.offset += 2;\n          return value;\n        case 209:\n          value = this.view.getInt16(this.offset + 1);\n          this.offset += 3;\n          return value;\n        case 210:\n          value = this.view.getInt32(this.offset + 1);\n          this.offset += 5;\n          return value;\n        case 211:\n          value = getInt64(this.view, this.offset + 1);\n          this.offset += 9;\n          return value;\n        case 212:\n          length = 1;\n          this.offset++;\n          return this.ext(length);\n        case 213:\n          length = 2;\n          this.offset++;\n          return this.ext(length);\n        case 214:\n          length = 4;\n          this.offset++;\n          return this.ext(length);\n        case 215:\n          length = 8;\n          this.offset++;\n          return this.ext(length);\n        case 216:\n          length = 16;\n          this.offset++;\n          return this.ext(length);\n        case 217:\n          length = this.view.getUint8(this.offset + 1);\n          this.offset += 2;\n          return this.str(length);\n        case 218:\n          length = this.view.getUint16(this.offset + 1);\n          this.offset += 3;\n          return this.str(length);\n        case 219:\n          length = this.view.getUint32(this.offset + 1);\n          this.offset += 5;\n          return this.str(length);\n        case 220:\n          length = this.view.getUint16(this.offset + 1);\n          this.offset += 3;\n          return this.array(length);\n        case 221:\n          length = this.view.getUint32(this.offset + 1);\n          this.offset += 5;\n          return this.array(length);\n        case 222:\n          length = this.view.getUint16(this.offset + 1);\n          this.offset += 3;\n          return this.map(length);\n        case 223:\n          length = this.view.getUint32(this.offset + 1);\n          this.offset += 5;\n          return this.map(length);\n      }\n      throw new Error(\"Unknown type 0x\" + type.toString(16));\n    };\n    this.offset = offset || 0;\n    this.view = view;\n  }\n};\nfunction decode2(buffer) {\n  const view = new DataView(buffer);\n  const decoder = new Decoder(view);\n  const value = decoder.parse();\n  if (decoder.offset !== buffer.byteLength)\n    throw new Error(buffer.byteLength - decoder.offset + \" trailing bytes\");\n  return value;\n}\nfunction encodeableKeys(value, sparse) {\n  return Object.keys(value).filter(function(e) {\n    const val = value[e], type = typeof val;\n    return (!sparse || val !== void 0 && val !== null) && (\"function\" !== type || !!val.toJSON);\n  });\n}\nfunction _encode(value, view, offset, sparse) {\n  const type = typeof value;\n  if (typeof value === \"string\") {\n    const length = utf8ByteCount(value);\n    if (length < 32) {\n      view.setUint8(offset, length | 160);\n      utf8Write(view, offset + 1, value);\n      return 1 + length;\n    }\n    if (length < 256) {\n      view.setUint8(offset, 217);\n      view.setUint8(offset + 1, length);\n      utf8Write(view, offset + 2, value);\n      return 2 + length;\n    }\n    if (length < 65536) {\n      view.setUint8(offset, 218);\n      view.setUint16(offset + 1, length);\n      utf8Write(view, offset + 3, value);\n      return 3 + length;\n    }\n    if (length < 4294967296) {\n      view.setUint8(offset, 219);\n      view.setUint32(offset + 1, length);\n      utf8Write(view, offset + 5, value);\n      return 5 + length;\n    }\n  }\n  if (ArrayBuffer.isView && ArrayBuffer.isView(value)) {\n    value = value.buffer;\n  }\n  if (value instanceof ArrayBuffer) {\n    const length = value.byteLength;\n    if (length < 256) {\n      view.setUint8(offset, 196);\n      view.setUint8(offset + 1, length);\n      new Uint8Array(view.buffer).set(new Uint8Array(value), offset + 2);\n      return 2 + length;\n    }\n    if (length < 65536) {\n      view.setUint8(offset, 197);\n      view.setUint16(offset + 1, length);\n      new Uint8Array(view.buffer).set(new Uint8Array(value), offset + 3);\n      return 3 + length;\n    }\n    if (length < 4294967296) {\n      view.setUint8(offset, 198);\n      view.setUint32(offset + 1, length);\n      new Uint8Array(view.buffer).set(new Uint8Array(value), offset + 5);\n      return 5 + length;\n    }\n  }\n  if (typeof value === \"number\") {\n    if (Math.floor(value) !== value) {\n      view.setUint8(offset, 203);\n      view.setFloat64(offset + 1, value);\n      return 9;\n    }\n    if (value >= 0) {\n      if (value < 128) {\n        view.setUint8(offset, value);\n        return 1;\n      }\n      if (value < 256) {\n        view.setUint8(offset, 204);\n        view.setUint8(offset + 1, value);\n        return 2;\n      }\n      if (value < 65536) {\n        view.setUint8(offset, 205);\n        view.setUint16(offset + 1, value);\n        return 3;\n      }\n      if (value < 4294967296) {\n        view.setUint8(offset, 206);\n        view.setUint32(offset + 1, value);\n        return 5;\n      }\n      if (value < 18446744073709552e3) {\n        view.setUint8(offset, 207);\n        setUint64(view, offset + 1, value);\n        return 9;\n      }\n      throw new Error(\"Number too big 0x\" + value.toString(16));\n    }\n    if (value >= -32) {\n      view.setInt8(offset, value);\n      return 1;\n    }\n    if (value >= -128) {\n      view.setUint8(offset, 208);\n      view.setInt8(offset + 1, value);\n      return 2;\n    }\n    if (value >= -32768) {\n      view.setUint8(offset, 209);\n      view.setInt16(offset + 1, value);\n      return 3;\n    }\n    if (value >= -2147483648) {\n      view.setUint8(offset, 210);\n      view.setInt32(offset + 1, value);\n      return 5;\n    }\n    if (value >= -9223372036854776e3) {\n      view.setUint8(offset, 211);\n      setInt64(view, offset + 1, value);\n      return 9;\n    }\n    throw new Error(\"Number too small -0x\" + (-value).toString(16).substr(1));\n  }\n  if (type === \"undefined\") {\n    if (sparse)\n      return 0;\n    view.setUint8(offset, 212);\n    view.setUint8(offset + 1, 0);\n    view.setUint8(offset + 2, 0);\n    return 3;\n  }\n  if (value === null) {\n    if (sparse)\n      return 0;\n    view.setUint8(offset, 192);\n    return 1;\n  }\n  if (type === \"boolean\") {\n    view.setUint8(offset, value ? 195 : 194);\n    return 1;\n  }\n  if (\"function\" === typeof value.toJSON)\n    return _encode(value.toJSON(), view, offset, sparse);\n  if (type === \"object\") {\n    let length, size = 0;\n    let keys;\n    const isArray = Array.isArray(value);\n    if (isArray) {\n      length = value.length;\n    } else {\n      keys = encodeableKeys(value, sparse);\n      length = keys.length;\n    }\n    if (length < 16) {\n      view.setUint8(offset, length | (isArray ? 144 : 128));\n      size = 1;\n    } else if (length < 65536) {\n      view.setUint8(offset, isArray ? 220 : 222);\n      view.setUint16(offset + 1, length);\n      size = 3;\n    } else if (length < 4294967296) {\n      view.setUint8(offset, isArray ? 221 : 223);\n      view.setUint32(offset + 1, length);\n      size = 5;\n    }\n    if (isArray) {\n      for (let i = 0; i < length; i++) {\n        size += _encode(value[i], view, offset + size, sparse);\n      }\n    } else if (keys) {\n      for (let i = 0; i < length; i++) {\n        const key = keys[i];\n        size += _encode(key, view, offset + size);\n        size += _encode(value[key], view, offset + size, sparse);\n      }\n    }\n    return size;\n  }\n  if (type === \"function\")\n    return 0;\n  throw new Error(\"Unknown type \" + type);\n}\nfunction sizeof(value, sparse) {\n  const type = typeof value;\n  if (type === \"string\") {\n    const length = utf8ByteCount(value);\n    if (length < 32) {\n      return 1 + length;\n    }\n    if (length < 256) {\n      return 2 + length;\n    }\n    if (length < 65536) {\n      return 3 + length;\n    }\n    if (length < 4294967296) {\n      return 5 + length;\n    }\n  }\n  if (ArrayBuffer.isView && ArrayBuffer.isView(value)) {\n    value = value.buffer;\n  }\n  if (value instanceof ArrayBuffer) {\n    const length = value.byteLength;\n    if (length < 256) {\n      return 2 + length;\n    }\n    if (length < 65536) {\n      return 3 + length;\n    }\n    if (length < 4294967296) {\n      return 5 + length;\n    }\n  }\n  if (typeof value === \"number\") {\n    if (Math.floor(value) !== value)\n      return 9;\n    if (value >= 0) {\n      if (value < 128)\n        return 1;\n      if (value < 256)\n        return 2;\n      if (value < 65536)\n        return 3;\n      if (value < 4294967296)\n        return 5;\n      if (value < 18446744073709552e3)\n        return 9;\n      throw new Error(\"Number too big 0x\" + value.toString(16));\n    }\n    if (value >= -32)\n      return 1;\n    if (value >= -128)\n      return 2;\n    if (value >= -32768)\n      return 3;\n    if (value >= -2147483648)\n      return 5;\n    if (value >= -9223372036854776e3)\n      return 9;\n    throw new Error(\"Number too small -0x\" + value.toString(16).substr(1));\n  }\n  if (type === \"boolean\")\n    return 1;\n  if (value === null)\n    return sparse ? 0 : 1;\n  if (value === void 0)\n    return sparse ? 0 : 3;\n  if (\"function\" === typeof value.toJSON)\n    return sizeof(value.toJSON(), sparse);\n  if (type === \"object\") {\n    let length, size = 0;\n    if (Array.isArray(value)) {\n      length = value.length;\n      for (let i = 0; i < length; i++) {\n        size += sizeof(value[i], sparse);\n      }\n    } else {\n      const keys = encodeableKeys(value, sparse);\n      length = keys.length;\n      for (let i = 0; i < length; i++) {\n        const key = keys[i];\n        size += sizeof(key) + sizeof(value[key], sparse);\n      }\n    }\n    if (length < 16) {\n      return 1 + size;\n    }\n    if (length < 65536) {\n      return 3 + size;\n    }\n    if (length < 4294967296) {\n      return 5 + size;\n    }\n    throw new Error(\"Array or object too long 0x\" + length.toString(16));\n  }\n  if (type === \"function\")\n    return 0;\n  throw new Error(\"Unknown type \" + type);\n}\nvar msgpack_default = {\n  encode: encode2,\n  decode: decode2,\n  inspect,\n  utf8Write,\n  utf8Read,\n  utf8ByteCount\n};\n\n// src/platform/web/lib/http/request/fetchrequest.ts\nfunction isAblyError2(responseBody, headers) {\n  return !!headers.get(\"x-ably-errorcode\");\n}\nfunction getAblyError2(responseBody, headers) {\n  if (isAblyError2(responseBody, headers)) {\n    return responseBody.error && ErrorInfo.fromValues(responseBody.error);\n  }\n}\nfunction convertHeaders(headers) {\n  const result = {};\n  headers.forEach((value, key) => {\n    result[key] = value;\n  });\n  return result;\n}\nasync function fetchRequest(method, client, uri, headers, params, body) {\n  const fetchHeaders = new Headers(headers || {});\n  const _method = method ? method.toUpperCase() : isNil(body) ? \"GET\" : \"POST\";\n  const controller = new AbortController();\n  let timeout;\n  const timeoutPromise = new Promise((resolve) => {\n    timeout = setTimeout(\n      () => {\n        controller.abort();\n        resolve({ error: new PartialErrorInfo(\"Request timed out\", null, 408) });\n      },\n      client ? client.options.timeouts.httpRequestTimeout : defaults_default.TIMEOUTS.httpRequestTimeout\n    );\n  });\n  const requestInit = {\n    method: _method,\n    headers: fetchHeaders,\n    body,\n    signal: controller.signal\n  };\n  if (!Platform.Config.isWebworker) {\n    requestInit.credentials = fetchHeaders.has(\"authorization\") ? \"include\" : \"same-origin\";\n  }\n  const resultPromise = (async () => {\n    try {\n      const urlParams = new URLSearchParams(params || {});\n      urlParams.set(\"rnd\", cheapRandStr());\n      const preparedURI = uri + \"?\" + urlParams;\n      const res = await getGlobalObject().fetch(preparedURI, requestInit);\n      clearTimeout(timeout);\n      if (res.status == 204) {\n        return { error: null, statusCode: res.status };\n      }\n      const contentType = res.headers.get(\"Content-Type\");\n      let body2;\n      if (contentType && contentType.indexOf(\"application/x-msgpack\") > -1) {\n        body2 = await res.arrayBuffer();\n      } else if (contentType && contentType.indexOf(\"application/json\") > -1) {\n        body2 = await res.json();\n      } else {\n        body2 = await res.text();\n      }\n      const unpacked = !!contentType && contentType.indexOf(\"application/x-msgpack\") === -1;\n      const headers2 = convertHeaders(res.headers);\n      if (!res.ok) {\n        const error = getAblyError2(body2, res.headers) || new PartialErrorInfo(\n          \"Error response received from server: \" + res.status + \" body was: \" + Platform.Config.inspect(body2),\n          null,\n          res.status\n        );\n        return { error, body: body2, headers: headers2, unpacked, statusCode: res.status };\n      } else {\n        return { error: null, body: body2, headers: headers2, unpacked, statusCode: res.status };\n      }\n    } catch (error) {\n      clearTimeout(timeout);\n      return { error };\n    }\n  })();\n  return Promise.race([timeoutPromise, resultPromise]);\n}\n\n// src/platform/web/lib/http/request/index.ts\nvar defaultBundledRequestImplementations = {\n  XHRRequest: xhrrequest_default,\n  FetchRequest: fetchRequest\n};\n\n// src/platform/web/index.ts\nvar Crypto = createCryptoClass(config_default, bufferutils_default);\nPlatform.Crypto = Crypto;\nPlatform.BufferUtils = bufferutils_default;\nPlatform.Http = http_default;\nPlatform.Config = config_default;\nPlatform.Transports = transport_default2;\nPlatform.WebStorage = webstorage_default;\nfor (const clientClass of [DefaultRest, DefaultRealtime]) {\n  clientClass.Crypto = Crypto;\n  clientClass._MsgPack = msgpack_default;\n}\nhttp_default.bundledRequestImplementations = defaultBundledRequestImplementations;\nlogger_default.initLogHandlers();\nPlatform.Defaults = getDefaults(defaults_default2);\nif (Platform.Config.agent) {\n  Platform.Defaults.agent += \" \" + Platform.Config.agent;\n}\nvar web_default = {\n  ErrorInfo,\n  Rest: DefaultRest,\n  Realtime: DefaultRealtime,\n  msgpack: msgpack_default,\n  makeProtocolMessageFromDeserialized: makeFromDeserializedWithDependencies\n};\nif (typeof module.exports == \"object\" && typeof exports == \"object\") {\n  var __cp = (to, from, except, desc) => {\n    if ((from && typeof from === \"object\") || typeof from === \"function\") {\n      for (let key of Object.getOwnPropertyNames(from)) {\n        if (!Object.prototype.hasOwnProperty.call(to, key) && key !== except)\n        Object.defineProperty(to, key, {\n          get: () => from[key],\n          enumerable: !(desc = Object.getOwnPropertyDescriptor(from, key)) || desc.enumerable,\n        });\n      }\n    }\n    return to;\n  };\n  module.exports = __cp(module.exports, exports);\n}\nreturn module.exports;\n}))\n//# sourceMappingURL=ably.js.map\n",
    "/*eslint no-unused-vars: [\"error\", { \"varsIgnorePattern\": \"^_\", \"argsIgnorePattern\": \"^_\", \"destructuredArrayIgnorePattern\": \"^_\"}]*/\n\nfunction toFn(x) {\n  if (x == null) return x;\n  if (x instanceof Function) {\n    return x;\n  }\n  const t = typeof x;\n  if (t === 'string') {\n    return (coll, d) => {\n      return get(coll, x, d);\n    };\n  }\n  if (t === 'object') {\n    return (k, d) => {\n      return get(x, k, d);\n    };\n  }\n  return x;\n}\n\n// inlined and modified version of https://github.com/lukeed/dequal\nvar has = Object.prototype.hasOwnProperty;\n\nfunction findKey(iter, tar, key) {\n  for (key of iter.keys()) {\n    if (dequal(key, tar)) return key;\n  }\n}\n\nfunction dequal(foo, bar) {\n  // supports primitives, Array, Set, Map and plain objects\n  // like CLJS: does not support NaN\n  if (foo === bar) return true;\n  var ctor, len, tmp;\n\n  if (foo && bar && (ctor = foo.constructor) === bar.constructor) {\n    if (ctor === Array) {\n      if ((len = foo.length) === bar.length) {\n        while (len-- && dequal(foo[len], bar[len]));\n      }\n      return len === -1;\n    }\n\n    if (ctor === Set) {\n      if (foo.size !== bar.size) {\n        return false;\n      }\n      for (const elt of foo) {\n        tmp = elt;\n        if (tmp && typeof tmp === 'object') {\n          tmp = findKey(bar, tmp);\n          if (!tmp) return false;\n        }\n        if (!bar.has(tmp)) return false;\n      }\n      return true;\n    }\n\n    if (ctor === Map) {\n      if (foo.size !== bar.size) {\n        return false;\n      }\n      for (const kv of foo) {\n        tmp = kv[0];\n        if (tmp && typeof tmp === 'object') {\n          tmp = findKey(bar, tmp);\n          if (!tmp) return false;\n        }\n        if (!dequal(len[1], bar.get(tmp))) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    if (!ctor || typeof foo === 'object') {\n      len = 0;\n      for (const k in foo) {\n        if (has.call(foo, k) && ++len && !has.call(bar, k)) return false;\n        if (!(k in bar) || !dequal(foo[k], bar[k])) return false;\n      }\n      return Object.keys(bar).length === len;\n    }\n  }\n  return false;\n}\n// end inlined version of dequals\n\nfunction walkArray(arr, comp) {\n  return arr.every(function (x, i) {\n    return i === 0 || comp(arr[i - 1], x);\n  });\n}\n\nexport function _EQ_(...xs) {\n  return walkArray(xs, (x, y) => dequal(x, y));\n}\n\nexport function _GT_(...xs) {\n  return walkArray(xs, (x, y) => x > y);\n}\n\nexport function _GT__EQ_(...xs) {\n  return walkArray(xs, (x, y) => x >= y);\n}\n\nexport function _LT_(...xs) {\n  return walkArray(xs, (x, y) => x < y);\n}\n\nexport function _LT__EQ_(...xs) {\n  return walkArray(xs, (x, y) => x <= y);\n}\n\nexport function _PLUS_(...xs) {\n  return xs.reduce((x, y) => x + y, 0);\n}\n\nexport function _STAR_(...xs) {\n  return xs.reduce((x, y) => x * y, 1);\n}\n\nexport function _(...xs) {\n  if (xs.length == 1) {\n    return 0 - xs[0];\n  }\n  return xs.reduce((x, y) => x - y);\n}\n\nexport const __protocol_satisfies = {};\n\nexport function satisfies_QMARK_(protocol, x) {\n  if (x == null) {\n    return protocol[null];\n  }\n  if (typeof protocol == 'symbol') return x[protocol];\n  return x[protocol.__sym];\n}\n\nfunction mapAssocMut(m, k, v) {\n  m.set(k, v);\n  return m;\n}\n\nfunction objAssocMut(m, k, v) {\n  m[k] = v;\n  return m;\n}\n\nfunction getAssocMut(m) {\n  switch (typeConst(m)) {\n    case MAP_TYPE:\n      return mapAssocMut;\n    case ARRAY_TYPE:\n    case OBJECT_TYPE:\n      return objAssocMut;\n  }\n}\n\nexport function assoc_BANG_(m, k, v, ...kvs) {\n  if (kvs.length % 2 !== 0) {\n    throw new Error('Illegal argument: assoc expects an odd number of arguments.');\n  }\n  switch (typeConst(m)) {\n    case MAP_TYPE:\n      m.set(k, v);\n\n      for (let i = 0; i < kvs.length; i += 2) {\n        m.set(kvs[i], kvs[i + 1]);\n      }\n      break;\n    case ARRAY_TYPE:\n    case OBJECT_TYPE:\n      m[k] = v;\n\n      for (let i = 0; i < kvs.length; i += 2) {\n        m[kvs[i]] = kvs[i + 1];\n      }\n      break;\n    default:\n      throw new Error(\n        `Illegal argument: assoc! expects a Map, Array, or Object as the first argument, but got ${typeof m}.`\n      );\n  }\n\n  return m;\n}\n\nfunction copy(o) {\n  switch (typeConst(o)) {\n    case MAP_TYPE:\n      return new Map(o);\n    case SET_TYPE:\n      return new o.constructor(o);\n    case ARRAY_TYPE:\n      return [...o];\n    case OBJECT_TYPE:\n      return { ...o };\n    default:\n      throw new Error(`Don't know how to copy object of type ${typeof o}.`);\n  }\n}\n\nexport function assoc(o, k, v, ...kvs) {\n  if (!o) {\n    o = {};\n  }\n  const ret = copy(o);\n  assoc_BANG_(ret, k, v, ...kvs);\n  return ret;\n}\n\nconst MAP_TYPE = 1;\nconst ARRAY_TYPE = 2;\nconst OBJECT_TYPE = 3;\nconst LIST_TYPE = 4;\nconst SET_TYPE = 5;\nconst LAZY_ITERABLE_TYPE = 6;\n\nfunction emptyOfType(type) {\n  switch (type) {\n    case MAP_TYPE:\n      return new Map();\n    case ARRAY_TYPE:\n      return [];\n    case OBJECT_TYPE:\n      return {}; // Object.create?\n    case LIST_TYPE:\n      return new List();\n    case SET_TYPE:\n      return new Set();\n    case LAZY_ITERABLE_TYPE:\n      return lazy(function* () {\n        return;\n      });\n  }\n  return undefined;\n}\n\nfunction isObj(coll) {\n  return coll.constructor === Object;\n}\n\nexport function object_QMARK_(coll) {\n  return coll != null && isObj(coll);\n}\n\nfunction typeConst(obj) {\n  if (obj == null) {\n    return undefined;\n  }\n  // optimize for object\n  if (isObj(obj)) {\n    return OBJECT_TYPE;\n  }\n  if (obj instanceof Map) return MAP_TYPE;\n  if (obj instanceof Set) return SET_TYPE;\n  if (obj instanceof List) return LIST_TYPE;\n  if (Array.isArray(obj)) return ARRAY_TYPE;\n  if (obj instanceof LazyIterable) return LAZY_ITERABLE_TYPE;\n  if (obj instanceof SortedSet) return SET_TYPE;\n\n  // everything more specific than Object should go before this\n  if (obj instanceof Object) return OBJECT_TYPE;\n\n  return undefined;\n}\n\nfunction assoc_in_with(f, fname, o, keys, value) {\n  keys = vec(keys);\n  o = o || {}; // default nil behavior is JS object\n  const baseType = typeConst(o);\n  if (baseType !== MAP_TYPE && baseType !== ARRAY_TYPE && baseType !== OBJECT_TYPE)\n    throw new Error(\n      `Illegal argument: ${fname} expects the first argument to be a Map, Array, or Object.`\n    );\n\n  const chain = [o];\n  let lastInChain = o;\n\n  for (let i = 0; i < keys.length - 1; i += 1) {\n    const k = keys[i];\n    let chainValue;\n    if (lastInChain instanceof Map) chainValue = lastInChain.get(k);\n    else chainValue = lastInChain[k];\n    if (!chainValue) {\n      chainValue = emptyOfType(baseType);\n    }\n    chain.push(chainValue);\n    lastInChain = chainValue;\n  }\n\n  chain.push(value);\n\n  for (let i = chain.length - 2; i >= 0; i -= 1) {\n    chain[i] = f(chain[i], keys[i], chain[i + 1]);\n  }\n\n  return chain[0];\n}\n\nexport function assoc_in(o, keys, value) {\n  return assoc_in_with(assoc, 'assoc-in', o, keys, value);\n}\n\nexport function assoc_in_BANG_(o, keys, value) {\n  keys = vec(keys);\n  var currObj = o;\n  const baseType = typeConst(o);\n  for (const k of keys.splice(0, keys.length - 1)) {\n    let v = get(currObj, k);\n    if (v === undefined) {\n      v = emptyOfType(baseType);\n      assoc_BANG_(currObj, k, v);\n    }\n    currObj = v;\n  }\n  assoc_BANG_(currObj, keys[keys.length - 1], value);\n  return o;\n}\n\nexport function comp(...fs) {\n  fs = fs.map(toFn);\n  if (fs.length === 0) {\n    return identity;\n  } else if (fs.length === 1) {\n    return fs[0];\n  }\n  const [f, ...more] = fs.slice().reverse();\n  return function (...args) {\n    let x = f(...args);\n    for (const g of more) {\n      x = g(x);\n    }\n    return x;\n  };\n}\n\nfunction conj_BANG_set(o, rest) {\n  for (const x of rest) {\n    o.add(x);\n  }\n  return o;\n}\n\nexport function conj_BANG_(...xs) {\n  if (xs.length === 0) {\n    return vector();\n  }\n\n  const [_o, ...rest] = xs;\n\n  let o = _o;\n  if (o === null || o === undefined) {\n    o = [];\n  }\n\n  switch (typeConst(o)) {\n    case SET_TYPE:\n      conj_BANG_set(o, rest);\n      break;\n    case LIST_TYPE:\n      o.unshift(...rest.reverse());\n      break;\n    case ARRAY_TYPE:\n      o.push(...rest);\n      break;\n    case MAP_TYPE:\n      for (const x of rest) {\n        if (!Array.isArray(x))\n          iterable(x).forEach((kv) => {\n            o.set(kv[0], kv[1]);\n          });\n        else o.set(x[0], x[1]);\n      }\n      break;\n    case OBJECT_TYPE:\n      for (const x of rest) {\n        if (!Array.isArray(x)) Object.assign(o, x);\n        else o[x[0]] = x[1];\n      }\n      break;\n    default:\n      throw new Error(\n        'Illegal argument: conj! expects a Set, Array, List, Map, or Object as the first argument.'\n      );\n  }\n\n  return o;\n}\n\nexport function conj(...xs) {\n  if (xs.length === 0) {\n    return vector();\n  }\n\n  const [_o, ...rest] = xs;\n\n  let o = _o;\n  if (o === null || o === undefined) {\n    o = list();\n  }\n  let m, o2;\n\n  switch (typeConst(o)) {\n    case SET_TYPE:\n      if (o instanceof SortedSet) {\n        // prevent re-sorting of collection\n        return conj_BANG_set(new o.constructor(o), rest);\n      } else {\n        return new o.constructor([...o, ...rest]);\n      }\n    case LIST_TYPE:\n      return new List(...rest.reverse(), ...o);\n    case ARRAY_TYPE:\n      return [...o, ...rest];\n    case MAP_TYPE:\n      m = new Map(o);\n      for (const x of rest) {\n        if (!Array.isArray(x))\n          iterable(x).forEach((kv) => {\n            m.set(kv[0], kv[1]);\n          });\n        else m.set(x[0], x[1]);\n      }\n\n      return m;\n    case LAZY_ITERABLE_TYPE:\n      return lazy(function* () {\n        yield* rest;\n        yield* o;\n      });\n    case OBJECT_TYPE:\n      o2 = { ...o };\n\n      for (const x of rest) {\n        if (!Array.isArray(x)) Object.assign(o2, x);\n        else o2[x[0]] = x[1];\n      }\n\n      return o2;\n    default:\n      throw new Error(\n        'Illegal argument: conj expects a Set, Array, List, Map, or Object as the first argument.'\n      );\n  }\n}\n\nexport function disj_BANG_(s, ...xs) {\n  for (const x of xs) {\n    s.delete(x);\n  }\n  return s;\n}\n\nexport function disj(s, ...xs) {\n  const s1 = new s.constructor([...s]);\n  return disj_BANG_(s1, ...xs);\n}\n\nexport function contains_QMARK_(coll, v) {\n  switch (typeConst(coll)) {\n    case SET_TYPE:\n    case MAP_TYPE:\n      return coll.has(v);\n    case undefined:\n      return false;\n    default:\n      return v in coll;\n  }\n}\n\nexport function dissoc_BANG_(m, ...ks) {\n  for (const k of ks) {\n    delete m[k];\n  }\n\n  return m;\n}\n\nexport function dissoc(m, ...ks) {\n  if (!m) return;\n  if (ks.length === 0) return m;\n  const m2 = copy(m);\n  switch (typeConst(m)) {\n    case MAP_TYPE:\n      for (const k of ks) {\n        m2.delete(k);\n      }\n      break;\n    default:\n      for (const k of ks) {\n        delete m2[k];\n      }\n      break;\n  }\n  return m2;\n}\n\nexport function inc(n) {\n  return n + 1;\n}\n\nexport function dec(n) {\n  return n - 1;\n}\n\nexport function println(...args) {\n  console.log(...args);\n}\n\nexport function nth(coll, idx, orElse) {\n  if (coll) {\n    var elt = undefined;\n    if (Array.isArray(coll)) {\n      elt = coll[idx];\n    } else {\n      const iter = iterable(coll);\n      let i = 0;\n      for (const value of iter) {\n        if (i++ == idx) {\n          elt = value;\n          break;\n        }\n      }\n    }\n    if (elt !== undefined) {\n      return elt;\n    }\n  }\n  return orElse;\n}\n\nexport function get(coll, key, otherwise = undefined) {\n  if (coll == null) {\n    return otherwise;\n  }\n  let v;\n  // optimize for getting values out of objects\n  if (isObj(coll)) {\n    v = coll[key];\n    if (v === undefined) {\n      return otherwise;\n    } else {\n      return v;\n    }\n  }\n  let g;\n  switch (typeConst(coll)) {\n    case SET_TYPE:\n      if (coll.has(key)) v = key;\n      break;\n    case MAP_TYPE:\n      v = coll.get(key);\n      break;\n    case ARRAY_TYPE:\n      v = coll[key];\n      break;\n    default:\n      // we choose .get as the default implementation, e.g. fetch Headers are not Maps, but do implement a .get method\n      g = coll['get'];\n      if (g instanceof Function) {\n        try {\n          v = coll.get(key);\n          break;\n        } catch (e) {\n          // ignore error\n        }\n      }\n      v = coll[key];\n      break;\n  }\n  return v !== undefined ? v : otherwise;\n}\n\nexport function seq_QMARK_(x) {\n  return x != null && !!x[Symbol.iterator];\n}\n\nexport const sequential_QMARK_ = seq_QMARK_;\n\nexport function seqable_QMARK_(x) {\n  return (\n    x === null ||\n    x === undefined ||\n    // we used to check instanceof Object but this returns false for TC39 Records\n    // also we used to write `Symbol.iterator in` but this does not work for strings and some other types\n    !!x[Symbol.iterator]\n  );\n}\n\nexport function iterable(x) {\n  // nil puns to empty iterable, support passing nil to first/rest/reduce, etc.\n  if (x === null || x === undefined) {\n    return [];\n  }\n  if (seqable_QMARK_(x)) {\n    return x;\n  }\n  if (x instanceof Object) return Object.entries(x);\n  throw new TypeError(`${x} is not iterable`);\n}\n\nexport const IIterable = Symbol('Iterable');\n\nexport const IIterable__iterator = Symbol.iterator;\n\nexport function _iterator(coll) {\n  return coll[Symbol.iterator]();\n}\n\nexport const es6_iterator = _iterator;\n\nexport function seq(x) {\n  if (x == null) return x;\n  const iter = iterable(x);\n  // return nil for terminal checking\n  if (iter.length === 0 || iter.size === 0) {\n    return null;\n  }\n  const _i = iter[Symbol.iterator]();\n  if (_i.next().done) return null;\n  return iter;\n}\n\nexport function first(coll) {\n  // destructuring uses iterable protocol\n  const [first] = iterable(coll);\n  return first;\n}\n\nexport function second(coll) {\n  const [_, v] = iterable(coll);\n  return v;\n}\n\nexport function ffirst(coll) {\n  return first(first(coll));\n}\n\nexport function rest(coll) {\n  return lazy(function* () {\n    let first = true;\n    for (const x of iterable(coll)) {\n      if (first) first = false;\n      else yield x;\n    }\n  });\n}\n\nclass Reduced {\n  value;\n  constructor(x) {\n    this.value = x;\n  }\n  _deref() {\n    return this.value;\n  }\n}\n\nexport function last(coll) {\n  coll = iterable(coll);\n  let lastEl;\n  switch (typeConst(coll)) {\n    case ARRAY_TYPE:\n      return coll[coll.length - 1];\n    default:\n      for (const x of coll) {\n        lastEl = x;\n      }\n      return lastEl;\n  }\n}\n\nexport function reduced(x) {\n  return new Reduced(x);\n}\n\nexport function reduced_QMARK_(x) {\n  return x instanceof Reduced;\n}\n\nexport function reduce(f, arg1, arg2) {\n  f = toFn(f);\n  let coll, val;\n  if (arguments.length === 2) {\n    // (reduce f coll)\n    const iter = iterable(arg1)[Symbol.iterator]();\n    const vd = iter.next();\n    if (vd.done) {\n      val = f();\n    } else {\n      val = vd.value;\n    }\n    coll = iter;\n  } else {\n    // (reduce f val coll)\n    val = arg1;\n    coll = iterable(arg2);\n  }\n  if (val instanceof Reduced) {\n    return val.value;\n  }\n  for (const x of coll) {\n    val = f(val, x);\n    if (val instanceof Reduced) {\n      val = val.value;\n      break;\n    }\n  }\n  return val;\n}\n\nfunction* _reductions2(f, s) {\n  const vd = s.next();\n  if (vd.done) {\n    yield f();\n  } else {\n    yield* _reductions3(f, vd.value, s);\n  }\n}\n\nfunction* _reductions3(f, init, coll) {\n  let i = init,\n    rst = coll;\n  while (true) {\n    if (reduced_QMARK_(i)) {\n      yield i.value;\n      return;\n    } else yield i;\n    const vd = rst.next();\n    if (vd.done) {\n      break;\n    }\n    i = f(i, vd.value);\n  }\n}\n\nexport function reductions(f, arg1, arg2) {\n  f = toFn(f);\n  if (arguments.length === 2) {\n    return lazy(function* () {\n      yield* _reductions2(f, iterable(arg1)[Symbol.iterator]());\n    });\n  }\n  return lazy(function* () {\n    yield* _reductions3(f, arg1, iterable(arg2)[Symbol.iterator]());\n  });\n}\n\nvar tolr = false;\nexport function warn_on_lazy_reusage_BANG_() {\n  tolr = true;\n}\n\nclass LazyIterable {\n  constructor(gen) {\n    this.gen = gen;\n    this.usages = 0;\n  }\n  [Symbol.iterator]() {\n    this.usages++;\n    if (this.usages >= 2 && tolr) {\n      try {\n        throw new Error();\n      } catch (e) {\n        console.warn('Re-use of lazy value', e.stack);\n      }\n    }\n    return this.gen();\n  }\n}\n\nLazyIterable.prototype[IIterable] = true; // Closure compatibility\n\nexport function lazy(f) {\n  return new LazyIterable(f);\n}\n\nexport class Cons {\n  constructor(x, coll) {\n    this.x = x;\n    this.coll = coll;\n  }\n  *[Symbol.iterator]() {\n    yield this.x;\n    yield* iterable(this.coll);\n  }\n}\n\nexport function cons(x, coll) {\n  return new Cons(x, coll);\n  // return lazy(function* () {\n  //   yield x;\n  //   yield* iterable(coll);\n  // });\n}\n\nexport function map(f, ...colls) {\n  // if (! (f instanceof Function)) {\n  //   throw new Error(`Argument f must be a function but is ${typeof(f)}`);\n  // }\n  f = toFn(f);\n  switch (colls.length) {\n    case 0:\n      return (rf) => {\n        return (...args) => {\n          switch (args.length) {\n            case 0: {\n              return rf();\n            }\n            case 1: {\n              return rf(args[0]);\n            }\n            case 2: {\n              return rf(args[0], f(args[1]));\n            }\n            default: {\n              return rf(args[0], f(...args.slice(1)));\n            }\n          }\n        };\n      };\n    case 1:\n      return lazy(function* () {\n        for (const x of iterable(colls[0])) {\n          yield f(x);\n        }\n      });\n    default:\n      return lazy(function* () {\n        const iters = colls.map((coll) => es6_iterator(iterable(coll)));\n        while (true) {\n          const args = [];\n          for (const i of iters) {\n            const nextVal = i.next();\n            if (nextVal.done) {\n              return;\n            }\n            args.push(nextVal.value);\n          }\n          yield f(...args);\n        }\n      });\n  }\n}\n\nfunction filter1(pred) {\n  return (rf) => {\n    return (...args) => {\n      switch (args.length) {\n        case 0:\n          return rf();\n        case 1:\n          return rf(args[0]);\n        case 2: {\n          const result = args[0];\n          const input = args[1];\n          if (truth_(pred(input))) {\n            return rf(result, input);\n          } else return result;\n        }\n      }\n    };\n  };\n}\n\nexport function filter(pred, coll) {\n  if (arguments.length === 1) {\n    return filter1(pred);\n  }\n  pred = toFn(pred);\n  return lazy(function* () {\n    for (const x of iterable(coll)) {\n      if (truth_(pred(x))) {\n        yield x;\n      }\n    }\n  });\n}\n\nexport function filterv(pred, coll) {\n  return [...filter(pred, coll)];\n}\n\nexport function remove(pred, coll) {\n  if (arguments.length === 1) {\n    return filter1(complement(pred));\n  }\n  return filter(complement(pred), coll);\n}\n\nfunction map_indexed1(f) {\n  return (rf) => {\n    let i = -1;\n    return (...args) => {\n      switch (args.length) {\n        case 0:\n          return rf();\n        case 1:\n          return rf(args[0]);\n        case 2:\n          return rf(args[0], f(((i = i + 1), i), args[1]));\n      }\n    };\n  };\n}\n\nexport function map_indexed(f, coll) {\n  f = toFn(f);\n  if (arguments.length === 1) {\n    return map_indexed1(f);\n  }\n  return lazy(function* () {\n    let idx = 0;\n    for (const i of iterable(coll)) {\n      yield f(idx, i);\n      idx++;\n    }\n  });\n}\n\nfunction keep_indexed2(f, coll) {\n  f = toFn(f);\n  return lazy(function* () {\n    let idx = 0;\n    for (const i of iterable(coll)) {\n      const v = f(idx, i);\n      if (truth_(v)) yield v;\n      idx++;\n    }\n  });\n}\n\nfunction keep_indexed1(f) {\n  return (rf) => {\n    let ia = -1;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) {\n        return rf();\n      }\n      if (al === 1) {\n        return rf(args[0]);\n      }\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        ia++;\n        const v = f(ia, input);\n        if (v == null) {\n          return result;\n        }\n        return rf(result, v);\n      }\n    };\n  };\n}\n\nexport function keep_indexed(f, coll) {\n  if (arguments.length === 1) {\n    return keep_indexed1(f);\n  } else {\n    return keep_indexed2(f, coll);\n  }\n}\n\nexport function str(...xs) {\n  return xs.join('');\n}\n\nexport function not(expr) {\n  return !truth_(expr);\n}\n\nexport function nil_QMARK_(v) {\n  return v == null;\n}\n\nexport const PROTOCOL_SENTINEL = {};\n\nfunction pr_str_1(x) {\n  if (x === null) {\n    return 'null';\n  }\n  return JSON.stringify(x, (_key, value) => {\n    switch (typeConst(value)) {\n      case SET_TYPE:\n      case LAZY_ITERABLE_TYPE:\n        return [...value];\n      case MAP_TYPE:\n        return Object.fromEntries(value);\n      default: {\n        // console.log(value);\n        return value;\n      }\n    }\n  });\n}\n\nexport function pr_str(...xs) {\n  return xs.map(pr_str_1).join(' ');\n}\n\nexport function prn(...xs) {\n  println(pr_str(...xs));\n}\n\nexport class Atom {\n  constructor(init) {\n    this.val = init;\n    this._watches = {};\n    this._deref = () => this.val;\n    this._hasWatches = false;\n    this._reset_BANG_ = (x) => {\n      const old_val = this.val;\n      this.val = x;\n      if (this._hasWatches) {\n        for (const entry of Object.entries(this._watches)) {\n          const k = entry[0];\n          const f = entry[1];\n          f(k, this, old_val, x);\n        }\n      }\n      return x;\n    };\n    this._add_watch = (k, fn) => {\n      this._watches[k] = fn;\n      this._hasWatches = true;\n    };\n    this._remove_watch = (k) => {\n      delete this._watches[k];\n    };\n  }\n}\n\nexport function atom(init) {\n  return new Atom(init);\n}\n\nexport function deref(ref) {\n  return ref._deref();\n}\n\nexport function reset_BANG_(atm, v) {\n  atm._reset_BANG_(v);\n}\n\nexport function swap_BANG_(atm, f, ...args) {\n  f = toFn(f);\n  const v = f(deref(atm), ...args);\n  reset_BANG_(atm, v);\n  return v;\n}\n\nexport function range(begin, end, step) {\n  return lazy(function* () {\n    let b = begin,\n      e = end,\n      s = step;\n    if (end === undefined) {\n      b = 0;\n      e = begin;\n    }\n    let i = b || 0;\n    s = step ?? 1;\n    const ascending = s >= 0;\n    while (e === undefined || (ascending && i < e) || (!ascending && e < i)) {\n      yield i;\n      i += s;\n    }\n  });\n}\n\nexport function re_matches(re, s) {\n  const matches = re.exec(s);\n  if (matches && s === matches[0]) {\n    if (matches.length === 1) {\n      return matches[0];\n    } else {\n      return matches;\n    }\n  }\n  return null;\n}\n\nexport function re_find(re, s) {\n  if (string_QMARK_(s)) {\n    const matches = re.exec(s);\n    if (matches != null) {\n      if (matches.length === 1) return matches[0];\n      else {\n        return [...matches];\n      }\n    }\n    return null;\n  } else {\n    throw new TypeError('re-find must match against a string.');\n  }\n}\n\nexport function re_pattern(s) {\n  if (s instanceof RegExp) {\n    return s;\n  }\n\n  // Allow all flags available in JavaScript\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/RegExp#flags\n  const flagMatches = s.match(/^\\(\\?([dgimsuvy]*)\\)/);\n\n  if (flagMatches) {\n    return new RegExp(s.slice(flagMatches[0].length), flagMatches[1]);\n  }\n\n  return new RegExp(s);\n}\n\nexport function subvec(arr, start, end) {\n  return arr.slice(start, end);\n}\n\nexport function vector(...args) {\n  return args;\n}\n\nexport function vector_QMARK_(x) {\n  return typeConst(x) === ARRAY_TYPE;\n}\n\nexport function mapv(...args) {\n  if (args.length === 2) {\n    const [f, coll] = args;\n    const iter = iterable(coll);\n    if (Array.isArray(iter)) {\n      const ret = new Array(iter.length);\n      for (var i = 0; i < iter.length; i++) {\n        ret[i] = f(iter[i]);\n      }\n      return ret;\n    } else {\n      var ret = [];\n      for (const x of iter) {\n        ret.push(f(x));\n      }\n      return ret;\n    }\n  }\n  return [...map(...args)];\n}\n\nexport function vec(x) {\n  if (array_QMARK_(x)) {\n    // return original, no need to clone the entire thing\n    return x;\n  }\n  return [...iterable(x)];\n}\n\nexport function set(coll) {\n  return new Set(iterable(coll));\n}\n\nexport function set_QMARK_(x) {\n  return typeConst(x) === SET_TYPE;\n}\n\nconst IApply__apply = Symbol('IApply__apply');\n\nexport function apply(f, ...args) {\n  f = toFn(f);\n  const xs = args.slice(0, args.length - 1);\n  const coll = iterable(args[args.length - 1]);\n  const af = f[IApply__apply];\n  if (af) {\n    return af(...xs, coll);\n  }\n  return f(...xs, ...coll);\n}\n\nexport function even_QMARK_(x) {\n  return x % 2 == 0;\n}\n\nexport function odd_QMARK_(x) {\n  return !even_QMARK_(x);\n}\n\nexport function complement(f) {\n  f = toFn(f);\n  return (...args) => not(f(...args));\n}\n\nexport function constantly(x) {\n  return (..._) => x;\n}\n\nclass List extends Array {\n  constructor(...args) {\n    super();\n    this.push(...args);\n  }\n}\n\nexport function list_QMARK_(x) {\n  return typeConst(x) === LIST_TYPE;\n}\n\nexport function list(...args) {\n  return new List(...args);\n}\n\nexport function array_QMARK_(x) {\n  return Array.isArray(x);\n}\n\nfunction concat1(colls) {\n  return lazy(function* () {\n    for (const coll of colls) {\n      yield* iterable(coll);\n    }\n  });\n}\n\nexport function concat(...colls) {\n  return concat1(colls);\n}\n\n// lazy seqable argument\nconcat[IApply__apply] = (colls) => {\n  return concat1(colls);\n};\n\nexport function mapcat(f, ...colls) {\n  if (colls.length === 0) {\n    return comp(map(f), cat);\n  } else {\n    const mapped = map(f, ...colls);\n    return concat1(mapped);\n  }\n}\n\nexport function identity(x) {\n  return x;\n}\n\nexport function interleave(...colls) {\n  return lazy(function* () {\n    const iters = colls.map((coll) => es6_iterator(iterable(coll)));\n    while (true) {\n      const res = [];\n      for (const i of iters) {\n        const nextVal = i.next();\n        if (nextVal.done) {\n          return;\n        }\n        res.push(nextVal.value);\n      }\n      yield* res;\n    }\n  });\n}\n\nfunction interpose1(sep) {\n  return (rf) => {\n    let started = false;\n    return (...args) => {\n      switch (args.length) {\n        case 0:\n          return rf();\n        case 1:\n          return rf(args[0]);\n        case 2: {\n          if (started) {\n            const sepr = rf(args[0], sep);\n            if (reduced_QMARK_(sepr)) {\n              return sepr;\n            } else {\n              return rf(sepr, args[1]);\n            }\n          } else {\n            started = true;\n            return rf(args[0], args[1]);\n          }\n        }\n      }\n    };\n  };\n}\n\nexport function interpose(sep, coll) {\n  if (arguments.length === 1) return interpose1(sep);\n  return drop(1, interleave(repeat(sep), coll));\n}\n\nexport function select_keys(o, ks) {\n  const type = typeConst(o);\n  // ret could be object or array, but in the future, maybe we'll have an IEmpty protocol\n  const ret = emptyOfType(type) || {};\n  for (const k of ks) {\n    const v = get(o, k);\n    if (v != undefined) {\n      assoc_BANG_(ret, k, v);\n    }\n  }\n  return ret;\n}\n\nexport function unreduced(x) {\n  if (reduced_QMARK_(x)) {\n    return deref(x);\n  } else {\n    return x;\n  }\n}\n\nfunction partition_all1(n) {\n  return (rf) => {\n    let a = [];\n    return (...args) => {\n      let result, v;\n      switch (args.length) {\n        case 0:\n          return rf();\n        case 1: {\n          result = args[0];\n          if (a.length !== 0) {\n            v = [...a];\n            a = [];\n            result = unreduced(rf(result, v));\n          }\n          return rf(result);\n        }\n        case 2: {\n          result = args[0];\n          a.push(args[1]);\n          if (n === a.length) {\n            v = [...a];\n            a = [];\n            return rf(result, v);\n          } else {\n            return result;\n          }\n        }\n      }\n    };\n  };\n}\n\nexport function partition_all(n, ...args) {\n  if (arguments.length === 1) {\n    return partition_all1(n);\n  }\n  let step = n,\n    coll = args[0];\n\n  if (args.length === 2) {\n    [step, coll] = args;\n  }\n  return partitionInternal(n, step, [], coll, true);\n}\n\nexport function partition(n, ...args) {\n  let step = n,\n    pad = [],\n    coll = args[0];\n\n  if (args.length === 2) {\n    [step, coll] = args;\n  } else if (args.length > 2) {\n    [step, pad, coll] = args;\n  }\n  return partitionInternal(n, step, pad, coll, false);\n}\n\nexport const partitionv = partition; // partition already returns a lazy of arrays\nexport const partitionv_all = partition_all;\n\nfunction partitionInternal(n, step, pad, coll, all) {\n  return lazy(function* () {\n    let p = [];\n    let i = 0;\n    for (const x of iterable(coll)) {\n      if (i < n) {\n        p.push(x);\n        if (p.length === n) {\n          yield p;\n          p = step < n ? p.slice(step) : [];\n        }\n      }\n      i++;\n      if (i === step) {\n        i = 0;\n      }\n    }\n\n    if (p.length > 0) {\n      if (p.length === n || all) {\n        yield p;\n      } else if (pad.length) {\n        p.push(...pad.slice(0, n - p.length));\n        yield p;\n      }\n    }\n  });\n}\n\nfunction partition_by1(f) {\n  return (rf) => {\n    let a = [];\n    const none = {};\n    let pa = none;\n    return (...args) => {\n      const l = args.length;\n      if (l === 0) {\n        return rf();\n      }\n      if (l === 1) {\n        let result = args[0];\n        if (a.length !== 0) {\n          const v = [...a];\n          a = [];\n          result = unreduced(rf(result, v));\n        }\n        return rf(result);\n      }\n      if (l === 2) {\n        const result = args[0];\n        const input = args[1];\n        const pval = pa;\n        const val = f(input);\n        pa = val;\n        if (pval === none || val === pval) {\n          a.push(input);\n          return result;\n        } else {\n          const v = [...a];\n          a = [];\n          const ret = rf(result, v);\n          if (!reduced_QMARK_(ret)) {\n            a.push(input);\n          }\n          return ret;\n        }\n      }\n    };\n  };\n}\n\nexport function partition_by(f, coll) {\n  f = toFn(f);\n  if (arguments.length === 1) {\n    return partition_by1(f);\n  }\n  return lazy(function* () {\n    const iter = es6_iterator(coll);\n    const _fst = iter.next();\n    if (_fst.done) {\n      yield* null;\n    }\n    const fst = _fst.value;\n    let fv = f(fst);\n    let run = [fst];\n    let rst = [];\n    while (true) {\n      const next = iter.next();\n      if (next.done) {\n        yield run;\n        break;\n      }\n      const _v = next.value;\n      const _fv = f(_v);\n      if (fv == _fv) {\n        run.push(_v);\n      } else {\n        yield run;\n        rst.push(_v);\n        run = rst;\n        fv = _fv;\n        rst = [];\n      }\n    }\n  });\n}\n\nexport function empty(coll) {\n  const type = typeConst(coll);\n  if (type != null) {\n    return emptyOfType(type);\n  } else {\n    throw new Error(`Can't create empty of ${typeof coll}`);\n  }\n}\n\nexport function merge(...args) {\n  // if the first arg is nil we coerce it into a map.\n  const firstArg = args[0];\n  let obj;\n  if (firstArg === null || firstArg === undefined) {\n    obj = {};\n  } else {\n    obj = into(empty(firstArg), firstArg);\n  }\n  return conj_BANG_(obj, ...args.slice(1));\n}\n\nexport function key(entry) {\n  return entry[0];\n}\n\nexport function val(entry) {\n  return entry[1];\n}\n\nexport function merge_with(f, ...maps) {\n  f = toFn(f);\n  var hasMap = false;\n  for (const m of maps) {\n    if (m != null) {\n      hasMap = true;\n      break;\n    }\n  }\n  if (hasMap) {\n    const mergeEntry = (m, e) => {\n      const k = key(e);\n      const v = val(e);\n      if (contains_QMARK_(m, k)) {\n        return assoc(m, k, f(get(m, k), v));\n      } else {\n        return assoc(m, k, v);\n      }\n    };\n    const merge2 = (m1, m2) => {\n      return reduce(mergeEntry, m1 || {}, seq(m2));\n    };\n    return reduce(merge2, maps);\n  } else {\n    return null;\n  }\n}\n\nexport function system_time() {\n  return performance.now();\n}\n\nexport function into(...args) {\n  let to, xform, from, c, rf;\n  switch (args.length) {\n    case 0:\n      return [];\n    case 1:\n      return args[0];\n    case 2:\n      return conj(args[0] ?? [], ...iterable(args[1]));\n    case 3:\n      to = args[0];\n      xform = args[1];\n      from = args[2];\n      c = copy(to);\n      rf = (coll, v) => {\n        if (v === undefined) {\n          return coll;\n        }\n        return conj_BANG_(coll, v);\n      };\n      return transduce(xform, rf, c, from);\n    default:\n      throw TypeError(`Invalid arity call of into: ${args.length}`);\n  }\n}\n\nexport function identical_QMARK_(x, y) {\n  return x === y;\n}\n\nexport function repeat(...args) {\n  if (args.length == 0 || args.length > 2) {\n    throw new Error(`Invalid arity: ${args.length}`);\n  }\n\n  return {\n    [IIterable]: true,\n    [IIterable__iterator]:\n      args.length == 1\n        ? function* () {\n            const x = args[0];\n            while (true) yield x;\n          }\n        : function* () {\n            const [n, x] = args;\n            for (var i = 0; i < n; i++) yield x;\n          },\n  };\n}\n\nexport function ensure_reduced(x) {\n  if (reduced_QMARK_(x)) {\n    return x;\n  } else {\n    return reduced(x);\n  }\n}\n\nfunction take1(n) {\n  return (rf) => {\n    let na = n;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) {\n        return rf();\n      }\n      if (al === 1) {\n        const result = args[0];\n        return rf(result);\n      }\n      if (al === 2) {\n        let result = args[0];\n        const input = args[1];\n        const n = na;\n        const nn = ((na = na - 1), na);\n        if (n > 0) {\n          result = rf(result, input);\n        }\n        if (!(nn > 0)) {\n          return ensure_reduced(result);\n        } else {\n          return result;\n        }\n      }\n    };\n  };\n}\n\nexport function take(n, coll) {\n  if (arguments.length === 1) {\n    return take1(n);\n  }\n  return lazy(function* () {\n    let i = n - 1;\n    for (const x of iterable(coll)) {\n      if (i-- >= 0) {\n        yield x;\n      }\n      if (i < 0) {\n        return;\n      }\n    }\n  });\n}\n\nexport function take_last(n, coll) {\n  if (n == 0) {\n    return null;\n  }\n  if (Array.isArray(coll)) {\n    return seq(coll.slice(-Math.abs(n)));\n  } else {\n    let lastN = new Array(n);\n    let i = 0;\n    for (const x of iterable(coll)) {\n      lastN[i % n] = x;\n      i++;\n    }\n    if (i % n !== 0 && i >= n) {\n      return lastN.slice(i % n).concat(lastN.slice(0, i % n));\n    } else {\n      lastN.length = Math.min(i, n);\n      return lastN;\n    }\n  }\n}\n\nfunction take_while1(pred) {\n  return (rf) => {\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) return rf();\n      if (al === 1) return rf(args[0]);\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        if (truth_(pred(input))) {\n          return rf(result, input);\n        } else {\n          return reduced(result);\n        }\n      }\n    };\n  };\n}\n\nexport function take_while(pred, coll) {\n  pred = toFn(pred);\n  if (arguments.length === 1) {\n    return take_while1(pred);\n  }\n  return lazy(function* () {\n    for (const o of iterable(coll)) {\n      if (truth_(pred(o))) yield o;\n      else return;\n    }\n  });\n}\n\nfunction take_nth1(n) {\n  return (rf) => {\n    let ia = -1;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) return rf();\n      if (al === 1) return rf(args[0]);\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        ia++;\n        const i = ia;\n        if (rem(i, n) === 0) {\n          return rf(result, input);\n        } else return result;\n      }\n    };\n  };\n}\n\nexport function take_nth(n, coll) {\n  if (arguments.length === 1) return take_nth1(n);\n  if (n <= 0) {\n    return repeat(first(coll));\n  }\n\n  return lazy(function* () {\n    let i = 0;\n    for (const x of iterable(coll)) {\n      if (i % n === 0) {\n        yield x;\n      }\n      i++;\n    }\n  });\n}\n\nexport function partial(f, ...xs) {\n  f = toFn(f);\n  return function (...args) {\n    return f(...xs, ...args);\n  };\n}\n\nexport function cycle(coll) {\n  return lazy(function* () {\n    while (true) yield* coll;\n  });\n}\n\nfunction drop1(n) {\n  return (rf) => {\n    let na = n;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) {\n        return rf();\n      }\n      if (al === 1) {\n        return rf(args[0]);\n      }\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        const n = na;\n        na--;\n        if (n > 0) {\n          return result;\n        } else return rf(result, input);\n      }\n    };\n  };\n}\n\nexport function drop(n, xs) {\n  if (arguments.length === 1) return drop1(n);\n  return lazy(function* () {\n    const iter = _iterator(iterable(xs));\n    for (let x = 0; x < n; x++) {\n      iter.next();\n    }\n    yield* iter;\n  });\n}\n\nfunction drop_while1(pred) {\n  return (rf) => {\n    let da = true;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) {\n        return rf();\n      }\n      if (al === 1) {\n        return rf(args[0]);\n      }\n      if (al === 2) {\n        const isDrop = da;\n        const result = args[0];\n        const input = args[1];\n        if (isDrop && truth_(pred(input))) {\n          return result;\n        } else {\n          da = null;\n          return rf(result, input);\n        }\n      }\n    };\n  };\n}\n\nexport function drop_while(pred, xs) {\n  pred = toFn(pred);\n  if (arguments.length === 1) return drop_while1(pred);\n  return lazy(function* () {\n    const iter = _iterator(iterable(xs));\n    while (true) {\n      const nextItem = iter.next();\n      if (nextItem.done) {\n        break;\n      }\n      const value = nextItem.value;\n      if (!truth_(pred(value))) {\n        yield value;\n        break;\n      }\n    }\n    yield* iter;\n  });\n}\n\nfunction distinct1() {\n  return (rf) => {\n    const seen = new Set();\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) return rf();\n      if (al === 1) return rf(args[0]);\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        if (seen.has(input)) return result;\n        seen.add(input);\n        return rf(result, input);\n      }\n    };\n  };\n}\n\nexport function distinct(coll) {\n  if (arguments.length === 0) return distinct1();\n  return lazy(function* () {\n    const seen = new Set();\n    for (const x of iterable(coll)) {\n      if (!seen.has(x)) yield x;\n      seen.add(x);\n    }\n    return;\n  });\n}\n\nexport function update(coll, k, f, ...args) {\n  f = toFn(f);\n  return assoc(coll, k, f(get(coll, k), ...args));\n}\n\nexport function get_in(coll, path, orElse) {\n  let entry = coll;\n  for (const item of path) {\n    entry = get(entry, item);\n  }\n  if (entry === undefined) return orElse;\n  return entry;\n}\n\nexport function update_in(coll, path, f, ...args) {\n  f = toFn(f);\n  return assoc_in(coll, path, f(get_in(coll, path), ...args));\n}\n\nexport function fnil(f, x, ...xs) {\n  f = toFn(f);\n  return function (a, ...args) {\n    if (!a) {\n      return f(x, ...xs, ...args);\n    } else {\n      return f(a, ...xs, ...args);\n    }\n  };\n}\n\nexport function every_QMARK_(pred, coll) {\n  pred = toFn(pred);\n  for (const x of iterable(coll)) {\n    if (!pred(x)) return false;\n  }\n  return true;\n}\n\nexport function not_every_QMARK_(pred, coll) {\n  return !every_QMARK_(pred, coll);\n}\n\nfunction keep1(pred) {\n  return (rf) => {\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) return rf();\n      if (al === 1) return rf(args[0]);\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        const v = pred(input);\n        if (v == null) return result;\n        return rf(result, v);\n      }\n    };\n  };\n}\n\nexport function keep(pred, coll) {\n  pred = toFn(pred);\n  if (arguments.length === 1) return keep1(pred);\n  return lazy(function* () {\n    for (const o of iterable(coll)) {\n      const res = pred(o);\n      if (truth_(res)) yield res;\n    }\n  });\n}\n\nexport function reverse(coll) {\n  coll = iterable(coll);\n  return [...coll].reverse();\n}\n\nexport function sort(f, coll) {\n  if (arguments.length === 1) {\n    coll = f;\n    f = undefined;\n  }\n  f = toFn(f);\n  coll = iterable(coll);\n  // we need to clone coll since .sort works in place and .toSorted isn't available on Node < 20\n  const clone = [...coll];\n  // result is guaranteed to be stable since ES2019, like CLJS\n  return clone.sort(f || compare);\n}\n\nfunction fnToComparator(f) {\n  if (f === compare) {\n    return f;\n  }\n  return (x, y) => {\n    const r = f(x, y);\n    if (number_QMARK_(r)) {\n      return r;\n    }\n    if (r) {\n      return -1;\n    }\n    if (f(y, x)) {\n      return 1;\n    }\n    return 0;\n  };\n}\n\nexport function sort_by(keyfn, comp, coll) {\n  if (arguments.length === 2) {\n    coll = comp;\n    comp = compare;\n  }\n  keyfn = toFn(keyfn);\n  comp = toFn(comp);\n  return sort((x, y) => {\n    const f = fnToComparator(comp);\n    const kx = keyfn(x);\n    const ky = keyfn(y);\n    return f(kx, ky);\n  }, coll);\n}\n\nexport function shuffle(coll) {\n  const result = [...coll];\n  let remaining = coll.length;\n  while (remaining) {\n    const i = Math.floor(Math.random() * remaining--);\n    const tmp = result[remaining];\n    result[remaining] = result[i];\n    result[i] = tmp;\n  }\n\n  return result;\n}\n\nexport function some(pred, coll) {\n  pred = toFn(pred);\n  for (const o of iterable(coll)) {\n    const res = pred(o);\n    if (truth_(res)) return res;\n  }\n  return undefined;\n}\n\nexport function not_any_QMARK_(pred, coll) {\n  pred = toFn(pred);\n  return !some(pred, coll);\n}\n\nexport function replace(smap, coll) {\n  const mapf = Array.isArray(coll) ? mapv : map;\n  return mapf((x) => {\n    const repl = smap[x];\n    if (repl !== undefined) {\n      return repl;\n    } else {\n      return x;\n    }\n  }, coll);\n}\n\nexport function empty_QMARK_(coll) {\n  return seq(coll) ? false : true;\n}\n\nexport function rand_int(n) {\n  return Math.floor(Math.random() * n);\n}\n\nexport function rand_nth(coll) {\n  const ri = rand_int(count(coll));\n  return nth(coll, ri);\n}\n\nfunction _repeatedly(f) {\n  return lazy(function* () {\n    while (true) yield f();\n  });\n}\n\nexport function repeatedly(n, f) {\n  if (arguments.length === 1) {\n    f = n;\n    n = undefined;\n  }\n  const res = _repeatedly(f);\n  if (n) {\n    return take(n, res);\n  } else {\n    return res;\n  }\n}\n\nexport function update_BANG_(m, k, f, ...args) {\n  const v = get(m, k);\n  return assoc_BANG_(m, k, f(v, ...args));\n}\n\nexport function group_by(f, coll) {\n  f = toFn(f);\n  const res = {};\n  for (const o of iterable(coll)) {\n    const key = f(o);\n    update_BANG_(res, key, fnil(conj_BANG_, []), o);\n  }\n  return res;\n}\n\nexport function frequencies(coll) {\n  const res = {};\n  const uf = fnil(inc, 0);\n  for (const o of iterable(coll)) {\n    update_BANG_(res, o, uf);\n  }\n  return res;\n}\n\nexport class LazySeq {\n  constructor(f) {\n    this.f = f;\n    this.res = undefined;\n  }\n  *[Symbol.iterator]() {\n    if (this.res === undefined) {\n      this.res = this.f();\n      this.f = null;\n    }\n    yield* iterable(this.res);\n  }\n}\n\nexport function butlast(coll) {\n  const x = [...iterable(coll)];\n  x.pop();\n  return x.length > 0 ? x : null;\n}\n\nexport function drop_last(...args) {\n  const [n, coll] = args.length > 1 ? args : [1, args[0]];\n  return map((x, _) => x, coll, drop(n, coll));\n}\n\nexport function split_at(n, coll) {\n  return [take(n, coll), drop(n, coll)];\n}\n\nexport function split_with(pred, coll) {\n  return [take_while(pred, coll), drop_while(pred, coll)];\n}\n\nexport function count(coll) {\n  if (!coll) return 0;\n  const len = coll.length || coll.size;\n  if (typeof len === 'number') {\n    return len;\n  }\n  let ret = 0;\n  for (const _ of iterable(coll)) {\n    ret++;\n  }\n  return ret;\n}\n\nexport function true_QMARK_(x) {\n  return x === true;\n}\n\nexport function false_QMARK_(x) {\n  return x === false;\n}\n\nexport function some_QMARK_(x) {\n  return !(x === null || x === undefined);\n}\n\nexport function boolean$(x) {\n  return !!x;\n}\n\nexport function zero_QMARK_(x) {\n  return x === 0;\n}\n\nexport function neg_QMARK_(x) {\n  return x < 0;\n}\n\nexport function pos_QMARK_(x) {\n  return x > 0;\n}\n\nexport function js_obj(...args) {\n  let ctr = 0;\n  const ret = {};\n  for (;;) {\n    if (ctr >= args.length) {\n      break;\n    }\n    ret[args[ctr]] = args[ctr + 1];\n    ctr = ctr + 2;\n  }\n  return ret;\n}\n\nexport function alength(arr) {\n  return arr.length;\n}\n\nexport function aset(arr, idx, val, ...more) {\n  if (more.length == 0) {\n    arr[idx] = val;\n    return val;\n  } else {\n    const path = [idx, val, ...more];\n    const _val = path[path.length - 1];\n    let innerArray = arr;\n    let _idx = 0;\n    const _pathLen = path.length - 2;\n    for (; _idx < _pathLen; _idx++) {\n      innerArray = innerArray[path[_idx]];\n    }\n    innerArray[path[_idx]] = _val;\n    return val;\n  }\n}\n\nexport function dorun(x) {\n  for (const _ of iterable(x)) {\n    // nothing here, just consume for side effects\n  }\n  return null;\n}\n\nexport function doall(x) {\n  // realize as concrete array\n  return vec(x);\n}\n\nexport function aclone(arr) {\n  const cloned = [...arr];\n  return cloned;\n}\n\nexport function add_watch(ref, key, fn) {\n  return ref._add_watch(key, fn);\n}\n\nexport function remove_watch(ref, key) {\n  return ref._remove_watch(key);\n}\n\nexport function reduce_kv(f, init, m) {\n  if (!m) {\n    return init;\n  }\n  var ret = init;\n  for (const o of iterable(m)) {\n    ret = f(ret, o[0], o[1]);\n  }\n  return ret;\n}\n\nexport function max(x, y, ...more) {\n  if (y == undefined) {\n    return x;\n  }\n  return Math.max(x, y, ...more);\n}\n\nexport function min(x, y, ...more) {\n  if (y == undefined) {\n    return x;\n  }\n  return Math.min(x, y, ...more);\n}\n\nexport function map_QMARK_(coll) {\n  if (coll == null) return false;\n  if (isObj(coll)) return true;\n  if (coll instanceof Map) return true;\n  return false;\n}\n\nexport function every_pred(...preds) {\n  return (...args) => {\n    for (const p of preds) {\n      for (const a of args) {\n        const res = p(a);\n        if (!res) {\n          return false;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nexport function some_fn(...fns) {\n  return (...args) => {\n    for (const f of fns) {\n      for (const a of args) {\n        const res = f(a);\n        if (res) {\n          return res;\n        }\n      }\n    }\n    return undefined;\n  };\n}\n\nexport function into_array(type, aseq) {\n  const theSeq = aseq || type;\n  return vec(theSeq);\n}\n\nexport function iterate(f, x) {\n  var current = x;\n  return lazy(function* () {\n    while (true) {\n      yield current;\n      current = f(current);\n    }\n  });\n}\n\nexport function juxt(...fs) {\n  fs = fs.map(toFn);\n  return (...args) => {\n    const ret = [];\n    for (const f of fs) {\n      ret.push(f(...args));\n    }\n    return ret;\n  };\n}\n\nexport function next(x) {\n  if (Array.isArray(x)) {\n    const ret = x.slice(1);\n    if (ret.length > 0) {\n      return ret;\n    } else {\n      return null;\n    }\n  } else {\n    return seq(rest(x));\n  }\n}\n\nexport function nnext(x) {\n  return next(next(x));\n}\n\nexport function compare(x, y) {\n  if (x === y) {\n    return 0;\n  } else {\n    if (x == null) {\n      return -1;\n    }\n    if (y == null) {\n      return 1;\n    }\n    const tx = typeof x;\n    const ty = typeof y;\n    if ((tx === 'number' && ty === 'number') || (tx === 'string' && ty === 'string')) {\n      if (x === y) {\n        return 0;\n      }\n      if (x < y) {\n        return -1;\n      }\n      return 1;\n    } else if (Array.isArray(x) && Array.isArray(y)) {\n      // Implemented like `APersistentVector.compareTo`.\n      if (x.length < y.length) {\n        return -1;\n      } else if (x.length > y.length) {\n        return 1;\n      } else {\n        for (let i = 0; i < x.length; i++) {\n          const c = compare(x[i], y[i]);\n          if (c != 0) {\n            return c;\n          }\n        }\n        return 0;\n      }\n    } else {\n      throw new Error(`comparing ${tx} to ${ty}`);\n    }\n  }\n}\n\nexport function to_array(aseq) {\n  return into_array(aseq);\n}\n\nexport function truth_(x) {\n  return x != null && x !== false;\n}\n\nexport const t = truth_; // backward compat, remove in 2025\n\nexport function subs(s, start, end) {\n  return s.substring(start, end);\n}\n\nexport function fn_QMARK_(x) {\n  return 'function' === typeof x;\n}\n\nexport function re_seq(re, s) {\n  return lazy(function* () {\n    while (true) {\n      const matches = re.exec(s);\n      if (matches) {\n        const match_str = matches[0];\n        const match_vals = matches.length === 1 ? match_str : vec(matches);\n        yield match_vals;\n        const post_idx = matches.index + max(1, match_str.length);\n        if (post_idx > s.length) break;\n        s = subs(s, post_idx);\n      } else break;\n    }\n  });\n}\n\nexport function NaN_QMARK_(x) {\n  return Number.isNaN(x);\n}\n\nexport function number_QMARK_(x) {\n  return typeof x == 'number';\n}\n\nexport function keys(obj) {\n  if (obj == null) return;\n  const t = typeConst(obj);\n  switch (t) {\n    case OBJECT_TYPE:\n      return Object.keys(obj);\n    case MAP_TYPE:\n      return Array.from(obj.keys());\n  }\n}\n\nexport function js_keys(obj) {\n  return keys(obj);\n}\n\nexport function vals(obj) {\n  if (obj == null) return;\n  const t = typeConst(obj);\n  switch (t) {\n    case OBJECT_TYPE:\n      return Object.values(obj);\n    case MAP_TYPE:\n      return Array.from(obj.values());\n  }\n}\n\nexport function string_QMARK_(s) {\n  return typeof s === 'string';\n}\n\nexport function coll_QMARK_(coll) {\n  return typeConst(coll) != undefined;\n}\n\nexport function regexp_QMARK_(coll) {\n  return coll instanceof RegExp;\n}\n\nclass ExceptionInfo extends Error {\n  constructor(message, data, cause) {\n    super(message);\n    this._data = data;\n    this._cause = cause;\n  }\n}\n\nexport function ex_data(e) {\n  if (e instanceof ExceptionInfo) return e._data;\n  else return null;\n}\n\nexport function ex_message(e) {\n  if (e instanceof Error) return e.message;\n  else return null;\n}\n\nexport function ex_cause(e) {\n  if (e instanceof ExceptionInfo) return e._cause;\n  else return null;\n}\n\nexport function ex_info(message, data, cause) {\n  return new ExceptionInfo(message, data, cause);\n}\n\nexport function int_QMARK_(x) {\n  return Number.isInteger(x);\n}\n\nexport const integer_QMARK_ = int_QMARK_;\n\nconst _metaSym = Symbol('meta');\n\nexport function meta(x) {\n  if (x instanceof Object) {\n    return x[_metaSym];\n  } else return null;\n}\n\nexport function with_meta(x, m) {\n  const ret = copy(x);\n  ret[_metaSym] = m;\n  return ret;\n}\n\nexport function boolean_QMARK_(x) {\n  return x === true || x === false;\n}\n\nexport function counted_QMARK_(x) {\n  const tc = typeConst(x);\n  switch (tc) {\n    case ARRAY_TYPE:\n    case MAP_TYPE:\n    case OBJECT_TYPE:\n    case LIST_TYPE:\n    case SET_TYPE:\n      return true;\n  }\n  return false;\n}\n\nexport function bounded_count(n, coll) {\n  if (counted_QMARK_(coll)) {\n    return count(coll);\n  } else {\n    return count(take(n, coll));\n  }\n}\n\nexport function find(m, k) {\n  const v = get(m, k);\n  if (v !== undefined) {\n    return [k, v];\n  }\n}\n\nexport function mod(x, y) {\n  return ((x % y) + y) % y;\n}\n\nexport function min_key(k, x, ...more) {\n  if (more.length == 0) {\n    return x;\n  }\n  var kx = k(x);\n  var min = x;\n  more.forEach((y) => {\n    var ky = k(y);\n    if (ky <= kx) {\n      kx = ky;\n      min = y;\n    }\n  });\n  return min;\n}\n\nexport function max_key(k, x, ...more) {\n  if (more.length == 0) {\n    return x;\n  }\n  var kx = k(x);\n  var max = x;\n  more.forEach((y) => {\n    var ky = k(y);\n    if (ky >= kx) {\n      kx = ky;\n      max = y;\n    }\n  });\n  return max;\n}\n\nfunction parsing_err(x) {\n  throw new Error(`Expected string, got: ${typeof x}`);\n}\n\nexport function parse_long(s) {\n  if (string_QMARK_(s)) {\n    if (/^[+-]?\\d+$/.test(s)) {\n      const i = parseInt(s);\n      if (Number.MIN_SAFE_INTEGER <= i <= Number.MAX_SAFE_INTEGER) {\n        return i;\n      }\n    }\n    return null;\n  }\n  return parsing_err(s);\n}\n\nexport function parse_double(s) {\n  if (string_QMARK_(s)) {\n    if (/^[\\\\x00-\\\\x20]*[+-]?NaN[\\\\x00-\\\\x20]*$/.test(s)) {\n      return NaN;\n    } else if (\n      /^[\\\\x00-\\\\x20]*[+-]?(Infinity|((\\d+\\.?\\d*|\\.\\d+)([eE][+-]?\\d+)?)[dDfF]?)[\\\\x00-\\\\x20]*$/.test(\n        s\n      )\n    ) {\n      return parseFloat(s);\n    } else {\n      return null;\n    }\n  } else {\n    throw new parsing_err(s);\n  }\n}\n\nfunction fix(q) {\n  if (q >= 0) {\n    return Math.floor(q);\n  }\n  return Math.ceil(q);\n}\n\nexport function quot(n, d) {\n  const rem = n % d;\n  return fix((n - rem) / d);\n}\n\nexport function trampoline(f, ...args) {\n  if (args.length == 0) {\n    while (true) {\n      const ret = f();\n      if (truth_(fn_QMARK_(ret))) {\n        f = ret;\n        continue;\n      } else {\n        return ret;\n      }\n    }\n  } else {\n    return trampoline(function () {\n      return apply(f, args);\n    });\n  }\n}\n\nexport function transduce(xform, ...args) {\n  switch (args.length) {\n    case 2: {\n      const f = args[0];\n      const coll = args[1];\n      return transduce(xform, f, f(), coll);\n    }\n    default: {\n      let f = args[0];\n      const init = args[1];\n      const coll = args[2];\n      f = xform(f);\n      const ret = reduce(f, init, coll);\n      return f(ret);\n    }\n  }\n}\n\nexport function zipmap(keys, vals) {\n  const res = {};\n  const keyIterator = iterable(keys)[Symbol.iterator]();\n  const valIterator = iterable(vals)[Symbol.iterator]();\n  let nextKey, nextVal;\n  for (;;) {\n    nextKey = keyIterator.next();\n    if (nextKey.done) break;\n    nextVal = valIterator.next();\n    if (nextVal.done) break;\n    res[nextKey.value] = nextVal.value;\n  }\n  return res;\n}\n\nexport function not_empty(x) {\n  const isSeq = seq(x);\n  if (isSeq) {\n    return x;\n  } else return null;\n}\n\nexport function tree_seq(isBranch, children, root) {\n  const walk = function* (node) {\n    yield node;\n    if (truth_(isBranch(node))) {\n      for (const c of iterable(children(node))) {\n        yield* walk(c);\n      }\n    }\n  };\n  return lazy(function* () {\n    yield* walk(root);\n  });\n}\n\nexport function flatten(x) {\n  return filter(complement(sequential_QMARK_), rest(tree_seq(sequential_QMARK_, seq, x)));\n}\n\nexport function transient$(x) {\n  return copy(x);\n}\n\nexport function persistent_BANG_(x) {\n  return Object.freeze(x);\n}\n\nclass SortedSet {\n  constructor(xs) {\n    const isSorted = xs instanceof SortedSet;\n    if (!isSorted) {\n      xs = sort(xs);\n    }\n    const s = new Set(xs);\n    // we don't re-use xs since xs can contain duplicates\n    this._elts = [...s];\n    this._set = s;\n  }\n  add(x) {\n    if (this._set.has(x)) return this;\n    const xs = this._elts;\n    let added = false;\n    for (let i = 0; i < xs.length; i++) {\n      if (compare(x, xs[i]) <= 0) {\n        xs.splice(i, 0, x);\n        added = true;\n        break;\n      }\n    }\n    if (!added) {\n      xs.push(x);\n      // in this case we can re-use the set, since we add the element last\n      this._set.add(x);\n    } else {\n      this._set = new Set(xs);\n    }\n    this.size = xs.length;\n    return this;\n  }\n  delete(x) {\n    if (!this._set.has(x)) return this;\n    const xs = this._elts;\n    const idx = xs.indexOf(x);\n    xs.splice(idx, 1);\n    this._set = new Set(xs);\n    this.size = xs.length;\n    return this;\n  }\n  has(x) {\n    return this._set.has(x);\n  }\n  keys() {\n    return this.values();\n  }\n  values() {\n    return this._elts[Symbol.iterator]();\n  }\n  entries() {\n    return this._set.entries();\n  }\n  forEach(...xs) {\n    return this.set.forEach(...xs);\n  }\n  clear() {\n    this._elts = [];\n    this._set = new Set(this._elts);\n  }\n  [Symbol.iterator]() {\n    return this.keys();\n  }\n}\n\nexport function sorted_set(...xs) {\n  return new SortedSet(xs);\n}\n\nfunction mkBoundFn(_sc, test, key) {\n  return (e) => {\n    return test(compare(e, key), 0);\n  };\n}\n\nfunction indexFrom(sc, startKey, _asc = true) {\n  let i = 0;\n  for (; i < sc.length; i++) {\n    if (!(compare(startKey, sc[i]) > 0)) {\n      break;\n    }\n  }\n  return i;\n}\n\nfunction subseq3([sc, test, key]) {\n  const includeFn = mkBoundFn(sc, test, key);\n  if (test === _GT_ || test === _GT__EQ_) {\n    const seqFrom = [...sc];\n    const startIdx = indexFrom(seqFrom, key, true);\n    // delete startIdx items from the start;\n    seqFrom.splice(0, startIdx);\n    if (includeFn(seqFrom[0])) {\n      return seqFrom;\n    } else {\n      // delete 1 item from the start;\n      seqFrom.splice(0, 1);\n      return seqFrom;\n    }\n  } else {\n    return [...take_while(includeFn, sc)];\n  }\n}\n\nfunction subseq5([sc, startTest, startKey, endTest, endKey]) {\n  const seqFrom = [...sc];\n  const startIdx = indexFrom(seqFrom, startKey, true);\n  // delete startIdx items from the start\n  seqFrom.splice(0, startIdx);\n  const whileFn = mkBoundFn(sc, endTest, endKey);\n  if (!mkBoundFn(sc, startTest, startKey)(seqFrom[0])) {\n    // delete 1 item from the start\n    seqFrom.splice(0, 1);\n  }\n  return [...take_while(whileFn, seqFrom)];\n}\n\nexport function subseq(...xs) {\n  if (xs.length === 3) {\n    return subseq3(xs);\n  }\n  if (xs.length === 5) {\n    return subseq5(xs);\n  }\n}\n\nexport function abs(x) {\n  return Math.abs(x);\n}\n\nexport function long$(x) {\n  return fix(x);\n}\n\nexport function type(x) {\n  return x != null && x.constructor;\n}\n\nfunction preserving_reduced(rf) {\n  return (a1, a2) => {\n    const ret = rf(a1, a2);\n    if (reduced_QMARK_(ret)) {\n      return reduced(ret);\n    } else return ret;\n  };\n}\n\nexport function cat(rf) {\n  rf = preserving_reduced(rf);\n  return (...args) => {\n    switch (args.length) {\n      case 0:\n        return rf();\n      case 1:\n        return rf(args[0]);\n      case 2:\n        return reduce(rf, args[0], args[1]);\n    }\n  };\n}\n\nexport function rem(n, d) {\n  const q = quot(n, d);\n  return n - d * q;\n}\n\nexport function memoize(f) {\n  const cache = new Map();\n  return (...xs) => {\n    const path = [xs.length, ...xs];\n    const res = get_in(cache, path);\n    if (res === undefined) {\n      const v = f(...xs);\n      assoc_in_BANG_(cache, path, v);\n      return v;\n    } else return res;\n  };\n}\n\nexport function peek(vec) {\n  if (array_QMARK_(vec)) {\n    return vec[vec.length - 1];\n  } else {\n    return first(vec);\n  }\n}\n\nexport function pop(vec) {\n  if (array_QMARK_(vec)) {\n    const ret = [...vec];\n    ret.pop();\n    return ret;\n  } else {\n    return rest(vec);\n  }\n}\n\nexport function update_keys(m, f) {\n  const m2 = empty(m);\n  const assocFn = getAssocMut(m) || assoc_BANG_;\n  reduce_kv(\n    (acc, k, v) => {\n      return assocFn(acc, f(k), v);\n    },\n    m2,\n    m\n  );\n  return m2;\n}\n\nexport function update_vals(m, f) {\n  const m2 = empty(m);\n  const assocFn = getAssocMut(m) || assoc_BANG_;\n  reduce_kv(\n    (acc, k, v) => {\n      return assocFn(acc, k, f(v));\n    },\n    m2,\n    m\n  );\n  return m2;\n}\n\nexport function random_uuid() {\n  return crypto.randomUUID();\n}\n\nexport class Delay {\n  constructor(f) {\n    this.f = f;\n  }\n  _deref() {\n    if (this.realized) {\n      return this.v;\n    } else {\n      this.v = this.f();\n      this.realized = true;\n      return this.v;\n    }\n  }\n}\n\nfunction clj__GT_js_(x, seen) {\n  // we need to protect against circular objects\n  if (seen.has(x)) return x;\n  seen.add(x);\n  if (map_QMARK_(x)) {\n    return update_vals(x, (x) => clj__GT_js_(x, seen));\n  }\n\n  const tc = typeConst(x);\n  if (tc && tc != OBJECT_TYPE) {\n    return mapv((x) => clj__GT_js_(x, seen), x);\n  }\n  return x;\n}\n\nexport function clj__GT_js(x) {\n  return clj__GT_js_(x, new Set());\n}\n\nexport function run_BANG_(proc, coll) {\n  reduce((_, x) => proc(x), null, coll);\n}\n\nexport function not_EQ_(x, y, ...more) {\n  if (y === undefined) return false;\n  if (x === y) return false;\n  for (const e of more) {\n    if (x === e) return false;\n  }\n  return true;\n}\n",
    "/*eslint no-unused-vars: [\"error\", { \"varsIgnorePattern\": \"^_\", \"argsIgnorePattern\": \"^_\", \"destructuredArrayIgnorePattern\": \"^_\"}]*/\n\nfunction toFn(x) {\n  if (x == null) return x;\n  if (x instanceof Function) {\n    return x;\n  }\n  const t = typeof x;\n  if (t === 'string') {\n    return (coll, d) => {\n      return get(coll, x, d);\n    };\n  }\n  if (t === 'object') {\n    return (k, d) => {\n      return get(x, k, d);\n    };\n  }\n  return x;\n}\n\n// inlined and modified version of https://github.com/lukeed/dequal\nvar has = Object.prototype.hasOwnProperty;\n\nfunction findKey(iter, tar, key) {\n  for (key of iter.keys()) {\n    if (dequal(key, tar)) return key;\n  }\n}\n\nfunction dequal(foo, bar) {\n  // supports primitives, Array, Set, Map and plain objects\n  // like CLJS: does not support NaN\n  if (foo === bar) return true;\n  var ctor, len, tmp;\n\n  if (foo && bar && (ctor = foo.constructor) === bar.constructor) {\n    if (ctor === Array) {\n      if ((len = foo.length) === bar.length) {\n        while (len-- && dequal(foo[len], bar[len]));\n      }\n      return len === -1;\n    }\n\n    if (ctor === Set) {\n      if (foo.size !== bar.size) {\n        return false;\n      }\n      for (const elt of foo) {\n        tmp = elt;\n        if (tmp && typeof tmp === 'object') {\n          tmp = findKey(bar, tmp);\n          if (!tmp) return false;\n        }\n        if (!bar.has(tmp)) return false;\n      }\n      return true;\n    }\n\n    if (ctor === Map) {\n      if (foo.size !== bar.size) {\n        return false;\n      }\n      for (const kv of foo) {\n        tmp = kv[0];\n        if (tmp && typeof tmp === 'object') {\n          tmp = findKey(bar, tmp);\n          if (!tmp) return false;\n        }\n        if (!dequal(kv[1], bar.get(tmp))) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    if (!ctor || typeof foo === 'object') {\n      len = 0;\n      for (const k in foo) {\n        if (has.call(foo, k) && ++len && !has.call(bar, k)) return false;\n        if (!(k in bar) || !dequal(foo[k], bar[k])) return false;\n      }\n      return Object.keys(bar).length === len;\n    }\n  }\n  return false;\n}\n// end inlined version of dequals\n\nfunction walkArray(arr, comp) {\n  return arr.every(function (x, i) {\n    return i === 0 || comp(arr[i - 1], x);\n  });\n}\n\nexport function _EQ_(...xs) {\n  return walkArray(xs, (x, y) => dequal(x, y));\n}\n\nexport function _GT_(...xs) {\n  return walkArray(xs, (x, y) => x > y);\n}\n\nexport function _GT__EQ_(...xs) {\n  return walkArray(xs, (x, y) => x >= y);\n}\n\nexport function _LT_(...xs) {\n  return walkArray(xs, (x, y) => x < y);\n}\n\nexport function _LT__EQ_(...xs) {\n  return walkArray(xs, (x, y) => x <= y);\n}\n\nexport function _PLUS_(...xs) {\n  return xs.reduce((x, y) => x + y, 0);\n}\n\nexport function _STAR_(...xs) {\n  return xs.reduce((x, y) => x * y, 1);\n}\n\nexport function _(...xs) {\n  if (xs.length == 1) {\n    return 0 - xs[0];\n  }\n  return xs.reduce((x, y) => x - y);\n}\n\nexport const __protocol_satisfies = {};\n\nexport function satisfies_QMARK_(protocol, x) {\n  if (x == null) {\n    return protocol[null];\n  }\n  if (typeof protocol == 'symbol') return x[protocol];\n  return x[protocol.__sym];\n}\n\nfunction mapAssocMut(m, k, v) {\n  m.set(k, v);\n  return m;\n}\n\nfunction objAssocMut(m, k, v) {\n  m[k] = v;\n  return m;\n}\n\nfunction getAssocMut(m) {\n  switch (typeConst(m)) {\n    case MAP_TYPE:\n      return mapAssocMut;\n    case ARRAY_TYPE:\n    case OBJECT_TYPE:\n      return objAssocMut;\n  }\n}\n\nexport function assoc_BANG_(m, k, v, ...kvs) {\n  if (kvs.length % 2 !== 0) {\n    throw new Error('Illegal argument: assoc expects an odd number of arguments.');\n  }\n  switch (typeConst(m)) {\n    case MAP_TYPE:\n      m.set(k, v);\n\n      for (let i = 0; i < kvs.length; i += 2) {\n        m.set(kvs[i], kvs[i + 1]);\n      }\n      break;\n    case ARRAY_TYPE:\n    case OBJECT_TYPE:\n      m[k] = v;\n\n      for (let i = 0; i < kvs.length; i += 2) {\n        m[kvs[i]] = kvs[i + 1];\n      }\n      break;\n    default:\n      throw new Error(\n        `Illegal argument: assoc! expects a Map, Array, or Object as the first argument, but got ${typeof m}.`\n      );\n  }\n\n  return m;\n}\n\nfunction copy(o) {\n  switch (typeConst(o)) {\n    case MAP_TYPE:\n      return new Map(o);\n    case SET_TYPE:\n      return new o.constructor(o);\n    case ARRAY_TYPE:\n      return [...o];\n    case OBJECT_TYPE:\n      return { ...o };\n    default:\n      throw new Error(`Don't know how to copy object of type ${typeof o}.`);\n  }\n}\n\nexport function assoc(o, k, v, ...kvs) {\n  if (!o) {\n    o = {};\n  }\n  const ret = copy(o);\n  assoc_BANG_(ret, k, v, ...kvs);\n  return ret;\n}\n\nconst MAP_TYPE = 1;\nconst ARRAY_TYPE = 2;\nconst OBJECT_TYPE = 3;\nconst LIST_TYPE = 4;\nconst SET_TYPE = 5;\nconst LAZY_ITERABLE_TYPE = 6;\n\nfunction emptyOfType(type) {\n  switch (type) {\n    case MAP_TYPE:\n      return new Map();\n    case ARRAY_TYPE:\n      return [];\n    case OBJECT_TYPE:\n      return {}; // Object.create?\n    case LIST_TYPE:\n      return new List();\n    case SET_TYPE:\n      return new Set();\n    case LAZY_ITERABLE_TYPE:\n      return lazy(function* () {\n        return;\n      });\n  }\n  return undefined;\n}\n\nfunction isObj(coll) {\n  return coll.constructor === Object;\n}\n\nexport function object_QMARK_(coll) {\n  return coll != null && isObj(coll);\n}\n\nfunction typeConst(obj) {\n  if (obj == null) {\n    return undefined;\n  }\n  // optimize for object\n  if (isObj(obj)) {\n    return OBJECT_TYPE;\n  }\n  if (obj instanceof Map) return MAP_TYPE;\n  if (obj instanceof Set) return SET_TYPE;\n  if (obj instanceof List) return LIST_TYPE;\n  if (Array.isArray(obj)) return ARRAY_TYPE;\n  if (obj instanceof LazyIterable) return LAZY_ITERABLE_TYPE;\n  if (obj instanceof SortedSet) return SET_TYPE;\n\n  // everything more specific than Object should go before this\n  if (obj instanceof Object) return OBJECT_TYPE;\n\n  return undefined;\n}\n\nfunction assoc_in_with(f, fname, o, keys, value) {\n  keys = vec(keys);\n  o = o || {}; // default nil behavior is JS object\n  const baseType = typeConst(o);\n  if (baseType !== MAP_TYPE && baseType !== ARRAY_TYPE && baseType !== OBJECT_TYPE)\n    throw new Error(\n      `Illegal argument: ${fname} expects the first argument to be a Map, Array, or Object.`\n    );\n\n  const chain = [o];\n  let lastInChain = o;\n\n  for (let i = 0; i < keys.length - 1; i += 1) {\n    const k = keys[i];\n    let chainValue;\n    if (lastInChain instanceof Map) chainValue = lastInChain.get(k);\n    else chainValue = lastInChain[k];\n    if (!chainValue) {\n      chainValue = emptyOfType(baseType);\n    }\n    chain.push(chainValue);\n    lastInChain = chainValue;\n  }\n\n  chain.push(value);\n\n  for (let i = chain.length - 2; i >= 0; i -= 1) {\n    chain[i] = f(chain[i], keys[i], chain[i + 1]);\n  }\n\n  return chain[0];\n}\n\nexport function assoc_in(o, keys, value) {\n  return assoc_in_with(assoc, 'assoc-in', o, keys, value);\n}\n\nexport function assoc_in_BANG_(o, keys, value) {\n  keys = vec(keys);\n  var currObj = o;\n  const baseType = typeConst(o);\n  for (const k of keys.splice(0, keys.length - 1)) {\n    let v = get(currObj, k);\n    if (v === undefined) {\n      v = emptyOfType(baseType);\n      assoc_BANG_(currObj, k, v);\n    }\n    currObj = v;\n  }\n  assoc_BANG_(currObj, keys[keys.length - 1], value);\n  return o;\n}\n\nexport function comp(...fs) {\n  fs = fs.map(toFn);\n  if (fs.length === 0) {\n    return identity;\n  } else if (fs.length === 1) {\n    return fs[0];\n  }\n  const [f, ...more] = fs.slice().reverse();\n  return function (...args) {\n    let x = f(...args);\n    for (const g of more) {\n      x = g(x);\n    }\n    return x;\n  };\n}\n\nfunction conj_BANG_set(o, rest) {\n  for (const x of rest) {\n    o.add(x);\n  }\n  return o;\n}\n\nexport function conj_BANG_(...xs) {\n  if (xs.length === 0) {\n    return vector();\n  }\n\n  const [_o, ...rest] = xs;\n\n  let o = _o;\n  if (o === null || o === undefined) {\n    o = [];\n  }\n\n  switch (typeConst(o)) {\n    case SET_TYPE:\n      conj_BANG_set(o, rest);\n      break;\n    case LIST_TYPE:\n      o.unshift(...rest.reverse());\n      break;\n    case ARRAY_TYPE:\n      o.push(...rest);\n      break;\n    case MAP_TYPE:\n      for (const x of rest) {\n        if (!Array.isArray(x))\n          iterable(x).forEach((kv) => {\n            o.set(kv[0], kv[1]);\n          });\n        else o.set(x[0], x[1]);\n      }\n      break;\n    case OBJECT_TYPE:\n      for (const x of rest) {\n        if (!Array.isArray(x)) Object.assign(o, x);\n        else o[x[0]] = x[1];\n      }\n      break;\n    default:\n      throw new Error(\n        'Illegal argument: conj! expects a Set, Array, List, Map, or Object as the first argument.'\n      );\n  }\n\n  return o;\n}\n\nexport function conj(...xs) {\n  if (xs.length === 0) {\n    return vector();\n  }\n\n  const [_o, ...rest] = xs;\n\n  let o = _o;\n  if (o === null || o === undefined) {\n    o = list();\n  }\n  let m, o2;\n\n  switch (typeConst(o)) {\n    case SET_TYPE:\n      if (o instanceof SortedSet) {\n        // prevent re-sorting of collection\n        return conj_BANG_set(new o.constructor(o), rest);\n      } else {\n        return new o.constructor([...o, ...rest]);\n      }\n    case LIST_TYPE:\n      return new List(...rest.reverse(), ...o);\n    case ARRAY_TYPE:\n      return [...o, ...rest];\n    case MAP_TYPE:\n      m = new Map(o);\n      for (const x of rest) {\n        if (!Array.isArray(x))\n          iterable(x).forEach((kv) => {\n            m.set(kv[0], kv[1]);\n          });\n        else m.set(x[0], x[1]);\n      }\n\n      return m;\n    case LAZY_ITERABLE_TYPE:\n      return lazy(function* () {\n        yield* rest;\n        yield* o;\n      });\n    case OBJECT_TYPE:\n      o2 = { ...o };\n\n      for (const x of rest) {\n        if (!Array.isArray(x)) Object.assign(o2, x);\n        else o2[x[0]] = x[1];\n      }\n\n      return o2;\n    default:\n      throw new Error(\n        'Illegal argument: conj expects a Set, Array, List, Map, or Object as the first argument.'\n      );\n  }\n}\n\nexport function disj_BANG_(s, ...xs) {\n  for (const x of xs) {\n    s.delete(x);\n  }\n  return s;\n}\n\nexport function disj(s, ...xs) {\n  const s1 = new s.constructor([...s]);\n  return disj_BANG_(s1, ...xs);\n}\n\nexport function contains_QMARK_(coll, v) {\n  switch (typeConst(coll)) {\n    case SET_TYPE:\n    case MAP_TYPE:\n      return coll.has(v);\n    case undefined:\n      return false;\n    default:\n      return v in coll;\n  }\n}\n\nexport function dissoc_BANG_(m, ...ks) {\n  for (const k of ks) {\n    delete m[k];\n  }\n\n  return m;\n}\n\nexport function dissoc(m, ...ks) {\n  if (!m) return;\n  if (ks.length === 0) return m;\n  const m2 = copy(m);\n  switch (typeConst(m)) {\n    case MAP_TYPE:\n      for (const k of ks) {\n        m2.delete(k);\n      }\n      break;\n    default:\n      for (const k of ks) {\n        delete m2[k];\n      }\n      break;\n  }\n  return m2;\n}\n\nexport function inc(n) {\n  return n + 1;\n}\n\nexport function dec(n) {\n  return n - 1;\n}\n\nexport function println(...args) {\n  console.log(...args);\n}\n\nexport function nth(coll, idx, orElse) {\n  if (coll) {\n    var elt = undefined;\n    if (Array.isArray(coll)) {\n      elt = coll[idx];\n    } else {\n      const iter = iterable(coll);\n      let i = 0;\n      for (const value of iter) {\n        if (i++ == idx) {\n          elt = value;\n          break;\n        }\n      }\n    }\n    if (elt !== undefined) {\n      return elt;\n    }\n  }\n  return orElse;\n}\n\nexport function get(coll, key, otherwise = undefined) {\n  if (coll == null) {\n    return otherwise;\n  }\n  let v;\n  // optimize for getting values out of objects\n  if (isObj(coll)) {\n    v = coll[key];\n    if (v === undefined) {\n      return otherwise;\n    } else {\n      return v;\n    }\n  }\n  let g;\n  switch (typeConst(coll)) {\n    case SET_TYPE:\n      if (coll.has(key)) v = key;\n      break;\n    case MAP_TYPE:\n      v = coll.get(key);\n      break;\n    case ARRAY_TYPE:\n      v = coll[key];\n      break;\n    default:\n      // we choose .get as the default implementation, e.g. fetch Headers are not Maps, but do implement a .get method\n      g = coll['get'];\n      if (g instanceof Function) {\n        try {\n          v = coll.get(key);\n          break;\n        } catch (e) {\n          // ignore error\n        }\n      }\n      v = coll[key];\n      break;\n  }\n  return v !== undefined ? v : otherwise;\n}\n\nexport function seq_QMARK_(x) {\n  return x != null && !!x[Symbol.iterator];\n}\n\nexport const sequential_QMARK_ = seq_QMARK_;\n\nexport function seqable_QMARK_(x) {\n  return (\n    x === null ||\n    x === undefined ||\n    // we used to check instanceof Object but this returns false for TC39 Records\n    // also we used to write `Symbol.iterator in` but this does not work for strings and some other types\n    !!x[Symbol.iterator]\n  );\n}\n\nexport function iterable(x) {\n  // nil puns to empty iterable, support passing nil to first/rest/reduce, etc.\n  if (x === null || x === undefined) {\n    return [];\n  }\n  if (seqable_QMARK_(x)) {\n    return x;\n  }\n  if (x instanceof Object) return Object.entries(x);\n  throw new TypeError(`${x} is not iterable`);\n}\n\nexport const IIterable = Symbol('Iterable');\n\nexport const IIterable__iterator = Symbol.iterator;\n\nexport function _iterator(coll) {\n  return coll[Symbol.iterator]();\n}\n\nexport const es6_iterator = _iterator;\n\nexport function seq(x) {\n  if (x == null) return x;\n  const iter = iterable(x);\n  // return nil for terminal checking\n  if (iter.length === 0 || iter.size === 0) {\n    return null;\n  }\n  const _i = iter[Symbol.iterator]();\n  if (_i.next().done) return null;\n  return iter;\n}\n\nexport function first(coll) {\n  // destructuring uses iterable protocol\n  const [first] = iterable(coll);\n  return first;\n}\n\nexport function second(coll) {\n  const [_, v] = iterable(coll);\n  return v;\n}\n\nexport function ffirst(coll) {\n  return first(first(coll));\n}\n\nexport function rest(coll) {\n  return lazy(function* () {\n    let first = true;\n    for (const x of iterable(coll)) {\n      if (first) first = false;\n      else yield x;\n    }\n  });\n}\n\nclass Reduced {\n  value;\n  constructor(x) {\n    this.value = x;\n  }\n  _deref() {\n    return this.value;\n  }\n}\n\nexport function last(coll) {\n  coll = iterable(coll);\n  let lastEl;\n  switch (typeConst(coll)) {\n    case ARRAY_TYPE:\n      return coll[coll.length - 1];\n    default:\n      for (const x of coll) {\n        lastEl = x;\n      }\n      return lastEl;\n  }\n}\n\nexport function reduced(x) {\n  return new Reduced(x);\n}\n\nexport function reduced_QMARK_(x) {\n  return x instanceof Reduced;\n}\n\nexport function reduce(f, arg1, arg2) {\n  f = toFn(f);\n  let coll, val;\n  if (arguments.length === 2) {\n    // (reduce f coll)\n    const iter = iterable(arg1)[Symbol.iterator]();\n    const vd = iter.next();\n    if (vd.done) {\n      val = f();\n    } else {\n      val = vd.value;\n    }\n    coll = iter;\n  } else {\n    // (reduce f val coll)\n    val = arg1;\n    coll = iterable(arg2);\n  }\n  if (val instanceof Reduced) {\n    return val.value;\n  }\n  for (const x of coll) {\n    val = f(val, x);\n    if (val instanceof Reduced) {\n      val = val.value;\n      break;\n    }\n  }\n  return val;\n}\n\nfunction* _reductions2(f, s) {\n  const vd = s.next();\n  if (vd.done) {\n    yield f();\n  } else {\n    yield* _reductions3(f, vd.value, s);\n  }\n}\n\nfunction* _reductions3(f, init, coll) {\n  let i = init,\n    rst = coll;\n  while (true) {\n    if (reduced_QMARK_(i)) {\n      yield i.value;\n      return;\n    } else yield i;\n    const vd = rst.next();\n    if (vd.done) {\n      break;\n    }\n    i = f(i, vd.value);\n  }\n}\n\nexport function reductions(f, arg1, arg2) {\n  f = toFn(f);\n  if (arguments.length === 2) {\n    return lazy(function* () {\n      yield* _reductions2(f, iterable(arg1)[Symbol.iterator]());\n    });\n  }\n  return lazy(function* () {\n    yield* _reductions3(f, arg1, iterable(arg2)[Symbol.iterator]());\n  });\n}\n\nvar tolr = false;\nexport function warn_on_lazy_reusage_BANG_() {\n  tolr = true;\n}\n\nclass LazyIterable {\n  constructor(gen) {\n    this.gen = gen;\n    this.usages = 0;\n  }\n  [Symbol.iterator]() {\n    this.usages++;\n    if (this.usages >= 2 && tolr) {\n      try {\n        throw new Error();\n      } catch (e) {\n        console.warn('Re-use of lazy value', e.stack);\n      }\n    }\n    return this.gen();\n  }\n}\n\nLazyIterable.prototype[IIterable] = true; // Closure compatibility\n\nexport function lazy(f) {\n  return new LazyIterable(f);\n}\n\nexport class Cons {\n  constructor(x, coll) {\n    this.x = x;\n    this.coll = coll;\n  }\n  *[Symbol.iterator]() {\n    yield this.x;\n    yield* iterable(this.coll);\n  }\n}\n\nexport function cons(x, coll) {\n  return new Cons(x, coll);\n  // return lazy(function* () {\n  //   yield x;\n  //   yield* iterable(coll);\n  // });\n}\n\nexport function map(f, ...colls) {\n  // if (! (f instanceof Function)) {\n  //   throw new Error(`Argument f must be a function but is ${typeof(f)}`);\n  // }\n  f = toFn(f);\n  switch (colls.length) {\n    case 0:\n      return (rf) => {\n        return (...args) => {\n          switch (args.length) {\n            case 0: {\n              return rf();\n            }\n            case 1: {\n              return rf(args[0]);\n            }\n            case 2: {\n              return rf(args[0], f(args[1]));\n            }\n            default: {\n              return rf(args[0], f(...args.slice(1)));\n            }\n          }\n        };\n      };\n    case 1:\n      return lazy(function* () {\n        for (const x of iterable(colls[0])) {\n          yield f(x);\n        }\n      });\n    default:\n      return lazy(function* () {\n        const iters = colls.map((coll) => es6_iterator(iterable(coll)));\n        while (true) {\n          const args = [];\n          for (const i of iters) {\n            const nextVal = i.next();\n            if (nextVal.done) {\n              return;\n            }\n            args.push(nextVal.value);\n          }\n          yield f(...args);\n        }\n      });\n  }\n}\n\nfunction filter1(pred) {\n  return (rf) => {\n    return (...args) => {\n      switch (args.length) {\n        case 0:\n          return rf();\n        case 1:\n          return rf(args[0]);\n        case 2: {\n          const result = args[0];\n          const input = args[1];\n          if (truth_(pred(input))) {\n            return rf(result, input);\n          } else return result;\n        }\n      }\n    };\n  };\n}\n\nexport function filter(pred, coll) {\n  if (arguments.length === 1) {\n    return filter1(pred);\n  }\n  pred = toFn(pred);\n  return lazy(function* () {\n    for (const x of iterable(coll)) {\n      if (truth_(pred(x))) {\n        yield x;\n      }\n    }\n  });\n}\n\nexport function filterv(pred, coll) {\n  return [...filter(pred, coll)];\n}\n\nexport function remove(pred, coll) {\n  if (arguments.length === 1) {\n    return filter1(complement(pred));\n  }\n  return filter(complement(pred), coll);\n}\n\nfunction map_indexed1(f) {\n  return (rf) => {\n    let i = -1;\n    return (...args) => {\n      switch (args.length) {\n        case 0:\n          return rf();\n        case 1:\n          return rf(args[0]);\n        case 2:\n          return rf(args[0], f(((i = i + 1), i), args[1]));\n      }\n    };\n  };\n}\n\nexport function map_indexed(f, coll) {\n  f = toFn(f);\n  if (arguments.length === 1) {\n    return map_indexed1(f);\n  }\n  return lazy(function* () {\n    let idx = 0;\n    for (const i of iterable(coll)) {\n      yield f(idx, i);\n      idx++;\n    }\n  });\n}\n\nfunction keep_indexed2(f, coll) {\n  f = toFn(f);\n  return lazy(function* () {\n    let idx = 0;\n    for (const i of iterable(coll)) {\n      const v = f(idx, i);\n      if (truth_(v)) yield v;\n      idx++;\n    }\n  });\n}\n\nfunction keep_indexed1(f) {\n  return (rf) => {\n    let ia = -1;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) {\n        return rf();\n      }\n      if (al === 1) {\n        return rf(args[0]);\n      }\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        ia++;\n        const v = f(ia, input);\n        if (v == null) {\n          return result;\n        }\n        return rf(result, v);\n      }\n    };\n  };\n}\n\nexport function keep_indexed(f, coll) {\n  if (arguments.length === 1) {\n    return keep_indexed1(f);\n  } else {\n    return keep_indexed2(f, coll);\n  }\n}\n\nexport function str(...xs) {\n  return xs.join('');\n}\n\nexport function not(expr) {\n  return !truth_(expr);\n}\n\nexport function nil_QMARK_(v) {\n  return v == null;\n}\n\nexport const PROTOCOL_SENTINEL = {};\n\nexport class Atom {\n  constructor(init) {\n    this.val = init;\n    this._watches = {};\n    this._deref = () => this.val;\n    this._hasWatches = false;\n    this._reset_BANG_ = (x) => {\n      const old_val = this.val;\n      this.val = x;\n      if (this._hasWatches) {\n        for (const entry of Object.entries(this._watches)) {\n          const k = entry[0];\n          const f = entry[1];\n          f(k, this, old_val, x);\n        }\n      }\n      return x;\n    };\n    this._add_watch = (k, fn) => {\n      this._watches[k] = fn;\n      this._hasWatches = true;\n    };\n    this._remove_watch = (k) => {\n      delete this._watches[k];\n    };\n  }\n}\n\nexport function atom(init) {\n  return new Atom(init);\n}\n\nexport function deref(ref) {\n  return ref._deref();\n}\n\nexport function reset_BANG_(atm, v) {\n  atm._reset_BANG_(v);\n}\n\nexport function swap_BANG_(atm, f, ...args) {\n  f = toFn(f);\n  const v = f(deref(atm), ...args);\n  reset_BANG_(atm, v);\n  return v;\n}\n\nexport function range(begin, end, step) {\n  return lazy(function* () {\n    let b = begin,\n      e = end,\n      s = step;\n    if (end === undefined) {\n      b = 0;\n      e = begin;\n    }\n    let i = b || 0;\n    s = step ?? 1;\n    const ascending = s >= 0;\n    while (e === undefined || (ascending && i < e) || (!ascending && e < i)) {\n      yield i;\n      i += s;\n    }\n  });\n}\n\nexport function re_matches(re, s) {\n  const matches = re.exec(s);\n  if (matches && s === matches[0]) {\n    if (matches.length === 1) {\n      return matches[0];\n    } else {\n      return matches;\n    }\n  }\n  return null;\n}\n\nexport function re_find(re, s) {\n  if (string_QMARK_(s)) {\n    const matches = re.exec(s);\n    if (matches != null) {\n      if (matches.length === 1) return matches[0];\n      else {\n        return [...matches];\n      }\n    }\n    return null;\n  } else {\n    throw new TypeError('re-find must match against a string.');\n  }\n}\n\nexport function re_pattern(s) {\n  if (s instanceof RegExp) {\n    return s;\n  }\n\n  // Allow all flags available in JavaScript\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/RegExp#flags\n  const flagMatches = s.match(/^\\(\\?([dgimsuvy]*)\\)/);\n\n  if (flagMatches) {\n    return new RegExp(s.slice(flagMatches[0].length), flagMatches[1]);\n  }\n\n  return new RegExp(s);\n}\n\nexport function subvec(arr, start, end) {\n  return arr.slice(start, end);\n}\n\nexport function vector(...args) {\n  return args;\n}\n\nexport const array = vector;\n\nexport function vector_QMARK_(x) {\n  return typeConst(x) === ARRAY_TYPE;\n}\n\nexport function mapv(...args) {\n  if (args.length === 2) {\n    const [_f, coll] = args;\n    const f = toFn(_f);\n    const iter = iterable(coll);\n    if (Array.isArray(iter)) {\n      // explicit for loop was faster\n      const ret = new Array(iter.length);\n      for (var i = 0; i < iter.length; i++) {\n        ret[i] = f(iter[i]);\n      }\n      return ret;\n    } else {\n      var ret = [];\n      for (const x of iter) {\n        ret.push(f(x));\n      }\n      return ret;\n    }\n  }\n  return [...map(...args)];\n}\n\nexport function vec(x) {\n  if (array_QMARK_(x)) {\n    // return original, no need to clone the entire thing\n    return x;\n  }\n  return [...iterable(x)];\n}\n\nexport function set(coll) {\n  return new Set(iterable(coll));\n}\n\nexport function set_QMARK_(x) {\n  return typeConst(x) === SET_TYPE;\n}\n\nconst IApply__apply = Symbol('IApply__apply');\n\nexport function apply(f, ...args) {\n  f = toFn(f);\n  const xs = args.slice(0, args.length - 1);\n  const coll = iterable(args[args.length - 1]);\n  const af = f[IApply__apply];\n  if (af) {\n    return af(...xs, coll);\n  }\n  return f(...xs, ...coll);\n}\n\nexport function even_QMARK_(x) {\n  return x % 2 == 0;\n}\n\nexport function odd_QMARK_(x) {\n  return !even_QMARK_(x);\n}\n\nexport function complement(f) {\n  f = toFn(f);\n  return (...args) => not(f(...args));\n}\n\nexport function constantly(x) {\n  return (..._) => x;\n}\n\nclass List extends Array {\n  constructor(...args) {\n    super();\n    this.push(...args);\n  }\n}\n\nexport function list_QMARK_(x) {\n  return typeConst(x) === LIST_TYPE;\n}\n\nexport function list(...args) {\n  return new List(...args);\n}\n\nexport function array_QMARK_(x) {\n  return Array.isArray(x);\n}\n\nfunction concat1(colls) {\n  return lazy(function* () {\n    for (const coll of colls) {\n      yield* iterable(coll);\n    }\n  });\n}\n\nexport function concat(...colls) {\n  return concat1(colls);\n}\n\n// lazy seqable argument\nconcat[IApply__apply] = (colls) => {\n  return concat1(colls);\n};\n\nexport function mapcat(f, ...colls) {\n  if (colls.length === 0) {\n    return comp(map(f), cat);\n  } else {\n    const mapped = map(f, ...colls);\n    return concat1(mapped);\n  }\n}\n\nexport function identity(x) {\n  return x;\n}\n\nexport function interleave(...colls) {\n  return lazy(function* () {\n    const iters = colls.map((coll) => es6_iterator(iterable(coll)));\n    while (true) {\n      const res = [];\n      for (const i of iters) {\n        const nextVal = i.next();\n        if (nextVal.done) {\n          return;\n        }\n        res.push(nextVal.value);\n      }\n      yield* res;\n    }\n  });\n}\n\nfunction interpose1(sep) {\n  return (rf) => {\n    let started = false;\n    return (...args) => {\n      switch (args.length) {\n        case 0:\n          return rf();\n        case 1:\n          return rf(args[0]);\n        case 2: {\n          if (started) {\n            const sepr = rf(args[0], sep);\n            if (reduced_QMARK_(sepr)) {\n              return sepr;\n            } else {\n              return rf(sepr, args[1]);\n            }\n          } else {\n            started = true;\n            return rf(args[0], args[1]);\n          }\n        }\n      }\n    };\n  };\n}\n\nexport function interpose(sep, coll) {\n  if (arguments.length === 1) return interpose1(sep);\n  return drop(1, interleave(repeat(sep), coll));\n}\n\nexport function select_keys(o, ks) {\n  const type = typeConst(o);\n  // ret could be object or array, but in the future, maybe we'll have an IEmpty protocol\n  const ret = emptyOfType(type) || {};\n  for (const k of ks) {\n    const v = get(o, k);\n    if (v != undefined) {\n      assoc_BANG_(ret, k, v);\n    }\n  }\n  return ret;\n}\n\nexport function unreduced(x) {\n  if (reduced_QMARK_(x)) {\n    return deref(x);\n  } else {\n    return x;\n  }\n}\n\nfunction partition_all1(n) {\n  return (rf) => {\n    let a = [];\n    return (...args) => {\n      let result, v;\n      switch (args.length) {\n        case 0:\n          return rf();\n        case 1: {\n          result = args[0];\n          if (a.length !== 0) {\n            v = [...a];\n            a = [];\n            result = unreduced(rf(result, v));\n          }\n          return rf(result);\n        }\n        case 2: {\n          result = args[0];\n          a.push(args[1]);\n          if (n === a.length) {\n            v = [...a];\n            a = [];\n            return rf(result, v);\n          } else {\n            return result;\n          }\n        }\n      }\n    };\n  };\n}\n\nexport function partition_all(n, ...args) {\n  if (arguments.length === 1) {\n    return partition_all1(n);\n  }\n  let step = n,\n    coll = args[0];\n\n  if (args.length === 2) {\n    [step, coll] = args;\n  }\n  return partitionInternal(n, step, [], coll, true);\n}\n\nexport function partition(n, ...args) {\n  let step = n,\n    pad = [],\n    coll = args[0];\n\n  if (args.length === 2) {\n    [step, coll] = args;\n  } else if (args.length > 2) {\n    [step, pad, coll] = args;\n  }\n  return partitionInternal(n, step, pad, coll, false);\n}\n\nexport const partitionv = partition; // partition already returns a lazy of arrays\nexport const partitionv_all = partition_all;\n\nfunction partitionInternal(n, step, pad, coll, all) {\n  return lazy(function* () {\n    let p = [];\n    let i = 0;\n    for (const x of iterable(coll)) {\n      if (i < n) {\n        p.push(x);\n        if (p.length === n) {\n          yield p;\n          p = step < n ? p.slice(step) : [];\n        }\n      }\n      i++;\n      if (i === step) {\n        i = 0;\n      }\n    }\n\n    if (p.length > 0) {\n      if (p.length === n || all) {\n        yield p;\n      } else if (pad.length) {\n        p.push(...pad.slice(0, n - p.length));\n        yield p;\n      }\n    }\n  });\n}\n\nfunction partition_by1(f) {\n  return (rf) => {\n    let a = [];\n    const none = {};\n    let pa = none;\n    return (...args) => {\n      const l = args.length;\n      if (l === 0) {\n        return rf();\n      }\n      if (l === 1) {\n        let result = args[0];\n        if (a.length !== 0) {\n          const v = [...a];\n          a = [];\n          result = unreduced(rf(result, v));\n        }\n        return rf(result);\n      }\n      if (l === 2) {\n        const result = args[0];\n        const input = args[1];\n        const pval = pa;\n        const val = f(input);\n        pa = val;\n        if (pval === none || val === pval) {\n          a.push(input);\n          return result;\n        } else {\n          const v = [...a];\n          a = [];\n          const ret = rf(result, v);\n          if (!reduced_QMARK_(ret)) {\n            a.push(input);\n          }\n          return ret;\n        }\n      }\n    };\n  };\n}\n\nexport function partition_by(f, coll) {\n  f = toFn(f);\n  if (arguments.length === 1) {\n    return partition_by1(f);\n  }\n  return lazy(function* () {\n    const iter = es6_iterator(coll);\n    const _fst = iter.next();\n    if (_fst.done) {\n      yield* null;\n    }\n    const fst = _fst.value;\n    let fv = f(fst);\n    let run = [fst];\n    let rst = [];\n    while (true) {\n      const next = iter.next();\n      if (next.done) {\n        yield run;\n        break;\n      }\n      const _v = next.value;\n      const _fv = f(_v);\n      if (fv == _fv) {\n        run.push(_v);\n      } else {\n        yield run;\n        rst.push(_v);\n        run = rst;\n        fv = _fv;\n        rst = [];\n      }\n    }\n  });\n}\n\nexport function empty(coll) {\n  const type = typeConst(coll);\n  if (type != null) {\n    return emptyOfType(type);\n  } else {\n    throw new Error(`Can't create empty of ${typeof coll}`);\n  }\n}\n\nexport function merge(...args) {\n  // if the first arg is nil we coerce it into a map.\n  const firstArg = args[0];\n  let obj;\n  if (firstArg === null || firstArg === undefined) {\n    obj = {};\n  } else {\n    obj = into(empty(firstArg), firstArg);\n  }\n  return conj_BANG_(obj, ...args.slice(1));\n}\n\nexport function key(entry) {\n  return entry[0];\n}\n\nexport function val(entry) {\n  return entry[1];\n}\n\nexport function merge_with(f, ...maps) {\n  f = toFn(f);\n  var hasMap = false;\n  for (const m of maps) {\n    if (m != null) {\n      hasMap = true;\n      break;\n    }\n  }\n  if (hasMap) {\n    const mergeEntry = (m, e) => {\n      const k = key(e);\n      const v = val(e);\n      if (contains_QMARK_(m, k)) {\n        return assoc(m, k, f(get(m, k), v));\n      } else {\n        return assoc(m, k, v);\n      }\n    };\n    const merge2 = (m1, m2) => {\n      return reduce(mergeEntry, m1 || {}, seq(m2));\n    };\n    return reduce(merge2, maps);\n  } else {\n    return null;\n  }\n}\n\nexport function system_time() {\n  return performance.now();\n}\n\nexport function into(...args) {\n  let to, xform, from, c, rf;\n  switch (args.length) {\n    case 0:\n      return [];\n    case 1:\n      return args[0];\n    case 2:\n      return conj(args[0] ?? [], ...iterable(args[1]));\n    case 3:\n      to = args[0];\n      xform = args[1];\n      from = args[2];\n      c = copy(to);\n      rf = (coll, v) => {\n        if (v === undefined) {\n          return coll;\n        }\n        return conj_BANG_(coll, v);\n      };\n      return transduce(xform, rf, c, from);\n    default:\n      throw TypeError(`Invalid arity call of into: ${args.length}`);\n  }\n}\n\nexport function identical_QMARK_(x, y) {\n  return x === y;\n}\n\nexport function repeat(...args) {\n  if (args.length == 0 || args.length > 2) {\n    throw new Error(`Invalid arity: ${args.length}`);\n  }\n\n  return {\n    [IIterable]: true,\n    [IIterable__iterator]:\n      args.length == 1\n        ? function* () {\n            const x = args[0];\n            while (true) yield x;\n          }\n        : function* () {\n            const [n, x] = args;\n            for (var i = 0; i < n; i++) yield x;\n          },\n  };\n}\n\nexport function ensure_reduced(x) {\n  if (reduced_QMARK_(x)) {\n    return x;\n  } else {\n    return reduced(x);\n  }\n}\n\nfunction take1(n) {\n  return (rf) => {\n    let na = n;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) {\n        return rf();\n      }\n      if (al === 1) {\n        const result = args[0];\n        return rf(result);\n      }\n      if (al === 2) {\n        let result = args[0];\n        const input = args[1];\n        const n = na;\n        const nn = ((na = na - 1), na);\n        if (n > 0) {\n          result = rf(result, input);\n        }\n        if (!(nn > 0)) {\n          return ensure_reduced(result);\n        } else {\n          return result;\n        }\n      }\n    };\n  };\n}\n\nexport function take(n, coll) {\n  if (arguments.length === 1) {\n    return take1(n);\n  }\n  return lazy(function* () {\n    let i = n - 1;\n    for (const x of iterable(coll)) {\n      if (i-- >= 0) {\n        yield x;\n      }\n      if (i < 0) {\n        return;\n      }\n    }\n  });\n}\n\nexport function take_last(n, coll) {\n  if (n <= 0) {\n    return null;\n  }\n  if (Array.isArray(coll)) {\n    return seq(coll.slice(-n));\n  } else {\n    const lastN = new Array(n);\n    let i = 0;\n    for (const x of iterable(coll)) {\n      lastN[i % n] = x;\n      i++;\n    }\n    if (i % n !== 0 && i >= n) {\n      return lastN.slice(i % n).concat(lastN.slice(0, i % n));\n    } else {\n      lastN.length = Math.min(i, n);\n      return lastN;\n    }\n  }\n}\n\nfunction take_while1(pred) {\n  return (rf) => {\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) return rf();\n      if (al === 1) return rf(args[0]);\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        if (truth_(pred(input))) {\n          return rf(result, input);\n        } else {\n          return reduced(result);\n        }\n      }\n    };\n  };\n}\n\nexport function take_while(pred, coll) {\n  pred = toFn(pred);\n  if (arguments.length === 1) {\n    return take_while1(pred);\n  }\n  return lazy(function* () {\n    for (const o of iterable(coll)) {\n      if (truth_(pred(o))) yield o;\n      else return;\n    }\n  });\n}\n\nfunction take_nth1(n) {\n  return (rf) => {\n    let ia = -1;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) return rf();\n      if (al === 1) return rf(args[0]);\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        ia++;\n        const i = ia;\n        if (rem(i, n) === 0) {\n          return rf(result, input);\n        } else return result;\n      }\n    };\n  };\n}\n\nexport function take_nth(n, coll) {\n  if (arguments.length === 1) return take_nth1(n);\n  if (n <= 0) {\n    return repeat(first(coll));\n  }\n\n  return lazy(function* () {\n    let i = 0;\n    for (const x of iterable(coll)) {\n      if (i % n === 0) {\n        yield x;\n      }\n      i++;\n    }\n  });\n}\n\nexport function partial(f, ...xs) {\n  f = toFn(f);\n  return function (...args) {\n    return f(...xs, ...args);\n  };\n}\n\nexport function cycle(coll) {\n  return lazy(function* () {\n    while (true) yield* coll;\n  });\n}\n\nfunction drop1(n) {\n  return (rf) => {\n    let na = n;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) {\n        return rf();\n      }\n      if (al === 1) {\n        return rf(args[0]);\n      }\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        const n = na;\n        na--;\n        if (n > 0) {\n          return result;\n        } else return rf(result, input);\n      }\n    };\n  };\n}\n\nexport function drop(n, xs) {\n  if (arguments.length === 1) return drop1(n);\n  return lazy(function* () {\n    const iter = _iterator(iterable(xs));\n    for (let x = 0; x < n; x++) {\n      iter.next();\n    }\n    yield* iter;\n  });\n}\n\nfunction drop_while1(pred) {\n  return (rf) => {\n    let da = true;\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) {\n        return rf();\n      }\n      if (al === 1) {\n        return rf(args[0]);\n      }\n      if (al === 2) {\n        const isDrop = da;\n        const result = args[0];\n        const input = args[1];\n        if (isDrop && truth_(pred(input))) {\n          return result;\n        } else {\n          da = null;\n          return rf(result, input);\n        }\n      }\n    };\n  };\n}\n\nexport function drop_while(pred, xs) {\n  pred = toFn(pred);\n  if (arguments.length === 1) return drop_while1(pred);\n  return lazy(function* () {\n    const iter = _iterator(iterable(xs));\n    while (true) {\n      const nextItem = iter.next();\n      if (nextItem.done) {\n        break;\n      }\n      const value = nextItem.value;\n      if (!truth_(pred(value))) {\n        yield value;\n        break;\n      }\n    }\n    yield* iter;\n  });\n}\n\nfunction distinct1() {\n  return (rf) => {\n    const seen = new Set();\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) return rf();\n      if (al === 1) return rf(args[0]);\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        if (seen.has(input)) return result;\n        seen.add(input);\n        return rf(result, input);\n      }\n    };\n  };\n}\n\nexport function distinct(coll) {\n  if (arguments.length === 0) return distinct1();\n  return lazy(function* () {\n    const seen = new Set();\n    for (const x of iterable(coll)) {\n      if (!seen.has(x)) yield x;\n      seen.add(x);\n    }\n    return;\n  });\n}\n\nexport function update(coll, k, f, ...args) {\n  f = toFn(f);\n  return assoc(coll, k, f(get(coll, k), ...args));\n}\n\nexport function get_in(coll, path, orElse) {\n  let entry = coll;\n  for (const item of path) {\n    entry = get(entry, item);\n  }\n  if (entry === undefined) return orElse;\n  return entry;\n}\n\nexport function update_in(coll, path, f, ...args) {\n  f = toFn(f);\n  return assoc_in(coll, path, f(get_in(coll, path), ...args));\n}\n\nexport function fnil(f, x, ...xs) {\n  f = toFn(f);\n  return function (a, ...args) {\n    if (!a) {\n      return f(x, ...xs, ...args);\n    } else {\n      return f(a, ...xs, ...args);\n    }\n  };\n}\n\nexport function every_QMARK_(pred, coll) {\n  pred = toFn(pred);\n  for (const x of iterable(coll)) {\n    if (!pred(x)) return false;\n  }\n  return true;\n}\n\nexport function not_every_QMARK_(pred, coll) {\n  return !every_QMARK_(pred, coll);\n}\n\nfunction keep1(pred) {\n  return (rf) => {\n    return (...args) => {\n      const al = args.length;\n      if (al === 0) return rf();\n      if (al === 1) return rf(args[0]);\n      if (al === 2) {\n        const result = args[0];\n        const input = args[1];\n        const v = pred(input);\n        if (v == null) return result;\n        return rf(result, v);\n      }\n    };\n  };\n}\n\nexport function keep(pred, coll) {\n  pred = toFn(pred);\n  if (arguments.length === 1) return keep1(pred);\n  return lazy(function* () {\n    for (const o of iterable(coll)) {\n      const res = pred(o);\n      if (truth_(res)) yield res;\n    }\n  });\n}\n\nexport function reverse(coll) {\n  coll = iterable(coll);\n  return [...coll].reverse();\n}\n\nexport function sort(f, coll) {\n  if (arguments.length === 1) {\n    coll = f;\n    f = undefined;\n  }\n  f = toFn(f);\n  coll = iterable(coll);\n  // we need to clone coll since .sort works in place and .toSorted isn't available on Node < 20\n  const clone = [...coll];\n  // result is guaranteed to be stable since ES2019, like CLJS\n  return clone.sort(f || compare);\n}\n\nfunction fnToComparator(f) {\n  if (f === compare) {\n    return f;\n  }\n  return (x, y) => {\n    const r = f(x, y);\n    if (number_QMARK_(r)) {\n      return r;\n    }\n    if (r) {\n      return -1;\n    }\n    if (f(y, x)) {\n      return 1;\n    }\n    return 0;\n  };\n}\n\nexport function sort_by(keyfn, comp, coll) {\n  if (arguments.length === 2) {\n    coll = comp;\n    comp = compare;\n  }\n  keyfn = toFn(keyfn);\n  comp = toFn(comp);\n  return sort((x, y) => {\n    const f = fnToComparator(comp);\n    const kx = keyfn(x);\n    const ky = keyfn(y);\n    return f(kx, ky);\n  }, coll);\n}\n\nexport function shuffle(coll) {\n  const result = [...coll];\n  let remaining = coll.length;\n  while (remaining) {\n    const i = Math.floor(Math.random() * remaining--);\n    const tmp = result[remaining];\n    result[remaining] = result[i];\n    result[i] = tmp;\n  }\n\n  return result;\n}\n\nexport function some(pred, coll) {\n  pred = toFn(pred);\n  for (const o of iterable(coll)) {\n    const res = pred(o);\n    if (truth_(res)) return res;\n  }\n  return undefined;\n}\n\nexport function not_any_QMARK_(pred, coll) {\n  pred = toFn(pred);\n  return !some(pred, coll);\n}\n\nexport function replace(smap, coll) {\n  const mapf = Array.isArray(coll) ? mapv : map;\n  return mapf((x) => {\n    const repl = smap[x];\n    if (repl !== undefined) {\n      return repl;\n    } else {\n      return x;\n    }\n  }, coll);\n}\n\nexport function empty_QMARK_(coll) {\n  return seq(coll) ? false : true;\n}\n\nexport function rand(n) {\n  if (undefined === n) {\n    n = 1;\n  }\n  return Math.random() * n;\n}\n\nexport function rand_int(n) {\n  return Math.floor(Math.random() * n);\n}\n\nexport function rand_nth(coll) {\n  const ri = rand_int(count(coll));\n  return nth(coll, ri);\n}\n\nfunction _repeatedly(f) {\n  return lazy(function* () {\n    while (true) yield f();\n  });\n}\n\nexport function repeatedly(n, f) {\n  if (arguments.length === 1) {\n    f = n;\n    n = undefined;\n  }\n  const res = _repeatedly(f);\n  if (n) {\n    return take(n, res);\n  } else {\n    return res;\n  }\n}\n\nexport function update_BANG_(m, k, f, ...args) {\n  f = toFn(f);\n  const v = get(m, k);\n  return assoc_BANG_(m, k, f(v, ...args));\n}\n\nexport function group_by(f, coll) {\n  f = toFn(f);\n  const res = {};\n  for (const o of iterable(coll)) {\n    const key = f(o);\n    update_BANG_(res, key, fnil(conj_BANG_, []), o);\n  }\n  return res;\n}\n\nexport function frequencies(coll) {\n  const res = {};\n  const uf = fnil(inc, 0);\n  for (const o of iterable(coll)) {\n    update_BANG_(res, o, uf);\n  }\n  return res;\n}\n\nexport class LazySeq {\n  constructor(f) {\n    this.f = f;\n    this.res = undefined;\n  }\n  *[Symbol.iterator]() {\n    if (this.res === undefined) {\n      this.res = this.f();\n      this.f = null;\n    }\n    yield* iterable(this.res);\n  }\n}\n\nexport function butlast(coll) {\n  const x = [...iterable(coll)];\n  x.pop();\n  return x.length > 0 ? x : null;\n}\n\nexport function drop_last(...args) {\n  const [n, coll] = args.length > 1 ? args : [1, args[0]];\n  return map((x, _) => x, coll, drop(n, coll));\n}\n\nexport function split_at(n, coll) {\n  return [take(n, coll), drop(n, coll)];\n}\n\nexport function split_with(pred, coll) {\n  return [take_while(pred, coll), drop_while(pred, coll)];\n}\n\nexport function count(coll) {\n  if (!coll) return 0;\n  const len = coll.length || coll.size;\n  if (typeof len === 'number') {\n    return len;\n  }\n  let ret = 0;\n  for (const _ of iterable(coll)) {\n    ret++;\n  }\n  return ret;\n}\n\nexport function true_QMARK_(x) {\n  return x === true;\n}\n\nexport function false_QMARK_(x) {\n  return x === false;\n}\n\nexport function some_QMARK_(x) {\n  return !(x === null || x === undefined);\n}\n\nexport function boolean$(x) {\n  return !!x;\n}\n\nexport function zero_QMARK_(x) {\n  return x === 0;\n}\n\nexport function neg_QMARK_(x) {\n  return x < 0;\n}\n\nexport function pos_QMARK_(x) {\n  return x > 0;\n}\n\nexport function js_obj(...args) {\n  let ctr = 0;\n  const ret = {};\n  for (;;) {\n    if (ctr >= args.length) {\n      break;\n    }\n    ret[args[ctr]] = args[ctr + 1];\n    ctr = ctr + 2;\n  }\n  return ret;\n}\n\nexport function alength(arr) {\n  return arr.length;\n}\n\nexport function aset(arr, idx, val, ...more) {\n  if (more.length == 0) {\n    arr[idx] = val;\n    return val;\n  } else {\n    const path = [idx, val, ...more];\n    const _val = path[path.length - 1];\n    let innerArray = arr;\n    let _idx = 0;\n    const _pathLen = path.length - 2;\n    for (; _idx < _pathLen; _idx++) {\n      innerArray = innerArray[path[_idx]];\n    }\n    innerArray[path[_idx]] = _val;\n    return val;\n  }\n}\n\nexport function dorun(x) {\n  for (const _ of iterable(x)) {\n    // nothing here, just consume for side effects\n  }\n  return null;\n}\n\nexport function doall(x) {\n  // realize as concrete array\n  return vec(x);\n}\n\nexport function aclone(arr) {\n  const cloned = [...arr];\n  return cloned;\n}\n\nexport function add_watch(ref, key, fn) {\n  return ref._add_watch(key, fn);\n}\n\nexport function remove_watch(ref, key) {\n  return ref._remove_watch(key);\n}\n\nexport function reduce_kv(f, init, m) {\n  if (!m) {\n    return init;\n  }\n  var ret = init;\n  for (const o of iterable(m)) {\n    ret = f(ret, o[0], o[1]);\n  }\n  return ret;\n}\n\nexport function max(x, y, ...more) {\n  if (y == undefined) {\n    return x;\n  }\n  return Math.max(x, y, ...more);\n}\n\nexport function min(x, y, ...more) {\n  if (y == undefined) {\n    return x;\n  }\n  return Math.min(x, y, ...more);\n}\n\nexport function map_QMARK_(coll) {\n  if (coll == null) return false;\n  if (isObj(coll)) return true;\n  if (coll instanceof Map) return true;\n  return false;\n}\n\nexport function every_pred(...preds) {\n  return (...args) => {\n    for (const p of preds) {\n      for (const a of args) {\n        const res = p(a);\n        if (!res) {\n          return false;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nexport function some_fn(...fns) {\n  return (...args) => {\n    for (const f of fns) {\n      for (const a of args) {\n        const res = f(a);\n        if (res) {\n          return res;\n        }\n      }\n    }\n    return undefined;\n  };\n}\n\nexport function into_array(type, aseq) {\n  const theSeq = aseq || type;\n  return vec(theSeq);\n}\n\nexport function iterate(f, x) {\n  var current = x;\n  return lazy(function* () {\n    while (true) {\n      yield current;\n      current = f(current);\n    }\n  });\n}\n\nexport function juxt(...fs) {\n  fs = fs.map(toFn);\n  return (...args) => {\n    const ret = [];\n    for (const f of fs) {\n      ret.push(f(...args));\n    }\n    return ret;\n  };\n}\n\nexport function next(x) {\n  if (Array.isArray(x)) {\n    const ret = x.slice(1);\n    if (ret.length > 0) {\n      return ret;\n    } else {\n      return null;\n    }\n  } else {\n    return seq(rest(x));\n  }\n}\n\nexport function nnext(x) {\n  return next(next(x));\n}\n\nexport function compare(x, y) {\n  if (x === y) {\n    return 0;\n  } else {\n    if (x == null) {\n      return -1;\n    }\n    if (y == null) {\n      return 1;\n    }\n    const tx = typeof x;\n    const ty = typeof y;\n    if ((tx === 'number' && ty === 'number') || (tx === 'string' && ty === 'string')) {\n      if (x === y) {\n        return 0;\n      }\n      if (x < y) {\n        return -1;\n      }\n      return 1;\n    } else if (Array.isArray(x) && Array.isArray(y)) {\n      // Implemented like `APersistentVector.compareTo`.\n      if (x.length < y.length) {\n        return -1;\n      } else if (x.length > y.length) {\n        return 1;\n      } else {\n        for (let i = 0; i < x.length; i++) {\n          const c = compare(x[i], y[i]);\n          if (c != 0) {\n            return c;\n          }\n        }\n        return 0;\n      }\n    } else {\n      throw new Error(`comparing ${tx} to ${ty}`);\n    }\n  }\n}\n\nexport function to_array(aseq) {\n  return into_array(aseq);\n}\n\nexport function truth_(x) {\n  return x != null && x !== false;\n}\n\nexport const t = truth_; // backward compat, remove in 2025\n\nexport function subs(s, start, end) {\n  return s.substring(start, end);\n}\n\nexport function fn_QMARK_(x) {\n  return 'function' === typeof x;\n}\n\nexport function re_seq(re, s) {\n  return lazy(function* () {\n    while (true) {\n      const matches = re.exec(s);\n      if (matches) {\n        const match_str = matches[0];\n        const match_vals = matches.length === 1 ? match_str : vec(matches);\n        yield match_vals;\n        const post_idx = matches.index + max(1, match_str.length);\n        if (post_idx > s.length) break;\n        s = subs(s, post_idx);\n      } else break;\n    }\n  });\n}\n\nexport function NaN_QMARK_(x) {\n  return Number.isNaN(x);\n}\n\nexport function number_QMARK_(x) {\n  return typeof x == 'number';\n}\n\nexport function keys(obj) {\n  if (obj == null) return;\n  const t = typeConst(obj);\n  switch (t) {\n    case OBJECT_TYPE:\n      return Object.keys(obj);\n    case MAP_TYPE:\n      return Array.from(obj.keys());\n  }\n}\n\nexport function js_keys(obj) {\n  return keys(obj);\n}\n\nexport function vals(obj) {\n  if (obj == null) return;\n  const t = typeConst(obj);\n  switch (t) {\n    case OBJECT_TYPE:\n      return Object.values(obj);\n    case MAP_TYPE:\n      return Array.from(obj.values());\n  }\n}\n\nexport function string_QMARK_(s) {\n  return typeof s === 'string';\n}\n\nexport function coll_QMARK_(coll) {\n  return typeConst(coll) != undefined;\n}\n\nexport function regexp_QMARK_(coll) {\n  return coll instanceof RegExp;\n}\n\nclass ExceptionInfo extends Error {\n  constructor(message, data, cause) {\n    super(message);\n    this._data = data;\n    this._cause = cause;\n  }\n}\n\nexport function ex_data(e) {\n  if (e instanceof ExceptionInfo) return e._data;\n  else return null;\n}\n\nexport function ex_message(e) {\n  if (e instanceof Error) return e.message;\n  else return null;\n}\n\nexport function ex_cause(e) {\n  if (e instanceof ExceptionInfo) return e._cause;\n  else return null;\n}\n\nexport function ex_info(message, data, cause) {\n  return new ExceptionInfo(message, data, cause);\n}\n\nexport function int_QMARK_(x) {\n  return Number.isInteger(x);\n}\n\nexport const integer_QMARK_ = int_QMARK_;\n\nexport function pos_int_QMARK_(x) {\n  return int_QMARK_(x) && x > 0;\n}\n\nexport function nat_int_QMARK_(x) {\n  return int_QMARK_(x) && x > -1;\n}\n\nexport function neg_int_QMARK_(x) {\n  return int_QMARK_(x) && x < 0;\n}\n\nconst _metaSym = Symbol('meta');\n\nexport function meta(x) {\n  if (x instanceof Object) {\n    return x[_metaSym];\n  } else return null;\n}\n\nexport function with_meta(x, m) {\n  const ret = copy(x);\n  ret[_metaSym] = m;\n  return ret;\n}\n\nexport function boolean_QMARK_(x) {\n  return x === true || x === false;\n}\n\nexport function counted_QMARK_(x) {\n  const tc = typeConst(x);\n  switch (tc) {\n    case ARRAY_TYPE:\n    case MAP_TYPE:\n    case OBJECT_TYPE:\n    case LIST_TYPE:\n    case SET_TYPE:\n      return true;\n  }\n  return false;\n}\n\nexport function bounded_count(n, coll) {\n  if (counted_QMARK_(coll)) {\n    return count(coll);\n  } else {\n    return count(take(n, coll));\n  }\n}\n\nexport function find(m, k) {\n  const v = get(m, k);\n  if (v !== undefined) {\n    return [k, v];\n  }\n}\n\nexport function mod(x, y) {\n  return ((x % y) + y) % y;\n}\n\nexport function min_key(k, x, ...more) {\n  if (more.length == 0) {\n    return x;\n  }\n  var kx = k(x);\n  var min = x;\n  more.forEach((y) => {\n    var ky = k(y);\n    if (ky <= kx) {\n      kx = ky;\n      min = y;\n    }\n  });\n  return min;\n}\n\nexport function max_key(k, x, ...more) {\n  if (more.length == 0) {\n    return x;\n  }\n  var kx = k(x);\n  var max = x;\n  more.forEach((y) => {\n    var ky = k(y);\n    if (ky >= kx) {\n      kx = ky;\n      max = y;\n    }\n  });\n  return max;\n}\n\nfunction parsing_err(x) {\n  throw new Error(`Expected string, got: ${typeof x}`);\n}\n\nexport function parse_long(s) {\n  if (string_QMARK_(s)) {\n    if (/^[+-]?\\d+$/.test(s)) {\n      const i = parseInt(s);\n      if (Number.MIN_SAFE_INTEGER <= i <= Number.MAX_SAFE_INTEGER) {\n        return i;\n      }\n    }\n    return null;\n  }\n  return parsing_err(s);\n}\n\nexport function parse_double(s) {\n  if (string_QMARK_(s)) {\n    if (/^[\\\\x00-\\\\x20]*[+-]?NaN[\\\\x00-\\\\x20]*$/.test(s)) {\n      return NaN;\n    } else if (\n      /^[\\\\x00-\\\\x20]*[+-]?(Infinity|((\\d+\\.?\\d*|\\.\\d+)([eE][+-]?\\d+)?)[dDfF]?)[\\\\x00-\\\\x20]*$/.test(\n        s\n      )\n    ) {\n      return parseFloat(s);\n    } else {\n      return null;\n    }\n  } else {\n    throw new parsing_err(s);\n  }\n}\n\nfunction fix(q) {\n  if (q >= 0) {\n    return Math.floor(q);\n  }\n  return Math.ceil(q);\n}\n\nexport function quot(n, d) {\n  const rem = n % d;\n  return fix((n - rem) / d);\n}\n\nexport function trampoline(f, ...args) {\n  if (args.length == 0) {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const ret = f();\n      if (truth_(fn_QMARK_(ret))) {\n        f = ret;\n        continue;\n      } else {\n        return ret;\n      }\n    }\n  } else {\n    return trampoline(function () {\n      return apply(f, args);\n    });\n  }\n}\n\nexport function transduce(xform, ...args) {\n  switch (args.length) {\n    case 2: {\n      const f = args[0];\n      const coll = args[1];\n      return transduce(xform, f, f(), coll);\n    }\n    default: {\n      let f = args[0];\n      const init = args[1];\n      const coll = args[2];\n      f = xform(f);\n      const ret = reduce(f, init, coll);\n      return f(ret);\n    }\n  }\n}\n\nexport function zipmap(keys, vals) {\n  const res = {};\n  const keyIterator = iterable(keys)[Symbol.iterator]();\n  const valIterator = iterable(vals)[Symbol.iterator]();\n  let nextKey, nextVal;\n  for (;;) {\n    nextKey = keyIterator.next();\n    if (nextKey.done) break;\n    nextVal = valIterator.next();\n    if (nextVal.done) break;\n    res[nextKey.value] = nextVal.value;\n  }\n  return res;\n}\n\nexport function not_empty(x) {\n  const isSeq = seq(x);\n  if (isSeq) {\n    return x;\n  } else return null;\n}\n\nexport function tree_seq(isBranch, children, root) {\n  const walk = function* (node) {\n    yield node;\n    if (truth_(isBranch(node))) {\n      for (const c of iterable(children(node))) {\n        yield* walk(c);\n      }\n    }\n  };\n  return lazy(function* () {\n    yield* walk(root);\n  });\n}\n\nexport function flatten(x) {\n  return filter(complement(sequential_QMARK_), rest(tree_seq(sequential_QMARK_, seq, x)));\n}\n\nexport function transient$(x) {\n  return copy(x);\n}\n\nexport function persistent_BANG_(x) {\n  return Object.freeze(x);\n}\n\nclass SortedSet {\n  constructor(xs) {\n    const isSorted = xs instanceof SortedSet;\n    if (!isSorted) {\n      xs = sort(xs);\n    }\n    const s = new Set(xs);\n    // we don't re-use xs since xs can contain duplicates\n    this._elts = [...s];\n    this._set = s;\n  }\n  add(x) {\n    if (this._set.has(x)) return this;\n    const xs = this._elts;\n    let added = false;\n    for (let i = 0; i < xs.length; i++) {\n      if (compare(x, xs[i]) <= 0) {\n        xs.splice(i, 0, x);\n        added = true;\n        break;\n      }\n    }\n    if (!added) {\n      xs.push(x);\n      // in this case we can re-use the set, since we add the element last\n      this._set.add(x);\n    } else {\n      this._set = new Set(xs);\n    }\n    this.size = xs.length;\n    return this;\n  }\n  delete(x) {\n    if (!this._set.has(x)) return this;\n    const xs = this._elts;\n    const idx = xs.indexOf(x);\n    xs.splice(idx, 1);\n    this._set = new Set(xs);\n    this.size = xs.length;\n    return this;\n  }\n  has(x) {\n    return this._set.has(x);\n  }\n  keys() {\n    return this.values();\n  }\n  values() {\n    return this._elts[Symbol.iterator]();\n  }\n  entries() {\n    return this._set.entries();\n  }\n  forEach(...xs) {\n    return this.set.forEach(...xs);\n  }\n  clear() {\n    this._elts = [];\n    this._set = new Set(this._elts);\n  }\n  [Symbol.iterator]() {\n    return this.keys();\n  }\n}\n\nexport function sorted_set(...xs) {\n  return new SortedSet(xs);\n}\n\nfunction mkBoundFn(_sc, test, key) {\n  return (e) => {\n    return test(compare(e, key), 0);\n  };\n}\n\nfunction indexFrom(sc, startKey, _asc = true) {\n  let i = 0;\n  for (; i < sc.length; i++) {\n    if (!(compare(startKey, sc[i]) > 0)) {\n      break;\n    }\n  }\n  return i;\n}\n\nfunction subseq3([sc, test, key]) {\n  const includeFn = mkBoundFn(sc, test, key);\n  if (test === _GT_ || test === _GT__EQ_) {\n    const seqFrom = [...sc];\n    const startIdx = indexFrom(seqFrom, key, true);\n    // delete startIdx items from the start;\n    seqFrom.splice(0, startIdx);\n    if (includeFn(seqFrom[0])) {\n      return seqFrom;\n    } else {\n      // delete 1 item from the start;\n      seqFrom.splice(0, 1);\n      return seqFrom;\n    }\n  } else {\n    return [...take_while(includeFn, sc)];\n  }\n}\n\nfunction subseq5([sc, startTest, startKey, endTest, endKey]) {\n  const seqFrom = [...sc];\n  const startIdx = indexFrom(seqFrom, startKey, true);\n  // delete startIdx items from the start\n  seqFrom.splice(0, startIdx);\n  const whileFn = mkBoundFn(sc, endTest, endKey);\n  if (!mkBoundFn(sc, startTest, startKey)(seqFrom[0])) {\n    // delete 1 item from the start\n    seqFrom.splice(0, 1);\n  }\n  return [...take_while(whileFn, seqFrom)];\n}\n\nexport function subseq(...xs) {\n  if (xs.length === 3) {\n    return subseq3(xs);\n  }\n  if (xs.length === 5) {\n    return subseq5(xs);\n  }\n}\n\nexport function abs(x) {\n  return Math.abs(x);\n}\n\nexport function long$(x) {\n  return fix(x);\n}\n\nexport function type(x) {\n  return x != null && x.constructor;\n}\n\nfunction preserving_reduced(rf) {\n  return (a1, a2) => {\n    const ret = rf(a1, a2);\n    if (reduced_QMARK_(ret)) {\n      return reduced(ret);\n    } else return ret;\n  };\n}\n\nexport function cat(rf) {\n  rf = preserving_reduced(rf);\n  return (...args) => {\n    switch (args.length) {\n      case 0:\n        return rf();\n      case 1:\n        return rf(args[0]);\n      case 2:\n        return reduce(rf, args[0], args[1]);\n    }\n  };\n}\n\nexport function rem(n, d) {\n  const q = quot(n, d);\n  return n - d * q;\n}\n\nexport function memoize(f) {\n  const cache = new Map();\n  return (...xs) => {\n    const path = [xs.length, ...xs];\n    const res = get_in(cache, path);\n    if (res === undefined) {\n      const v = f(...xs);\n      assoc_in_BANG_(cache, path, v);\n      return v;\n    } else return res;\n  };\n}\n\nexport function peek(vec) {\n  if (array_QMARK_(vec)) {\n    return vec[vec.length - 1];\n  } else {\n    return first(vec);\n  }\n}\n\nexport function pop(vec) {\n  if (array_QMARK_(vec)) {\n    const ret = [...vec];\n    ret.pop();\n    return ret;\n  } else {\n    return rest(vec);\n  }\n}\n\nexport function update_keys(m, f) {\n  const m2 = empty(m);\n  const assocFn = getAssocMut(m) || assoc_BANG_;\n  reduce_kv(\n    (acc, k, v) => {\n      return assocFn(acc, f(k), v);\n    },\n    m2,\n    m\n  );\n  return m2;\n}\n\nexport function update_vals(m, f) {\n  const m2 = empty(m);\n  const assocFn = getAssocMut(m) || assoc_BANG_;\n  reduce_kv(\n    (acc, k, v) => {\n      return assocFn(acc, k, f(v));\n    },\n    m2,\n    m\n  );\n  return m2;\n}\n\nexport function random_uuid() {\n  return crypto.randomUUID();\n}\n\nexport class Delay {\n  constructor(f) {\n    this.f = f;\n  }\n  _deref() {\n    if (this.realized) {\n      return this.v;\n    } else {\n      this.v = this.f();\n      this.realized = true;\n      return this.v;\n    }\n  }\n}\n\nfunction clj__GT_js_(x, seen) {\n  // we need to protect against circular objects\n  if (seen.has(x)) return x;\n  seen.add(x);\n  if (map_QMARK_(x)) {\n    return update_vals(x, (x) => clj__GT_js_(x, seen));\n  }\n\n  const tc = typeConst(x);\n  if (tc && tc != OBJECT_TYPE) {\n    return mapv((x) => clj__GT_js_(x, seen), x);\n  }\n  return x;\n}\n\nexport function clj__GT_js(x) {\n  return clj__GT_js_(x, new Set());\n}\n\nexport function run_BANG_(proc, coll) {\n  reduce((_, x) => proc(x), null, coll);\n}\n\nexport function not_EQ_(...more) {\n  return not(_EQ_(...more));\n}\n\nclass Volatile {\n  constructor(v) {\n    this.v = v;\n  }\n  _deref() {\n    return this.v;\n  }\n}\n\nexport function volatile_BANG_(x) {\n  return new Volatile(x);\n}\n\nexport function vreset_BANG_(vol, v) {\n  vol.v = v;\n}\n\nfunction toEDN(value, seen = new WeakSet()) {\n  if (value === null) return 'nil';\n  if (typeof value === 'number' || typeof value === 'boolean') return String(value);\n  if (typeof value === 'string') return JSON.stringify(value);\n  if (typeof value === 'bigint') return `${value}N`;\n\n  if (typeof value === 'object') {\n    if (seen.has(value)) return '#object[circular]';\n    seen.add(value);\n    const T = typeConst(value);\n    let keys;\n    switch (T) {\n      case ARRAY_TYPE:\n        return `[${value.map((v) => toEDN(v, seen)).join(' ')}]`;\n      case SET_TYPE:\n        return `#{${Array.from(value)\n          .map((v) => toEDN(v, seen))\n          .join(' ')}}`;\n      case MAP_TYPE:\n        return `#js/Map {${Array.from(value.entries())\n          .map(([k, v]) => `${toEDN(k, seen)} ${toEDN(v, seen)}`)\n          .join(', ')}}`;\n      case LAZY_ITERABLE_TYPE:\n      case LIST_TYPE:\n        return `(${mapv((v) => `${toEDN(v, seen)}`, value).join(', ')})`;\n      default:\n        keys = Object.keys(value);\n        return `{${keys.map((k) => `:${k} ${toEDN(value[k], seen)}`).join(', ')}}`;\n    }\n  }\n\n  return `#object[${value.constructor.name}]`;\n}\n\nexport function pr_str(...xs) {\n  return xs.map((v, _) => toEDN(v)).join(' ');\n}\n\nexport function prn(...xs) {\n  return console.log(pr_str(...xs));\n}\n",
    "import * as squint_core from 'squint-cljs/core.js';\nvar svg_ns = \"http://www.w3.org/2000/svg\";\nvar parse_tag = function (tag) {\nconst id_index1 = (() => {\nconst index2 = tag.indexOf(\"#\");\nif ((index2 > 0)) {\nreturn index2;\n};\n\n})();\nconst class_index3 = (() => {\nconst index4 = tag.indexOf(\".\");\nif ((index4 > 0)) {\nreturn index4;\n};\n\n})();\nreturn [((squint_core.truth_(id_index1)) ? (tag.substring(0, id_index1)) : (((squint_core.truth_(class_index3)) ? (tag.substring(0, class_index3)) : (((\"else\") ? (tag) : (null)))))), ((squint_core.truth_(id_index1)) ? (((squint_core.truth_(class_index3)) ? (tag.substring((id_index1 + 1), class_index3)) : (tag.substring((id_index1 + 1))))) : (null)), ((squint_core.truth_(class_index3)) ? (tag.substring((class_index3 + 1))) : (null))];\n\n};\nvar properties = (new Set([\"checked\", \"disabled\", \"selected\", \"value\", \"innerHTML\"]));\nvar property_QMARK_ = function (x) {\nreturn properties.has(x);\n\n};\nvar array_seq = function (s) {\nreturn s;\n\n};\nvar name = function (s) {\nreturn s;\n\n};\nvar hiccup_seq_QMARK_ = function (x) {\nreturn (squint_core.not(squint_core.string_QMARK_(x)) && (() => {\nconst and__23210__auto__1 = squint_core.seq_QMARK_(x);\nif (squint_core.truth_(and__23210__auto__1)) {\nreturn squint_core.not(squint_core.vector_QMARK_(x))} else {\nreturn and__23210__auto__1};\n\n})());\n\n};\nvar move_to_back = function (o, v) {\nif (v in o) {\nconst value1 = o[v];\ndelete o[v];\nreturn (o[v] = value1);\n};\n\n};\nvar create_vnode_STAR_ = function (hiccup, in_svg_QMARK_) {\nif (squint_core.truth_((() => {\nconst or__23188__auto__1 = (hiccup == null);\nif (or__23188__auto__1) {\nreturn or__23188__auto__1} else {\nconst or__23188__auto__2 = squint_core.string_QMARK_(hiccup);\nif (squint_core.truth_(or__23188__auto__2)) {\nreturn or__23188__auto__2} else {\nconst or__23188__auto__3 = squint_core.number_QMARK_(hiccup);\nif (squint_core.truth_(or__23188__auto__3)) {\nreturn or__23188__auto__3} else {\nreturn squint_core.boolean_QMARK_(hiccup)};\n};\n};\n\n})())) {\nreturn ({\"tag\": \"#text\", \"text\": `${hiccup??''}`})} else {\nif (squint_core.truth_(squint_core.vector_QMARK_(hiccup))) {\nconst tag7 = hiccup[0];\nconst children_idx8 = 1;\nconst vec__49 = ((squint_core.truth_(squint_core.string_QMARK_(tag7))) ? (parse_tag(tag7)) : ([tag7]));\nconst tag10 = squint_core.nth(vec__49, 0, null);\nconst id11 = squint_core.nth(vec__49, 1, null);\nconst class$12 = squint_core.nth(vec__49, 2, null);\nconst classes13 = ((squint_core.truth_(class$12)) ? (class$12.split(\".\")) : (null));\nconst first_child14 = hiccup[children_idx8];\nconst attr_idx15 = ((squint_core.truth_(squint_core.map_QMARK_(first_child14))) ? (1) : (-1));\nconst children_idx16 = (((-1 === attr_idx15)) ? (children_idx8) : ((children_idx8 + 1)));\nconst in_svg_QMARK_17 = (() => {\nconst or__23188__auto__18 = in_svg_QMARK_;\nif (squint_core.truth_(or__23188__auto__18)) {\nreturn or__23188__auto__18} else {\nreturn (\"svg\" === tag10)};\n\n})();\nconst node19 = ((squint_core.truth_(squint_core.fn_QMARK_(tag10))) ? ((() => {\nconst res20 = squint_core.apply(tag10, hiccup.slice(1));\nreturn create_vnode_STAR_(res20, in_svg_QMARK_17);\n\n})()) : ((() => {\nconst new_children21 = [];\nconst node22 = ({\"type\": \"element\", \"svg\": in_svg_QMARK_17, \"tag\": ((squint_core.truth_(in_svg_QMARK_17)) ? (tag10) : (tag10.toUpperCase())), \"children\": new_children21});\nconst modified_props23 = ({});\nconst modified_attrs24 = ({});\n(node22[\"reagami.core/props\"] = modified_props23);\n(node22[\"reagami.core/attrs\"] = modified_attrs24);\nconst n325 = (hiccup.length - children_idx16);\nfor (let i=0;i<n325;i++) {\n(() => {\nconst child26 = hiccup[(i + children_idx16)];\nif (squint_core.truth_(hiccup_seq_QMARK_(child26))) {\nfor (let G__27 of squint_core.iterable(child26)) {\nconst x28 = G__27;\nnew_children21.push(create_vnode_STAR_(x28, in_svg_QMARK_17))\n}\nreturn null} else {\nreturn new_children21.push(create_vnode_STAR_(child26, in_svg_QMARK_17))};\n\n})()\n};\nif ((-1 === attr_idx15)) {\n} else {\nconst attrs29 = hiccup[1];\nconst entry_names30 = Object.getOwnPropertyNames(attrs29);\nconst entry_count31 = entry_names30.length;\nif (squint_core.truth_((() => {\nconst or__23188__auto__32 = \"max\" in attrs29;\nif (or__23188__auto__32) {\nreturn or__23188__auto__32} else {\nreturn \"min\" in attrs29};\n\n})())) {\nmove_to_back(attrs29, \"default-value\");\nmove_to_back(attrs29, \"value\")};\nconst n433 = entry_count31;\nfor (let i=0;i<n433;i++) {\n(() => {\nconst k34 = entry_names30[i];\nconst v35 = attrs29[k34];\nif ((\"on-render\" === k34)) {\nreturn (node22[\"reagami.core/on-render\"] = v35)} else {\nif (squint_core.truth_(k34.startsWith(\"on\"))) {\nconst event36 = k34.replaceAll(\"-\", \"\");\nreturn (modified_props23[event36] = v35);\n} else {\nif (squint_core.truth_(k34.startsWith(\"default\"))) {\nconst default_attr37 = squint_core.subs(k34, 7).replaceAll(\"-\", \"\");\nreturn (modified_attrs24[default_attr37] = v35);\n} else {\nif (\"else\") {\nif (squint_core.truth_(((\"style\" === k34) && squint_core.object_QMARK_(v35)))) {\nconst style38 = squint_core.reduce((function (s, e) {\nreturn `${s??''}${e[0]??''}${\": \"}${e[1]??''}${\";\"}`;\n\n}), \"\", Object.entries(v35));\nreturn (modified_attrs24[\"style\"] = style38);\n} else {\nif (squint_core.truth_(property_QMARK_(k34))) {\nreturn (modified_props23[k34] = v35)} else {\nif (\"else\") {\nif (squint_core.truth_(v35)) {\nreturn (modified_attrs24[k34] = v35);\n}} else {\nreturn null}}};\n} else {\nreturn null}}}};\n\n})()\n};\n};\nif (squint_core.truth_((!(classes13 == null) && (classes13.length > 0)))) {\n(modified_attrs24[\"class\"] = `${(() => {\nconst temp__22881__auto__39 = modified_attrs24[\"class\"];\nif (squint_core.truth_(temp__22881__auto__39)) {\nconst c40 = temp__22881__auto__39;\nreturn `${c40??''}${\" \"}`;\n};\n\n})()??''}${classes13.join(\" \")??''}`)};\nif (squint_core.truth_(id11)) {\n(modified_attrs24[\"id\"] = id11)};\nreturn node22;\n\n})()));\nreturn node19;\n} else {\nif (\"else\") {\nthrow (() => {\nconsole.error(\"Invalid hiccup:\", hiccup);\nreturn (new Error(`${\"Invalid hiccup: \"}${hiccup??''}`))\n})()} else {\nreturn null}}};\n\n};\nvar create_vnode = function (hiccup) {\nreturn create_vnode_STAR_(hiccup, false);\n\n};\nvar ref_registry = (new Map());\nvar create_node = function (vnode, root) {\nconst node1 = (() => {\nconst temp__22832__auto__2 = vnode[\"text\"];\nif (squint_core.truth_(temp__22832__auto__2)) {\nconst text3 = temp__22832__auto__2;\nreturn document.createTextNode(text3);\n} else {\nconst tag4 = vnode[\"tag\"];\nconst node5 = ((squint_core.truth_(vnode[\"svg\"])) ? (document.createElementNS(svg_ns, tag4)) : (document.createElement(tag4)));\nconst props6 = vnode[\"reagami.core/props\"];\nconst attrs7 = vnode[\"reagami.core/attrs\"];\nconst attr_names8 = Object.getOwnPropertyNames(attrs7);\nconst prop_names9 = Object.getOwnPropertyNames(props6);\nconst n510 = attr_names8.length;\nfor (let i=0;i<n510;i++) {\n(() => {\nconst n11 = attr_names8[i];\nconst new_attr12 = attrs7[n11];\nreturn node5.setAttribute(n11, new_attr12);\n\n})()\n};\nconst n613 = prop_names9.length;\nfor (let i=0;i<n613;i++) {\n(() => {\nconst n14 = prop_names9[i];\nconst new_prop15 = props6[n14];\nconst new_prop16 = (((void 0 === new_prop15)) ? (null) : (new_prop15));\nreturn (node5[n14] = new_prop16);\n\n})()\n};\nconst temp__22881__auto__17 = vnode[\"children\"];\nif (squint_core.truth_(temp__22881__auto__17)) {\nconst children18 = temp__22881__auto__17;\nconst len19 = children18.length;\nconst n720 = len19;\nfor (let i=0;i<n720;i++) {\n(() => {\nconst child21 = children18[i];\nreturn node5.appendChild(create_node(child21, root));\n\n})()\n};\n};\nconst temp__22881__auto__22 = vnode[\"reagami.core/on-render\"];\nif (squint_core.truth_(temp__22881__auto__22)) {\nconst ref23 = temp__22881__auto__22;\n(node5[\"reagami.core/on-render\"] = ref23);\nsquint_core.update_BANG_(ref_registry, root, squint_core.fnil(squint_core.conj, (new Set ([]))), node5)};\nreturn node5;\n};\n\n})();\n(node1[\"reagami.core/vnode\"] = vnode);\nreturn node1;\n\n};\nvar patch = function (parent, new_children, root) {\nconst parent_vnode1 = parent[\"reagami.core/vnode\"];\nconst old_children_count2 = ((squint_core.truth_((() => {\nconst and__23210__auto__3 = parent_vnode1;\nif (squint_core.truth_(and__23210__auto__3)) {\nreturn squint_core.not(parent[\"reagami.core/root\"])} else {\nreturn and__23210__auto__3};\n\n})())) ? (parent_vnode1[\"children\"].length) : ((((root === parent)) ? (parent.childNodes.length) : (((\"else\") ? (-1) : (null))))));\nif ((-1 === old_children_count2)) {\nreturn null} else {\nconst old_children4 = parent.childNodes;\nconst new_children_count5 = squint_core.count(new_children);\nif (!(old_children_count2 === new_children_count5)) {\nreturn parent.replaceChildren.apply(parent, new_children.map((function (_PERCENT_1) {\nreturn create_node(_PERCENT_1, root);\n\n})))} else {\nconst n86 = new_children_count5;\nfor (let i=0;i<n86;i++) {\n(() => {\nconst old7 = old_children4[i];\nconst old_vnode8 = old7[\"reagami.core/vnode\"];\nconst new_vnode9 = new_children[i];\nconst txt_old10 = old_vnode8[\"text\"];\nconst txt11 = new_vnode9[\"text\"];\nconst new_tag12 = new_vnode9[\"tag\"];\nif (squint_core.truth_((() => {\nconst and__23210__auto__13 = txt_old10;\nif (squint_core.truth_(and__23210__auto__13)) {\nreturn txt11} else {\nreturn and__23210__auto__13};\n\n})())) {\nif ((txt11 === txt_old10)) {\nreturn null} else {\nold7.textContent = txt11;\nreturn (old7[\"reagami.core/vnode\"] = new_vnode9);\n}} else {\nif (squint_core.truth_((() => {\nconst and__23210__auto__14 = old7;\nif (squint_core.truth_(and__23210__auto__14)) {\nconst and__23210__auto__15 = old_vnode8;\nif (squint_core.truth_(and__23210__auto__15)) {\nconst and__23210__auto__16 = new_vnode9;\nif (squint_core.truth_(and__23210__auto__16)) {\nreturn (new_tag12 === old_vnode8[\"tag\"])} else {\nreturn and__23210__auto__16};\n} else {\nreturn and__23210__auto__15};\n} else {\nreturn and__23210__auto__14};\n\n})())) {\nconst old_props17 = old_vnode8[\"reagami.core/props\"];\nconst old_attrs18 = old_vnode8[\"reagami.core/attrs\"];\nconst new_props19 = new_vnode9[\"reagami.core/props\"];\nconst new_attrs20 = new_vnode9[\"reagami.core/attrs\"];\nconst old_prop_names21 = Object.getOwnPropertyNames(old_props17);\nconst old_attr_names22 = Object.getOwnPropertyNames(old_attrs18);\nconst new_attr_names23 = Object.getOwnPropertyNames(new_attrs20);\nconst new_prop_names24 = Object.getOwnPropertyNames(new_props19);\nconst n925 = squint_core.count(old_prop_names21);\nfor (let i=0;i<n925;i++) {\n(() => {\nconst o26 = old_prop_names21[i];\nif (o26 in new_props19) {\nreturn null} else {\nreturn (old7[o26] = null);\n};\n\n})()\n};\nconst n1027 = squint_core.count(old_attr_names22);\nfor (let i=0;i<n1027;i++) {\n(() => {\nconst o28 = old_attr_names22[i];\nif (o28 in new_attrs20) {\nreturn null} else {\nreturn old7.removeAttribute(o28);\n};\n\n})()\n};\nconst n1129 = squint_core.count(new_attr_names23);\nfor (let i=0;i<n1129;i++) {\n(() => {\nconst n30 = new_attr_names23[i];\nconst new_attr31 = new_attrs20[n30];\nif ((new_attr31 === old_attrs18[n30])) {\nreturn null} else {\nreturn old7.setAttribute(n30, new_attr31);\n};\n\n})()\n};\nconst n1232 = squint_core.count(new_prop_names24);\nfor (let i=0;i<n1232;i++) {\n(() => {\nconst n33 = new_prop_names24[i];\nconst new_prop34 = (() => {\nconst v35 = new_props19[n33];\nif ((void 0 === v35)) {\nreturn null} else {\nreturn v35};\n\n})();\nif ((old_props17[n33] === new_prop34)) {\nreturn null} else {\nreturn (old7[n33] = new_prop34);\n};\n\n})()\n};\nconst temp__22881__auto__36 = new_vnode9[\"children\"];\nif (squint_core.truth_(temp__22881__auto__36)) {\nconst new_children37 = temp__22881__auto__36;\npatch(old7, new_children37, root)};\nreturn (old7[\"reagami.core/vnode\"] = new_vnode9);\n} else {\nif (\"else\") {\nconst new_node38 = create_node(new_vnode9, root);\nreturn parent.replaceChild(new_node38, old7);\n} else {\nreturn null}}};\n\n})()\n};\nreturn null;\n};\n};\n\n};\nvar render = function (root, hiccup) {\nif (squint_core.truth_(root[\"reagami.core/root\"])) {\n} else {\nroot.textContent = \"\";\n(root[\"reagami.core/root\"] = true)};\nconst new_node1 = create_vnode(hiccup);\npatch(root, [new_node1], root);\nfor (let G__2 of squint_core.iterable(ref_registry.get(root))) {\nconst node3 = G__2;\nconst ref4 = node3[\"reagami.core/on-render\"];\nif (squint_core.truth_(node3.isConnected)) {\nif (squint_core.not(ref4[\"reagami.core/is-run\"])) {\nconst data5 = ref4(node3, \"mount\", null);\n(ref4[\"reagami.core/is-run\"] = true);\n(ref4[\"reagami.core/data\"] = data5)} else {\nconst data6 = ref4(node3, \"update\", ref4[\"reagami.core/data\"]);\n(ref4[\"reagami.core/data\"] = data6)}} else {\nref4(node3, \"unmount\", ref4[\"reagami.core/data\"]);\ndelete ref4[\"reagami.core/data\"];\nsquint_core.update_BANG_(ref_registry, root, squint_core.disj, node3)}\n}\nreturn null;\n\n};\n\nexport { properties, svg_ns, ref_registry, name, create_node, array_seq, render, hiccup_seq_QMARK_, property_QMARK_ }\n",
    "import * as squint_core from 'squint-cljs/core.js';\nimport * as Ably from 'ably';\nvar client_id = squint_core.str(squint_core.random_uuid());\nvar state = squint_core.atom(({ \"ably\": null, \"connection-status\": \"initialized\" }));\nvar ably_client = function () {\nreturn squint_core.get(squint_core.deref(state), \"ably\");\n\n};\nvar connection_status = function () {\nreturn squint_core.get(squint_core.deref(state), \"connection-status\");\n\n};\nvar connected_QMARK_ = function () {\nreturn (\"connected\" === squint_core.get(squint_core.deref(state), \"connection-status\"));\n\n};\nvar Realtime = Ably.default.Realtime;\nvar init_BANG_ = function (api_key) {\nconst client1 = new Realtime(({ \"key\": api_key, \"clientId\": client_id }));\nclient1.connection.on((function (state_change) {\nconst status2 = state_change.current;\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"connection-status\", status2);\n\n}));\nsquint_core.swap_BANG_(state, squint_core.assoc, \"ably\", client1);\nreturn client1;\n\n};\nvar channel = function (name) {\nreturn ably_client().channels.get(name);\n\n};\nvar enter_presence_BANG_ = (() => {\nconst f1 = (function (...args2) {\nconst G__31 = args2.length;\nswitch (G__31) {case 1:\nreturn f1.cljs$core$IFn$_invoke$arity$1(args2[0]);\n\nbreak;\ncase 2:\nreturn f1.cljs$core$IFn$_invoke$arity$2(args2[0], args2[1]);\n\nbreak;\ndefault:\nthrow new Error(squint_core.str(\"Invalid arity: \", args2.length))};\n\n});\nf1.cljs$core$IFn$_invoke$arity$1 = (function (channel_name) {\nreturn enter_presence_BANG_(channel_name, null);\n\n});\nf1.cljs$core$IFn$_invoke$arity$2 = (function (channel_name, data) {\nreturn channel(channel_name).presence.enter(data).catch((function (_PERCENT_1) {\nreturn squint_core.println(\"Presence enter failed:\", _PERCENT_1);\n\n}));\n\n});\nf1.cljs$lang$maxFixedArity = 2;\nreturn f1;\n\n})();\nvar update_presence_BANG_ = function (channel_name, data) {\nreturn channel(channel_name).presence.update(data).catch((function (_PERCENT_1) {\nreturn squint_core.println(\"Presence update failed:\", _PERCENT_1);\n\n}));\n\n};\nvar on_presence_change_BANG_ = function (channel_name, callback) {\nconst presence1 = channel(channel_name).presence;\npresence1.subscribe((function (_) {\nreturn callback();\n\n}));\nreturn ably_client().connection.once(\"connected\", callback);\n\n};\nvar get_presence_members = function (channel_name, callback) {\nreturn channel(channel_name).presence.get().then((function (members) {\nreturn callback(squint_core.vec(members));\n\n})).catch((function (_PERCENT_1) {\nreturn squint_core.println(\"Get presence failed:\", _PERCENT_1);\n\n}));\n\n};\nvar publish_BANG_ = function (channel_name, event, data) {\nreturn channel(channel_name).publish(event, data).catch((function (_PERCENT_1) {\nreturn squint_core.println(\"Publish failed:\", _PERCENT_1);\n\n}));\n\n};\nvar subscribe_BANG_ = function (channel_name, callback) {\nreturn channel(channel_name).subscribe(callback);\n\n};\n\nexport { connection_status, on_presence_change_BANG_, publish_BANG_, ably_client, get_presence_members, Realtime, init_BANG_, connected_QMARK_, state, subscribe_BANG_, channel, update_presence_BANG_, client_id, enter_presence_BANG_ }\n",
    "import * as squint_core from 'squint-cljs/core.js';\nvar config = ({ \"axis-color\": \"#374151\", \"grid-divisions\": 10, \"selection-fill\": \"rgba(59, 130, 246, 0.2)\", \"handle-color\": \"rgba(100, 100, 100, 0.4)\", \"axis-label-color\": \"#6b7280\", \"selected-stroke\": \"rgba(59, 130, 246, 1)\", \"point-stroke-width\": 2, \"foreground-grid-color\": \"rgba(0, 0, 0, 0.3)\", \"handle-width\": 8, \"padding\": 60, \"selected-stroke-width\": 2, \"selection-stroke\": \"rgba(59, 130, 246, 0.8)\", \"grid-color\": \"#e5e7eb\", \"point-radius\": 8 });\nvar clear_canvas_BANG_ = function (ctx, width, height) {\nctx.fillStyle = \"#ffffff\";\nreturn ctx.fillRect(0, 0, width, height);\n\n};\nvar draw_grid_BANG_ = function (ctx, width, height, padding, divisions, color) {\nconst draw_width1 = (width) - ((2) * (padding));\nconst draw_height2 = (height) - ((2) * (padding));\nconst step_x3 = (draw_width1) / (divisions);\nconst step_y4 = (draw_height2) / (divisions);\nctx.strokeStyle = color;\nctx.lineWidth = 1;\nfor (let G__5 of squint_core.iterable(squint_core.range((divisions + 1)))) {\nconst i6 = G__5;\nconst x7 = (padding) + ((i6) * (step_x3));\nctx.beginPath();\nctx.moveTo(x7, padding);\nctx.lineTo(x7, (height) - (padding));\nctx.stroke()\n};\nfor (let G__8 of squint_core.iterable(squint_core.range((divisions + 1)))) {\nconst i9 = G__8;\nconst y10 = (height) - (padding) - ((i9) * (step_y4));\nctx.beginPath();\nctx.moveTo(padding, y10);\nctx.lineTo((width) - (padding), y10);\nctx.stroke()\n}return null;\n\n};\nvar draw_axes_BANG_ = function (ctx, width, height, padding) {\nctx.strokeStyle = squint_core.get(config, \"axis-color\");\nctx.lineWidth = 2;\nctx.beginPath();\nctx.moveTo(padding, (height) - (padding));\nctx.lineTo((width) - (padding), (height) - (padding));\nctx.stroke();\nctx.beginPath();\nctx.moveTo(padding, padding);\nctx.lineTo(padding, (height) - (padding));\nctx.stroke();\nctx.fillStyle = squint_core.get(config, \"axis-color\");\nctx.beginPath();\nctx.moveTo((width) - (padding), (height) - (padding));\nctx.lineTo((width) - (padding) - (10), (height) - (padding) - (5));\nctx.lineTo((width) - (padding) - (10), ((height) - (padding)) + (5));\nctx.closePath();\nctx.fill();\nctx.beginPath();\nctx.moveTo(padding, padding);\nctx.lineTo((padding) - (5), (padding) + (10));\nctx.lineTo((padding) + (5), (padding) + (10));\nctx.closePath();\nreturn ctx.fill();\n\n};\nvar draw_axis_labels_BANG_ = function (ctx, width, height, padding) {\nctx.fillStyle = squint_core.get(config, \"axis-label-color\");\nctx.font = \"14px system-ui, sans-serif\";\nctx.textAlign = \"center\";\nctx.textBaseline = \"top\";\nctx.fillText(\"Valid Time\", (width) / (2), (height) - (padding) - (-20));\nctx.save();\nctx.translate((padding) - (30), (height) / (2));\nctx.rotate(-(Math.PI) / (2));\nctx.textAlign = \"center\";\nctx.textBaseline = \"bottom\";\nctx.fillText(\"System Time\", 0, 0);\nreturn ctx.restore();\n\n};\nvar draw_ticks_BANG_ = function (ctx, width, height, padding, divisions) {\nconst draw_width1 = (width) - ((2) * (padding));\nconst draw_height2 = (height) - ((2) * (padding));\nconst step_x3 = (draw_width1) / (divisions);\nconst step_y4 = (draw_height2) / (divisions);\nconst tick_length5 = 6;\nctx.fillStyle = squint_core.get(config, \"axis-label-color\");\nctx.strokeStyle = squint_core.get(config, \"axis-color\");\nctx.lineWidth = 1;\nctx.font = \"10px system-ui, sans-serif\";\nctx.textAlign = \"center\";\nctx.textBaseline = \"top\";\nfor (let G__6 of squint_core.iterable(squint_core.range((divisions + 1)))) {\nconst i7 = G__6;\nconst x8 = (padding) + ((i7) * (step_x3));\nconst y9 = (height) - (padding);\nctx.beginPath();\nctx.moveTo(x8, y9);\nctx.lineTo(x8, (y9) + (tick_length5));\nctx.stroke();\nctx.fillText(squint_core.str(\"t\", i7), x8, (y9) + (tick_length5) + (2))\n};\nctx.textAlign = \"right\";\nctx.textBaseline = \"middle\";\nfor (let G__10 of squint_core.iterable(squint_core.range((divisions + 1)))) {\nconst i11 = G__10;\nconst x12 = padding;\nconst y13 = (height) - (padding) - ((i11) * (step_y4));\nctx.beginPath();\nctx.moveTo(x12, y13);\nctx.lineTo((x12) - (tick_length5), y13);\nctx.stroke();\nctx.fillText(squint_core.str(\"t\", i11), (x12) - (tick_length5) - (2), y13)\n}return null;\n\n};\nvar rgb__GT_css = function (p__9) {\nconst vec__14 = p__9;\nconst r5 = squint_core.nth(vec__14, 0, null);\nconst g6 = squint_core.nth(vec__14, 1, null);\nconst b7 = squint_core.nth(vec__14, 2, null);\nreturn squint_core.str(\"rgb(\", r5, \",\", g6, \",\", b7, \")\");\n\n};\nvar sort_events_by_system_time = function (events) {\nreturn squint_core.sort_by(\"_system_from\", events);\n\n};\nvar draw_event_BANG_ = function (ctx, event, width, height, padding, selected_QMARK_) {\nconst map__12 = event;\nconst _valid_from3 = squint_core.get(map__12, \"_valid_from\");\nconst _valid_to4 = squint_core.get(map__12, \"_valid_to\");\nconst _system_from5 = squint_core.get(map__12, \"_system_from\");\nconst color6 = squint_core.get(map__12, \"color\");\nconst open_QMARK_7 = (_valid_to4 == null);\nconst draw_width8 = (width) - ((2) * (padding));\nconst draw_height9 = (height) - ((2) * (padding));\nconst handle_width10 = squint_core.get(config, \"handle-width\");\nconst x111 = (padding) + ((_valid_from3) * (draw_width8));\nconst x212 = (padding) + ((((open_QMARK_7) ? (1) : (_valid_to4))) * (draw_width8));\nconst y_bottom13 = (height) - (padding) - ((_system_from5) * (draw_height9));\nconst y_top14 = padding;\nctx.fillStyle = rgb__GT_css(color6);\nctx.fillRect(x111, y_top14, (x212) - (x111), (y_bottom13) - (y_top14));\nif (squint_core.truth_(selected_QMARK_)) {\nctx.strokeStyle = squint_core.get(config, \"selected-stroke\");\nctx.lineWidth = squint_core.get(config, \"selected-stroke-width\")} else {\nctx.strokeStyle = \"#000000\";\nctx.lineWidth = 1};\nctx.beginPath();\nctx.moveTo(x111, y_top14);\nctx.lineTo(x111, y_bottom13);\nctx.lineTo(x212, y_bottom13);\nif (open_QMARK_7) {\n} else {\nctx.lineTo(x212, y_top14)};\nctx.stroke();\nif (open_QMARK_7) {\nreturn null} else {\nctx.fillStyle = squint_core.get(config, \"handle-color\");\nreturn ctx.fillRect((x212) - (handle_width10), y_top14, handle_width10, (y_bottom13) - (y_top14));\n};\n\n};\nvar draw_events_BANG_ = function (ctx, events, width, height, padding, selected) {\nconst indexed_events1 = squint_core.map_indexed(squint_core.vector, events);\nconst sorted_events2 = squint_core.sort_by((function (_PERCENT_1) {\nreturn squint_core.get(squint_core.second(_PERCENT_1), \"_system_from\");\n\n}), indexed_events1);\nfor (let G__3 of squint_core.iterable(sorted_events2)) {\nconst vec__47 = G__3;\nconst idx8 = squint_core.nth(vec__47, 0, null);\nconst event9 = squint_core.nth(vec__47, 1, null);\ndraw_event_BANG_(ctx, event9, width, height, padding, squint_core.contains_QMARK_(selected, idx8))\n}return null;\n\n};\nvar draw_point_BANG_ = function (ctx, point, width, height, padding, selected_QMARK_) {\nconst map__12 = point;\nconst x3 = squint_core.get(map__12, \"x\");\nconst y4 = squint_core.get(map__12, \"y\");\nconst color5 = squint_core.get(map__12, \"color\");\nconst draw_width6 = (width) - ((2) * (padding));\nconst draw_height7 = (height) - ((2) * (padding));\nconst radius8 = squint_core.get(config, \"point-radius\");\nconst px9 = (padding) + ((x3) * (draw_width6));\nconst py10 = (height) - (padding) - ((y4) * (draw_height7));\nctx.fillStyle = rgb__GT_css(color5);\nctx.beginPath();\nctx.arc(px9, py10, radius8, 0, (2) * (Math.PI));\nctx.fill();\nif (squint_core.truth_(selected_QMARK_)) {\nctx.strokeStyle = squint_core.get(config, \"selected-stroke\");\nctx.lineWidth = squint_core.get(config, \"selected-stroke-width\")} else {\nctx.strokeStyle = \"#000000\";\nctx.lineWidth = 1};\nreturn ctx.stroke();\n\n};\nvar draw_points_BANG_ = function (ctx, points, width, height, padding, selected_points) {\nfor (let G__1 of squint_core.iterable(squint_core.map_indexed(squint_core.vector, points))) {\nconst vec__25 = G__1;\nconst idx6 = squint_core.nth(vec__25, 0, null);\nconst point7 = squint_core.nth(vec__25, 1, null);\ndraw_point_BANG_(ctx, point7, width, height, padding, squint_core.contains_QMARK_(selected_points, idx6))\n}return null;\n\n};\nvar draw_selection_box_BANG_ = function (ctx, width, height, padding, selection_box) {\nif (squint_core.truth_(selection_box)) {\nconst map__12 = selection_box;\nconst start3 = squint_core.get(map__12, \"start\");\nconst end4 = squint_core.get(map__12, \"end\");\nconst draw_width5 = (width) - ((2) * (padding));\nconst draw_height6 = (height) - ((2) * (padding));\nconst x17 = (padding) + ((squint_core.get(start3, \"x\")) * (draw_width5));\nconst y18 = (height) - (padding) - ((squint_core.get(start3, \"y\")) * (draw_height6));\nconst x29 = (padding) + ((squint_core.get(end4, \"x\")) * (draw_width5));\nconst y210 = (height) - (padding) - ((squint_core.get(end4, \"y\")) * (draw_height6));\nconst rx11 = squint_core.min(x17, x29);\nconst ry12 = squint_core.min(y18, y210);\nconst rw13 = Math.abs((x29) - (x17));\nconst rh14 = Math.abs((y210) - (y18));\nctx.fillStyle = squint_core.get(config, \"selection-fill\");\nctx.fillRect(rx11, ry12, rw13, rh14);\nctx.strokeStyle = squint_core.get(config, \"selection-stroke\");\nctx.lineWidth = 1;\nreturn ctx.strokeRect(rx11, ry12, rw13, rh14);\n};\n\n};\nvar render_canvas_BANG_ = function (canvas, events, opts) {\nif (squint_core.truth_(canvas)) {\nconst ctx1 = canvas.getContext(\"2d\");\nconst width2 = canvas.width;\nconst height3 = canvas.height;\nconst padding4 = squint_core.get(config, \"padding\");\nconst divisions5 = squint_core.get(config, \"grid-divisions\");\nconst show_grid6 = squint_core.get(opts, \"show-grid\", false);\nconst show_ticks7 = squint_core.get(opts, \"show-ticks\", false);\nconst selection_box8 = squint_core.get(opts, \"selection-box\");\nconst selected9 = (() => {\nconst or__23141__auto__10 = squint_core.get(opts, \"selected\");\nif (squint_core.truth_(or__23141__auto__10)) {\nreturn or__23141__auto__10} else {\nreturn new Set([])};\n\n})();\nconst points11 = (() => {\nconst or__23141__auto__12 = squint_core.get(opts, \"points\");\nif (squint_core.truth_(or__23141__auto__12)) {\nreturn or__23141__auto__12} else {\nreturn []};\n\n})();\nconst selected_points13 = (() => {\nconst or__23141__auto__14 = squint_core.get(opts, \"selected-points\");\nif (squint_core.truth_(or__23141__auto__14)) {\nreturn or__23141__auto__14} else {\nreturn new Set([])};\n\n})();\nclear_canvas_BANG_(ctx1, width2, height3);\ndraw_grid_BANG_(ctx1, width2, height3, padding4, divisions5, squint_core.get(config, \"grid-color\"));\ndraw_axes_BANG_(ctx1, width2, height3, padding4);\ndraw_axis_labels_BANG_(ctx1, width2, height3, padding4);\nif (squint_core.truth_(show_ticks7)) {\ndraw_ticks_BANG_(ctx1, width2, height3, padding4, divisions5)};\ndraw_events_BANG_(ctx1, events, width2, height3, padding4, selected9);\ndraw_points_BANG_(ctx1, points11, width2, height3, padding4, selected_points13);\nif (squint_core.truth_(show_grid6)) {\ndraw_grid_BANG_(ctx1, width2, height3, padding4, divisions5, squint_core.get(config, \"foreground-grid-color\"))};\nreturn draw_selection_box_BANG_(ctx1, width2, height3, padding4, selection_box8);\n};\n\n};\n\nexport { draw_ticks_BANG_, config, sort_events_by_system_time, draw_grid_BANG_, draw_axis_labels_BANG_, rgb__GT_css, draw_point_BANG_, render_canvas_BANG_, draw_event_BANG_, clear_canvas_BANG_, draw_selection_box_BANG_, draw_events_BANG_, draw_axes_BANG_, draw_points_BANG_ }\n",
    "import * as squint_core from 'squint-cljs/core.js';\nimport * as reagami from 'reagami';\nimport './entry.css';\nimport * as ably from './ably.js';\nimport * as canvas from './canvas.js';\nvar ABLY_API_KEY = \"Vr1zhQ.IsKO2g:nY_BkeBtmxQxs0W_MYZNkx-34cZBzzNLOrrAARrygfQ\";\nvar GLOBAL_CHANNEL = \"global\";\nvar STORAGE_KEY = \"bitemporal-visualizer\";\nvar SAVED_STATES_KEY = \"bitemporal-saved-states\";\nvar generate_room_code = function () {\nconst chars1 = \"ABCDEFGHJKLMNPQRSTUVWXYZ23456789\";\nconst len2 = 6;\nreturn squint_core.apply(squint_core.str, squint_core.repeatedly(len2, (function () {\nreturn squint_core.nth(chars1, squint_core.rand_int(squint_core.count(chars1)));\n\n})));\n\n};\nvar room_channel_name = function (code) {\nreturn squint_core.str(\"room:\", code);\n\n};\nvar default_events = [({ \"_valid_from\": 0.1, \"_valid_to\": 0.4, \"_system_from\": 0.1, \"color\": [59, 130, 246] }), ({ \"_valid_from\": 0.2, \"_valid_to\": 0.6, \"_system_from\": 0.2, \"color\": [34, 197, 94] }), ({ \"_valid_from\": 0.3, \"_valid_to\": 0.7, \"_system_from\": 0.3, \"color\": [249, 115, 22] }), ({ \"_valid_from\": 0.1, \"_valid_to\": 0.5, \"_system_from\": 0.4, \"color\": [168, 85, 247] }), ({ \"_valid_from\": 0.5, \"_valid_to\": 0.9, \"_system_from\": 0.5, \"color\": [236, 72, 153] })];\nvar default_settings = ({ \"show-grid\": false, \"snap-to-grid\": false, \"show-ticks\": false });\nvar save_to_storage_BANG_ = function (data) {\nreturn localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n\n};\nvar load_from_storage = function () {\nconst temp__22756__auto__1 = localStorage.getItem(STORAGE_KEY);\nif (squint_core.truth_(temp__22756__auto__1)) {\nconst stored2 = temp__22756__auto__1;\nreturn JSON.parse(stored2);\n};\n\n};\nvar get_persisted_state = function () {\nconst stored1 = load_from_storage();\nreturn ({ \"events\": (() => {\nconst or__23141__auto__2 = squint_core.get(stored1, \"events\");\nif (squint_core.truth_(or__23141__auto__2)) {\nreturn or__23141__auto__2} else {\nreturn default_events};\n\n})(), \"points\": (() => {\nconst or__23141__auto__3 = squint_core.get(stored1, \"points\");\nif (squint_core.truth_(or__23141__auto__3)) {\nreturn or__23141__auto__3} else {\nreturn []};\n\n})(), \"show-grid\": squint_core.get(stored1, \"show-grid\", squint_core.get(default_settings, \"show-grid\")), \"snap-to-grid\": squint_core.get(stored1, \"snap-to-grid\", squint_core.get(default_settings, \"snap-to-grid\")), \"show-ticks\": squint_core.get(stored1, \"show-ticks\", squint_core.get(default_settings, \"show-ticks\")) });\n\n};\nvar save_saved_states_BANG_ = function (saved_states) {\nreturn localStorage.setItem(SAVED_STATES_KEY, JSON.stringify(saved_states));\n\n};\nvar load_saved_states = function () {\nconst temp__22756__auto__1 = localStorage.getItem(SAVED_STATES_KEY);\nif (squint_core.truth_(temp__22756__auto__1)) {\nconst stored2 = temp__22756__auto__1;\nreturn JSON.parse(stored2);\n};\n\n};\nvar initial_persisted = get_persisted_state();\nvar initial_saved_states = (() => {\nconst or__23141__auto__1 = load_saved_states();\nif (squint_core.truth_(or__23141__auto__1)) {\nreturn or__23141__auto__1} else {\nreturn []};\n\n})();\nvar state = squint_core.atom(({ \"snap-to-grid\": squint_core.get(initial_persisted, \"snap-to-grid\"), \"syncing\": false, \"room-code\": generate_room_code(), \"events\": squint_core.get(initial_persisted, \"events\"), \"global-count\": 0, \"dml-end-date\": \"2025-01-01\", \"points\": squint_core.get(initial_persisted, \"points\"), \"auto-select\": true, \"show-ticks\": squint_core.get(initial_persisted, \"show-ticks\"), \"room-count\": 0, \"show-grid\": squint_core.get(initial_persisted, \"show-grid\"), \"current-tool\": \"select\", \"dml-start-date\": \"2024-01-01\", \"saved-states\": initial_saved_states }));\nvar canvas_ref = squint_core.atom(null);\nsquint_core.add_watch(state, \"app.app/persist\", (function (_, _1, old_state, new_state) {\nif (squint_core.truth_((() => {\nconst or__23141__auto__2 = squint_core.not_EQ_(squint_core.get(old_state, \"events\"), squint_core.get(new_state, \"events\"));\nif (squint_core.truth_(or__23141__auto__2)) {\nreturn or__23141__auto__2} else {\nconst or__23141__auto__3 = squint_core.not_EQ_(squint_core.get(old_state, \"points\"), squint_core.get(new_state, \"points\"));\nif (squint_core.truth_(or__23141__auto__3)) {\nreturn or__23141__auto__3} else {\nconst or__23141__auto__4 = squint_core.not_EQ_(squint_core.get(old_state, \"show-grid\"), squint_core.get(new_state, \"show-grid\"));\nif (squint_core.truth_(or__23141__auto__4)) {\nreturn or__23141__auto__4} else {\nconst or__23141__auto__5 = squint_core.not_EQ_(squint_core.get(old_state, \"snap-to-grid\"), squint_core.get(new_state, \"snap-to-grid\"));\nif (squint_core.truth_(or__23141__auto__5)) {\nreturn or__23141__auto__5} else {\nreturn squint_core.not_EQ_(squint_core.get(old_state, \"show-ticks\"), squint_core.get(new_state, \"show-ticks\"))};\n};\n};\n};\n\n})())) {\nreturn save_to_storage_BANG_(({ \"events\": squint_core.get(new_state, \"events\"), \"points\": squint_core.get(new_state, \"points\"), \"show-grid\": squint_core.get(new_state, \"show-grid\"), \"snap-to-grid\": squint_core.get(new_state, \"snap-to-grid\"), \"show-ticks\": squint_core.get(new_state, \"show-ticks\") }));\n};\n\n}));\nsquint_core.add_watch(state, \"app.app/persist-saved-states\", (function (_, _1, old_state, new_state) {\nif (squint_core.truth_(squint_core.not_EQ_(squint_core.get(old_state, \"saved-states\"), squint_core.get(new_state, \"saved-states\")))) {\nreturn save_saved_states_BANG_(squint_core.get(new_state, \"saved-states\"));\n};\n\n}));\nvar drag_state = squint_core.atom(({ \"select-start\": null, \"point-offsets\": null, \"selected\": new Set([]), \"dragging-point\": null, \"multi-offsets\": null, \"offset-y\": 0, \"mode\": null, \"selected-points\": new Set([]), \"dragging\": null, \"offset-x\": 0, \"select-end\": null }));\nvar context_menu = squint_core.atom(({ \"open\": false, \"x\": 0, \"y\": 0, \"target-indices\": new Set([]), \"target-point-indices\": new Set([]) }));\nvar close_context_menu_BANG_ = function () {\nreturn squint_core.reset_BANG_(context_menu, ({ \"open\": false, \"x\": 0, \"y\": 0, \"target-indices\": new Set([]), \"target-point-indices\": new Set([]) }));\n\n};\nvar PADDING = 60;\nvar HANDLE_WIDTH = 8;\nvar POINT_RADIUS = 8;\nvar MIN_DURATION = 0.05;\nvar GRID_DIVISIONS = 10;\nvar snap_to_grid_value = function (v) {\n\"Round a normalized 0..1 value to the nearest grid line (0.1 increments)\";\nconst step1 = (1) / (GRID_DIVISIONS);\nreturn (step1) * (Math.round((v) / (step1)));\n\n};\nvar render_canvas_BANG_ = function (canvas_el) {\nconst container2 = canvas_el.parentElement;\nconst width3 = container2.clientWidth;\nconst height4 = container2.clientHeight;\nconst map__15 = squint_core.deref(drag_state);\nconst mode6 = squint_core.get(map__15, \"mode\");\nconst select_start7 = squint_core.get(map__15, \"select-start\");\nconst select_end8 = squint_core.get(map__15, \"select-end\");\nconst selected9 = squint_core.get(map__15, \"selected\");\nconst selected_points10 = squint_core.get(map__15, \"selected-points\");\nif (squint_core.truth_((() => {\nconst and__23153__auto__11 = (width3 > 0);\nif (and__23153__auto__11) {\nreturn (height4 > 0)} else {\nreturn and__23153__auto__11};\n\n})())) {\ncanvas_el.width = width3;\ncanvas_el.height = height4;\nreturn canvas.render_canvas_BANG_(canvas_el, squint_core.get(squint_core.deref(state), \"events\"), ({ \"show-grid\": squint_core.get(squint_core.deref(state), \"show-grid\"), \"show-ticks\": squint_core.get(squint_core.deref(state), \"show-ticks\"), \"selection-box\": ((squint_core.truth_((() => {\nconst or__23141__auto__12 = (mode6 === \"select\");\nif (squint_core.truth_(or__23141__auto__12)) {\nreturn or__23141__auto__12} else {\nreturn (mode6 === \"draw\")};\n\n})())) ? (({ \"start\": select_start7, \"end\": select_end8 })) : (null)), \"selected\": selected9, \"points\": squint_core.get(squint_core.deref(state), \"points\"), \"selected-points\": selected_points10 }));\n};\n\n};\nvar canvas__GT_normalized = function (canvas_el, client_x, client_y) {\n\"Convert canvas pixel coordinates to 0..1 normalized coordinates\";\nconst rect1 = canvas_el.getBoundingClientRect();\nconst canvas_x2 = (client_x) - (rect1.left);\nconst canvas_y3 = (client_y) - (rect1.top);\nconst width4 = canvas_el.width;\nconst height5 = canvas_el.height;\nconst draw_width6 = (width4) - ((2) * (PADDING));\nconst draw_height7 = (height5) - ((2) * (PADDING));\nconst norm_x8 = ((canvas_x2) - (PADDING)) / (draw_width6);\nconst norm_y9 = (1) - (((canvas_y3) - (PADDING)) / (draw_height7));\nreturn ({ \"x\": norm_x8, \"y\": norm_y9 });\n\n};\nvar hit_test = function (canvas_el, events, norm_x, norm_y) {\n\"Find which event (if any) contains the point. Returns {:index idx :on-handle bool} or nil.\\n   Tests in reverse order (top events first) since later events are drawn on top.\";\nconst width1 = canvas_el.width;\nconst draw_width2 = (width1) - ((2) * (PADDING));\nconst handle_norm_width3 = (HANDLE_WIDTH) / (draw_width2);\nconst sorted_indices4 = squint_core.reverse(squint_core.map(squint_core.first, squint_core.sort_by((function (_PERCENT_1) {\nreturn squint_core.get(squint_core.second(_PERCENT_1), \"_system_from\");\n\n}), squint_core.map_indexed(squint_core.vector, events))));\nreturn squint_core.first(squint_core.keep((function (idx) {\nconst event6 = squint_core.nth(events, idx);\nconst map__57 = event6;\nconst _valid_from8 = squint_core.get(map__57, \"_valid_from\");\nconst _valid_to9 = squint_core.get(map__57, \"_valid_to\");\nconst _system_from10 = squint_core.get(map__57, \"_system_from\");\nconst open_QMARK_11 = (_valid_to9 == null);\nconst effective_valid_to12 = ((open_QMARK_11) ? (1) : (_valid_to9));\nif (squint_core.truth_((() => {\nconst and__23153__auto__13 = (norm_x) >= (_valid_from8);\nif (and__23153__auto__13) {\nconst and__23153__auto__14 = (norm_x) <= (effective_valid_to12);\nif (and__23153__auto__14) {\nreturn (norm_y) >= (_system_from10)} else {\nreturn and__23153__auto__14};\n} else {\nreturn and__23153__auto__13};\n\n})())) {\nreturn ({ \"index\": idx, \"on-handle\": (() => {\nconst and__23153__auto__15 = !(open_QMARK_11);\nif (and__23153__auto__15) {\nreturn (norm_x) >= ((effective_valid_to12) - (handle_norm_width3))} else {\nreturn and__23153__auto__15};\n\n})() });\n};\n\n}), sorted_indices4));\n\n};\nvar point_hit_test = function (canvas_el, points, norm_x, norm_y) {\n\"Find which point (if any) is at the click location. Returns {:index idx} or nil.\\n   Tests in reverse order (later points are drawn on top).\";\nconst width1 = canvas_el.width;\nconst height2 = canvas_el.height;\nconst draw_width3 = (width1) - ((2) * (PADDING));\nconst draw_height4 = (height2) - ((2) * (PADDING));\nconst norm_radius_x5 = (POINT_RADIUS) / (draw_width3);\nconst norm_radius_y6 = (POINT_RADIUS) / (draw_height4);\nreturn squint_core.first(squint_core.keep((function (idx) {\nconst point8 = squint_core.nth(points, idx);\nconst map__79 = point8;\nconst x10 = squint_core.get(map__79, \"x\");\nconst y11 = squint_core.get(map__79, \"y\");\nconst dx12 = (norm_x) - (x10);\nconst dy13 = (norm_y) - (y11);\nconst dist_sq14 = (((dx12) * (dx12)) / ((norm_radius_x5) * (norm_radius_x5))) + (((dy13) * (dy13)) / ((norm_radius_y6) * (norm_radius_y6)));\nif ((dist_sq14) <= (1)) {\nreturn ({ \"index\": idx });\n};\n\n}), squint_core.reverse(squint_core.range(squint_core.count(points)))));\n\n};\nvar on_mouse_down = function (canvas_el, e) {\nif (squint_core.truth_(squint_core.get(squint_core.deref(context_menu), \"open\"))) {\nclose_context_menu_BANG_()};\nif ((e.button === 0)) {\nconst map__12 = canvas__GT_normalized(canvas_el, e.clientX, e.clientY);\nconst x3 = squint_core.get(map__12, \"x\");\nconst y4 = squint_core.get(map__12, \"y\");\nconst events5 = squint_core.get(squint_core.deref(state), \"events\");\nconst points6 = squint_core.get(squint_core.deref(state), \"points\");\nconst currently_selected7 = squint_core.get(squint_core.deref(drag_state), \"selected\");\nconst currently_selected_points8 = squint_core.get(squint_core.deref(drag_state), \"selected-points\");\nconst current_tool9 = squint_core.get(squint_core.deref(state), \"current-tool\");\nif (squint_core.truth_((current_tool9 === \"rectangle\"))) {\nreturn squint_core.reset_BANG_(drag_state, ({ \"select-start\": ({ \"x\": x3, \"y\": y4 }), \"selected\": new Set([]), \"dragging-point\": null, \"offset-y\": 0, \"mode\": \"draw\", \"selected-points\": new Set([]), \"dragging\": null, \"offset-x\": 0, \"select-end\": ({ \"x\": x3, \"y\": y4 }) }))} else {\nif (squint_core.truth_((current_tool9 === \"point\"))) {\nsquint_core.swap_BANG_(state, squint_core.update, \"points\", squint_core.conj, ({ \"x\": x3, \"y\": y4, \"color\": default_new_event_color }));\nif (squint_core.truth_(squint_core.get(squint_core.deref(state), \"auto-select\"))) {\nsquint_core.swap_BANG_(state, squint_core.assoc, \"current-tool\", \"select\")};\nreturn render_canvas_BANG_(canvas_el);\n} else {\nif (\"else\") {\nconst point_hit10 = point_hit_test(canvas_el, points6, x3, y4);\nconst event_hit11 = hit_test(canvas_el, events5, x3, y4);\nif (squint_core.truth_(point_hit10)) {\nconst map__1213 = point_hit10;\nconst index14 = squint_core.get(map__1213, \"index\");\nconst point15 = squint_core.nth(points6, index14);\nif (squint_core.truth_((() => {\nconst and__23153__auto__16 = squint_core.contains_QMARK_(currently_selected_points8, index14);\nif (squint_core.truth_(and__23153__auto__16)) {\nreturn (squint_core.count(currently_selected_points8)) > (1)} else {\nreturn and__23153__auto__16};\n\n})())) {\nconst offsets17 = squint_core.into(({  }), squint_core.map((function (idx) {\nconst p18 = squint_core.nth(points6, idx);\nreturn [idx, ({ \"offset-x\": (x3) - (squint_core.get(p18, \"x\")), \"offset-y\": (y4) - (squint_core.get(p18, \"y\")) })];\n\n}), currently_selected_points8));\nreturn squint_core.swap_BANG_(drag_state, squint_core.assoc, \"dragging-point\", index14, \"mode\", \"move-points\", \"point-offsets\", offsets17);\n} else {\nreturn squint_core.swap_BANG_(drag_state, squint_core.assoc, \"dragging-point\", index14, \"mode\", \"move-point\", \"offset-x\", (x3) - (squint_core.get(point15, \"x\")), \"offset-y\", (y4) - (squint_core.get(point15, \"y\")), \"selected\", new Set([]), \"selected-points\", new Set([index14]))};\n} else {\nif (squint_core.truth_(event_hit11)) {\nconst map__1921 = event_hit11;\nconst index22 = squint_core.get(map__1921, \"index\");\nconst on_handle23 = squint_core.get(map__1921, \"on-handle\");\nconst event24 = squint_core.nth(events5, index22);\nconst map__2025 = event24;\nconst _valid_from26 = squint_core.get(map__2025, \"_valid_from\");\nconst _valid_to27 = squint_core.get(map__2025, \"_valid_to\");\nconst _system_from28 = squint_core.get(map__2025, \"_system_from\");\nif (squint_core.truth_(on_handle23)) {\nif (squint_core.truth_((() => {\nconst and__23153__auto__29 = squint_core.contains_QMARK_(currently_selected7, index22);\nif (squint_core.truth_(and__23153__auto__29)) {\nreturn (squint_core.count(currently_selected7)) > (1)} else {\nreturn and__23153__auto__29};\n\n})())) {\nconst selected_events30 = squint_core.map((function (_PERCENT_1) {\nreturn squint_core.nth(events5, _PERCENT_1);\n\n}), currently_selected7);\nconst min_valid_from31 = squint_core.apply(squint_core.min, squint_core.map(\"_valid_from\", selected_events30));\nconst max_valid_to32 = squint_core.apply(squint_core.max, squint_core.map(\"_valid_to\", selected_events30));\nconst original_span33 = (max_valid_to32) - (min_valid_from31);\nconst original_positions34 = squint_core.into(({  }), squint_core.map((function (idx) {\nconst evt35 = squint_core.nth(events5, idx);\nreturn [idx, ({ \"_valid_from\": squint_core.get(evt35, \"_valid_from\"), \"_valid_to\": squint_core.get(evt35, \"_valid_to\") })];\n\n}), currently_selected7));\nreturn squint_core.swap_BANG_(drag_state, squint_core.assoc, \"dragging\", index22, \"mode\", \"resize-multi\", \"offset-x\", (_valid_to27) - (x3), \"anchor-point\", min_valid_from31, \"original-span\", original_span33, \"original-positions\", original_positions34);\n} else {\nreturn squint_core.swap_BANG_(drag_state, squint_core.assoc, \"dragging\", index22, \"mode\", \"resize\", \"offset-x\", (_valid_to27) - (x3), \"offset-y\", 0)}} else {\nif (squint_core.truth_((() => {\nconst and__23153__auto__36 = squint_core.contains_QMARK_(currently_selected7, index22);\nif (squint_core.truth_(and__23153__auto__36)) {\nreturn (squint_core.count(currently_selected7)) > (1)} else {\nreturn and__23153__auto__36};\n\n})())) {\nconst offsets37 = squint_core.into(({  }), squint_core.map((function (idx) {\nconst evt38 = squint_core.nth(events5, idx);\nreturn [idx, ({ \"offset-x\": (x3) - (squint_core.get(evt38, \"_valid_from\")), \"offset-y\": (squint_core.get(evt38, \"_system_from\")) - (y4) })];\n\n}), currently_selected7));\nreturn squint_core.swap_BANG_(drag_state, squint_core.assoc, \"dragging\", index22, \"mode\", \"move-multi\", \"multi-offsets\", offsets37);\n} else {\nreturn squint_core.swap_BANG_(drag_state, squint_core.assoc, \"dragging\", index22, \"mode\", \"move\", \"offset-x\", (x3) - (_valid_from26), \"offset-y\", (_system_from28) - (y4), \"selected\", new Set([index22]), \"selected-points\", new Set([]))}};\n} else {\nif (\"else\") {\nreturn squint_core.reset_BANG_(drag_state, ({ \"select-start\": ({ \"x\": x3, \"y\": y4 }), \"selected\": new Set([]), \"dragging-point\": null, \"offset-y\": 0, \"mode\": \"select\", \"selected-points\": new Set([]), \"dragging\": null, \"offset-x\": 0, \"select-end\": ({ \"x\": x3, \"y\": y4 }) }))} else {\nreturn null}}};\n} else {\nreturn null}}};\n};\n\n};\nvar events_in_selection = function (events, select_start, select_end) {\n\"Find indices of events that intersect with the selection box\";\nconst min_x1 = squint_core.min(squint_core.get(select_start, \"x\"), squint_core.get(select_end, \"x\"));\nconst max_x2 = squint_core.max(squint_core.get(select_start, \"x\"), squint_core.get(select_end, \"x\"));\nconst min_y3 = squint_core.min(squint_core.get(select_start, \"y\"), squint_core.get(select_end, \"y\"));\nconst max_y4 = squint_core.max(squint_core.get(select_start, \"y\"), squint_core.get(select_end, \"y\"));\nreturn squint_core.set(squint_core.keep_indexed((function (idx, event) {\nconst map__56 = event;\nconst _valid_from7 = squint_core.get(map__56, \"_valid_from\");\nconst _valid_to8 = squint_core.get(map__56, \"_valid_to\");\nconst _system_from9 = squint_core.get(map__56, \"_system_from\");\nconst effective_valid_to10 = (((_valid_to8 == null)) ? (1) : (_valid_to8));\nif (squint_core.truth_((() => {\nconst and__23153__auto__11 = (_valid_from7) < (max_x2);\nif (and__23153__auto__11) {\nconst and__23153__auto__12 = (effective_valid_to10) > (min_x1);\nif (and__23153__auto__12) {\nconst and__23153__auto__13 = (_system_from9) <= (max_y4);\nif (and__23153__auto__13) {\nreturn (1) >= (min_y3)} else {\nreturn and__23153__auto__13};\n} else {\nreturn and__23153__auto__12};\n} else {\nreturn and__23153__auto__11};\n\n})())) {\nreturn idx;\n};\n\n}), events));\n\n};\nvar points_in_selection = function (points, select_start, select_end) {\n\"Find indices of points that are inside the selection box\";\nconst min_x1 = squint_core.min(squint_core.get(select_start, \"x\"), squint_core.get(select_end, \"x\"));\nconst max_x2 = squint_core.max(squint_core.get(select_start, \"x\"), squint_core.get(select_end, \"x\"));\nconst min_y3 = squint_core.min(squint_core.get(select_start, \"y\"), squint_core.get(select_end, \"y\"));\nconst max_y4 = squint_core.max(squint_core.get(select_start, \"y\"), squint_core.get(select_end, \"y\"));\nreturn squint_core.set(squint_core.keep_indexed((function (idx, point) {\nconst map__56 = point;\nconst x7 = squint_core.get(map__56, \"x\");\nconst y8 = squint_core.get(map__56, \"y\");\nif (squint_core.truth_((() => {\nconst and__23153__auto__9 = (x7) >= (min_x1);\nif (and__23153__auto__9) {\nconst and__23153__auto__10 = (x7) <= (max_x2);\nif (and__23153__auto__10) {\nconst and__23153__auto__11 = (y8) >= (min_y3);\nif (and__23153__auto__11) {\nreturn (y8) <= (max_y4)} else {\nreturn and__23153__auto__11};\n} else {\nreturn and__23153__auto__10};\n} else {\nreturn and__23153__auto__9};\n\n})())) {\nreturn idx;\n};\n\n}), points));\n\n};\nvar on_mouse_move = function (canvas_el, e) {\nconst map__13 = canvas__GT_normalized(canvas_el, e.clientX, e.clientY);\nconst x4 = squint_core.get(map__13, \"x\");\nconst y5 = squint_core.get(map__13, \"y\");\nconst map__26 = squint_core.deref(drag_state);\nconst select_start7 = squint_core.get(map__26, \"select-start\");\nconst point_offsets8 = squint_core.get(map__26, \"point-offsets\");\nconst selected9 = squint_core.get(map__26, \"selected\");\nconst multi_offsets10 = squint_core.get(map__26, \"multi-offsets\");\nconst dragging_point11 = squint_core.get(map__26, \"dragging-point\");\nconst offset_y12 = squint_core.get(map__26, \"offset-y\");\nconst mode13 = squint_core.get(map__26, \"mode\");\nconst dragging14 = squint_core.get(map__26, \"dragging\");\nconst offset_x15 = squint_core.get(map__26, \"offset-x\");\nconst current_tool16 = squint_core.get(squint_core.deref(state), \"current-tool\");\nif (squint_core.truth_((() => {\nconst or__23141__auto__17 = (current_tool16 === \"rectangle\");\nif (squint_core.truth_(or__23141__auto__17)) {\nreturn or__23141__auto__17} else {\nreturn (current_tool16 === \"point\")};\n\n})())) {\ncanvas_el.style.cursor = \"crosshair\"} else {\nif (squint_core.truth_((mode13 === \"select\"))) {\ncanvas_el.style.cursor = \"crosshair\"} else {\nif (squint_core.truth_((() => {\nconst or__23141__auto__18 = dragging14;\nif (squint_core.truth_(or__23141__auto__18)) {\nreturn or__23141__auto__18} else {\nreturn dragging_point11};\n\n})())) {\ncanvas_el.style.cursor = ((squint_core.truth_((() => {\nconst or__23141__auto__19 = (mode13 === \"resize\");\nif (squint_core.truth_(or__23141__auto__19)) {\nreturn or__23141__auto__19} else {\nreturn (mode13 === \"resize-multi\")};\n\n})())) ? (\"ew-resize\") : (\"move\"))} else {\nif (\"else\") {\nconst point_hit20 = point_hit_test(canvas_el, squint_core.get(squint_core.deref(state), \"points\"), x4, y5);\nconst event_hit21 = hit_test(canvas_el, squint_core.get(squint_core.deref(state), \"events\"), x4, y5);\ncanvas_el.style.cursor = ((squint_core.truth_(point_hit20)) ? (\"move\") : (((squint_core.truth_((() => {\nconst and__23153__auto__22 = event_hit21;\nif (squint_core.truth_(and__23153__auto__22)) {\nreturn squint_core.get(event_hit21, \"on-handle\")} else {\nreturn and__23153__auto__22};\n\n})())) ? (\"ew-resize\") : (((squint_core.truth_(event_hit21)) ? (\"move\") : (((\"else\") ? (\"crosshair\") : (null))))))))} else {\n}}}};\nif (squint_core.truth_((mode13 === \"draw\"))) {\nsquint_core.swap_BANG_(drag_state, squint_core.assoc, \"select-end\", ({ \"x\": x4, \"y\": y5 }));\nreturn render_canvas_BANG_(canvas_el);\n} else {\nif (squint_core.truth_((mode13 === \"select\"))) {\nconst events23 = squint_core.get(squint_core.deref(state), \"events\");\nconst points24 = squint_core.get(squint_core.deref(state), \"points\");\nconst selected_events25 = events_in_selection(events23, select_start7, ({ \"x\": x4, \"y\": y5 }));\nconst selected_pts26 = points_in_selection(points24, select_start7, ({ \"x\": x4, \"y\": y5 }));\nsquint_core.swap_BANG_(drag_state, squint_core.assoc, \"select-end\", ({ \"x\": x4, \"y\": y5 }), \"selected\", selected_events25, \"selected-points\", selected_pts26);\nreturn render_canvas_BANG_(canvas_el);\n} else {\nif (squint_core.truth_((() => {\nconst and__23153__auto__27 = dragging_point11;\nif (squint_core.truth_(and__23153__auto__27)) {\nreturn (mode13 === \"move-point\")} else {\nreturn and__23153__auto__27};\n\n})())) {\nconst points28 = squint_core.vec(squint_core.get(squint_core.deref(state), \"points\"));\nconst point29 = squint_core.nth(points28, dragging_point11);\nconst snap_QMARK_30 = squint_core.get(squint_core.deref(state), \"snap-to-grid\");\nconst new_x31 = (x4) - (offset_x15);\nconst new_y32 = (y5) - (offset_y12);\nconst new_x33 = squint_core.max(0, squint_core.min(1, new_x31));\nconst new_y34 = squint_core.max(0, squint_core.min(1, new_y32));\nconst new_x35 = ((squint_core.truth_(snap_QMARK_30)) ? (snap_to_grid_value(new_x33)) : (new_x33));\nconst new_y36 = ((squint_core.truth_(snap_QMARK_30)) ? (snap_to_grid_value(new_y34)) : (new_y34));\nconst updated_point37 = squint_core.assoc(point29, \"x\", new_x35, \"y\", new_y36);\nconst updated_points38 = squint_core.assoc(points28, dragging_point11, updated_point37);\nsquint_core.swap_BANG_(state, squint_core.assoc, \"points\", updated_points38);\nreturn render_canvas_BANG_(canvas_el);\n} else {\nif (squint_core.truth_((() => {\nconst and__23153__auto__39 = dragging_point11;\nif (squint_core.truth_(and__23153__auto__39)) {\nreturn (mode13 === \"move-points\")} else {\nreturn and__23153__auto__39};\n\n})())) {\nconst points40 = squint_core.vec(squint_core.get(squint_core.deref(state), \"points\"));\nconst snap_QMARK_41 = squint_core.get(squint_core.deref(state), \"snap-to-grid\");\nconst updated_points42 = squint_core.reduce((function (pts, idx) {\nconst point44 = squint_core.nth(pts, idx);\nconst map__4345 = squint_core.get(point_offsets8, idx);\nconst offset_x46 = squint_core.get(map__4345, \"offset-x\");\nconst offset_y47 = squint_core.get(map__4345, \"offset-y\");\nconst new_x48 = (x4) - (offset_x46);\nconst new_y49 = (y5) - (offset_y47);\nconst new_x50 = squint_core.max(0, squint_core.min(1, new_x48));\nconst new_y51 = squint_core.max(0, squint_core.min(1, new_y49));\nconst new_x52 = ((squint_core.truth_(snap_QMARK_41)) ? (snap_to_grid_value(new_x50)) : (new_x50));\nconst new_y53 = ((squint_core.truth_(snap_QMARK_41)) ? (snap_to_grid_value(new_y51)) : (new_y51));\nconst updated_point54 = squint_core.assoc(point44, \"x\", new_x52, \"y\", new_y53);\nreturn squint_core.assoc(pts, idx, updated_point54);\n\n}), points40, squint_core.keys(point_offsets8));\nsquint_core.swap_BANG_(state, squint_core.assoc, \"points\", updated_points42);\nreturn render_canvas_BANG_(canvas_el);\n} else {\nif (squint_core.truth_((() => {\nconst and__23153__auto__55 = dragging14;\nif (squint_core.truth_(and__23153__auto__55)) {\nreturn (mode13 === \"resize\")} else {\nreturn and__23153__auto__55};\n\n})())) {\nconst events56 = squint_core.get(squint_core.deref(state), \"events\");\nconst event57 = squint_core.nth(events56, dragging14);\nconst snap_QMARK_58 = squint_core.get(squint_core.deref(state), \"snap-to-grid\");\nconst new_valid_to59 = (x4) + (offset_x15);\nconst new_valid_to60 = ((squint_core.truth_(snap_QMARK_58)) ? (snap_to_grid_value(new_valid_to59)) : (new_valid_to59));\nconst min_valid_to61 = (squint_core.get(event57, \"_valid_from\")) + (MIN_DURATION);\nconst new_valid_to62 = squint_core.max(min_valid_to61, squint_core.min(1, new_valid_to60));\nconst updated_event63 = squint_core.assoc(event57, \"_valid_to\", new_valid_to62);\nconst updated_events64 = squint_core.assoc(squint_core.vec(events56), dragging14, updated_event63);\nsquint_core.swap_BANG_(state, squint_core.assoc, \"events\", updated_events64);\nreturn render_canvas_BANG_(canvas_el);\n} else {\nif (squint_core.truth_((() => {\nconst and__23153__auto__65 = dragging14;\nif (squint_core.truth_(and__23153__auto__65)) {\nreturn (mode13 === \"resize-multi\")} else {\nreturn and__23153__auto__65};\n\n})())) {\nconst map__6667 = squint_core.deref(drag_state);\nconst anchor_point68 = squint_core.get(map__6667, \"anchor-point\");\nconst original_span69 = squint_core.get(map__6667, \"original-span\");\nconst original_positions70 = squint_core.get(map__6667, \"original-positions\");\nconst events71 = squint_core.vec(squint_core.get(squint_core.deref(state), \"events\"));\nconst snap_QMARK_72 = squint_core.get(squint_core.deref(state), \"snap-to-grid\");\nconst new_max_valid_to73 = (x4) + (offset_x15);\nconst new_max_valid_to74 = ((squint_core.truth_(snap_QMARK_72)) ? (snap_to_grid_value(new_max_valid_to73)) : (new_max_valid_to73));\nconst new_max_valid_to75 = squint_core.max((anchor_point68) + (MIN_DURATION), squint_core.min(1, new_max_valid_to74));\nconst new_span76 = (new_max_valid_to75) - (anchor_point68);\nconst scale77 = (new_span76) / (original_span69);\nconst updated_events78 = squint_core.reduce((function (evts, idx) {\nconst event79 = squint_core.nth(evts, idx);\nconst orig_pos80 = squint_core.get(original_positions70, idx);\nconst orig_from81 = squint_core.get(orig_pos80, \"_valid_from\");\nconst orig_to82 = squint_core.get(orig_pos80, \"_valid_to\");\nconst new_from83 = (anchor_point68) + (((orig_from81) - (anchor_point68)) * (scale77));\nconst new_to84 = (anchor_point68) + (((orig_to82) - (anchor_point68)) * (scale77));\nconst new_to85 = squint_core.max((new_from83) + (MIN_DURATION), new_to84);\nconst updated_event86 = squint_core.assoc(event79, \"_valid_from\", new_from83, \"_valid_to\", squint_core.min(1, new_to85));\nreturn squint_core.assoc(evts, idx, updated_event86);\n\n}), events71, squint_core.keys(original_positions70));\nsquint_core.swap_BANG_(state, squint_core.assoc, \"events\", updated_events78);\nreturn render_canvas_BANG_(canvas_el);\n} else {\nif (squint_core.truth_((() => {\nconst and__23153__auto__87 = dragging14;\nif (squint_core.truth_(and__23153__auto__87)) {\nreturn (mode13 === \"move-multi\")} else {\nreturn and__23153__auto__87};\n\n})())) {\nconst events88 = squint_core.vec(squint_core.get(squint_core.deref(state), \"events\"));\nconst snap_QMARK_89 = squint_core.get(squint_core.deref(state), \"snap-to-grid\");\nconst updated_events90 = squint_core.reduce((function (evts, idx) {\nconst event92 = squint_core.nth(evts, idx);\nconst map__9193 = squint_core.get(multi_offsets10, idx);\nconst offset_x94 = squint_core.get(map__9193, \"offset-x\");\nconst offset_y95 = squint_core.get(map__9193, \"offset-y\");\nconst open_QMARK_96 = (squint_core.get(event92, \"_valid_to\") == null);\nconst event_width97 = ((open_QMARK_96) ? (0) : ((squint_core.get(event92, \"_valid_to\")) - (squint_core.get(event92, \"_valid_from\"))));\nconst new_valid_from98 = (x4) - (offset_x94);\nconst new_system_from99 = (y5) + (offset_y95);\nconst new_valid_from100 = ((squint_core.truth_(snap_QMARK_89)) ? (snap_to_grid_value(new_valid_from98)) : (new_valid_from98));\nconst new_system_from101 = ((squint_core.truth_(snap_QMARK_89)) ? (snap_to_grid_value(new_system_from99)) : (new_system_from99));\nconst new_valid_from102 = squint_core.max(0, squint_core.min((1) - (event_width97), new_valid_from100));\nconst new_system_from103 = squint_core.max(0, squint_core.min(1, new_system_from101));\nconst updated_event104 = ((open_QMARK_96) ? (squint_core.assoc(event92, \"_valid_from\", new_valid_from102, \"_system_from\", new_system_from103)) : (squint_core.assoc(event92, \"_valid_from\", new_valid_from102, \"_valid_to\", (new_valid_from102) + (event_width97), \"_system_from\", new_system_from103)));\nreturn squint_core.assoc(evts, idx, updated_event104);\n\n}), events88, squint_core.keys(multi_offsets10));\nsquint_core.swap_BANG_(state, squint_core.assoc, \"events\", updated_events90);\nreturn render_canvas_BANG_(canvas_el);\n} else {\nif (squint_core.truth_((() => {\nconst and__23153__auto__105 = dragging14;\nif (squint_core.truth_(and__23153__auto__105)) {\nreturn (mode13 === \"move\")} else {\nreturn and__23153__auto__105};\n\n})())) {\nconst events106 = squint_core.get(squint_core.deref(state), \"events\");\nconst event107 = squint_core.nth(events106, dragging14);\nconst snap_QMARK_108 = squint_core.get(squint_core.deref(state), \"snap-to-grid\");\nconst open_QMARK_109 = (squint_core.get(event107, \"_valid_to\") == null);\nconst event_width110 = ((open_QMARK_109) ? (0) : ((squint_core.get(event107, \"_valid_to\")) - (squint_core.get(event107, \"_valid_from\"))));\nconst new_valid_from111 = (x4) - (offset_x15);\nconst new_system_from112 = (y5) + (offset_y12);\nconst new_valid_from113 = ((squint_core.truth_(snap_QMARK_108)) ? (snap_to_grid_value(new_valid_from111)) : (new_valid_from111));\nconst new_system_from114 = ((squint_core.truth_(snap_QMARK_108)) ? (snap_to_grid_value(new_system_from112)) : (new_system_from112));\nconst new_valid_from115 = squint_core.max(0, squint_core.min((1) - (event_width110), new_valid_from113));\nconst new_system_from116 = squint_core.max(0, squint_core.min(1, new_system_from114));\nconst updated_event117 = ((open_QMARK_109) ? (squint_core.assoc(event107, \"_valid_from\", new_valid_from115, \"_system_from\", new_system_from116)) : (squint_core.assoc(event107, \"_valid_from\", new_valid_from115, \"_valid_to\", (new_valid_from115) + (event_width110), \"_system_from\", new_system_from116)));\nconst updated_events118 = squint_core.assoc(squint_core.vec(events106), dragging14, updated_event117);\nsquint_core.swap_BANG_(state, squint_core.assoc, \"events\", updated_events118);\nreturn render_canvas_BANG_(canvas_el);\n} else {\nreturn null}}}}}}}};\n\n};\nvar default_new_event_color = [100, 116, 139];\nvar create_event_from_drag_BANG_ = function (select_start, select_end) {\nconst min_x1 = squint_core.min(squint_core.get(select_start, \"x\"), squint_core.get(select_end, \"x\"));\nconst max_x2 = squint_core.max(squint_core.get(select_start, \"x\"), squint_core.get(select_end, \"x\"));\nconst min_y3 = squint_core.min(squint_core.get(select_start, \"y\"), squint_core.get(select_end, \"y\"));\nconst width4 = (max_x2) - (min_x1);\nconst valid_from5 = squint_core.max(0, min_x1);\nconst valid_to6 = squint_core.min(1, (valid_from5) + (squint_core.max(MIN_DURATION, width4)));\nconst system_from7 = squint_core.max(0, squint_core.min(1, min_y3));\nconst new_event8 = ({ \"_valid_from\": valid_from5, \"_valid_to\": valid_to6, \"_system_from\": system_from7, \"color\": default_new_event_color });\nreturn squint_core.swap_BANG_(state, squint_core.update, \"events\", squint_core.conj, new_event8);\n\n};\nvar on_mouse_up = function (canvas_el, _e) {\nconst map__12 = squint_core.deref(drag_state);\nconst mode3 = squint_core.get(map__12, \"mode\");\nconst select_start4 = squint_core.get(map__12, \"select-start\");\nconst select_end5 = squint_core.get(map__12, \"select-end\");\nconst selected6 = squint_core.get(map__12, \"selected\");\nconst selected_points7 = squint_core.get(map__12, \"selected-points\");\nif (squint_core.truth_((() => {\nconst and__23153__auto__8 = (mode3 === \"draw\");\nif (squint_core.truth_(and__23153__auto__8)) {\nconst and__23153__auto__9 = select_start4;\nif (squint_core.truth_(and__23153__auto__9)) {\nreturn select_end5} else {\nreturn and__23153__auto__9};\n} else {\nreturn and__23153__auto__8};\n\n})())) {\nconst width10 = Math.abs((squint_core.get(select_end5, \"x\")) - (squint_core.get(select_start4, \"x\")));\nconst height11 = Math.abs((squint_core.get(select_end5, \"y\")) - (squint_core.get(select_start4, \"y\")));\nif (squint_core.truth_((() => {\nconst or__23141__auto__12 = (width10) > (0.02);\nif (or__23141__auto__12) {\nreturn or__23141__auto__12} else {\nreturn (height11) > (0.02)};\n\n})())) {\ncreate_event_from_drag_BANG_(select_start4, select_end5);\nif (squint_core.truth_(squint_core.get(squint_core.deref(state), \"auto-select\"))) {\nsquint_core.swap_BANG_(state, squint_core.assoc, \"current-tool\", \"select\")}}};\nsquint_core.reset_BANG_(drag_state, ({ \"select-start\": null, \"selected\": selected6, \"dragging-point\": null, \"offset-y\": 0, \"mode\": null, \"selected-points\": selected_points7, \"dragging\": null, \"offset-x\": 0, \"select-end\": null }));\nreturn render_canvas_BANG_(canvas_el);\n\n};\nvar on_context_menu = function (canvas_el, e) {\ne.preventDefault();\nconst map__12 = canvas__GT_normalized(canvas_el, e.clientX, e.clientY);\nconst x3 = squint_core.get(map__12, \"x\");\nconst y4 = squint_core.get(map__12, \"y\");\nconst events5 = squint_core.get(squint_core.deref(state), \"events\");\nconst points6 = squint_core.get(squint_core.deref(state), \"points\");\nconst point_hit7 = point_hit_test(canvas_el, points6, x3, y4);\nconst event_hit8 = hit_test(canvas_el, events5, x3, y4);\nconst currently_selected9 = squint_core.get(squint_core.deref(drag_state), \"selected\");\nconst currently_selected_points10 = squint_core.get(squint_core.deref(drag_state), \"selected-points\");\nif (squint_core.truth_(point_hit7)) {\nconst clicked_idx11 = squint_core.get(point_hit7, \"index\");\nconst in_selection_QMARK_12 = squint_core.contains_QMARK_(currently_selected_points10, clicked_idx11);\nreturn squint_core.reset_BANG_(context_menu, ({ \"open\": true, \"x\": e.clientX, \"y\": e.clientY, \"target-indices\": ((squint_core.truth_(in_selection_QMARK_12)) ? (currently_selected9) : (new Set([]))), \"target-point-indices\": ((squint_core.truth_(in_selection_QMARK_12)) ? (currently_selected_points10) : (new Set([clicked_idx11]))) }));\n} else {\nif (squint_core.truth_(event_hit8)) {\nconst clicked_idx13 = squint_core.get(event_hit8, \"index\");\nconst in_selection_QMARK_14 = squint_core.contains_QMARK_(currently_selected9, clicked_idx13);\nreturn squint_core.reset_BANG_(context_menu, ({ \"open\": true, \"x\": e.clientX, \"y\": e.clientY, \"target-indices\": ((squint_core.truth_(in_selection_QMARK_14)) ? (currently_selected9) : (new Set([clicked_idx13]))), \"target-point-indices\": ((squint_core.truth_(in_selection_QMARK_14)) ? (currently_selected_points10) : (new Set([]))) }));\n} else {\nreturn null}};\n\n};\nvar on_keydown = function (e) {\nconst key1 = e.key;\nconst selected2 = squint_core.get(squint_core.deref(drag_state), \"selected\");\nconst selected_points3 = squint_core.get(squint_core.deref(drag_state), \"selected-points\");\nif (squint_core.truth_((() => {\nconst and__23153__auto__4 = (() => {\nconst or__23141__auto__5 = (key1 === \"Delete\");\nif (squint_core.truth_(or__23141__auto__5)) {\nreturn or__23141__auto__5} else {\nreturn (key1 === \"Backspace\")};\n\n})();\nif (squint_core.truth_(and__23153__auto__4)) {\nconst or__23141__auto__6 = squint_core.seq(selected2);\nif (squint_core.truth_(or__23141__auto__6)) {\nreturn or__23141__auto__6} else {\nreturn squint_core.seq(selected_points3)};\n} else {\nreturn and__23153__auto__4};\n\n})())) {\ne.preventDefault();\nif (squint_core.truth_(squint_core.seq(selected2))) {\ndelete_events_BANG_(selected2)};\nif (squint_core.truth_(squint_core.seq(selected_points3))) {\nreturn delete_points_BANG_(selected_points3);\n};\n};\n\n};\nvar canvas_lifecycle = function (node, lifecycle, _data) {\nconst G__41 = lifecycle;\nswitch (G__41) {case \"mount\":\nconst resize_handler3 = (function () {\nreturn render_canvas_BANG_(node);\n\n});\nconst mousedown_handler4 = (function (_PERCENT_1) {\nreturn on_mouse_down(node, _PERCENT_1);\n\n});\nconst mousemove_handler5 = (function (_PERCENT_1) {\nreturn on_mouse_move(node, _PERCENT_1);\n\n});\nconst mouseup_handler6 = (function (_PERCENT_1) {\nreturn on_mouse_up(node, _PERCENT_1);\n\n});\nconst contextmenu_handler7 = (function (_PERCENT_1) {\nreturn on_context_menu(node, _PERCENT_1);\n\n});\nconst keydown_handler8 = on_keydown;\nwindow.addEventListener(\"resize\", resize_handler3);\nnode.addEventListener(\"mousedown\", mousedown_handler4);\nwindow.addEventListener(\"mousemove\", mousemove_handler5);\nwindow.addEventListener(\"mouseup\", mouseup_handler6);\nnode.addEventListener(\"contextmenu\", contextmenu_handler7);\nwindow.addEventListener(\"keydown\", keydown_handler8);\nsquint_core.reset_BANG_(canvas_ref, node);\nrender_canvas_BANG_(node);\nreturn ({ \"resize\": resize_handler3, \"mousedown\": mousedown_handler4, \"mousemove\": mousemove_handler5, \"mouseup\": mouseup_handler6, \"contextmenu\": contextmenu_handler7, \"keydown\": keydown_handler8 });\n\nbreak;\ncase \"update\":\nreturn render_canvas_BANG_(node);\n\nbreak;\ncase \"unmount\":\nreturn squint_core.reset_BANG_(canvas_ref, null);\n\nbreak;\n};\n\n};\nvar connection_pill = function () {\nconst status1 = ably.connection_status();\nif (squint_core.truth_(squint_core.not_EQ_(status1, \"connected\"))) {\nreturn [\"div\", ({ \"class\": \"fixed bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-yellow-500 text-white text-sm font-medium rounded-full shadow-lg animate-pulse z-10\" }), (() => {\nconst G__52 = status1;\nswitch (G__52) {case \"initialized\":\nreturn \"Connecting...\";\n\nbreak;\ncase \"connecting\":\nreturn \"Connecting...\";\n\nbreak;\ncase \"disconnected\":\nreturn \"Disconnected\";\n\nbreak;\ncase \"suspended\":\nreturn \"Connection suspended\";\n\nbreak;\ncase \"failed\":\nreturn \"Connection failed\";\n\nbreak;\ncase \"closing\":\nreturn \"Closing...\";\n\nbreak;\ncase \"closed\":\nreturn \"Closed\";\n\nbreak;\ndefault:\nreturn squint_core.str(\"Status: \", status1)};\n\n})()];\n};\n\n};\nvar presence_indicator = function () {\nconst map__12 = squint_core.deref(state);\nconst room_count3 = squint_core.get(map__12, \"room-count\");\nconst global_count4 = squint_core.get(map__12, \"global-count\");\nreturn [\"div\", ({ \"class\": \"fixed bottom-4 right-4 px-3 py-2 bg-white rounded-lg shadow-md text-sm text-gray-600 z-10\" }), [\"span\", ({ \"class\": \"inline-flex items-center gap-2\" }), [\"span\", ({ \"class\": \"w-2 h-2 bg-green-500 rounded-full\" })], squint_core.str(room_count3, \"/\", global_count4, \" online\")]];\n\n};\nvar toggle_grid_BANG_ = function () {\nreturn squint_core.swap_BANG_(state, squint_core.update, \"show-grid\", squint_core.not);\n\n};\nvar toggle_snap_to_grid_BANG_ = function () {\nreturn squint_core.swap_BANG_(state, squint_core.update, \"snap-to-grid\", squint_core.not);\n\n};\nvar toggle_show_ticks_BANG_ = function () {\nreturn squint_core.swap_BANG_(state, squint_core.update, \"show-ticks\", squint_core.not);\n\n};\nvar preset_colors = [[59, 130, 246], [34, 197, 94], [249, 115, 22], [168, 85, 247], [236, 72, 153]];\nvar rgb__GT_css = function (p__6) {\nconst vec__14 = p__6;\nconst r5 = squint_core.nth(vec__14, 0, null);\nconst g6 = squint_core.nth(vec__14, 1, null);\nconst b7 = squint_core.nth(vec__14, 2, null);\nreturn squint_core.str(\"rgb(\", r5, \",\", g6, \",\", b7, \")\");\n\n};\nvar rgb__GT_hex = function (p__7) {\nconst vec__14 = p__7;\nconst r5 = squint_core.nth(vec__14, 0, null);\nconst g6 = squint_core.nth(vec__14, 1, null);\nconst b7 = squint_core.nth(vec__14, 2, null);\nreturn squint_core.str(\"#\", r5.toString(16).padStart(2, \"0\"), g6.toString(16).padStart(2, \"0\"), b7.toString(16).padStart(2, \"0\"));\n\n};\nvar hex__GT_rgb = function (hex) {\nconst hex1 = ((squint_core.truth_((squint_core.first(hex) === \"#\"))) ? (squint_core.subs(hex, 1)) : (hex));\nconst r2 = parseInt(squint_core.subs(hex1, 0, 2), 16);\nconst g3 = parseInt(squint_core.subs(hex1, 2, 4), 16);\nconst b4 = parseInt(squint_core.subs(hex1, 4, 6), 16);\nreturn [r2, g3, b4];\n\n};\nvar set_event_colors_BANG_ = function (indices, color) {\nconst events1 = squint_core.vec(squint_core.get(squint_core.deref(state), \"events\"));\nconst updated_events2 = squint_core.reduce((function (evts, idx) {\nreturn squint_core.update(evts, idx, squint_core.assoc, \"color\", color);\n\n}), events1, indices);\nsquint_core.swap_BANG_(state, squint_core.assoc, \"events\", updated_events2);\nreturn close_context_menu_BANG_();\n\n};\nvar set_point_colors_BANG_ = function (indices, color) {\nconst points1 = squint_core.vec(squint_core.get(squint_core.deref(state), \"points\"));\nconst updated_points2 = squint_core.reduce((function (pts, idx) {\nreturn squint_core.update(pts, idx, squint_core.assoc, \"color\", color);\n\n}), points1, indices);\nsquint_core.swap_BANG_(state, squint_core.assoc, \"points\", updated_points2);\nreturn close_context_menu_BANG_();\n\n};\nvar toggle_events_open_BANG_ = function (indices, make_open_QMARK_) {\nconst events1 = squint_core.vec(squint_core.get(squint_core.deref(state), \"events\"));\nconst updated_events2 = squint_core.reduce((function (evts, idx) {\nconst event3 = squint_core.nth(evts, idx);\nif (squint_core.truth_(make_open_QMARK_)) {\nreturn squint_core.assoc(evts, idx, squint_core.assoc(event3, \"_valid_to\", null))} else {\nconst new_valid_to4 = squint_core.min(1, (squint_core.get(event3, \"_valid_from\")) + (0.2));\nreturn squint_core.assoc(evts, idx, squint_core.assoc(event3, \"_valid_to\", new_valid_to4));\n};\n\n}), events1, indices);\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"events\", updated_events2);\n\n};\nvar delete_events_BANG_ = function (indices) {\nif (squint_core.truth_(squint_core.seq(indices))) {\nconst events1 = squint_core.get(squint_core.deref(state), \"events\");\nconst indices_set2 = squint_core.set(indices);\nconst updated_events3 = squint_core.vec(squint_core.keep_indexed((function (idx, event) {\nif (squint_core.truth_(squint_core.contains_QMARK_(indices_set2, idx))) {\nreturn null} else {\nreturn event;\n};\n\n}), events1));\nsquint_core.swap_BANG_(drag_state, squint_core.assoc, \"selected\", new Set([]));\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"events\", updated_events3);\n};\n\n};\nvar delete_points_BANG_ = function (indices) {\nif (squint_core.truth_(squint_core.seq(indices))) {\nconst points1 = squint_core.get(squint_core.deref(state), \"points\");\nconst indices_set2 = squint_core.set(indices);\nconst updated_points3 = squint_core.vec(squint_core.keep_indexed((function (idx, point) {\nif (squint_core.truth_(squint_core.contains_QMARK_(indices_set2, idx))) {\nreturn null} else {\nreturn point;\n};\n\n}), points1));\nsquint_core.swap_BANG_(drag_state, squint_core.assoc, \"selected-points\", new Set([]));\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"points\", updated_points3);\n};\n\n};\nvar set_all_colors_BANG_ = function (event_indices, point_indices, color) {\n\"Set color for both events and points, then close context menu\";\nif (squint_core.truth_(squint_core.seq(event_indices))) {\nconst events1 = squint_core.vec(squint_core.get(squint_core.deref(state), \"events\"));\nconst updated_events2 = squint_core.reduce((function (evts, idx) {\nreturn squint_core.update(evts, idx, squint_core.assoc, \"color\", color);\n\n}), events1, event_indices);\nsquint_core.swap_BANG_(state, squint_core.assoc, \"events\", updated_events2)};\nif (squint_core.truth_(squint_core.seq(point_indices))) {\nconst points3 = squint_core.vec(squint_core.get(squint_core.deref(state), \"points\"));\nconst updated_points4 = squint_core.reduce((function (pts, idx) {\nreturn squint_core.update(pts, idx, squint_core.assoc, \"color\", color);\n\n}), points3, point_indices);\nsquint_core.swap_BANG_(state, squint_core.assoc, \"points\", updated_points4)};\nreturn close_context_menu_BANG_();\n\n};\nvar delete_all_selected_BANG_ = function (event_indices, point_indices) {\n\"Delete both events and points, then close context menu\";\nif (squint_core.truth_(squint_core.seq(event_indices))) {\ndelete_events_BANG_(event_indices)};\nif (squint_core.truth_(squint_core.seq(point_indices))) {\ndelete_points_BANG_(point_indices)};\nreturn close_context_menu_BANG_();\n\n};\nvar color_menu = function () {\nconst map__12 = squint_core.deref(context_menu);\nconst open3 = squint_core.get(map__12, \"open\");\nconst x4 = squint_core.get(map__12, \"x\");\nconst y5 = squint_core.get(map__12, \"y\");\nconst target_indices6 = squint_core.get(map__12, \"target-indices\");\nconst target_point_indices7 = squint_core.get(map__12, \"target-point-indices\");\nconst events8 = squint_core.get(squint_core.deref(state), \"events\");\nconst has_events_QMARK_9 = squint_core.seq(target_indices6);\nconst has_points_QMARK_10 = squint_core.seq(target_point_indices7);\nconst all_open_QMARK_11 = (() => {\nconst and__23153__auto__12 = has_events_QMARK_9;\nif (squint_core.truth_(and__23153__auto__12)) {\nreturn squint_core.every_QMARK_((function (_PERCENT_1) {\nreturn (squint_core.get(squint_core.nth(events8, _PERCENT_1), \"_valid_to\") == null);\n\n}), target_indices6)} else {\nreturn and__23153__auto__12};\n\n})();\nif (squint_core.truth_(open3)) {\nreturn [\"div\", ({ \"class\": \"fixed bg-white rounded-lg shadow-xl border border-gray-200 p-2 z-50\", \"style\": ({ \"left\": squint_core.str(x4, \"px\"), \"top\": squint_core.str(y5, \"px\") }) }), [\"div\", ({ \"class\": \"flex gap-1 items-center\" }), squint_core.lazy(function* () {\nfor (let G__13 of squint_core.iterable(preset_colors)) {\nconst color14 = G__13;\nyield [\"button\", ({ \"key\": rgb__GT_css(color14), \"class\": \"w-6 h-6 rounded border border-gray-300 hover:scale-110 transition-transform cursor-pointer\", \"style\": ({ \"background-color\": rgb__GT_css(color14) }), \"on-click\": (function () {\nreturn set_all_colors_BANG_(target_indices6, target_point_indices7, color14);\n\n}) })]\n}\n}), [\"input\", ({ \"type\": \"color\", \"class\": \"w-6 h-6 rounded cursor-pointer border-0 p-0\", \"on-change\": (function (_PERCENT_1) {\nreturn set_all_colors_BANG_(target_indices6, target_point_indices7, hex__GT_rgb(_PERCENT_1.target.value));\n\n}) })]], ((squint_core.truth_(has_events_QMARK_9)) ? ([\"div\", [\"div\", ({ \"class\": \"h-px bg-gray-200 my-2\" })], [\"label\", ({ \"class\": \"flex items-center gap-2 text-sm text-gray-700 cursor-pointer select-none px-1\" }), [\"input\", ({ \"type\": \"checkbox\", \"checked\": all_open_QMARK_11, \"on-change\": (function () {\nreturn toggle_events_open_BANG_(target_indices6, squint_core.not(all_open_QMARK_11));\n\n}), \"class\": \"w-4 h-4 cursor-pointer\" })], \"Open\"]]) : (null)), [\"div\", ({ \"class\": \"h-px bg-gray-200 my-2\" })], [\"button\", ({ \"class\": \"w-full text-left text-sm text-red-600 hover:bg-red-50 px-1 py-1 rounded cursor-pointer\", \"on-click\": (function () {\nreturn delete_all_selected_BANG_(target_indices6, target_point_indices7);\n\n}) }), \"Delete\"]];\n};\n\n};\nvar set_tool_BANG_ = function (tool) {\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"current-tool\", tool);\n\n};\nvar toolbar = function () {\nconst current_tool1 = squint_core.get(squint_core.deref(state), \"current-tool\");\nreturn [\"div\", ({ \"class\": \"absolute top-2 left-2 bg-white rounded-lg shadow-lg border border-gray-200 p-1 flex flex-col gap-1 z-10\" }), [\"button\", ({ \"class\": squint_core.str(\"w-8 h-8 rounded flex items-center justify-center transition-colors \", ((squint_core.truth_((current_tool1 === \"select\"))) ? (\"bg-blue-500 text-white\") : (\"hover:bg-gray-100 text-gray-600\"))), \"title\": \"Select\", \"on-click\": (function () {\nreturn set_tool_BANG_(\"select\");\n\n}) }), [\"svg\", ({ \"width\": \"16\", \"height\": \"16\", \"viewBox\": \"0 0 24 24\", \"fill\": \"none\", \"stroke\": \"currentColor\", \"stroke-width\": \"2\" }), [\"path\", ({ \"d\": \"M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z\" })], [\"path\", ({ \"d\": \"M13 13l6 6\" })]]], [\"button\", ({ \"class\": squint_core.str(\"w-8 h-8 rounded flex items-center justify-center transition-colors \", ((squint_core.truth_((current_tool1 === \"rectangle\"))) ? (\"bg-blue-500 text-white\") : (\"hover:bg-gray-100 text-gray-600\"))), \"title\": \"Rectangle\", \"on-click\": (function () {\nreturn set_tool_BANG_(\"rectangle\");\n\n}) }), [\"svg\", ({ \"width\": \"16\", \"height\": \"16\", \"viewBox\": \"0 0 24 24\", \"fill\": \"none\", \"stroke\": \"currentColor\", \"stroke-width\": \"2\" }), [\"rect\", ({ \"x\": \"3\", \"y\": \"3\", \"width\": \"18\", \"height\": \"18\", \"rx\": \"2\" })]]], [\"button\", ({ \"class\": squint_core.str(\"w-8 h-8 rounded flex items-center justify-center transition-colors \", ((squint_core.truth_((current_tool1 === \"point\"))) ? (\"bg-blue-500 text-white\") : (\"hover:bg-gray-100 text-gray-600\"))), \"title\": \"Point\", \"on-click\": (function () {\nreturn set_tool_BANG_(\"point\");\n\n}) }), [\"svg\", ({ \"width\": \"16\", \"height\": \"16\", \"viewBox\": \"0 0 24 24\", \"fill\": \"none\", \"stroke\": \"currentColor\", \"stroke-width\": \"2\" }), [\"circle\", ({ \"cx\": \"12\", \"cy\": \"12\", \"r\": \"4\" })]]]];\n\n};\nvar toggle_auto_select_BANG_ = function () {\nreturn squint_core.swap_BANG_(state, squint_core.update, \"auto-select\", squint_core.not);\n\n};\nvar prompt_join_room_BANG_ = function () {\nconst temp__22756__auto__1 = prompt(\"Enter room code to join:\");\nif (squint_core.truth_(temp__22756__auto__1)) {\nconst code2 = temp__22756__auto__1;\nconst code3 = squint_core.subs(code2.trim().toUpperCase(), 0, 6);\nif (squint_core.truth_((() => {\nconst and__23153__auto__4 = squint_core.seq(code3);\nif (squint_core.truth_(and__23153__auto__4)) {\nreturn (squint_core.count(code3)) >= (4)} else {\nreturn and__23153__auto__4};\n\n})())) {\nreturn join_room_BANG_(code3);\n};\n};\n\n};\nvar copy_room_code_BANG_ = function () {\nconst code1 = squint_core.get(squint_core.deref(state), \"room-code\");\nreturn navigator.clipboard.writeText(code1).then((function () {\nreturn console.log(\"Copied room code:\", code1);\n\n})).catch((function (_PERCENT_1) {\nreturn console.error(\"Failed to copy:\", _PERCENT_1);\n\n}));\n\n};\nvar parse_date = function (date_str) {\n\"Parse a date string (YYYY-MM-DD) to a js/Date at midnight UTC\";\nconst vec__14 = squint_core.map(parseInt, date_str.split(\"-\"));\nconst year5 = squint_core.nth(vec__14, 0, null);\nconst month6 = squint_core.nth(vec__14, 1, null);\nconst day7 = squint_core.nth(vec__14, 2, null);\nreturn new Date(Date.UTC(year5, (month6 - 1), day7));\n\n};\nvar format_date_for_dml = function (date) {\n\"Format a js/Date as YYYY-MM-DD for XTDB DML\";\nconst year1 = date.getUTCFullYear();\nconst month2 = (date.getUTCMonth() + 1);\nconst day3 = date.getUTCDate();\nconst pad4 = (function (_PERCENT_1) {\nreturn squint_core.str(_PERCENT_1).padStart(2, \"0\");\n\n});\nreturn squint_core.str(year1, \"-\", pad4(month2), \"-\", pad4(day3));\n\n};\nvar normalized_to_date = function (normalized, start_date, end_date) {\n\"Convert a normalized 0-1 value to a date within the range\";\nconst start_ms1 = start_date.getTime();\nconst end_ms2 = end_date.getTime();\nconst range_ms3 = (end_ms2) - (start_ms1);\nconst target_ms4 = (start_ms1) + ((range_ms3) * (normalized));\nreturn new Date(target_ms4);\n\n};\nvar event_to_dml = function (event, start_date, end_date) {\n\"Convert a single event to a DML INSERT statement with system time transaction\";\nconst map__12 = event;\nconst _valid_from3 = squint_core.get(map__12, \"_valid_from\");\nconst _valid_to4 = squint_core.get(map__12, \"_valid_to\");\nconst _system_from5 = squint_core.get(map__12, \"_system_from\");\nconst color6 = squint_core.get(map__12, \"color\");\nconst valid_from_date7 = format_date_for_dml(normalized_to_date(_valid_from3, start_date, end_date));\nconst system_from_date8 = format_date_for_dml(normalized_to_date(_system_from5, start_date, end_date));\nconst open_QMARK_9 = (_valid_to4 == null);\nconst color_str10 = squint_core.str(\"[\", squint_core.first(color6), \", \", squint_core.second(color6), \", \", squint_core.nth(color6, 2), \"]\");\nreturn squint_core.str(\"BEGIN READ WRITE WITH (SYSTEM_TIME = DATE '\", system_from_date8, \"');\\n\", \"INSERT INTO docs RECORDS {_id: 1, _valid_from: DATE '\", valid_from_date7, \"', \", ((open_QMARK_9) ? (null) : ((() => {\nconst valid_to_date11 = format_date_for_dml(normalized_to_date(_valid_to4, start_date, end_date));\nreturn squint_core.str(\"_valid_to: DATE '\", valid_to_date11, \"', \");\n\n})())), \"color: \", color_str10, \"};\\n\", \"COMMIT;\");\n\n};\nvar generate_dml = function () {\n\"Generate DML for all events on the canvas\";\nconst events1 = squint_core.get(squint_core.deref(state), \"events\");\nconst start_date2 = parse_date(squint_core.get(squint_core.deref(state), \"dml-start-date\"));\nconst end_date3 = parse_date(squint_core.get(squint_core.deref(state), \"dml-end-date\"));\nconst dml_statements4 = squint_core.map((function (_PERCENT_1) {\nreturn event_to_dml(_PERCENT_1, start_date2, end_date3);\n\n}), events1);\nreturn squint_core.to_array(dml_statements4).join(\"\\n\\n\");\n\n};\nvar copy_dml_BANG_ = function () {\n\"Copy generated DML to clipboard\";\nconst dml1 = generate_dml();\nreturn navigator.clipboard.writeText(dml1).then((function () {\nreturn console.log(\"Copied DML to clipboard\");\n\n})).catch((function (_PERCENT_1) {\nreturn console.error(\"Failed to copy DML:\", _PERCENT_1);\n\n}));\n\n};\nvar generate_state_id = function () {\nreturn squint_core.str(Date.now(), \"-\", squint_core.rand_int(10000));\n\n};\nvar capture_thumbnail = function () {\n\"Capture canvas as a small thumbnail data URL\";\nconst temp__22756__auto__1 = squint_core.deref(canvas_ref);\nif (squint_core.truth_(temp__22756__auto__1)) {\nconst canvas2 = temp__22756__auto__1;\nconst thumb_width3 = 120;\nconst thumb_height4 = 80;\nconst thumb_canvas5 = document.createElement(\"canvas\");\nconst thumb_ctx6 = thumb_canvas5.getContext(\"2d\");\nthumb_canvas5.width = thumb_width3;\nthumb_canvas5.height = thumb_height4;\nthumb_ctx6.drawImage(canvas2, 0, 0, thumb_width3, thumb_height4);\nreturn thumb_canvas5.toDataURL(\"image/png\", 0.8);\n};\n\n};\nvar save_current_state_BANG_ = function () {\n\"Save current canvas state with thumbnail\";\nconst temp__22756__auto__1 = capture_thumbnail();\nif (squint_core.truth_(temp__22756__auto__1)) {\nconst thumbnail2 = temp__22756__auto__1;\nconst new_state3 = ({ \"id\": generate_state_id(), \"events\": squint_core.get(squint_core.deref(state), \"events\"), \"points\": squint_core.get(squint_core.deref(state), \"points\"), \"thumbnail\": thumbnail2, \"timestamp\": Date.now() });\nreturn squint_core.swap_BANG_(state, squint_core.update, \"saved-states\", squint_core.conj, new_state3);\n};\n\n};\nvar load_saved_state_BANG_ = function (saved_state) {\n\"Load a saved state onto the canvas\";\nsquint_core.swap_BANG_(state, squint_core.assoc, \"events\", squint_core.get(saved_state, \"events\"), \"points\", squint_core.get(saved_state, \"points\"));\nreturn squint_core.swap_BANG_(drag_state, squint_core.assoc, \"selected\", new Set([]), \"selected-points\", new Set([]));\n\n};\nvar delete_saved_state_BANG_ = function (state_id) {\n\"Delete a saved state by its ID\";\nreturn squint_core.swap_BANG_(state, squint_core.update, \"saved-states\", (function (states) {\nreturn squint_core.vec(squint_core.remove((function (_PERCENT_1) {\nreturn squint_core._EQ_(squint_core.get(_PERCENT_1, \"id\"), state_id);\n\n}), states));\n\n}));\n\n};\nvar saved_state_card = function (saved_state) {\nconst map__12 = saved_state;\nconst id3 = squint_core.get(map__12, \"id\");\nconst thumbnail4 = squint_core.get(map__12, \"thumbnail\");\nreturn [\"div\", ({ \"class\": \"relative group cursor-pointer\", \"on-click\": (function () {\nreturn load_saved_state_BANG_(saved_state);\n\n}) }), [\"img\", ({ \"src\": thumbnail4, \"class\": \"w-full rounded border border-gray-600 hover:border-blue-400 transition-colors\" })], [\"button\", ({ \"class\": \"absolute -top-2 -right-2 w-5 h-5 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\", \"on-click\": (function (e) {\ne.stopPropagation();\nreturn delete_saved_state_BANG_(id3);\n\n}) }), [\"svg\", ({ \"width\": \"10\", \"height\": \"10\", \"viewBox\": \"0 0 24 24\", \"fill\": \"none\", \"stroke\": \"white\", \"stroke-width\": \"3\" }), [\"path\", ({ \"d\": \"M18 6L6 18M6 6l12 12\" })]]]];\n\n};\nvar side_panel = function () {\nconst saved_states1 = squint_core.get(squint_core.deref(state), \"saved-states\");\nreturn [\"div\", ({ \"class\": \"w-64 bg-gray-800 text-white p-4 flex flex-col h-full\" }), [\"h1\", ({ \"class\": \"text-xl font-bold mb-4\" }), \"Bitemporal Visualizer\"], [\"div\", ({ \"class\": \"mb-6 p-3 bg-gray-700 rounded-lg\" }), [\"div\", ({ \"class\": \"text-xs text-gray-400 mb-1\" }), \"Room\"], [\"div\", ({ \"class\": \"flex items-center gap-2\" }), [\"span\", ({ \"class\": \"font-mono text-lg tracking-wider\" }), squint_core.get(squint_core.deref(state), \"room-code\")], [\"button\", ({ \"class\": \"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 rounded cursor-pointer\", \"title\": \"Copy room code\", \"on-click\": copy_room_code_BANG_ }), \"Copy\"], [\"button\", ({ \"class\": \"px-2 py-1 text-xs bg-blue-500 hover:bg-blue-600 rounded cursor-pointer\", \"on-click\": prompt_join_room_BANG_ }), \"Join\"]]], [\"div\", ({ \"class\": \"flex flex-col gap-2 mb-4\" }), [\"label\", ({ \"class\": \"flex items-center gap-2 cursor-pointer\" }), [\"input\", ({ \"type\": \"checkbox\", \"checked\": squint_core.get(squint_core.deref(state), \"show-grid\"), \"on-change\": toggle_grid_BANG_, \"class\": \"w-4 h-4\" })], [\"span\", \"Grid\"]], [\"label\", ({ \"class\": \"flex items-center gap-2 cursor-pointer\" }), [\"input\", ({ \"type\": \"checkbox\", \"checked\": squint_core.get(squint_core.deref(state), \"auto-select\"), \"on-change\": toggle_auto_select_BANG_, \"class\": \"w-4 h-4\" })], [\"span\", \"Auto-select after draw\"]]], [\"div\", ({ \"class\": \"h-px bg-gray-600 my-4\" })], [\"div\", ({ \"class\": \"mb-4\" }), [\"div\", ({ \"class\": \"text-xs text-gray-400 mb-2\" }), \"Room Settings\"], [\"div\", ({ \"class\": \"flex flex-col gap-2\" }), [\"label\", ({ \"class\": \"flex items-center gap-2 cursor-pointer\" }), [\"input\", ({ \"type\": \"checkbox\", \"checked\": squint_core.get(squint_core.deref(state), \"snap-to-grid\"), \"on-change\": toggle_snap_to_grid_BANG_, \"class\": \"w-4 h-4\" })], [\"span\", \"Snap to grid\"], [\"svg\", ({ \"class\": \"w-3.5 h-3.5 text-gray-400\", \"viewBox\": \"0 0 24 24\", \"fill\": \"none\", \"stroke\": \"currentColor\", \"stroke-width\": \"2\", \"title\": \"Synced to room\" }), [\"path\", ({ \"d\": \"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" })]]], [\"label\", ({ \"class\": \"flex items-center gap-2 cursor-pointer\" }), [\"input\", ({ \"type\": \"checkbox\", \"checked\": squint_core.get(squint_core.deref(state), \"show-ticks\"), \"on-change\": toggle_show_ticks_BANG_, \"class\": \"w-4 h-4\" })], [\"span\", \"Axis ticks\"], [\"svg\", ({ \"class\": \"w-3.5 h-3.5 text-gray-400\", \"viewBox\": \"0 0 24 24\", \"fill\": \"none\", \"stroke\": \"currentColor\", \"stroke-width\": \"2\", \"title\": \"Synced to room\" }), [\"path\", ({ \"d\": \"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" })]]]]], [\"div\", ({ \"class\": \"h-px bg-gray-600 my-4\" })], [\"div\", ({ \"class\": \"mb-4\" }), [\"div\", ({ \"class\": \"text-xs text-gray-400 mb-2\" }), \"DML Export\"], [\"div\", ({ \"class\": \"flex flex-col gap-2\" }), [\"div\", ({ \"class\": \"flex items-center gap-2\" }), [\"label\", ({ \"class\": \"text-sm text-gray-300 w-12\" }), \"Start\"], [\"input\", ({ \"type\": \"date\", \"value\": squint_core.get(squint_core.deref(state), \"dml-start-date\"), \"on-change\": (function (_PERCENT_1) {\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"dml-start-date\", _PERCENT_1.target.value);\n\n}), \"class\": \"flex-1 px-2 py-1 text-sm bg-gray-700 border border-gray-600 rounded text-white\" })]], [\"div\", ({ \"class\": \"flex items-center gap-2\" }), [\"label\", ({ \"class\": \"text-sm text-gray-300 w-12\" }), \"End\"], [\"input\", ({ \"type\": \"date\", \"value\": squint_core.get(squint_core.deref(state), \"dml-end-date\"), \"on-change\": (function (_PERCENT_1) {\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"dml-end-date\", _PERCENT_1.target.value);\n\n}), \"class\": \"flex-1 px-2 py-1 text-sm bg-gray-700 border border-gray-600 rounded text-white\" })]], [\"button\", ({ \"class\": \"w-full px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 rounded cursor-pointer mt-1\", \"on-click\": copy_dml_BANG_ }), \"Copy DML\"]]], [\"div\", ({ \"class\": \"h-px bg-gray-600 my-4\" })], [\"div\", ({ \"class\": \"flex-1 flex flex-col min-h-0\" }), [\"div\", ({ \"class\": \"flex items-center justify-between mb-3\" }), [\"span\", ({ \"class\": \"text-sm font-medium text-gray-300\" }), \"Saved States\"], [\"button\", ({ \"class\": \"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 rounded cursor-pointer\", \"on-click\": save_current_state_BANG_ }), \"Save\"]], [\"div\", ({ \"class\": \"flex-1 overflow-y-auto\" }), ((squint_core.truth_(squint_core.seq(saved_states1))) ? ([\"div\", ({ \"class\": \"grid grid-cols-2 gap-2\" }), squint_core.lazy(function* () {\nfor (let G__2 of squint_core.iterable(saved_states1)) {\nconst s3 = G__2;\nyield [\"div\", ({ \"key\": squint_core.get(s3, \"id\") }), [saved_state_card, s3]]\n}\n})]) : ([\"div\", ({ \"class\": \"text-xs text-gray-500 text-center py-4\" }), \"No saved states yet\"]))]]];\n\n};\nvar main_canvas = function () {\nreturn [\"div\", ({ \"class\": \"flex-1 bg-gray-100 p-4\" }), [\"div\", ({ \"class\": \"relative w-full h-full bg-white rounded-lg shadow-md overflow-hidden\" }), [\"div\", ({ \"class\": \"absolute inset-0 left-5\" }), [\"canvas\", ({ \"on-render\": canvas_lifecycle, \"class\": \"w-full h-full\" })]], [toolbar]]];\n\n};\nvar app = function () {\nreturn [\"div\", ({ \"class\": \"h-screen flex\" }), [side_panel], [main_canvas], [presence_indicator], [connection_pill], [color_menu]];\n\n};\nvar render = function () {\nreturn reagami.render(document.getElementById(\"app\"), [app]);\n\n};\nsquint_core.add_watch(state, \"app.app/render\", (function (_, _1, _2, _3) {\nreturn render();\n\n}));\nsquint_core.add_watch(ably.state, \"app.app/render-ably\", (function (_, _1, _2, _3) {\nreturn render();\n\n}));\nsquint_core.add_watch(context_menu, \"app.app/render-context-menu\", (function (_, _1, _2, _3) {\nreturn render();\n\n}));\nvar update_global_presence_count_BANG_ = function () {\nreturn ably.get_presence_members(GLOBAL_CHANNEL, (function (members) {\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"global-count\", squint_core.count(members));\n\n}));\n\n};\nvar update_room_presence_count_BANG_ = function () {\nconst room_code1 = squint_core.get(squint_core.deref(state), \"room-code\");\nreturn ably.get_presence_members(room_channel_name(room_code1), (function (members) {\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"room-count\", squint_core.count(members));\n\n}));\n\n};\nvar broadcast_state_BANG_ = function () {\n\"Broadcast current events, points, and synced settings to room\";\nif (squint_core.truth_(squint_core.get(squint_core.deref(state), \"syncing\"))) {\nreturn null} else {\nconst room_code1 = squint_core.get(squint_core.deref(state), \"room-code\");\nconst events2 = squint_core.get(squint_core.deref(state), \"events\");\nconst points3 = squint_core.get(squint_core.deref(state), \"points\");\nconst snap_to_grid4 = squint_core.get(squint_core.deref(state), \"snap-to-grid\");\nconst show_ticks5 = squint_core.get(squint_core.deref(state), \"show-ticks\");\nreturn ably.publish_BANG_(room_channel_name(room_code1), \"state-sync\", ({ \"events\": events2, \"points\": points3, \"snapToGrid\": snap_to_grid4, \"showTicks\": show_ticks5, \"from\": ably.client_id }));\n};\n\n};\nvar request_state_BANG_ = function () {\n\"Request current state from room members\";\nconst room_code1 = squint_core.get(squint_core.deref(state), \"room-code\");\nreturn ably.publish_BANG_(room_channel_name(room_code1), \"state-request\", ({ \"from\": ably.client_id }));\n\n};\nvar handle_room_message = function (msg) {\nconst event1 = msg.name;\nconst data2 = msg.data;\nconst from3 = data2.from;\nif (squint_core.truth_(squint_core.not_EQ_(from3, ably.client_id))) {\nconst G__84 = event1;\nswitch (G__84) {case \"state-request\":\nreturn broadcast_state_BANG_();\n\nbreak;\ncase \"state-sync\":\nconst events6 = data2.events;\nconst points7 = data2.points;\nconst snap_to_grid8 = data2.snapToGrid;\nconst show_ticks9 = data2.showTicks;\nsquint_core.swap_BANG_(state, squint_core.assoc, \"syncing\", true);\nsquint_core.swap_BANG_(state, squint_core.assoc, \"events\", squint_core.vec(events6));\nif (squint_core.truth_(points7)) {\nsquint_core.swap_BANG_(state, squint_core.assoc, \"points\", squint_core.vec(points7))};\nif (squint_core.truth_(squint_core.some_QMARK_(snap_to_grid8))) {\nsquint_core.swap_BANG_(state, squint_core.assoc, \"snap-to-grid\", snap_to_grid8)};\nif (squint_core.truth_(squint_core.some_QMARK_(show_ticks9))) {\nsquint_core.swap_BANG_(state, squint_core.assoc, \"show-ticks\", show_ticks9)};\nreturn squint_core.swap_BANG_(state, squint_core.assoc, \"syncing\", false);\n\nbreak;\n};\n};\n\n};\nvar join_room_BANG_ = function (code) {\n\"Join a room by code\";\nconst old_code1 = squint_core.get(squint_core.deref(state), \"room-code\");\nconst old_channel2 = room_channel_name(old_code1);\nconst new_channel3 = room_channel_name(code);\nif (squint_core.truth_(old_code1)) {\nably.channel(old_channel2).presence.leave()};\nsquint_core.swap_BANG_(state, squint_core.assoc, \"room-code\", code, \"room-count\", 0);\nably.enter_presence_BANG_(new_channel3);\nably.on_presence_change_BANG_(new_channel3, update_room_presence_count_BANG_);\nably.subscribe_BANG_(new_channel3, handle_room_message);\nreturn setTimeout(request_state_BANG_, 500);\n\n};\nsquint_core.add_watch(state, \"app.app/sync-to-room\", (function (_, _1, old_state, new_state) {\nif (squint_core.truth_((() => {\nconst and__23153__auto__2 = squint_core.not(squint_core.get(new_state, \"syncing\"));\nif (and__23153__auto__2) {\nconst or__23141__auto__3 = squint_core.not_EQ_(squint_core.get(old_state, \"events\"), squint_core.get(new_state, \"events\"));\nif (squint_core.truth_(or__23141__auto__3)) {\nreturn or__23141__auto__3} else {\nconst or__23141__auto__4 = squint_core.not_EQ_(squint_core.get(old_state, \"points\"), squint_core.get(new_state, \"points\"));\nif (squint_core.truth_(or__23141__auto__4)) {\nreturn or__23141__auto__4} else {\nconst or__23141__auto__5 = squint_core.not_EQ_(squint_core.get(old_state, \"snap-to-grid\"), squint_core.get(new_state, \"snap-to-grid\"));\nif (squint_core.truth_(or__23141__auto__5)) {\nreturn or__23141__auto__5} else {\nreturn squint_core.not_EQ_(squint_core.get(old_state, \"show-ticks\"), squint_core.get(new_state, \"show-ticks\"))};\n};\n};\n} else {\nreturn and__23153__auto__2};\n\n})())) {\nreturn broadcast_state_BANG_();\n};\n\n}));\nvar init_BANG_ = function () {\nrender();\nably.init_BANG_(ABLY_API_KEY);\nably.enter_presence_BANG_(GLOBAL_CHANNEL);\nably.on_presence_change_BANG_(GLOBAL_CHANNEL, update_global_presence_count_BANG_);\nreturn join_room_BANG_(squint_core.get(squint_core.deref(state), \"room-code\"));\n\n};\ninit_BANG_();\n\nexport { default_settings, side_panel, on_mouse_down, hit_test, parse_date, main_canvas, toggle_show_ticks_BANG_, format_date_for_dml, drag_state, toggle_snap_to_grid_BANG_, request_state_BANG_, HANDLE_WIDTH, connection_pill, preset_colors, generate_room_code, close_context_menu_BANG_, save_saved_states_BANG_, events_in_selection, set_point_colors_BANG_, rgb__GT_hex, delete_points_BANG_, toggle_auto_select_BANG_, load_saved_state_BANG_, snap_to_grid_value, delete_all_selected_BANG_, toolbar, rgb__GT_css, GRID_DIVISIONS, set_event_colors_BANG_, capture_thumbnail, load_saved_states, update_global_presence_count_BANG_, initial_persisted, event_to_dml, render_canvas_BANG_, color_menu, create_event_from_drag_BANG_, canvas_lifecycle, on_context_menu, POINT_RADIUS, default_new_event_color, GLOBAL_CHANNEL, on_mouse_move, toggle_events_open_BANG_, context_menu, toggle_grid_BANG_, set_tool_BANG_, generate_dml, MIN_DURATION, STORAGE_KEY, points_in_selection, delete_events_BANG_, init_BANG_, app, render, load_from_storage, broadcast_state_BANG_, state, join_room_BANG_, save_to_storage_BANG_, hex__GT_rgb, on_keydown, room_channel_name, canvas_ref, default_events, get_persisted_state, ABLY_API_KEY, set_all_colors_BANG_, prompt_join_room_BANG_, generate_state_id, handle_room_message, presence_indicator, canvas__GT_normalized, initial_saved_states, point_hit_test, on_mouse_up, PADDING, SAVED_STATES_KEY, copy_room_code_BANG_, delete_saved_state_BANG_, save_current_state_BANG_, normalized_to_date, saved_state_card, copy_dml_BANG_, update_room_presence_count_BANG_ }\n"
  ],
  "mappings": "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",
  "debugId": "174AF4DA8A15CA7F64756E2164756E21",
  "names": []
}